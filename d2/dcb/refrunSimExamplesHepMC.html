<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Example reading HepMC events</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/dcb/refrunSimExamplesHepMC.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example reading HepMC events</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here are pointers on how to use <code>GeneratorHepMC</code> selected by the option <code>-g hepmc</code> for <code>o2-sim</code>.</p>
<p>HepMC event structures can be read from any file format supported by HepMC it self (see <a href="http://hepmc.web.cern.ch/hepmc/group__IO.html">here</a> and <a href="http://hepmc.web.cern.ch/hepmc/group__factory.html">here</a>.</p>
<h2>Reading HepMC files</h2>
<p>The generator <code>GeneratorHepMC</code> can read events from a <a href="http://hepmc.web.cern.ch/hepmc/">HepMC(3)</a> formatted file. These files can be produced by a standalone event generator program (EG). Examples of such programs are</p>
<ul>
<li><a href="https://pythia.org">Pythia8</a></li>
<li>The <a href="https://gitlab.iap.kit.edu/AirShowerPhysics/crmc">CRMC</a> suite</li>
<li><a href="https://herwig.hepforge.org/">Herwig</a></li>
<li><a href="https://smash-transport.github.io/">SMASH</a></li>
<li>... and many others</li>
</ul>
<p>Please refer to the documentation of these for more on how to make event files in the HepMC format.</p>
<p>To make a simulation reading from the file <code>events.hepmc</code>, do </p><pre class="fragment">o2-sim -g hepmc --configKeyValues "GeneratorFileOrCmd.fileNames=events.hepmc" ...
</pre><p> See also <a href="../../read.sh"><code>read.sh</code></a>.</p>
<h2>Reading HepMC events from child process</h2>
<p><code>GeneratorHepMC</code> can not only read HepMC events from a file, but can also spawn an child EG to produce events. Suppose we have a program named <code>eg</code> which is some EG that writes HepMC event records to the standard output. Then we can execute a simulation using this external EG by </p><pre class="fragment">o2-sim -g hepmc --configKeyValues "GeneratorFileOrCmd.cmd=eg"
</pre><p> See also <a href="../../child.sh"><code>child.sh</code></a>.</p>
<p>There are some requirements on the program <code>eg</code>:</p>
<ul>
<li>The EG program <em>must</em> be able to write the HepMC event structures to a specified file. The option passed to the program is specified via the key <code>GeneratorFileOrCmd.outputSwitch</code>. This defaults to <code>&gt;</code> which means the EG program is assumed to write the HepMC event structures to standard output, <em>and</em> that nothing else is printed on standard output.</li>
<li>It <em>must</em> accept an option to set the number of events to generate. This is controlled by the configuration key <code>GeneratorFileOrCmd.nEventsSwitch</code> and defaults to <code>-n</code>. Thus, the EG application should accept <code>-n 10</code> to mean that it should generate <code>10</code> events, for example.</li>
<li>The EG application should accept a command line switch to set the random number generator seed. This option is specified via the configuration key <code>GeneratorFileOrCmd.seedSwitch</code> and defaults to <code>-s</code>. Thus, the EG application must accept <code>-s 123456</code> to mean to set the random number seed to <code>123456</code> for example.</li>
<li>The EG application should accept a command line switch to set the maximum impact parameter (in Fermi-metre) sampled. This is set via the configuration key <code>GeneratorFileOrCmd.bMaxSwithc</code> and defaults to <code>-b</code>. Thus, the EG application should take the command line argument <code>-b 10</code> to mean that it should only generate events with an impact parameter between 0fm and 10fm.</li>
</ul>
<p>If a program does not adhere to these requirements, it will often be simple enough to make a small wrapper script that enforce this. For example, <code>crmc</code> will write a lot of information to standard output. We can filter that out via a shell script (<a href="../../crmc.sh"><code>crmc.sh</code></a>) like </p><pre class="fragment">#!/bin/sh
crmc $@ -o hepmc3 -f /dev/stdout | sed -n 's/^\&zwj;(HepMC::\|[EAUWVP] \&zwj;)/\1/p'
</pre><p> The <code>sed</code> command selects lines that begin with <code>HepMC::</code>, or one of single characters <code>E</code> (event), <code><a class="el" href="../../d2/d88/classA.html">A</a></code> (attribute), <code>U</code> (units), <code>W</code> (weight), <code>V</code> (vertex), or <code><a class="el" href="../../dc/dec/structP.html">P</a></code> (particle) followed by a space. This should in most cases be enough to filter out extra stuff written on standard output.</p>
<p>The script above also passes any additional command line options on to <code>crmc</code> via <code>$@</code>. We can utilise this with <code>o2-sim</code> to set options to the CRMC suite. For example, if we want to simulate p-Pb collisions using DpmJET, we can do </p><pre class="fragment">o2-sim -g hepmc --configKeyValues "GeneratorFileOrCmd.cmd=crmc.sh -m 12 -i2212 -I 1002080820"
</pre><h3>Implementation details</h3>
<p>Internally <code>GeneratorHepMC</code></p>
<ol type="1">
<li>creates a unique temporary file name in the working directory,</li>
<li>then creates a FIFO (or named pipe, see <a href="https://en.wikipedia.org/wiki/Named_pipe">Wikipedia</a>),</li>
<li>builds a command line, e.g., <pre class="fragment"> eg options &gt; fifo-name &amp;
</pre></li>
<li>and executes that command line</li>
</ol>
<h2>The configuration keys</h2>
<p>The <code>GeneratorHepMC</code> (and sister generator <code>GeneratorTParticle</code>) allows customisation of the execution via configuration keys passed via <code>--configKeyValues</code></p>
<ul>
<li><code>HepMC.eventsToSkip=number</code> a number events to skip at the beginning of each file read.</li>
<li><p class="startli"><code>HepMC.prune=boolean</code> if true, then prune events of particles that are not</p><ul>
<li>beam particles (status = 4),</li>
<li>decayed (status = 2), nor</li>
<li>final state (status = 1)</li>
</ul>
<p class="startli">This reduces the event size. How much depend on the event generator. Use with caution, as it can potentially corrupt the event structure (though measures are taken to minimise that risk).</p>
<p class="startli">In the future, we may want more granular control of which particles to keep. For example, we could have the keys</p><ul>
<li><code>HepMC.keepStatus=list-of-status-codes</code></li>
<li><code>HepMC.keepPDGs=list-of-pdg-numbers</code></li>
</ul>
</li>
<li><code>HepMC.version</code> - when reading the events from files, this option is no longer needed. The code itself figures out which format version the input file is in. If executing a child process through <code>GeneratorFileOrCmd.cmd</code> and the EG writes out HepMC2 format, then this <em>must</em> be set to <code>2</code>. Otherwise, <a class="el" href="../../dc/dd2/namespaceHepMC3.html">HepMC3</a> is assumed.</li>
<li><code>GeneratorFileOrCmd.fileNames=list</code> a comma separated list of HepMC files to read.</li>
<li><code>GeneratorFileOrCmd.cmd=command line</code> a command line to execute as a background child process. If this is set (not the empty string), then <code>GeneratorFileOrCmd.fileNames</code> is ignored.</li>
<li><a class="el" href="../../d2/d88/classA.html">A</a> number of keys that specifies the command line option switch that the child program accepts for certain things. If any of these are set to the empty string, then that switch and corresponding option value is not passed to the child program.<ul>
<li><code>GeneratorFileOrCmd.outputSwitch=switch</code> (default <code>&gt;</code>) to specify output file. The default of <code>&gt;</code> assumes that the program write HepMC events, and <em>only</em> those, to standard output.</li>
<li><code>GeneratorFileOrCmd.seedSwitch=switch</code> (default <code>-s</code>) to specify the random number generator seed. The value passed is selected by the <code>o2-sim</code> option <code>--seed</code></li>
<li><code>GeneratorFileOrCmd.bMaxSwitch=switch</code> (default <code>-b</code>) to specify the upper limit on the impact parameters sampled. The value passed is selected by the <code>o2-sim</code> option <code>--bMax</code></li>
<li><code>GeneratorFileOrCmd.nEventsSwitch=switch</code> (default <code>-n</code>) to specify the number of events to generate. The value passed is selected by the <code>o2-sim</code> option <code>--nEvents</code> or (<code>-n</code>)</li>
<li><code>GeneratorFileOrCmd.backgroundSwitch=switch</code> (default <code>&amp;</code>) to specify how the program is put in the background. Typically this should be <code>&amp;</code>, but a program may itself fork to the background.</li>
</ul>
</li>
<li>Some options are deprecated<ul>
<li><code>HepMC.fileName</code> - use <code>GeneratorFileOrCmd.fileNames</code></li>
</ul>
</li>
</ul>
<p>The command line build will now be</p>
<blockquote class="doxtable">
<p>&zwj;<em>commandLine</em> <em>nEventsSwitch</em> <em>nEvents</em> <em>seedSwitch</em> <em>seed</em> <em>bMaxSwitch</em> <em>bMax</em> <em>outputSwitch</em> <em>output</em> <em>backgroundSwitch</em> </p>
</blockquote>
<p>If any of the <code>Switch</code> keys are empty, then the corresponding option is not propagated to the command line. For example, if <em>bMaxSwitch</em> is empty, then the build command line will be</p>
<blockquote class="doxtable">
<p>&zwj;<em>commandLine</em> <em>nEventsSwitch</em> <em>nEvents</em> <em>seedSwitch</em> <em>seed</em> <em>outputSwitch</em> <em>output</em> <em>backgroundSwitch</em> </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d0b/refrun.html">Module &#39;run&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dc9/refrunSimExamples.html">Simulation Examples</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
