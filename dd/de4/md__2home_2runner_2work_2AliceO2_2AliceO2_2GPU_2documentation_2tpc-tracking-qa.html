<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: tpc-tracking-qa</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dd/de4/md__2home_2runner_2work_2AliceO2_2AliceO2_2GPU_2documentation_2tpc-tracking-qa.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">tpc-tracking-qa</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a quick documentation on the TPC Tracking QA for Resolution, Efficiency, and Cluster Attachment based on MC data.</p>
<p>The TPC QA can produce 3 different output types:</p><ul>
<li><em>mergeble</em> histograms: <a class="el" href="../../d2/d88/classA.html">A</a> collection of <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> histograms that can be merged from different inputs. The need to be postprocessed to get meaningful output.</li>
<li><em>postprocessed</em> histograms: Histograms showing the efficiencies, resolutions etc. These histograms can no longer be merged from multiple inputs.</li>
<li><em>layouts</em>: TCanvases with multiple postprocessed histograms arranged in reasonable layouts.</li>
</ul>
<p>The TPC Tracking QA consists of multiple QA subtasks ((de)activated via a bitmask):</p><ul>
<li><em>Efficiency</em> / <em>Clone Rate</em> / <em>Fake Rate</em> (1)</li>
<li><em>Resolution</em> (2)</li>
<li><em>Pulls</em> (4)</li>
<li><em>Cluster Attachment Statistics</em> (8)</li>
<li><em>nClusters and pt distribution</em> (16)</li>
<li><em>Cluster rejection counts</em> (32) (both as aggregate text report and as histogram)</li>
</ul>
<p>The TPC QA can run in 3 different ways:</p><ul>
<li><em>Standalone</em> inside the tracking (o2-tpc-reco-workflow), it will write its output in pdf format to the plots folder in the current directory: supports <em>all subtasks</em> and will always produce the <em>layouts</em> output.</li>
<li>As <em>external source</em> to QC: the QA is running inside the o2-tpc-reco-workflow and ships the histograms to QC via DPL: supports <em>all subtasks</em>, can produce the <em>postprocessed</em> or the <em>layouts</em> output.</li>
<li>As <em>independent</em> QC tasks, operating on DPL input, that can e.g. be read from <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> files: supports <em>subtasks</em> <em>1</em>, <em>2</em>, and <em>4</em>, currently is hardcoded to the <em>mergeable</em> output, but could be made configurable. _(Note: the reason that the independent QC supports fewer subtasks is that the other tasks require internal tracking data structures that are no available a posteriori.)_</li>
</ul>
<p>Remark on the <em>Cluster Rejection count histograms</em> for the <em>online QC</em>:</p><ul>
<li>These are mainly meant for monitoring the TPC compression during data taking without MC information, while most other subtasks rely on MC information.</li>
<li>These are always in the mergeable format, the postprocessing will just forward them.</li>
<li>By default they are disabled and only aggregate text output shows the rejection ratios, they must be enabled explicitly as explained below.</li>
</ul>
<p>Running the TPC QA standalone:</p><ul>
<li>It must be enabled via the configKeyValue GPU_proc.runQA in the o2-tpc-reco-workflow. The QA will run as part of the normal TPC tracking and will have access to all data structures of the tracking. Otherwise, the normal settings for the o2-tpc-reco-workflow apply.</li>
<li>Example to run on digits: {code}o2-tpc-reco-workflow -b &ndash;infile tpcdigits.root &ndash;configKeyValues "GPU_proc.runQA=1;" &ndash;output-type clusters,tracks{code}</li>
<li>Example to run on clusters: {code}o2-tpc-reco-workflow &ndash;input-type clusters &ndash;infile tpc-native-clusters.root &ndash;output-type tracks &ndash;configKeyValues "GPU_proc.runQA=1"{code}</li>
</ul>
<p>Running the TPC QA inside the o2-tpc-reco-workflow as external source for qc:</p><ul>
<li>As in the standalone mode, the TPC Tracking QA will run as part of the o2-tpc-reco-workflow with full access to the tracking data structures.</li>
<li>The output is shipped to QC as external qc-input in the form of <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> histograms, which disables some subtasks that do not produce <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> histograms (such as the cluster counts (32)).</li>
<li><a class="el" href="../../d2/d88/classA.html">A</a> merged workflow of the o2-tpc-reco-workflow and qc must be configures, such as: {code}o2-tpc-reco-workflow &ndash;input-type clusters &ndash;infile tpc-native-clusters.root &ndash;output-type tracks,qa | o2-qc &ndash;config json:/${QUALITYCONTROL_ROOT}/etc/tpcQCTrackingFromExternal_direct.json{code} (Note that by default, the output will be uploaded and visible at <a href="https://qcg-test.cern.ch/">https://qcg-test.cern.ch/</a>)</li>
<li>By default, this will create postprocessed histograms, and it can be switched via configKeyValues to layouts output via: {code}o2-tpc-reco-workflow &ndash;input-type clusters &ndash;infile tpc-native-clusters.root &ndash;output-type tracks,qa &ndash;configKeyValues "GPU_QA.shipToQCAsCanvas=true" | o2-qc &ndash;config json:/${QUALITYCONTROL_ROOT}/etc/tpcQCTrackingFromExternal_direct.json{code}</li>
<li>This mode can be combined with the standalone QA mode.</li>
<li>Running the <em>online cluster rejection histogram QA</em>: ** This mode works also without MC information, it must be enabled explicitly. Irrespective of the output mode, it will always furnish the same mergeable histograms, since there is no postprocessing. An example to run them on <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> files: {code}o2-tpc-reco-workflow &ndash;input-type clusters &ndash;infile tpc-native-clusters.root &ndash;output-type tracks,qa &ndash;disable-mc &ndash;configKeyValues "GPU_QA.clusterRejectionHistograms=1" | o2-qc &ndash;config json:/${QUALITYCONTROL_ROOT}/etc/tpcQCTrackingFromExternal_direct.json{code} ** In order to set the x-axis scale (number of clusters), use the configKeyValue GPU_QA.histMaxNClusters.</li>
</ul>
<p>Running the QA as independent QC task:</p><ul>
<li>In this mode, the QA runs independently from the o2-tpc-reco-workflow, getting clusters, tracks, and MC labels via DPL.</li>
<li>The example below uses the track reader and the reco workflow to fetch the input and ship them via DPL, but the inputs can of course also come from other sources.</li>
<li>This mode is mostly foreseen for the mergeble output. In this way, many instance can run in parallel and the output can be merged before being postprocessed.</li>
<li>Currently, the mergeble output is hardcoded, but the task could easily be extended for other outputs (see below).</li>
<li>To run the tasks on <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> file input, you can use the following example: {code}o2-tpc-track-reader | o2-tpc-reco-workflow &ndash;input-type clusters &ndash;infile tpc-native-clusters.root &ndash;output-type disable-writer | o2-qc &ndash;config json:/${QUALITYCONTROL_ROOT}/etc/tpcQCTracking_direct.json{code}</li>
</ul>
<p>Postprocessing the mergeble output:</p><ul>
<li>The <a class="el" href="../../dd/df4/classo2_1_1tpc_1_1qc_1_1Tracking.html">o2::tpc::qc::Tracking</a> class can be used for the postprocessing in a standalone way.</li>
<li>Initialize the class with the settings postprocessOnly = true and outputMode = outputPostprocessed or outputLayout.</li>
<li>Call the postprocess(...) function, passing in std::vectors of the 3 types of <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> histograms (TH1F, TH2F, TH1D) which are used by the QA. Note that the order of the histograms must be the same as obtained in the mergeble output.</li>
<li>Depending on the outputMode setting, the class will fill the out object witl either the postprocessed histograms or the canvas layouts.</li>
</ul>
<p>The following classes in O2 / QC belong to the TPC tracking QA:</p><ul>
<li><a class="el" href="../../d1/dd7/classo2_1_1gpu_1_1GPUQA.html">o2::gpu::GPUQA</a> (O2/GPU/GPUTracking/Standalone/qa/GPUQA.cxx): The main QA class, which can produce the standalone output, or can run with external input driven from the <a class="el" href="../../d0/d1c/classo2_1_1gpu_1_1GPUO2InterfaceQA.html">o2::gpu::GPUO2InterfaceQA</a>.</li>
<li><a class="el" href="../../d0/d1c/classo2_1_1gpu_1_1GPUO2InterfaceQA.html">o2::gpu::GPUO2InterfaceQA</a> (<a class="el" href="../../d2/df5/GPUO2InterfaceQA_8cxx.html">O2/GPU/GPUTracking/Interface/GPUO2InterfaceQA.cxx</a>): Internal interface class, uses <a class="el" href="../../d1/dd7/classo2_1_1gpu_1_1GPUQA.html">o2::gpu::GPUQA</a>.</li>
<li><a class="el" href="../../dd/df4/classo2_1_1tpc_1_1qc_1_1Tracking.html">o2::tpc::qc::Tracking</a> (<a class="el" href="../../df/d48/TPC_2qc_2src_2Tracking_8cxx.html">O2/Detectors/TPC/qc/src/Tracking.cxx</a>): The main QC class for running the TPC QA independent from the o2-tpc-reco-workflow, uses <a class="el" href="../../d0/d1c/classo2_1_1gpu_1_1GPUO2InterfaceQA.html">o2::gpu::GPUO2InterfaceQA</a>. ** Can produce all output types from tracks / clusters as input. ** Can produce postprocessed / layout output from mergeble input. ** Is limited to subtasks that do not require access to the internal tracking data structures.</li>
<li>o2::quality_control_modules::tpc::Tracking (QC/Modules/TPC/src/Tracking.cxx): Mostly a QC wrapper for <a class="el" href="../../dd/df4/classo2_1_1tpc_1_1qc_1_1Tracking.html">o2::tpc::qc::Tracking</a>, with the necessary framework code to receive clusters / tracks / MC labels via DPL.</li>
</ul>
<p>Several additional settings can be configured via configKeyValues as listed in <a href="https://github.com/AliceO2Group/AliceO2/blob/dev/Detectors/TPC/qc/include/TPCQC/Tracking.h#L44:">https://github.com/AliceO2Group/AliceO2/blob/dev/Detectors/TPC/qc/include/TPCQC/Tracking.h#L44:</a></p><ul>
<li>"GPU_QA.strict=[bool]" Strict QA mode: Only consider resolution of tracks where the fit ended within 5 cm of the reference, and remove outliers. (Default: true)</li>
<li>"GPU_QA.qpt=[float]" Set cut for Q/Pt. (Default: 10.0)</li>
<li>"GPU_QA.recThreshold=[float]" Compute the efficiency including impure tracks with fake contamination. (Default 0.9)</li>
<li>"GPU_QA.maxResX=[float]" Maxmimum X (~radius) for reconstructed track position to take into accound for resolution QA in cm (Default: no limit)</li>
<li>"GPU_QA.nativeFitResolutions=[bool]" Create resolution histograms in the native fit units (sin(phi), tan(lambda), Q/Pt) (Default: false)</li>
<li>"GPU_QA.filterCharge=[int]" Filter for positive (+1) or negative (-1) charge (Default: no filter)</li>
<li>"GPU_QA.filterPID=[int]" Filter for Particle Type (0 Electron, 1 Muon, 2 Pion, 3 Kaon, 4 Proton) (Default: no filter) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
