<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: ALICE-O2 GEANT Simulation of CAD Geometries</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d2b/md__2home_2runner_2work_2AliceO2_2AliceO2_2scripts_2geometry_2simulating__CAD__modules.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ALICE-O2 GEANT Simulation of CAD Geometries</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These are a few notes related to the inclusion of external (CAD-described) detector modules into the O2 simulation framework.</p>
<h1>Description of the Workflow</h1>
<p>In principle, such integration is now possible and requires the following steps:</p>
<ol type="1">
<li>The CAD geometry needs to be exported to STEP format and must contain only the final geometry (no artificial eta-cut elements). Ideally, the geometry should be fully hierarchical with proper solid reuse. The solids should retain their proper surface representation for detailed analysis.</li>
<li><p class="startli"><a class="el" href="../../d2/d88/classA.html">A</a> tool <code>O2-CADtoTGeo.py</code> is provided to convert the STEP geometry into TGeo format. The tool is part of AliceO2 and is based on Python bindings (OCC) for OpenCascade. The tool can be used as follows:</p>
<div class="fragment"><div class="line">python O2-CADtoTGeo.py STEP_FILE --output-folder my_detector -o geom.C --mesh \</div>
<div class="line">                       --mesh-prec 0.2</div>
</div><!-- fragment --><p class="startli">This will create a <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> macro file <code>geom.C</code> containing the geometry description in <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> format, as well as several binary files describing the TGeo solids. The <code>geom.C</code> file can either be used directly in <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> to inspect the geometry or be provided to ALICE-O2 for inclusion in the geometry.</p>
</li>
<li>Introduction of materials/media in the file <code>geom.C</code>. Currently, the file <code>geom.C</code> needs to be patched or edited to properly include <code>TGeoMaterial</code>/<code>TGeoMedium</code> definitions and connect them to the relevant <code>TGeoVolume</code> objects. At present, every solid has the same dummy material attached, which is not realistic. It may be a good idea to create a new file <code>geom_withMaterials.C</code>, which differs from <code>geom.C</code> by the addition of these material definitions.</li>
<li><p class="startli">Once the conversion is complete, the module can be inserted into the O2 geometry via the <code>ExternalModule</code> class. To do so, follow this pattern in <code>build_geometry.C</code>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (isActivated(<span class="stringliteral">&quot;EXT&quot;</span>)) {</div>
<div class="line">  <a class="code hl_struct" href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html">o2::passive::ExternalModuleOptions</a> options;</div>
<div class="line">  options.<a class="code hl_variable" href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#a39d5c96574a89729c0293b06300220aa">root_macro_file</a> = <span class="stringliteral">&quot;PATH_TO_MY_DETECTOR/my_detector/geom_withMaterials.C&quot;</span>;</div>
<div class="line">  options.<a class="code hl_variable" href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#aba4bdd89e29c90437c1bf22d15bf1ff1">anchor_volume</a> = <span class="stringliteral">&quot;barrel&quot;</span>; <span class="comment">// hook this into barrel</span></div>
<div class="line">  <span class="keyword">auto</span> rot = <span class="keyword">new</span> TGeoCombiTrans();</div>
<div class="line">  rot-&gt;RotateX(90);</div>
<div class="line">  rot-&gt;SetDy(30); <span class="comment">// compensate for a shift of the barrel with respect to zero</span></div>
<div class="line">  options.<a class="code hl_variable" href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#a3c0408ec88f9d55b3a99d6ebf40a0bec">placement</a> = rot;</div>
<div class="line">  run-&gt;AddModule(<span class="keyword">new</span> <a class="code hl_class" href="../../df/de3/classo2_1_1passive_1_1ExternalModule.html">o2::passive::ExternalModule</a>(<span class="stringliteral">&quot;A3VTX&quot;</span>, <span class="stringliteral">&quot;ALICE3 beam pipe&quot;</span>, options));</div>
<div class="line">}</div>
<div class="ttc" id="aclasso2_1_1passive_1_1ExternalModule_html"><div class="ttname"><a href="../../df/de3/classo2_1_1passive_1_1ExternalModule.html">o2::passive::ExternalModule</a></div><div class="ttdef"><b>Definition</b> <a href="../../d7/d2e/ExternalModule_8h_source.html#l00035">ExternalModule.h:36</a></div></div>
<div class="ttc" id="astructo2_1_1passive_1_1ExternalModuleOptions_html"><div class="ttname"><a href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html">o2::passive::ExternalModuleOptions</a></div><div class="ttdef"><b>Definition</b> <a href="../../d7/d2e/ExternalModule_8h_source.html#l00027">ExternalModule.h:27</a></div></div>
<div class="ttc" id="astructo2_1_1passive_1_1ExternalModuleOptions_html_a39d5c96574a89729c0293b06300220aa"><div class="ttname"><a href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#a39d5c96574a89729c0293b06300220aa">o2::passive::ExternalModuleOptions::root_macro_file</a></div><div class="ttdeci">std::string root_macro_file</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d2e/ExternalModule_8h_source.html#l00028">ExternalModule.h:28</a></div></div>
<div class="ttc" id="astructo2_1_1passive_1_1ExternalModuleOptions_html_a3c0408ec88f9d55b3a99d6ebf40a0bec"><div class="ttname"><a href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#a3c0408ec88f9d55b3a99d6ebf40a0bec">o2::passive::ExternalModuleOptions::placement</a></div><div class="ttdeci">TGeoMatrix const  * placement</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d2e/ExternalModule_8h_source.html#l00031">ExternalModule.h:31</a></div></div>
<div class="ttc" id="astructo2_1_1passive_1_1ExternalModuleOptions_html_aba4bdd89e29c90437c1bf22d15bf1ff1"><div class="ttname"><a href="../../da/d39/structo2_1_1passive_1_1ExternalModuleOptions.html#aba4bdd89e29c90437c1bf22d15bf1ff1">o2::passive::ExternalModuleOptions::anchor_volume</a></div><div class="ttdeci">std::string anchor_volume</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d2e/ExternalModule_8h_source.html#l00030">ExternalModule.h:30</a></div></div>
</div><!-- fragment --></li>
<li><p class="startli">Create a custom detector geometry list file <code>my_det.json</code> in JSON format that includes the external detector (and any other required components, such as the L3 magnet in this example):</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;MY_DET&quot;: [</div>
<div class="line">    &quot;EXT&quot;,</div>
<div class="line">    &quot;MAG&quot;</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli">Run the Geant simulation with:</p>
<div class="fragment"><div class="line">o2-sim --detectorList MY_DET:my_det.json -g pythia8pp ....</div>
</div><!-- fragment --></li>
</ol>
<h1>Known Limitations</h1>
<ul>
<li>The <code>O2-CADtoTGeo.py</code> tool currently converts geometries only into TGeoTessellated solids. This may be suboptimal for primitive shapes or only an approximation for shapes with exact second-order surfaces (e.g., tubes). The precision (and therefore the number of surface triangles) can be controlled with the <code>--mesh-prec</code> parameter. The smaller the value, the more precise the mesh.</li>
<li>Meshed solids created by the tool may have issues, such as topological errors or non-watertight surfaces. It is planned to include "healing" steps via additional processing with well-known geometry kernels (e.g., CGAL).</li>
<li>The tool does not currently export materials or TGeoMedia. These must be inserted or edited manually. It is planned to make this process more automatic and user-friendly.</li>
<li>The Python tool requires the OCC Python module, which is currently not part of our software distribution. We have found it most practical to run the tool in a separate conda environment (fully decoupled from the ALICE software stack).</li>
<li>The tool currently generates a <code>geom.C</code> macro file. In the future, it may be possible to directly create an in-memory TGeo representation for deeper integration.</li>
<li>Currently, only passive modules can be integrated. Treatment of sensitive volumes or parts will be addressed in a future step.</li>
</ul>
<h1>Software Installation</h1>
<ul>
<li>The simulation must be run in the standard O2 environment built with alibuild.</li>
<li>The CAD conversion tool must currently be run in a dedicated conda environment, as described in <a class="el" href="../../de/db4/scripts_2geometry_2README_8md.html">scripts/geometry/README.md</a> in the AliceO2 source code. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Feb 21 2026 17:59:16 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
