<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: TRD Reconstruction</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d2f/refDetectorsTRDreconstruction.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TRD Reconstruction</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>TRD Reconstruction</h1>
<h2>Introduction</h2>
<p>12 FLPs are receiving the data from the TRD detector. Each FLP is equipped with 3 CRUs. In total we thus have 36 CRUs. The CRUs pack the data into the O2 raw data format. This means that Raw Data Headers (RDH) are added to the data stream and the data from each link (one link receives the data from one TRD half-chamber) are aligned to 256 bits. If there is less data for one link then padding words (0xeeeeeeee) are added to keep the alignment. The RDH itself contains the FEE ID. This is something not specific to the TRD. For us the CRU ID can be obtained from it. The FEE ID comprises the sector number, the sector side (A/C-side, this is <em>not</em> the same as half-chamber side) and the endpoint. We have two CRUs connected to one sector. One serves the A-side and the other the C-side. Each CRU furthermore has two end points. In the data stream we receive the data in chunks of single heart beat frames per half-CRU. Currently one time frame is set to contain 128 hear beat frames. Since we have 72 half-CRUs we expect 128 * 72 chunks of data for a single time frame. And each chunk contains the data of 15 links for one HBF. There can be multiple triggers in a single HBF.</p>
<h2>Processing</h2>
<ul>
<li>Currently there is no processing done on the FLPs for the TRD. The <code>o2-trd-datareader</code> workflow parses the data coming from the FLPs.</li>
<li>It is possible to generate simulated raw data with the following workflows:</li>
</ul>
<div class="fragment"><div class="line">o2-sim -n 200 -g pythia8pp --skipModules ZDC</div>
<div class="line">o2-sim-digitizer-workflow -b --onlyDet TRD</div>
<div class="line">o2-trd-trap2raw -o raw/TRD --file-per cru |&amp; tee trdraw.log</div>
</div><!-- fragment --><ul>
<li>Parse raw data :</li>
</ul>
<p>In order to simply read the generated raw data and extract the digits and tracklets you can do the following. Remember to first rename the original digits and tracklets files in order not to overwrite them. This way you can compare afterwards that you in fact read back the same data that you have put in.</p>
<div class="fragment"><div class="line">mv trddigits.root trddigitsOrig.root</div>
<div class="line">mv trdtracklets.root trdtrackletsOrig.root</div>
<div class="line">o2-raw-file-reader-workflow --detect-tf0 --delay 100  --max-tf 0 --input-conf raw/TRD/TRDraw.cfg | o2-trd-datareader  -b | o2-trd-digittracklet-writer --run |&amp; tee trdrec.log</div>
</div><!-- fragment --><h3>Alternative approach</h3>
<p>You will need the datadistribution installed as well which has an O2 dependency.</p>
<div class="fragment"><div class="line">aliBuild build DataDistribution --defaults o2</div>
</div><!-- fragment --><p> Now we are ready to play.</p><ul>
<li>Where to find some raw data.<ul>
<li>Generate some as above, one can keep looping through a set of data if the traversal of your data is too quick for your purposes.</li>
<li>Pulling taken data from EOS (14 December 2020(testpattern) and January 2021(test pattern)). [link instructions of eos access]</li>
</ul>
</li>
<li>MC to raw<ul>
<li>pipe the simulated raw data through the rawreader and onto where ever you want to use it. <div class="fragment"><div class="line">o2-raw-file-reader-workflow --input-conf TRDraw.cfg | o2-trd-datareader --trd-datareader-disablebyteswapdata</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Bits and pieces required.<ul>
<li>Data input (StfBuilder)</li>
<li>Data processing (a pipeline of pre compressor, compressor, and post compressor)</li>
<li>Data output (StfSender)</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">StfBuilder  --id stfb --session default --transport shmem --detector TRD --detector-rdh 6 --dpl-channel-name dpl-chan --channel-config &quot;name=dpl-chan,type=push,method=bind,address=ipc:///tmp/stfb-to-dpl,transport=shmem,rateLogging=1&quot; --data-source-enable --data-source-dir /path/to/data --data-source-rate=44</div>
</div><!-- fragment --><div class="fragment"><div class="line">o2-dpl-raw-proxy --session default -b --dataspec &quot;A:TRD/RAWDATA&quot; --channel-config &quot;name=readout-proxy,type=pull,method=connect,address=ipc:///tmp/stfb-to-dpl,transport=shmem,rateLogging=1&quot; | o2-trd-crucompressor --session default -b | o2-dpl-output-proxy --session default -b --dataspec &quot;downstream:TRD/RAWDATA&quot; --channel-config &quot;name=downstream,type=push,method=bind,address=ipc:///tmp/dpl-to-stfs,rateLogging=1,transport=shmem&quot;</div>
</div><!-- fragment --><div class="fragment"><div class="line">StfSender --id stfs --session default --transport shmem --stand-alone --input-channel-name=from-dpl --channel-config &quot;name=from-dpl,type=pull,method=connect,address=ipc:///tmp/dpl-to-stfs,rateLogging=1,transport=shmem&quot;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d3/d5c/refDetectorsTRD.html">TRD</a></li>
    <li class="footer">Generated on Sat Feb 21 2026 17:59:16 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
