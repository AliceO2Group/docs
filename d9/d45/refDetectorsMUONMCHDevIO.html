<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: DevIO</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d45/refDetectorsMUONMCHDevIO.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DevIO</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>I/O tools for reading and writing MCH data in custom formats</h1>
<p>This is mostly for debug and/or usage with Run2 (converted) data.</p>
<ul>
<li>Digit I/O<ul>
<li>Digit sampler</li>
<li>Digit sink</li>
<li>Digit ID converter (from Run2 to Run3)</li>
<li>Digit random generator</li>
<li>Digit file dumper</li>
</ul>
</li>
<li>Precluster I/O<ul>
<li>Precluster sink</li>
</ul>
</li>
<li>Cluster I/O<ul>
<li>Cluster sampler</li>
<li>Cluster sink</li>
</ul>
</li>
<li>Track I/O<ul>
<li>Track sampler</li>
<li>Track sink</li>
</ul>
</li>
</ul>
<h2>Digit I/O</h2>
<p>The MCH digits can be stored in binary format for debug purpose.</p>
<p>The file they are stored in can currently be of two different formats : with or without associated ROFRecord. In both cases the digits themselves (currently) have the same version (named D0). The file version number changes whenever the file structure changes or the format of the objects it contain changes.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">File version   </th><th class="markdownTableHeadCenter">Digit version   </th><th class="markdownTableHeadCenter">contains ROF   </th><th class="markdownTableHeadCenter">ROF version   </th><th class="markdownTableHeadCenter">support    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">no   </td><td class="markdownTableBodyCenter">(0)   </td><td class="markdownTableBodyCenter">yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">yes   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">2   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">yes   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">planned    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">X   </td><td class="markdownTableBodyCenter">X   </td><td class="markdownTableBodyCenter">yes   </td><td class="markdownTableBodyCenter">X   </td><td class="markdownTableBodyCenter">xxxxxxx   </td></tr>
</table>
<h3>Digit sampler</h3>
<p>Reads a binary file containing digits. The binary format should be embedded in the file directly. If the reader cannot identify the format it will assume it is the <a class="el" href="../../df/d0e/structV0.html">V0</a> version, which might or not might be the case...</p>
<div class="fragment"><div class="line">o2-mch-digits-sampler-workflow</div>
<div class="line">  --infile arg       input file name</div>
<div class="line">  [--max-nof-tfs]    max number of timeframes to process</div>
<div class="line">  [--first-tf]       first timeframe to process</div>
<div class="line">  [--max-nof-rofs]   max number of ROFs to process</div>
<div class="line">  [--repack-rofs]    number of rofs to repack into a timeframe</div>
<div class="line">                     (aka min number of rofs per timeframe)</div>
<div class="line">  [--print-digits]   print digits</div>
<div class="line">  [--print-tfs]      print number of digits and rofs per tf</div>
</div><!-- fragment --><h3>Digit sink</h3>
<div class="fragment"><div class="line">o2-mch-digits-sink-workflow</div>
<div class="line">  [--outfile] arg (=digits.out)       output file name</div>
<div class="line">  [--max-nof-tfs] arg (=2147483647)   max number of timeframes to process</div>
<div class="line">  [--first-tf] arg (=0)               first timeframe to process</div>
<div class="line">  [--no-file]                         no output to file</div>
<div class="line">  [--binary-file-format] arg (=v1)    digit binary format to use</div>
<div class="line">  [--print-digits]                    print digits</div>
<div class="line">  [--print-tfs]                       print number of digits and rofs per tf</div>
<div class="line">  [--txt]                             output digits in text format</div>
<div class="line">  [--max-size] arg (=2147483647)      max output size (in KB)</div>
</div><!-- fragment --><p>Take as input a list of digits in timeframes (and optionally their associated Orbits) and dump them into a file (binary or text if <code>--txt</code> option is used) or to screen (if <code>--no-file</code> option is used)</p>
<h3>Digit ID converter (from Run2 to Run3)</h3>
<div class="fragment"><div class="line">o2-mch-digits-r23-workflow</div>
<div class="line">  [--verbose]        print ids being converted</div>
</div><!-- fragment --><p><a class="el" href="../../d2/d88/classA.html">A</a> device that reads digits with ids in Run2 convention and outputs digits with ids in Run3 convention. Note that expected input spec is <code>MCH/DIGITSRUN2</code> and the output one is <code>MCH/DIGITS</code></p>
<h3>Digit random generator</h3>
<div class="fragment"><div class="line">o2-mch-digits-random-generator-workflow</div>
<div class="line">  [--first-tf] arg (=0)               first timeframe to generate</div>
<div class="line">  [--max-nof-tfs] arg (=2147483647)   max number of timeframes to generate</div>
<div class="line">  [--nof-rofs-per-tf]                 number of ROFs to generate in each timeframe</div>
<div class="line">  [--occupancy]                       fraction of pads to generate digits for</div>
<div class="line">  [--print-digits]                    print digits</div>
<div class="line">  [--print-tfs]                       print number of digits and rofs per tf</div>
</div><!-- fragment --><p>Generate a fixed number of digits (equal to the total number of MCH pads times the occupancy) per ROFRecord for a fixed number of ROFRecord per time frames, for a fixed number of timeframes.</p>
<p>Note that the occupancy <b>must</b> be strictly positive and less than or equal to 1.</p>
<p>Example of use : generate digits (with 1% occupancy, 128 ROFs per <a class="el" href="../../d5/d14/structTF.html">TF</a>, 10 TFs) and dump them into debug binary form :</p>
<div class="fragment"><div class="line">o2-mch-digits-random-generator-workflow -b</div>
<div class="line">  --max-nof-tfs 10</div>
<div class="line">  --nof-rofs-per-tf 128</div>
<div class="line">  --occupancy 0.01 |</div>
<div class="line">o2-mch-digits-writer-workflow -b</div>
<div class="line">  --print-tfs</div>
<div class="line">  --binary-file-format 1</div>
<div class="line">  --outfile digits.v1.out</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ ls -alrth digits.v1.out</div>
<div class="line">-rw-r--r--  1 laurent  staff   258M 15 avr 10:30 digits.v1.out</div>
<div class="line"> </div>
<div class="line">$ o2-mch-digits-file-dumper --infile digits.v1.out -c -d</div>
<div class="line">[ file version 1 digit version 0 size 20 rof version 1 size 16 hasRof true run2ids false ] formatWord 1224998065220435759</div>
<div class="line">nTFs 10 nROFs 1280 nDigits 13506560</div>
</div><!-- fragment --><p>The generated digit file can then be injected into other workflows using <code>o2-mch-digits-file-reader-workflow</code> described above. (digits do not <em>need</em> to be written to disc, the <code>o2-mch-digits-random-generator-workflow</code> can of course also be used as the first stage of a multi device workflow using pipes).</p>
<h3>Digit file dumper</h3>
<p>The digit file dumper is not, in contrast to all the program above, a DPL worfklow, but a "regular" simple program, that dumps digit information on screen.</p>
<div class="fragment"><div class="line">o2-mch-digits-dumper</div>
<div class="line">options:</div>
<div class="line">  -h [ --help ]          produce help message</div>
<div class="line">  -i [ --infile ] arg    input file name</div>
<div class="line">  -c [ --count ]         count items (rofs, tfs, etc...)</div>
<div class="line">  -d [ --describe ]      describe file format</div>
<div class="line">  -p [ --print-digits ]  print digits</div>
<div class="line">  -t [ --print-tfs ]     print number of digits and rofs per tf</div>
<div class="line">  --max-nof-tfs arg      max number of timeframes to process</div>
<div class="line">  --first-tf arg         first timeframe to process</div>
</div><!-- fragment --><h2>Precluster I/O</h2>
<h3>Precluster sink</h3>
<div class="fragment"><div class="line">o2-mch-preclusters-sink-workflow --outfile &quot;preclusters.out&quot;</div>
</div><!-- fragment --><p>Take as input the list of all preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>) in the current time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the preclusters associated to each interaction, with the data description "PRECLUSTERS", "PRECLUSTERDIGITS" and "PRECLUSTERROFS", respectively, and write them event-by-event in the binary file <code>preclusters.out</code> with the following format for each event:</p>
<ul>
<li>number of preclusters (int)</li>
<li>number of associated digits (int)</li>
<li>list of preclusters (<a href="../../../Base/include/MCHBase/PreCluster.h">PreCluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)</li>
</ul>
<p>Option <code>--txt</code> allows to write the preclusters in the output file in text format.</p>
<p>Option <code>--useRun2DigitUID</code> allows to convert the run3 pad ID stored in the digit data member mPadID into a digit UID in run2 format.</p>
<h2>Cluster I/O</h2>
<h3>Cluster sampler</h3>
<div class="fragment"><div class="line">o2-mch-clusters-sampler-workflow --infile &quot;clusters.in&quot; [--global]</div>
</div><!-- fragment --><p>where <code>clusters.in</code> is a binary file containing for each event:</p>
<ul>
<li>number of clusters (int)</li>
<li>number of associated digits (int)</li>
<li>list of clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>)</li>
</ul>
<p>Send the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "CLUSTERS" (or "GLOBALCLUSTERS" if <code>--global</code> option is used), the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS", and the list of digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) associated to clusters, with the data description "CLUSTERDIGITS".</p>
<p>Option <code>--nEventsPerTF xxx</code> allows to set the number of events (i.e. ROF records) to send per time frame (default = 1).</p>
<p>Option <code>--no-digits</code> allows to do not send the associated digits.</p>
<h3>Cluster sink</h3>
<div class="fragment"><div class="line">o2-mch-clusters-sink-workflow --outfile &quot;clusters.out&quot; [--txt] [--no-digits] [--global]</div>
</div><!-- fragment --><p>Take as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, the list of all associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>), unless <code>--no-digits</code> option is used, and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERS" (or "GLOBALCLUSTERS" if <code>--global</code> option is used), "CLUSTERDIGITS" and "CLUSTERROFS", respectively, and write them event-by-event in the binary file <code>clusters.out</code> with the following format for each event:</p>
<ul>
<li>number of clusters (int)</li>
<li>number of associated digits (int) (= 0 if <code>--no-digits</code> is used)</li>
<li>list of clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
<li>list of associated digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) (unless option <code>--no-digits</code> is used)</li>
</ul>
<p>Option <code>--txt</code> allows to write the clusters in the output file in text format.</p>
<p>Option <code>--useRun2DigitUID</code> allows to convert the run3 pad ID stored in the digit data member mPadID into a digit UID in run2 format.</p>
<h2>Track I/O</h2>
<h3>Track sampler</h3>
<div class="fragment"><div class="line">o2-mch-tracks-sampler-workflow --infile &quot;tracks.in&quot;</div>
</div><!-- fragment --><p>where <code>tracks.in</code> is a binary file with the same format as the one written by the workflow o2-mch-tracks-sink-workflow</p>
<p>Send the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the current time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction in three separate messages with the data description "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively.</p>
<p>Option <code>--forTrackFitter</code> allows to send the messages with the data description "TRACKSIN", "TRACKCLUSTERSIN" and TRACKROFSIN, respectively, as expected by the workflow o2-mch-tracks-to-tracks-workflow.</p>
<p>Option <code>--nEventsPerTF xxx</code> allows to set the number of events (i.e. ROF records) to send per time frame (default = 1).</p>
<h3>Track sink</h3>
<div class="fragment"><div class="line">o2-mch-tracks-sink-workflow --outfile &quot;tracks.out&quot;</div>
</div><!-- fragment --><p>Take as input the list of all tracks at vertex (TrackAtVtxStruct) in the current time frame, the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>), the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the MCH tracks associated to each interaction, with the data description "TRACKSATVERTEX", "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively, and write them event-by-event in the binary file <code>tracks.out</code> with the following format for each event:</p>
<ul>
<li>number of tracks at vertex (int)</li>
<li>number of MCH tracks (int)</li>
<li>number of associated clusters (int)</li>
<li>list of tracks at vertex (TrackAtVtxStruct)</li>
<li>list of MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>)</li>
<li>list of associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>)</li>
</ul>
<p>Option <code>--tracksAtVertexOnly</code> allows to take as input and write only the tracks at vertex (number of MCH tracks and number of associated clusters = 0).</p>
<p>Option <code>--mchTracksOnly</code> allows to take as input and write only the MCH tracks and associated clusters (number of tracks at vertex = 0). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dff/refDetectorsMUON.html">MUON</a></li><li class="navelem"><a class="el" href="../../d0/daf/refDetectorsMUONMCH.html">MCH</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
