<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: TRD Particle Identification</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d18/refDetectorsTRDpid.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TRD Particle Identification</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Particle Identification with TRD</h1>
<h2>Usage</h2>
<p>Activate PID during tracking with the '&ndash;with-pid' flag. </p><pre class="fragment">o2-trd-global-tracking --with-pid --policy ML
</pre><p> Specify a which algorithm (called policy) should be use. Implemented are the following: </p><pre class="fragment">- LQ1D
- LQ2D
- LQ3D
- ML (every model, which is exported to the ONNX format):
    - XGB (XGBoost model)
    - NN (Pytorch model)
- Dummy (returns only -1)
- Test (one of the above)
- Default (one of the above, gets picked if '--policy' is unspecified)
</pre> <h2>Implementation details</h2>
<h3>Tracking workflow</h3>
<p>Every TRDTrack gets a PID value set (mSignal), which then gets propergated to the AO2D writer.</p>
<h3>Basic Interface</h3>
<p>The base interface for PID is defined in <a href="../../include/TRDPID/PIDBase.h">here</a>. The 'init' function is such that each policy can specify what if anything it needs from the CCDB. For the 'process' each policy defines how a TRDTrack gets assigned a PID value. Additionally, the base class implements how to get the <em>corrected charges</em> from the tracklets. <em>Corrected charges</em> means z-row merged and calibrated charges.</p>
<h3>Classical Likelihood</h3>
<p>The classical LQND policies (<a href="../../include/TRDPID/LQND.h">here</a>) require an array of lookup tables (LUTs) from the ccdb. $N$ stands for the dimension. Then the electron likelihood for layer $i$ is defined as this:</p>
<p>$$L_i(e|Q_i)=\frac{<a class="el" href="../../dc/dec/structP.html">P</a>(Q_i|e)}{<a class="el" href="../../dc/dec/structP.html">P</a>(Q_i|e)+<a class="el" href="../../dc/dec/structP.html">P</a>(Q_i|\pi)}$$</p>
<p>From the charge $Q_i$ the LUTs give the corresponding $L_i$. The <em>combined electron likelihood</em> is obtained by this formula:</p>
<p>$$L(e|Q)=\frac{\prod_i L_i(e|Q_i)}{\prod_i L_i(e|Q_i) + \prod_i L_i(\pi|Q_i)}$$</p>
<p>where $L_i(\pi|Q_i)=1-L_i(e|Q_i)$.</p>
<p>Extension to higher dimensions is easy each tracklet has charges $Q_j$ which cover the integral of the pulse height spectrum in different slice ($j\in [0,1,2]$). In our case $Q0$ covers the pulse height peak, $Q1$ the Transition Radiation peak and $Q2$ the plateau. For each charge $j$ a <a class="el" href="../../d1/d4f/classLUT.html">LUT</a> is available which gives the likelihood $L^e_j$. For each layer $i$ the likelihood is then:</p>
<p>$$L_i(e|Q)=\frac{\prod_j L_{i,j}(e|Q_j)}{\prod_j L_{i,j}(e|Q_j) + \prod_j L_{i,j}(\pi|Q_j)}$$</p>
<p>The combined electron likelihood is then:</p>
<p>$$L(e|Q)=\frac{\prod_{i,j} L_{i,j}(e|Q_j)}{\prod_{i,j} L_{i,j}(e|Q_j) + \prod_{i,j} L_{i,j}(\pi|Q_j)}$$</p>
<h3>Machine Learning</h3>
<p>The ML policies (<a href="../../include/TRDPID/ML.h">here</a>) are uploaded to the CCDB in the ONNX file format (most python machine learning libraries support this standardized format). In O2 we leverage the ONNXRuntime to use these formats and calculate a PID value. The models can thus be trained in python which is very convenient. The code should take care of most of the annoying stuff. Policies just have to specify how to get the electron likelihood from the ONNXRuntime output (each python library varies in that somewhat). The 'prepareModelInput' prepares the TRDTracks as input. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d3/d5c/refDetectorsTRD.html">TRD</a></li>
    <li class="footer">Generated on Sat Feb 21 2026 17:59:16 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
