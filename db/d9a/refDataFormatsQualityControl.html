<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Data Formats Quality Control</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d9a/refDataFormatsQualityControl.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Data Formats Quality Control</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Tagging Good Quality Data for Processing and Analysis</h2>
<p>This document outlines the data formats used for tagging good quality data for further processing and analysis. They allow us to describe problems affecting the data in concrete time intervals. Using this information, data can be filtered out according to criteria specific to a given analysis type.</p>
<h3>Data Quality Control workflow</h3>
<p>Data quality is determined through two methods:</p>
<ol type="1">
<li><b>Automated Checks:</b> The Quality Control framework runs Checks which may return quality Flags.</li>
<li><b>Manual Review:</b> Detector experts review data using the Run Condition Table (RCT) and can modify or add Flags.</li>
</ol>
<p>Both methods utilize the same data format for Flags. During processing (both synchronous and asynchronous), Checks produce Qualities and associate them with Flags. The Quality Control framework then transmits these Flags to the RCT through a gRPC interface (more details in QC repository documentation). Detector experts can then review the automatically generated Flags and make any necessary modifications or additions directly in the RCT.</p>
<h3>Quality Control Flag Structure</h3>
<p><a class="el" href="../../d2/d88/classA.html">A</a> <a href="../../include/DataFormatsQualityControl/QualityControlFlag.h">Quality Control Flag</a> consists of the following elements:</p>
<ul>
<li><b>Flag Type:</b> This identifies the specific issue the flag represents. (More details below)</li>
<li><b>Time Range:</b> This defines the time period affected by the flag.</li>
<li><b>Comment (Optional):</b> This allows human-readable explanations for assigning the flag.</li>
<li><b>Source String:</b> This identifies the entity (person or software module) that created the flag.</li>
</ul>
<p><b>Example:</b></p>
<div class="fragment"><div class="line">flag: Limited Acceptance MC Reproducible</div>
<div class="line">start: 1612707603626</div>
<div class="line">end: 1613999652000</div>
<div class="line">comment: Sector B in TPC inactive</div>
<div class="line">source: TPC/Clusters Check</div>
</div><!-- fragment --><h3>Flag Types</h3>
<p><a href="../../include/DataFormatsQualityControl/FlagType.h">Flag Types</a> define the specific categories of issues represented by flags. Each Flag Type has the following attributes:</p>
<ul>
<li><b>Identifier Number:</b> <a class="el" href="../../d2/d88/classA.html">A</a> unique numerical ID for the Flag Type.</li>
<li><b>Name:</b> <a class="el" href="../../d2/d88/classA.html">A</a> human-readable name describing the issue.</li>
<li>**"Bad Quality" Determinant:** This boolean constant indicates whether the type inherently signifies bad data quality.</li>
</ul>
<h4>Creating and Managing Flag Types</h4>
<ul>
<li><b>FlagTypeFactory</b> ensures a centralized and consistent list of available Flag Types. New Flags can only be created through this factory.</li>
<li><b><a href="../../etc/flagTypes.csv">flagTypes.csv</a></b> defines the existing Flag Types, including their ID, name, and "bad quality" determinant, factory method name and a switch to deprecate a flag. The table serves as the source to automatically generate the corresponding methods in FlagTypeFactory.</li>
<li><b>Adding new Flag Types:</b> If a new issue requires a flag not currently defined, propose the addition by contacting the async QC coordinators. They have the authority to add new Flag Types to the RCT. These changes will then be reflected in the <a href="../../etc/flagTypes.csv">flagTypes.csv</a> file through a pull request. Any proposals for new Flag Types should describe the effects on usability of data from analyzer point of view and they should not be detector-specific unless well-argumented.</li>
<li><b>Modification of existing Flag Types:</b> Existing Flag Types should not be modified in terms of their definition. Instead, one may create a new Flag Type and mark the existing one as obsolete in the CSV table. This will add the <code>[[ deprecated ]]</code> attribute to the corresponding method.</li>
</ul>
<h4>Currently available Flag Types</h4>
<p>This section details the currently available Flag Types and provides a brief explanation of their intended use cases.</p>
<ul>
<li><b>Good:</b> a Check or an expert sees nothing wrong with given time interval, but would like to add a comment. Note that the absence of any flag for a run implies good data quality. Thus, there is no need to mark it explicitly as such by using this flag type.</li>
<li><b>No Detector Data:</b> a complete and unexpected absence of data for a specific detector.</li>
<li><b>Limited Acceptance MC Not Reproducible:</b> a part of a detector did not acquire good data and this condition cannot be reproduced in Monte Carlo. If an automated Check cannot determine MC reproducibility, it should default to "Not Reproducible" for later expert review.</li>
<li><b>Limited Acceptance MC Reproducible:</b> a part of a detector did not acquire good data, but this condition can be reproduced in Monte Carlo.</li>
<li><b>Bad Tracking:</b> analyses relying on accurate track reconstruction should not use this data.</li>
<li><b>Bad PID:</b> analyses relying on correct identification of all kinds of tracked particles should not use this data.</li>
<li><b>Bad Hadron PID:</b> analyses relying on correct hadron identification should not use this data.</li>
<li><b>Bad Electron PID:</b> analyses relying on correct electron identification should not use this data.</li>
<li><b>Bad Photon Calorimetry:</b> analyses relying on correct photon calorimetry should not use this data.</li>
<li><b>Bad EMCalorimetry:</b> analyses relying on correct electromagnetic calorimetry should not use this data.</li>
<li><b>Unknown:</b> the exact impact of an issue on the data is unclear, but it's likely bad. Treat data with this flag with caution until further investigation.</li>
<li><b>Unknown Quality:</b> the quality of data could not be determined definitively.</li>
<li><b>Invalid:</b> there was an issue with processing the flags.</li>
</ul>
<h2>Usage in Analysis framework (plans, wishlist)</h2>
<h2>General idea</h2>
<ul>
<li>RCT exports a read-only copy of the flags for each detector, run and pass combination in the CCDB.</li>
<li>The Analysis framework uses the flags and user selection criteria to provide their Analysis Task with data matching these criteria. <b>Data Tags</b> are the structures defining the good time intervals for the provided criteria.</li>
</ul>
<h2>Notes on plans for Data Tags</h2>
<p>Data Tag definition has:</p><ul>
<li>name</li>
<li>global suppression list for bad flag types (applies to all detectors)</li>
<li>global requirement list for not bad flag types</li>
<li>list of needed detectors,</li>
<li>list of suppression list and requirement list specific to detectors</li>
</ul>
<p>Example configurations </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTrackingLimitedAcceptance&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [&quot;Limited acceptance&quot;, &quot;asdf&quot;],</div>
<div class="line">  &quot;globalRequiredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : [</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot; : &quot;TPC&quot;,</div>
<div class="line">      &quot;ignoredFlags&quot; : [ &quot;Reason X&quot; ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTracking&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [],</div>
<div class="line">  &quot;globalRequiredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : []</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;CentralBarrelTrackingOnlyLimitedAcceptanceinTPC&quot;,</div>
<div class="line">  &quot;globalRequiredDetectors&quot; : [ &quot;TPC&quot;, &quot;ITS&quot; ],</div>
<div class="line">  &quot;globalIgnoredFlags&quot; : [],</div>
<div class="line">  &quot;detectorSpecificFlags&quot; : [</div>
<div class="line">   {</div>
<div class="line">      &quot;name&quot; : &quot;TPC&quot;,</div>
<div class="line">      &quot;requiredFlags&quot; : [ &quot;Limited acceptance&quot; ]</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">]</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d3/dec/refDataFormats.html">Module &#39;DataFormats&#39;</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
