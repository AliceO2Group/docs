<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: TRD calibration</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/dd4/refDetectorsTRDcalibration.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">TRD calibration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>TRD calibration in O2</h1>
<h2>vDrift and ExB calibration</h2>
<p>The drift velocity and ExB angle are calibrated using input from the global tracking, namely ITS-TPC-TRD and TPC-TRD tracks. The latter is currently disabled, but can be enabled to have more statistics easily. From the global tracks we obtain the association of TRD tracklets to tracks. In the calibration procedure a refit is performed to get TRD only tracks and the angular deviations between those TRD tracks and the associated tracklets are stored in histograms (see class TrackBasedCalib). This is done on the EPNs during the reconstruction. The histograms are send to aggregator nodes which calculate for each TRD chamber the drift velocity and ExB angle based on those histograms (see class CalibratorVdExB).</p>
<p>To run the calibration one can start the following workflow: </p><pre class="fragment">o2-trd-global-tracking -b --disable-root-output --enable-trackbased-calib | o2-calibration-trd-workflow --vDriftAndExB -b --calib-vdexb-calibration '--tf-per-slot 5 --max-delay 90000'
</pre><p> For 'o2-calibration-trd-workflow &ndash;vDriftAndExB' there are also the following keyConfig values available: </p><pre class="fragment">TRDCalibParams.
- nTrackletsMin; minimum amount of tracklets in tracks
- chi2RedMax; maximum reduced chi2 acceptable for tracks quality
- minEntriesChamber; minimum number of entries per chamber to fit in a single time slot
- minEntriesTotal; minimum total required for meaningful fits
</pre><p> <em>Hint: You can get information on the meaning of the parameters by running <code>o2-calibration-trd-workflow --vDriftAndExB -b --help full</code></em></p>
<p>If you want to run the calibration from a local file with residuals, trdangreshistos.root, you can run: </p><pre class="fragment">o2-calibration-trd-workflow --vDriftAndExB -b --enable-root-input --calib-vdexb-calibration '--tf-per-slot 1' --configKeyValues "TRDCalibParams.minEntriesChamber=100;TRDCalibParams.minEntriesTotal=50000"
</pre><p> Additionally it is possible to perform the calibrations fit manually per chamber if you have TPC-TRD or ITS-TPC-TRD tracks, you can run: </p><pre class="fragment">o2-trd-global-tracking -b --enable-trackbased-calib
</pre><p> This produces <code>trdangreshistos.root</code> which holds the residuals of the angles and differences. Then run the macro <code>Detectors/TRD/calibration/macros/manualCalibFit.C</code>. This produces a file of similar name with the fitted data and prints out the fit results. This is equivalent to running: </p><pre class="fragment">o2-calibration-trd-workflow --vDriftAndExB -b --enable-root-input '--tf-per-slot 1 --enable-root-output'
</pre><p> You can plot the calibration values for VDrift and ExB for a given Run by using the macro at <code>Detectors/TRD/cailbration/macros/plotVdriftExB.C</code>. This produces a root file of similar name which holds the time-series plots (reference the macro).</p>
<p>It may also be worthwhile to look at the correlation of the deflection and slope of tracks and tracklets since this is good indicator how well the calibration works. For that you can use the macro at <code>Detectors/TRD/calibration/macros/makeDeflectionCorrelation.C</code> and to you have to include the '&ndash;enable-qc' flag. </p><pre class="fragment">o2-trd-global-tracking -b --enable-qc
</pre><p> In the macro you have to point to the right Run and potentially the correct CCDB.</p>
<h2>DCS data points</h2>
<p>To process the DCS data points for the TRD the list of aliases for example "trd_gaschromatographXe" has to be available in the CCDB. This can be achieved with the macro <code>Detectors/TRD/calibration/macros/makeTRDCCDBEntryForDCS.C</code>. The full list of aliases is available in jira (<a href="https://alice.its.cern.ch/jira/browse/TRD-109">https://alice.its.cern.ch/jira/browse/TRD-109</a>). With the list of aliases defined one can run the <code>o2-calibration-trd-dcs-sim-workflow</code> which provides DCS DPs for all possible aliases and sends them on via DPL. Attaching the <code>o2-calibration-trd-dcs-workflow</code> will include the processing of these data points. For testing purposes this is sufficient. In case also the CCDB should be populated the <code>o2-calibration-ccdb-populator-workflow</code> has to be appended. Via the <code>--ccdb-path</code> flag this can also be configured to write to a local CCDB for testing.</p>
<p>So, in order to test the workflow independent of the actual CCDB using a local instance one can do: </p><pre class="fragment">root $O2_ROOT/share/macro/makeTRDCCDBEntryForDCS.C+
o2-calibration-trd-dcs-sim-workflow -b --delta-fraction 0.5 --max-timeframes 10 | o2-calibration-trd-dcs-workflow -b --ccdb-path http://localhost:8080 --use-ccdb-to-configure --processor-verbosity 1 | o2-calibration-ccdb-populator-workflow -b --ccdb-path http://localhost:8080
</pre><p> The macro <code>readTRDDCSentries.C</code> shows an example how to read one of the created CCDB objects after processing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d3/d5c/refDetectorsTRD.html">TRD</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
