<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Example reading TParticle events</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/d7d/refrunSimExamplesTParticle.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example reading TParticle events</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here are pointers on how to use <code>GeneratorTParticle</code> selected by the option <code>-g tparticle</code> for <code>o2-sim</code>.</p>
<h2>Reading TParticle files</h2>
<p>The generator <code>GeneratorTParticle</code> can read events from a <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> file containing a <code>TTree</code> with a branch holding a <code>TClonesArray</code> of <code>TParticle</code> objects. These files can be produced by a standalone event generator program (EG).</p>
<p>To make a simulation reading from the file <code>particles.root</code>, do </p><pre class="fragment">o2-sim -g tparticle --configKeyValues "GeneratorFileOrCmd.fileNames=particles.root"  ...
</pre><p> See also <a href="../../read.sh"><code>read.sh</code></a>. Do </p><pre class="fragment">./read.sh --help
</pre><p> for a list of options. This expects an input file with a <code>TTree</code> with a single <code>TBranch</code> holding a <code>TClonesArray</code> of <code>TParticle</code> objects. One such example file can be made with [<code>myeg.sh</code>]. Do </p><pre class="fragment">./myeg.sh --help
</pre><p> for a list of options.</p>
<h3>Configurations</h3>
<ul>
<li>The name of the <code>TTree</code> to read can be set by the configuration key <code>GeneratorTParticle.treeName</code>. The default is <code>T</code></li>
<li>The name of the <code>TBranch</code> holding the <code>TClonesArray</code> of <code>TParticle</code> objects can be set by the configuration key <code>GeneratorTParticle.branchName</code>. The default is <code>Particles</code></li>
</ul>
<p>For example </p><pre class="fragment">o2-sim -g tparticle --configKeyValues "GeneratorFileOrCmd.fileNames=particles.root;GeneratorTParticle.treeName=Events;GeneratorTParticle.branchName=Tracks"  ...
</pre> <h2>Reading TParticle events from child process</h2>
<p><code>GeneratorTParticle</code> can not only read events from a file, but can also spawn an child EG to produce events. Suppose we have a program named <code>eg</code> which is some EG that writes <code>TParticle</code> event records to a file . Then we can execute a simulation using this external EG by </p><pre class="fragment">o2-sim -g tgenerator --configKeyValues "GeneratorFileOrCmd.cmd=eg"
</pre><p> See also <a href="../../child.sh"><code>child.sh</code></a>. Do </p><pre class="fragment">./child.sh --help
</pre><p> for a list of options.</p>
<p>There are some requirements on the program <code>eg</code>:</p>
<ul>
<li>The EG program <em>must</em> be able to write the HepMC event structures to a specified file. The option passed to the program is specified via the key <code>GeneratorFileOrCmd.outputSwitch</code>. This defaults to <code>-o</code>.</li>
<li>It <em>must</em> accept an option to set the number of events to generate. This is controlled by the configuration key <code>GeneratorFileOrCmd.nEventsSwitch</code> and defaults to <code>-n</code>. Thus, the EG application should accept <code>-n 10</code> to mean that it should generate <code>10</code> events, for example.</li>
<li>The EG application should accept a command line switch to set the random number generator seed. This option is specified via the configuration key <code>GeneratorFileOrCmd.seedSwitch</code> and defaults to <code>-s</code>. Thus, the EG application must accept <code>-s 123456</code> to mean to set the random number seed to <code>123456</code> for example.</li>
<li>The EG application should accept a command line switch to set the maximum impact parameter (in Fermi-metre) sampled. This is set via the configuration key <code>GeneratorFileOrCmd.bMaxSwithc</code> and defaults to <code>-b</code>. Thus, the EG application should take the command line argument <code>-b 10</code> to mean that it should only generate events with an impact parameter between 0fm and 10fm.</li>
</ul>
<p>If a program does not adhere to these requirements, it will often be simple enough to make a small wrapper script that enforce this.</p>
<h3>Configurations</h3>
<p>Same as above.</p>
<h3>Example EG</h3>
<p>The child-process feature allows us to use almost any EG for which we have a <code>TGenerator</code> interface without compiling it in to O2. Suppose we have defined the class <code>MyGenerator</code> to produce events. </p><pre class="fragment">class MyGenerator : public TGenerator {
public:
  MyGenerator();
  void Initialize(Long_t   projectile,
                  Long_t   target,
                  Double_t sqrts);
  void GenerateEvent();
  Int_t ImportParticles(TClonesArray* particles,Option_t*option="");
};
</pre><p> and a steering class </p><pre class="fragment">struct MySteer {
  TGenerator*   generator;
  TFile*        file;
  TTree*        tree;
  TClonesArray* particle;
  Int_t         flushEvery;
  MySteer(TGenerator* generator,
          const TString&amp; output,
          Int_t flushEvery)
    : generator(generator)
      file(TFile::Open(output,"RECREATE")),
      tree("T","Particle tree"),
      particles(new TClonesArray("TParticle")),
      flushEvery(flushEvery)
  {
    tree-&gt;SetDirectory(file);
    tree-&gt;Branch("Particles",&amp;particles);
  }
  ~MySteer() { close(); }
  void event() {
    particles-&gt;Clear();
    generator-&gt;GenerateEvent();
    generator-&gt;ImportParticles(particles);
    tree-&gt;Fill();
  }
  void sync() {
    tree-&gt;AutoSave("SaveSelf FlushBaskets Overwrite");
  }
  void run(Int_t nev) {
     for (Int_t iev = 0; iev &lt; nev; iev++) {
       event();
       if (flushEvery &gt; 0 and (iev % flushEvery == 0) and iev != 0)
         sync();
     }
  }
  void close() {
    if (not file) return;
    file-&gt;Write();
    file-&gt;Close();
    file = nullptr;
  }
};
</pre><p> Then we could make the script <a href="../../MyEG.macro"><code>MyEG.macro</code> (complete code)</a> like </p><pre class="fragment">void MyEG(Int_t nev,const TString&amp; out,Int_t every=1)
{
  MyGenerator* eg = new MyGenerator();
  eg-&gt;Initialize(2212, 2212, 5200);

  MySteer steer(eg, out, every);
  steer.run(nev);
}
</pre><p> and a simple shell-script <a href="../../myeg.sh"><code>myeg.sh</code></a> to pass arguments to the <code>MyEG.macro</code> script </p><pre class="fragment">#!/bin/sh

nev=1
out=particles.root

while test $# -gt 0 ; do
    case $1 in
    -n) nev=$2 ; shift ;;
    -o) out=$2 ; shift ;;
    *) ;;
    esac
    shift
done

root -l MyEG.macro -- $nev \"$out\"
</pre><p> We can then do </p><pre class="fragment">o2-sim -g tgenerator --configKeyValues "GeneratorFileOrCmd.cmd=./myeg.sh"
</pre><p> to produce events with our generator <code>MyGenerator</code>.</p>
<h3>Implementation details</h3>
<p>Internally <code>GeneratorTParticle</code></p>
<ol type="1">
<li>creates a unique temporary file name in the working directory,</li>
<li><p class="startli">builds a command line, e.g.,</p>
<p class="startli">eg options -o temporary-name &amp;</p>
</li>
<li>and executes that command line</li>
</ol>
<h2>The future</h2>
<p>The <code>GeneratorTParticle</code> (and sister generator <code>GeneratorHepMC</code>) is configured through configuration keys set via <code>--configKeyValues</code></p>
<ul>
<li><code>GeneratorTParticle.treeName=name</code> the name of the <code>TTree</code> in the input files.</li>
<li><code>GeneratorTParticle.branchName=name</code> the name of the <code>TBranch</code> in the <code>TTree</code> that holds the <code>TClonesArray</code> of <code>TParticle</code> objects.</li>
<li><code>GeneratorFileOrCmd.fileNames=list</code> a comma separated list of HepMC files to read</li>
<li><code>GeneratorFileOrCmd.cmd=command line</code> a command line to execute as a background child process. If this is set (not the empty string), then <code>GeneratorFileOrCmd.fileNames</code> is ignored.</li>
<li><a class="el" href="../../d2/d88/classA.html">A</a> number of keys that specifies the command line option switch that the child program accepts for certain things. If any of these are set to the empty string or special value <code>none</code>, then that switch and corresponding option value is not passed to the child program.<ul>
<li><code>GeneratorFileOrCmd.outputSwitch=switch</code> (default <code>&gt;</code>) to specify output file. The default of <code>&gt;</code> assumes that the program write events, and <em>only</em> those, to standard output.</li>
<li><code>GeneratorFileOrCmd.seedSwitch=switch</code> (default <code>-s</code>) to specify the random number generator seed. The value passed is selected by the <code>o2-sim</code> option <code>--seed</code>.</li>
<li><code>GeneratorFileOrCmd.bMaxSwitch=switch</code> (default <code>-b</code>) to specify the upper limit on the impact parameters sampled. The value passed is selected by the <code>o2-sim</code> option <code>--bMax</code>.</li>
<li><code>GeneratorFileOrCmd.nEventsSwitch=switch</code> (default <code>-n</code>) to specify the number of events to generate. The value passed is selected by the <code>o2-sim</code> option <code>--nEvents</code> or (<code>-n</code>).</li>
<li><code>GeneratorFileOrCmd.backgroundSwitch=switch</code> (default <code>&amp;</code>) to specify how the program is put in the background. Typically this should be <code>&amp;</code>, but a program may itself fork to the background.</li>
</ul>
</li>
</ul>
<p>The command line build will now be</p>
<blockquote class="doxtable">
<p>&zwj;<em>commandLine</em> <em>nEventsSwitch</em> <em>nEvents</em> <em>seedSwitch</em> <em>seed</em> <em>bMaxSwitch</em> <em>bMax</em> <em>outputSwitch</em> <em>output</em> <em>backgroundSwitch</em> </p>
</blockquote>
<p>If any of the <code>Switch</code> keys are empty or set to <code>none</code>, then the corresponding option is not propagated to the command line. For example, if <em>bMaxSwitch</em> is empty, then the build command line will be</p>
<blockquote class="doxtable">
<p>&zwj;<em>commandLine</em> <em>nEventsSwitch</em> <em>nEvents</em> <em>seedSwitch</em> <em>seed</em> <em>outputSwitch</em> <em>output</em> <em>backgroundSwitch</em> </p>
</blockquote>
<h2>TODO</h2>
<h3><a class="el" href="../../dc/d47/structHeader.html">Header</a> information</h3>
<p>The class <code>GeneratorTParticle</code> will take a key parameter, say <code>headerName</code> which will indicate a branch that contains header information. Under that branch, the class will then search for leaves (<code>TLeaf</code>) that correspond to standard header information keys (see <code><a class="el" href="../../d7/de3/structo2_1_1dataformats_1_1MCInfoKeys.html">o2::dataformats::MCInfoKeys</a></code>). If any of those leaves are present, then the corresponding keys will be set on the generated event header.</p>
<p>Thus, as long as the generator observes the convention used, we can also import auxiliary information (impact parameter, Npart, ...) from the input files in addition to the particle information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d0b/refrun.html">Module &#39;run&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dc9/refrunSimExamples.html">Simulation Examples</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
