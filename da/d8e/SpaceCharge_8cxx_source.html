<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/runner/work/AliceO2/AliceO2/Detectors/TPC/spacecharge/src/SpaceCharge.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d8e/SpaceCharge_8cxx_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">SpaceCharge.cxx</div></div>
</div><!--header-->
<div class="contents">
<a href="../../da/d8e/SpaceCharge_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2019-2020 CERN and copyright holders of ALICE O2.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// See https://alice-o2.web.cern.ch/copyright for details of the copyright holders.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// All rights not expressly granted are reserved.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">//</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">// This software is distributed under the terms of the GNU General Public</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">// License v3 (GPL Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">//</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">// or submit itself to any jurisdiction.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/db6/SpaceCharge_8h.html">TPCSpaceCharge/SpaceCharge.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;fmt/core.h&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/Logger_8h.html">Framework/Logger.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d2a/PoissonSolver_8h.html">TPCSpaceCharge/PoissonSolver.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;TGeoGlobalMagField.h&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="../../db/d5b/ParameterGas_8h.html">TPCBase/ParameterGas.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d47/ParameterElectronics_8h.html">TPCBase/ParameterElectronics.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/MagneticField_8h.html">Field/MagneticField.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d22/TreeStreamRedirector_8h.html">CommonUtils/TreeStreamRedirector.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d81/CalDet_8h.html">TPCBase/CalDet.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/db6/Painter_8h.html">TPCBaseRecSim/Painter.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h.html">MathUtils/Utils.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/dd2/GRPMagField_8h.html">DataFormatsParameters/GRPMagField.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/d53/GPUDebugStreamer_8h.html">GPUDebugStreamer.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d47/ParameterElectronics_8h.html">TPCBase/ParameterElectronics.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/dc6/LHCConstants_8h.html">CommonConstants/LHCConstants.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;TF1.h&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;TH3.h&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;TH2F.h&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;TGraph.h&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;TROOT.h&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;TStopwatch.h&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;ROOT/RDataFrame.hxx&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;THnSparse.h&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;TRandom.h&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#if defined(WITH_OPENMP) || defined(_OPENMP)</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> omp_get_thread_num() { <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> omp_get_max_threads() { <span class="keywordflow">return</span> 1; }</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a021e6e023b83ccdc5f7ff44ec3f61d41">   57</a></span><a class="code hl_function" href="../../da/d8e/SpaceCharge_8cxx.html#a021e6e023b83ccdc5f7ff44ec3f61d41">templateClassImp</a>(<a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge</a>);</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d0a/namespaceo2_1_1tpc.html">o2::tpc</a>;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00062" data-start="{" data-end="}">
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abb8a68f814746a57a81b566bf0c23dc4">   62</a></span><a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac7df75daa4554e43590229be7eb43368">SpaceCharge&lt;DataT&gt;::SpaceCharge</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> bfield, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nZVertices, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nRVertices, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nPhiVertices, <span class="keyword">const</span> <span class="keywordtype">bool</span> initBuffers) : mParamGrid{nRVertices, nZVertices, nPhiVertices}</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>{</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  ROOT::EnableThreadSafety();</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0e5633d230d25b21aafca1ec5f045992">initBField</a>(bfield);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="keywordflow">if</span> (initBuffers) {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    initAllBuffers();</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  }</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>};</div>
</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00072" data-start="{" data-end="}">
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac7df75daa4554e43590229be7eb43368">   72</a></span><a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac7df75daa4554e43590229be7eb43368">SpaceCharge&lt;DataT&gt;::SpaceCharge</a>()</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>{</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>  ROOT::EnableThreadSafety();</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>}</div>
</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::initAllBuffers</a>()</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>{</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#ab2729d1c6becc28660e849f6d60456d2">SIDES</a>; ++iside) {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>::<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">C</a>;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    initContainer(mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    initContainer(mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    initContainer(mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    initContainer(mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    initContainer(mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    initContainer(mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="foldopen" id="foldopen00088" data-start="{" data-end="}">
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abb8a68f814746a57a81b566bf0c23dc4">   88</a></span>    initContainer(mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    initContainer(mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    initContainer(mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="foldopen" id="foldopen00091" data-start="{" data-end="}">
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac7df75daa4554e43590229be7eb43368">   91</a></span>    initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    initContainer(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    initContainer(mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    initContainer(mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>  }</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>}</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00106" data-start="{" data-end="}">
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e763c27749fc15209e03300f0fa01aa">  106</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e763c27749fc15209e03300f0fa01aa">SpaceCharge&lt;DataT&gt;::getOMPMaxThreads</a>()</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>{</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>  <span class="keywordflow">return</span> std::clamp(omp_get_max_threads(), 1, 16);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>}</div>
</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00112" data-start="{" data-end="}">
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">  112</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">SpaceCharge&lt;DataT&gt;::calculateDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> calcVectors)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>{</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  <span class="keyword">using </span>timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  <span class="keyword">using </span><a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SC</a> = <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;</a>;</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  <span class="keywordflow">if</span> (!mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    LOGP(info, <span class="stringliteral">&quot;the charge is not set!&quot;</span>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>  }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sglobalType{<span class="stringliteral">&quot;local distortion/correction interpolator&quot;</span>, <span class="stringliteral">&quot;Electric fields&quot;</span>};</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sglobalDistType{<span class="stringliteral">&quot;Standard method&quot;</span>, <span class="stringliteral">&quot;interpolation of global corrections&quot;</span>};</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>  <span class="keyword">const</span> std::array&lt;std::string, 2&gt; sideName{<span class="stringliteral">&quot;A&quot;</span>, <span class="stringliteral">&quot;C&quot;</span>};</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  LOGP(info, <span class="stringliteral">&quot;====== starting calculation of distortions and corrections for Side {} ======&quot;</span>, sideName[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>]);</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>  LOGP(info, <span class="stringliteral">&quot;Using {} threads&quot;</span>, getNThreads());</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  <span class="keywordflow">if</span> (getGlobalDistCorrMethod() == SC::GlobalDistCorrMethod::LocalDistCorr) {</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    LOGP(info, <span class="stringliteral">&quot;calculation of global distortions and corrections are performed by using: {}&quot;</span>, sglobalType[0]);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    LOGP(info, <span class="stringliteral">&quot;calculation of global distortions and corrections are performed by using: {}&quot;</span>, sglobalType[1]);</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>  }</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  <span class="keywordflow">if</span> (getGlobalDistType() == SC::GlobalDistType::Fast) {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    LOGP(info, <span class="stringliteral">&quot;calculation of global distortions performed by following method: {}&quot;</span>, sglobalDistType[1]);</div>
<div class="foldopen" id="foldopen00135" data-start="{" data-end="}">
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">  135</a></span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getGlobalDistType() == SC::GlobalDistType::Standard) {</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    LOGP(info, <span class="stringliteral">&quot;calculation of global distortions performed by following method: {}&quot;</span>, sglobalDistType[0]);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    LOGP(info, <span class="stringliteral">&quot;skipping calculation of global distortions&quot;</span>);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>  }</div>
<div class="foldopen" id="foldopen00140" data-start="{" data-end="}">
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab9f3a77b792d579957eeab75f811e023">  140</a></span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>  <span class="keyword">auto</span> startTotal = timer::now();</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>  poissonSolver(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>  calcEField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="foldopen" id="foldopen00146" data-start="{" data-end="}">
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e321cf1e55b8bd151d3820b538289db">  146</a></span>  <span class="keyword">const</span> <span class="keyword">auto</span> numEFields = getElectricFieldsInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>  <span class="keywordflow">if</span> (getGlobalDistType() == SC::GlobalDistType::Standard) {</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="keyword">const</span> <span class="keyword">auto</span> dist = <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;::Type::Distortions</a>;</div>
<div class="foldopen" id="foldopen00150" data-start="{" data-end="}">
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dab3e3390f6b9c6fb8019d45070b96e">  150</a></span>    calcLocalDistortionsCorrections(dist, numEFields); <span class="comment">// local distortion calculation</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="keyword">auto</span> stop = timer::now();</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    std::chrono::duration&lt;float&gt; <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    LOGP(info, <span class="stringliteral">&quot;local distortions time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    LOGP(info, <span class="stringliteral">&quot;skipping local distortions (not needed)&quot;</span>);</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  }</div>
<div class="foldopen" id="foldopen00157" data-start="{" data-end="}">
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8b1c785c09f42829bc9c20ee6b2d2c58">  157</a></span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>  <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  <span class="keyword">const</span> <span class="keyword">auto</span> corr = <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;::Type::Corrections</a>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>  calcLocalDistortionsCorrections(corr, numEFields); <span class="comment">// local correction calculation</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>  <span class="keyword">auto</span> stop = timer::now();</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>  std::chrono::duration&lt;float&gt; <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  LOGP(info, <span class="stringliteral">&quot;local corrections time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="foldopen" id="foldopen00164" data-start="{" data-end="}">
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82913fcf78fb8274be5a8c19d21201f0">  164</a></span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>  <span class="keywordflow">if</span> (calcVectors) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    calcLocalDistortionCorrectionVector(numEFields);</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    stop = timer::now();</div>
<div class="foldopen" id="foldopen00169" data-start="{" data-end="}">
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3dd986e654962435fabcf1cd8bfa253c">  169</a></span>    <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    LOGP(info, <span class="stringliteral">&quot;local correction/distortion vector time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>  }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="foldopen" id="foldopen00174" data-start="{" data-end="}">
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">  174</a></span>  <span class="keyword">const</span> <span class="keyword">auto</span> lCorrInterpolator = getLocalCorrInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>  (getGlobalDistCorrMethod() == SC::GlobalDistCorrMethod::LocalDistCorr) ? calcGlobalCorrections(lCorrInterpolator) : calcGlobalCorrections(numEFields);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  stop = timer::now();</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>  <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="foldopen" id="foldopen00178" data-start="{" data-end="}">
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">  178</a></span>  LOGP(info, <span class="stringliteral">&quot;global corrections time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <span class="keywordflow">if</span> (getGlobalDistType() == SC::GlobalDistType::Fast) {</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="keyword">const</span> <span class="keyword">auto</span> globalCorrInterpolator = getGlobalCorrInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="foldopen" id="foldopen00182" data-start="{" data-end="}">
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">  182</a></span>    calcGlobalDistWithGlobalCorrIterative(globalCorrInterpolator);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getGlobalDistType() == SC::GlobalDistType::Standard) {</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keyword">const</span> <span class="keyword">auto</span> lDistInterpolator = getLocalDistInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    (getGlobalDistCorrMethod() == SC::GlobalDistCorrMethod::LocalDistCorr) ? calcGlobalDistortions(lDistInterpolator, 3 * sSteps * getNZVertices()) : calcGlobalDistortions(numEFields, 3 * sSteps * getNZVertices());</div>
<div class="foldopen" id="foldopen00186" data-start="{" data-end="}">
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">  186</a></span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>  }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  stop = timer::now();</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="foldopen" id="foldopen00191" data-start="{" data-end="}">
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a652634045c7a547e94854b3a43fefef4">  191</a></span>  LOGP(info, <span class="stringliteral">&quot;global distortions time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  stop = timer::now();</div>
<div class="foldopen" id="foldopen00194" data-start="{" data-end="}">
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af621105fd13f9cbfbd1ec260eac9ab71">  194</a></span>  <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - startTotal;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>  LOGP(info, <span class="stringliteral">&quot;everything is done. Total Time: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>}</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="foldopen" id="foldopen00198" data-start="{" data-end="}">
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">  198</a></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00199" data-start="{" data-end="}">
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">  199</a></span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">SpaceCharge&lt;DataT&gt;::regulateR</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> posR, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> minR = getRMinSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>  <span class="keywordflow">if</span> (posR &lt; minR) {</div>
<div class="foldopen" id="foldopen00203" data-start="{" data-end="}">
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7db68da7d1c4cd48903f83379d1b06ac">  203</a></span>    <span class="keywordflow">return</span> minR;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>  }</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> maxR = getRMaxSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>  <span class="keywordflow">if</span> (posR &gt; maxR) {</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">return</span> maxR;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>  }</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>  <span class="keywordflow">return</span> posR;</div>
<div class="foldopen" id="foldopen00210" data-start="{" data-end="}">
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25aed0bc6b816140e1618c3d350f030e">  210</a></span>}</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00213" data-start="{" data-end="}">
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">  213</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">SpaceCharge&lt;DataT&gt;::setChargeDensityFromFormula</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>{</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="foldopen" id="foldopen00218" data-start="{" data-end="}">
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3a46a0ad77d7d357b28b384627f098ec">  218</a></span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="foldopen" id="foldopen00223" data-start="{" data-end="}">
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a198395c3d578002731dcbd2ba549970f">  223</a></span>        mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a5a124cae7990696b48d1a5bed028f07f">evalDensity</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>      }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    }</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>  }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>}</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00230" data-start="{" data-end="}">
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3a46a0ad77d7d357b28b384627f098ec">  230</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3a46a0ad77d7d357b28b384627f098ec">SpaceCharge&lt;DataT&gt;::setDefaultStaticDistortionsGEMFrameChargeUp</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaPotential)</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>{</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt; deltaPotFormula = [deltaPotential](<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>) {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="keywordflow">return</span> deltaPotential;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  };</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>  setPotentialBoundaryGEMFrameAlongR(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  setPotentialBoundaryGEMFrameIROCBottomAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  setPotentialBoundaryGEMFrameIROCTopAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  setPotentialBoundaryGEMFrameOROC1BottomAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  setPotentialBoundaryGEMFrameOROC1TopAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  setPotentialBoundaryGEMFrameOROC2BottomAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  setPotentialBoundaryGEMFrameOROC2TopAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  setPotentialBoundaryGEMFrameOROC3BottomAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  setPotentialBoundaryGEMFrameOROC3TopAlongPhi(deltaPotFormula, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>}</div>
</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00248" data-start="{" data-end="}">
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10e3026161c8aa2eaa1982be85d1cd6e">  248</a></span><span class="keywordtype">size_t</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10e3026161c8aa2eaa1982be85d1cd6e">SpaceCharge&lt;DataT&gt;::getPhiBinsGapFrame</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a> == 1) {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>  }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; regInf = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">Mapper::instance</a>().<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9009179fa0078961b118a7f5cbdf4ccf">getPadRegionInfo</a>(0);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> localYEdgeIROC = regInf.<a class="code hl_function" href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a8f0855e5572ac21692b148a5c9810f32">getPadsInRowRegion</a>(0) / 2 * regInf.getPadWidth();</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  <span class="keyword">const</span> <span class="keyword">auto</span> globalPosGap = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ac3a82fbb8b2684194432dd095da3abfb">Mapper::LocalToGlobal</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#a29b3fe27b015528948b6f0bae6a92c11">LocalPosition2D</a>(regInf.getRadiusFirstRow(), -(localYEdgeIROC + <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::WIDTHFRAME</a>)), <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a>(0));</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  <span class="keyword">const</span> <span class="keyword">auto</span> phiGap = std::atan(globalPosGap.Y() / globalPosGap.X());</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  <span class="keyword">auto</span> nBinsPhiGap = getNearestPhiVertex(phiGap, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="keywordflow">if</span> (nBinsPhiGap == 0) {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    nBinsPhiGap = 1;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  }</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="keywordflow">return</span> nBinsPhiGap;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>}</div>
</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00268" data-start="{" data-end="}">
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a198395c3d578002731dcbd2ba549970f">  268</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a198395c3d578002731dcbd2ba549970f">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryGEMFrameAlongR</a>(<span class="keyword">const</span> std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt;&amp; potentialFunc, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>{</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a> = getPotentialBoundaryGEMFrameAlongRIndices(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  setBoundaryFromIndices(potentialFunc, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>}</div>
</div>
</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00276" data-start="{" data-end="}">
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a153f224e50193ee75876be32e85542ed">  276</a></span>std::vector&lt;std::pair&lt;size_t, float&gt;&gt; <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::getPotentialBoundaryGEMFrameAlongRIndices</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  <span class="keyword">const</span> <span class="keyword">auto</span> radiusStart = std::sqrt(std::pow(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::LENGTHFRAMEIROCBOTTOM</a> / 2, 2) + std::pow(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSBOTTOM</a>[0], 2));</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rStart = getNearestRVertex(radiusStart, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="foldopen" id="foldopen00281" data-start="{" data-end="}">
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa62a45be2e34032316254210125ccbc6">  281</a></span>  <span class="keyword">const</span> <span class="keyword">auto</span> radiusEnd = std::sqrt(std::pow(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::LENGTHFRAMEOROC3TOP</a> / 2, 2) + std::pow(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>[3], 2));</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rEnd = getNearestRVertex(radiusEnd, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// mParamGrid.NRVertices - 1</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; regInf = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">Mapper::instance</a>().<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9009179fa0078961b118a7f5cbdf4ccf">getPadRegionInfo</a>(0);</div>
<div class="foldopen" id="foldopen00287" data-start="{" data-end="}">
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#affebed01001fa0b594d20ef265a3565a">  287</a></span>  <span class="keyword">const</span> <span class="keywordtype">float</span> localYEdgeIROC = regInf.<a class="code hl_function" href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a8f0855e5572ac21692b148a5c9810f32">getPadsInRowRegion</a>(0) / 2 * regInf.getPadWidth();</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>  <span class="keyword">const</span> <span class="keyword">auto</span> globalPosEdgeIROC = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ac3a82fbb8b2684194432dd095da3abfb">Mapper::LocalToGlobal</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#a29b3fe27b015528948b6f0bae6a92c11">LocalPosition2D</a>(regInf.getRadiusFirstRow(), -localYEdgeIROC), <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a>(0));</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> stacks = <span class="keyword">sizeof</span>(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>) / <span class="keyword">sizeof</span>(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>[0]);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="foldopen" id="foldopen00292" data-start="{" data-end="}">
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae4e6953234f71f03477a2f88dcf34829">  292</a></span>  std::vector&lt;DataT&gt; radii;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> = 0; <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> &lt; stacks; ++<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>) {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="keywordtype">int</span> region = 3;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == 1) {</div>
<div class="foldopen" id="foldopen00296" data-start="{" data-end="}">
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">  296</a></span>      region = 5;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == 2) {</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      region = 7;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == 3) {</div>
<div class="foldopen" id="foldopen00300" data-start="{" data-end="}">
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">  300</a></span>      region = 9;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; regInf = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">Mapper::instance</a>().<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9009179fa0078961b118a7f5cbdf4ccf">getPadRegionInfo</a>(region);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> localYEdge = regInf.<a class="code hl_function" href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a8f0855e5572ac21692b148a5c9810f32">getPadsInRowRegion</a>(region) / 2 * regInf.getPadWidth();</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    radii.emplace_back(std::sqrt(std::pow(<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>], 2) + std::pow(localYEdge, 2)));</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  std::vector&lt;std::pair&lt;size_t, float&gt;&gt; potentialInd;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a> = 1;</div>
<div class="foldopen" id="foldopen00309" data-start="{" data-end="}">
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afb60aa556a63b877e6d3e5b25ebc78cd">  309</a></span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = rStart; iR &lt; rEnd; ++iR) {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="keyword">auto</span> <span class="keyword">const</span> it = std::lower_bound(radii.begin(), radii.end(), radius);</div>
<div class="foldopen" id="foldopen00312" data-start="{" data-end="}">
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82916266360bee79127c2ca19ad2a330">  312</a></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> = (it == radii.end()) ? (stacks - 1) : (it - radii.begin());</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="comment">// for stack 4 use the the number of phi bins at the edge</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="keyword">const</span> <span class="keyword">auto</span> radiusCompare = (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == 4) ? <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>] : <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters</a>&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&gt;::POSTOP[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>] + (<a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters</a>&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&gt;::POSTOP[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>] - <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters</a>&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&gt;::POSTOP[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>]) / 2;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhiTmp = 0; iPhiTmp &lt; getNPhiVertices(); ++iPhiTmp) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> margin = 0.5;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> offsetGlobalY = radiusCompare * iPhiTmp * getGridSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + margin;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>      <span class="keywordflow">if</span> (iPhiTmp &gt; 0 &amp;&amp; offsetGlobalY &gt; globalPosEdgeIROC.Y()) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <span class="keywordflow">break</span>;</div>
<div class="foldopen" id="foldopen00321" data-start="{" data-end="}">
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08b328d8f063ff0af239e81ad3bbcceb">  321</a></span>      }</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sector = 0; sector &lt; <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a>; ++sector) {</div>
<div class="foldopen" id="foldopen00324" data-start="{" data-end="}">
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a132f8becaf90d84135c890e606e60dda">  324</a></span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iPhiLeft = sector * verticesPerSector + iPhiTmp;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        potentialInd.emplace_back(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiLeft), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a>);</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="keywordflow">if</span> (iPhiTmp &gt; 0) {</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>          <span class="keyword">const</span> <span class="keywordtype">size_t</span> iPhiRight = (sector + 1) * verticesPerSector - iPhiTmp;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>          potentialInd.emplace_back(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiRight), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a>);</div>
<div class="foldopen" id="foldopen00330" data-start="{" data-end="}">
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af65e22a052d4188c6983457c76efffcc">  330</a></span>        }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>      }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    }</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>  }</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>  std::sort(potentialInd.begin(), potentialInd.end());</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="keywordflow">return</span> potentialInd;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>}</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryGEMFrameAlongPhi</a>(<span class="keyword">const</span> std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt;&amp; potentialFunc, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4ae">GEMstack</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> outerFrame)</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>{</div>
<div class="foldopen" id="foldopen00341" data-start="{" data-end="}">
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">  341</a></span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a> = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, outerFrame);</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>  setBoundaryFromIndices(potentialFunc, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>}</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::setBoundaryFromIndices</a>(<span class="keyword">const</span> std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt;&amp; potentialFunc, <span class="keyword">const</span> std::vector&lt;std::pair&lt;size_t, float&gt;&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>{</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>  <span class="comment">/*</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span><span class="comment">    make check for the weights</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="comment">    Loop over bins in the radial direction</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="comment">    Check for duplicates and use the one with larger weight</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="comment">  */</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; indexw : <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>) {</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a> = indexw.first;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iZ = mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getIndexZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>);</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iR = mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getIndexR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iPhi = mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getIndexPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>);</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a> = indexw.second;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> pot = mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="foldopen" id="foldopen00363" data-start="{" data-end="}">
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">  363</a></span>    <span class="keyword">const</span> <span class="keywordtype">float</span> potNew = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a> * potentialFunc(radius);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="keywordflow">if</span> (std::abs(potNew) &gt; std::abs(pot)) {</div>
<div class="foldopen" id="foldopen00365" data-start="{" data-end="}">
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4">  365</a></span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = potNew;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    }</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>  }</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>}</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>std::vector&lt;std::pair&lt;size_t, float&gt;&gt; <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::getPotentialBoundaryGEMFrameAlongPhiIndices</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4ae">GEMstack</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> outerFrame, <span class="keyword">const</span> <span class="keywordtype">bool</span> noGap)<span class="keyword"> const</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>  <span class="comment">// to avoid double counting</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>  <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a> = getPotentialBoundaryGEMFrameAlongRIndices(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="foldopen" id="foldopen00375" data-start="{" data-end="}">
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">  375</a></span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  <span class="keywordtype">int</span> region = 0;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  <span class="keywordtype">float</span> offsStart = 0;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>  <span class="keywordtype">float</span> offsEnd = 0;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a>) {</div>
<div class="foldopen" id="foldopen00380" data-start="{" data-end="}">
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aaf5c0638547e1a4af2c2798396530f7f">  380</a></span>    offsEnd = -0.5;</div>
<div class="foldopen" id="foldopen00381" data-start="{" data-end="}">
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9d6516b6be115d5edd7195d9e26241b3">  381</a></span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>) {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      region = 0;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea46e1c9be60cbf4a87dabc179218274cd">GEMstack::OROC1gem</a>) {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      region = 4;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea68644cbdd30d74e98dc467bd9a6e9917">GEMstack::OROC2gem</a>) {</div>
<div class="foldopen" id="foldopen00386" data-start="{" data-end="}">
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a482522fbc912d311883b72f3d93b574e">  386</a></span>      region = 6;</div>
<div class="foldopen" id="foldopen00387" data-start="{" data-end="}">
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa79d1358025054087884d679d2254909">  387</a></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">GEMstack::OROC3gem</a>) {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>      region = 8;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    offsStart = 0.5;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>) {</div>
<div class="foldopen" id="foldopen00393" data-start="{" data-end="}">
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa65ad3b3fbfd67af9df3ef0e172ba124">  393</a></span>      region = 3;</div>
<div class="foldopen" id="foldopen00394" data-start="{" data-end="}">
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a137526d4029a226573ab125104ae22a6">  394</a></span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea46e1c9be60cbf4a87dabc179218274cd">GEMstack::OROC1gem</a>) {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>      region = 5;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea68644cbdd30d74e98dc467bd9a6e9917">GEMstack::OROC2gem</a>) {</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>      region = 7;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">GEMstack::OROC3gem</a>) {</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>      region = 9;</div>
<div class="foldopen" id="foldopen00400" data-start="{" data-end="}">
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a4553fcd51a8cf4e85ed6a01b791e6ba7">  400</a></span>    }</div>
<div class="foldopen" id="foldopen00401" data-start="{" data-end="}">
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af8ec75cf3aea277824b881b1b5b23c5e">  401</a></span>  }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; regInf = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">Mapper::instance</a>().<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9009179fa0078961b118a7f5cbdf4ccf">getPadRegionInfo</a>(region);</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  <span class="keyword">const</span> <span class="keyword">auto</span> radiusFirstRow = regInf.<a class="code hl_function" href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a637bc7c57ceb250bcdf22fda72d41ec9">getRadiusFirstRow</a>();</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusStart = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a> ? <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSBOTTOM</a>[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>] : radiusFirstRow + regInf.getPadHeight() * regInf.getNumberOfPadRows();</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a> &amp;&amp; (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> != <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>)) {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    radiusStart -= 0.5;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  }</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>  <span class="keyword">auto</span> radiusMax = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a> ? radiusFirstRow : <a class="code hl_struct" href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">GEMFrameParameters&lt;DataT&gt;::POSTOP</a>[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>];</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>  <span class="comment">// add marging for first last padrows close to gap to improve numerical stabillity there</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>  radiusStart += offsStart;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>  radiusMax += offsEnd;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>  <span class="keywordtype">int</span> nVerticesR = (radiusMax - radiusStart) / getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>  <span class="keywordflow">if</span> (nVerticesR == 0) {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    nVerticesR = 1;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  }</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>  std::vector&lt;std::pair&lt;size_t, float&gt;&gt; potentialInd; <span class="comment">// index, weight</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nBinsPhi = (outerFrame || noGap) ? 0 : getPhiBinsGapFrame(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sector = 0; sector &lt; <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a>; ++sector) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="keyword">const</span> <span class="keyword">auto</span> offsetPhi = sector * verticesPerSector + verticesPerSector / 2;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhiLocal = 0; iPhiLocal &lt;= (verticesPerSector / 2 - nBinsPhi); ++iPhiLocal) {</div>
<div class="foldopen" id="foldopen00427" data-start="{" data-end="}">
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abe1f7bf99cbb36ad75208f91e190f2ba">  427</a></span>      <span class="keyword">const</span> <span class="keyword">auto</span> iPhiLeft = offsetPhi + iPhiLocal;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>      <span class="keyword">const</span> <span class="keyword">auto</span> iPhiRight = offsetPhi - iPhiLocal;</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiLeft = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhiLeft, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiRight = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhiRight, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localphi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhiLocal, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusBottom = radiusStart / std::cos(localphi);</div>
<div class="foldopen" id="foldopen00433" data-start="{" data-end="}">
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">  433</a></span>      <span class="keyword">auto</span> rStart = (outerFrame &amp;&amp; (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>)) ? 1 : std::round((radiusBottom - getRMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)) / getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + 0.5); <span class="comment">// round up to use only bins whihc are fully covered</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>      <span class="keyword">auto</span> nREnd = (outerFrame &amp;&amp; (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">GEMstack::OROC3gem</a>)) ? mParamGrid.NRVertices - 1 : rStart + nVerticesR;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="foldopen" id="foldopen00436" data-start="{" data-end="}">
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5122f33cc90c828f2fa7284a4b04d043">  436</a></span>      <span class="comment">// end at gem frame</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      <span class="keywordflow">if</span> ((outerFrame &amp;&amp; (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>))) {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="comment">// TODO: remove this?</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> marginCM = 0; <span class="comment">// 0.4;</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> nMargingBins = marginCM / getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + 0.5;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>        nREnd = (radiusBottom - <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(1, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + 0.5) / getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + nMargingBins; <span class="comment">// 2 safety margin</span></div>
<div class="foldopen" id="foldopen00442" data-start="{" data-end="}">
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">  442</a></span>        radiusMax = 3 + <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(getNearestRVertex(radiusBottom + getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * nMargingBins, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>      }</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="foldopen" id="foldopen00445" data-start="{" data-end="}">
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a60da58dfd88a8fc17474ed206ef6ff9e">  445</a></span>      rStart -= 1;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>      nREnd += 1;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      <span class="keywordflow">if</span> (rStart &lt;= 0) {</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        rStart = 1;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>      }</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>      <span class="keywordflow">if</span> (nREnd &gt;= mParamGrid.NRVertices) {</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        nREnd = mParamGrid.NRVertices - 1;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>      }</div>
<div class="foldopen" id="foldopen00454" data-start="{" data-end="}">
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043">  454</a></span> </div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>      <span class="keywordtype">float</span> lxMin = radiusStart;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>      <span class="keywordflow">if</span> ((outerFrame &amp;&amp; (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>))) {</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        lxMin = 0;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>      }</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> lxMax = (nREnd == mParamGrid.NRVertices - 1) ? 9999 : radiusMax;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = rStart; iR &lt; nREnd; ++iR) {</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a> = 1;</div>
<div class="foldopen" id="foldopen00463" data-start="{" data-end="}">
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">  463</a></span>        <span class="keywordflow">if</span> (iPhiLeft &lt; getNPhiVertices()) {</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>          <span class="keywordflow">if</span> (noGap || !std::binary_search(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.begin(), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.end(), std::make_pair(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiLeft), 0.0f), [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) { return (a.first &lt; b.first); })) {</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            <span class="comment">// check how much of the bin is in the lx range and assign weigth</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> nIterPoints = 1000;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="keywordtype">int</span> nPointsGood = 0;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nIterPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>              <span class="keyword">const</span> <span class="keywordtype">float</span> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + getGridSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * gRandom-&gt;Uniform(-0.5, 0.5);</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>              <span class="keyword">const</span> <span class="keywordtype">float</span> phi = getGridSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * gRandom-&gt;Uniform(-0.5, 0.5);</div>
<div class="foldopen" id="foldopen00472" data-start="{" data-end="}">
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae4eb9dfe90bd58959447c41842b400b5">  472</a></span>              <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lx = radius * std::cos(phi + localphi);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>              <span class="keywordflow">if</span> ((lx &gt;= lxMin) &amp;&amp; (lx &lt;= lxMax)) {</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                ++nPointsGood;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>              }</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            }</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>            <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a> = nPointsGood / double(nIterPoints);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>            potentialInd.emplace_back(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiLeft), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a>);</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>          }</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        }</div>
<div class="foldopen" id="foldopen00481" data-start="{" data-end="}">
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">  481</a></span> </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <span class="keywordflow">if</span> (iPhiLocal &amp;&amp; (noGap || !std::binary_search(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.begin(), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a>.end(), std::make_pair(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiRight), 0.0f), [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) { return (a.first &lt; b.first); }))) {</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>          potentialInd.emplace_back(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getDataIndex(iZ, iR, iPhiRight), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a>);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        }</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>      }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    }</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>  }</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>  <span class="comment">// remove duplicate entries</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>  std::sort(potentialInd.begin(), potentialInd.end());</div>
<div class="foldopen" id="foldopen00490" data-start="{" data-end="}">
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abdb871166e6604ba577957b30c8075c4">  490</a></span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>  <span class="comment">// Remove duplicates</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>  potentialInd.erase(std::unique(potentialInd.begin(), potentialInd.end()), potentialInd.end());</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>  <span class="keywordflow">return</span> potentialInd;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>}</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00498" data-start="{" data-end="}">
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a153f224e50193ee75876be32e85542ed">  498</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a153f224e50193ee75876be32e85542ed">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryInnerRadius</a>(<span class="keyword">const</span> std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt;&amp; potentialFunc, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="foldopen" id="foldopen00499" data-start="{" data-end="}">
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">  499</a></span>{</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pot = potentialFunc(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = 0;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) += pot;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>  }</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>}</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00512" data-start="{" data-end="}">
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa62a45be2e34032316254210125ccbc6">  512</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa62a45be2e34032316254210125ccbc6">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryOuterRadius</a>(<span class="keyword">const</span> std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt;&amp; potentialFunc, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>{</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="foldopen" id="foldopen00517" data-start="{" data-end="}">
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">  517</a></span>    <span class="keyword">const</span> <span class="keyword">auto</span> pot = potentialFunc(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>);</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = mParamGrid.NRVertices - 1;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = pot;</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    }</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>  }</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>}</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00526" data-start="{" data-end="}">
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac34ea9c44d2f1e891f86a5dde307749e">  526</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">SpaceCharge&lt;DataT&gt;::setPotentialFromFormula</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>{</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="foldopen" id="foldopen00535" data-start="{" data-end="}">
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">  535</a></span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>      }</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    }</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>  }</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>}</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span> </div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00543" data-start="{" data-end="}">
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7db68da7d1c4cd48903f83379d1b06ac">  543</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7db68da7d1c4cd48903f83379d1b06ac">SpaceCharge&lt;DataT&gt;::mirrorPotential</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> sideRef, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> sideMirrored)</div>
<div class="foldopen" id="foldopen00544" data-start="{" data-end="}">
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25ce586cf19f34be49b0c1dbba57c79d">  544</a></span>{</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>  initContainer(mPotential[sideRef], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>  initContainer(mPotential[sideMirrored], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        mPotential[sideMirrored](iZ, iR, iPhi) = mPotential[sideRef](iZ, iR, iPhi);</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>      }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    }</div>
<div class="foldopen" id="foldopen00553" data-start="{" data-end="}">
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">  553</a></span>  }</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>}</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span> </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00557" data-start="{" data-end="}">
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">  557</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">SpaceCharge&lt;DataT&gt;::setPotentialBoundaryFromFormula</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>{</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="foldopen" id="foldopen00562" data-start="{" data-end="}">
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7a1077333667739133b0ed53354294d5">  562</a></span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = 0;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    }</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>  }</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="foldopen" id="foldopen00571" data-start="{" data-end="}">
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">  571</a></span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iR = mParamGrid.NRVertices - 1;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    }</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>  }</div>
<div class="foldopen" id="foldopen00580" data-start="{" data-end="}">
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb0e50f91355e2e621479f2beffec4bd">  580</a></span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = 0;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    }</div>
<div class="foldopen" id="foldopen00589" data-start="{" data-end="}">
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">  589</a></span>  }</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">evalPotential</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>  }</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>}</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00603" data-start="{" data-end="}">
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#affebed01001fa0b594d20ef265a3565a">  603</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#affebed01001fa0b594d20ef265a3565a">SpaceCharge&lt;DataT&gt;::poissonSolver</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stoppingConvergence, <span class="keyword">const</span> <span class="keywordtype">int</span> symmetry)</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>{</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  <a class="code hl_function" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a196fbcdc355e62e60736768c7aab8189">PoissonSolver&lt;DataT&gt;::setConvergenceError</a>(stoppingConvergence);</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>  <a class="code hl_class" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html">PoissonSolver&lt;DataT&gt;</a> poissonSolver(mGrid3D[0]);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>  poissonSolver.<a class="code hl_function" href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a66d868c082110c6929f68a06fb168f3c">poissonSolver3D</a>(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], symmetry);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>}</div>
</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span> </div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00613" data-start="{" data-end="}">
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae4e6953234f71f03477a2f88dcf34829">  613</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#affebed01001fa0b594d20ef265a3565a">SpaceCharge&lt;DataT&gt;::poissonSolver</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stoppingConvergence, <span class="keyword">const</span> <span class="keywordtype">int</span> symmetry)</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>{</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="preprocessor">#pragma omp parallel for num_threads(2)</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    poissonSolver(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, stoppingConvergence, symmetry);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>  }</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>}</div>
</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00623" data-start="{" data-end="}">
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">  623</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">SpaceCharge&lt;DataT&gt;::setEFieldFromFormula</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataT&gt;</a>&amp; formulaStruct)</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>{</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">getSide</a>();</div>
<div class="foldopen" id="foldopen00626" data-start="{" data-end="}">
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881">  626</a></span>  initContainer(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  initContainer(mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>  initContainer(mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="foldopen" id="foldopen00632" data-start="{" data-end="}">
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec913e3cee7451e5101682da4d706e0b">  632</a></span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a89af2dd4607f5098178e0fe609703050">evalFieldR</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ae0d124f54f2584022f7cf92d855ce83d">evalFieldZ</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = formulaStruct.<a class="code hl_function" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a1b2761dc0464d4248bfce8a178d6542d">evalFieldPhi</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi);</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>      }</div>
<div class="foldopen" id="foldopen00639" data-start="{" data-end="}">
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642">  639</a></span>    }</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>  }</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>}</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00644" data-start="{" data-end="}">
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">  644</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">SpaceCharge&lt;DataT&gt;::calcEField</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>{</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>  <span class="keyword">using </span>timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>  <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="foldopen" id="foldopen00648" data-start="{" data-end="}">
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aab2fffb39681caafbafaea6d8b8cd11c">  648</a></span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>  initContainer(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>  initContainer(mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>  initContainer(mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> symmetry = 0;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="keywordtype">size_t</span> tmpPlus = iPhi + 1;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <span class="keywordtype">int</span> signPlus = 1;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="keywordtype">int</span> tmpMinus = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(iPhi - 1);</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="keywordtype">int</span> signMinus = 1;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    <span class="keywordflow">if</span> (symmetry == 1 || symmetry == -1) { <span class="comment">// Reflection symmetry in phi (e.g. symmetry at sector boundaries, or half sectors, etc.)</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>      <span class="keywordflow">if</span> (tmpPlus &gt; mParamGrid.NPhiVertices - 1) {</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="keywordflow">if</span> (symmetry == -1) {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>          signPlus = -1;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>        }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        tmpPlus = mParamGrid.NPhiVertices - 2;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>      }</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>      <span class="keywordflow">if</span> (tmpMinus &lt; 0) {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        tmpMinus = 1; <span class="comment">// SHOULD IT BE =0?</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        <span class="keywordflow">if</span> (symmetry == -1) {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>          signMinus = -1;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        }</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>      }</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    } <span class="keywordflow">else</span> { <span class="comment">// No Symmetries in phi, no boundaries, the calculations is continuous across all phi</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>      <span class="keywordflow">if</span> (tmpPlus &gt; mParamGrid.NPhiVertices - 1) {</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        tmpPlus = iPhi + 1 - mParamGrid.NPhiVertices;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>      }</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>      <span class="keywordflow">if</span> (tmpMinus &lt; 0) {</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>        tmpMinus = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(iPhi - 1 + mParamGrid.NPhiVertices);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>      }</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    }</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    <span class="comment">// for non-boundary V</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 1; iR &lt; mParamGrid.NRVertices - 1; iR++) {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices - 1; iZ++) {</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR + 1, iPhi) - mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR - 1, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// r direction</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) - mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// z direction</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="foldopen" id="foldopen00688" data-start="{" data-end="}">
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">  688</a></span>      }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>    }</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    <span class="comment">// for boundary-r</span></div>
<div class="foldopen" id="foldopen00692" data-start="{" data-end="}">
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">  692</a></span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ++) {</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>      mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 0, iPhi) = -1 * (-<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 2, iPhi) + 2 * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 1, iPhi) - <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, 0, iPhi)) * getInvSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                                                                                <span class="comment">// forward difference</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>      mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 1, iPhi) = -1 * (<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 1, iPhi) - 2 * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 2, iPhi) + <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, mParamGrid.NRVertices - 3, iPhi)) * getInvSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// backward difference</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    }</div>
<div class="foldopen" id="foldopen00696" data-start="{" data-end="}">
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">  696</a></span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; iR += mParamGrid.NRVertices - 1) {</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices - 1; iZ++) {</div>
<div class="foldopen" id="foldopen00700" data-start="{" data-end="}">
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">  700</a></span>        mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) - mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// z direction</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>      }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    }</div>
<div class="foldopen" id="foldopen00704" data-start="{" data-end="}">
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">  704</a></span> </div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    <span class="comment">// for boundary-z</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>      mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = -1 * (-<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi) + 2 * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi)) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>      mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = -1 * (<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(1.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) - 2 * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) + <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    }</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 1; iR &lt; mParamGrid.NRVertices - 1; ++iR) {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ += mParamGrid.NZVertices - 1) {</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>        mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR + 1, iPhi) - mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR - 1, iPhi)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingR(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);                                    <span class="comment">// r direction</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>      }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    <span class="comment">// corner points for EPhi</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; iR += mParamGrid.NRVertices - 1) {</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; iZ += mParamGrid.NZVertices - 1) {</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -1 * (signPlus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpPlus) - signMinus * mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, tmpMinus)) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * getInvSpacingPhi(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / radius; <span class="comment">// phi direction</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>      }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    }</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>  }</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>  <span class="keyword">auto</span> stop = timer::now();</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>  std::chrono::duration&lt;float&gt; <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> totalTime = <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count();</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  LOGP(detail, <span class="stringliteral">&quot;electric field calculation took {}s&quot;</span>, totalTime);</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>}</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span> </div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00734" data-start="{" data-end="}">
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">  734</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterative</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a>&amp; globCorr, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale)</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>{</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>  calcGlobalDistCorrIterative(globCorr, maxIter, approachZ, approachR, approachPhi, diffCorr, scSCale, scale, Type::Distortions);</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>}</div>
</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00740" data-start="{" data-end="}">
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aaf5c0638547e1a4af2c2798396530f7f">  740</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterative</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>{</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>  calcGlobalDistCorrIterative(getGlobalCorrInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), maxIter, approachZ, approachR, approachPhi, diffCorr, scSCale, scale, Type::Distortions);</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>}</div>
</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00746" data-start="{" data-end="}">
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9d6516b6be115d5edd7195d9e26241b3">  746</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterative</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>{</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>;</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    calcGlobalDistWithGlobalCorrIterative(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, scSCale, scale, maxIter, approachZ, approachR, approachPhi, diffCorr);</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>  }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>}</div>
</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span> </div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00756" data-start="{" data-end="}">
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a482522fbc912d311883b72f3d93b574e">  756</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a482522fbc912d311883b72f3d93b574e">SpaceCharge&lt;DataT&gt;::calcGlobalCorrWithGlobalDistIterative</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>{</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  calcGlobalDistCorrIterative(getGlobalDistInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), maxIter, approachZ, approachR, approachPhi, diffCorr, scSCale, scale, Type::Corrections);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>}</div>
</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00762" data-start="{" data-end="}">
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa79d1358025054087884d679d2254909">  762</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a482522fbc912d311883b72f3d93b574e">SpaceCharge&lt;DataT&gt;::calcGlobalCorrWithGlobalDistIterative</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>{</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>;</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    calcGlobalCorrWithGlobalDistIterative(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, scSCale, scale, maxIter, approachZ, approachR, approachPhi, diffCorr);</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>  }</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>}</div>
</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::calcGlobalDistCorrIterative</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a>&amp; globCorr, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachR, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> Type <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>)</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>{</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = globCorr.<a class="code hl_function" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a2c695f47938da98e89d832edb1d881f1">getSide</a>();</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>    initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>    initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  }</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; scSCaleInterpolator = (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) ? scSCale-&gt;mInterpolatorGlobalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] : scSCale-&gt;mInterpolatorGlobalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span> </div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 1; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        <span class="comment">//==========================================================================================</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        <span class="comment">//==== start algorithm: use tricubic upsampling to numerically approach the query point ====</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        <span class="comment">//==========================================================================================</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>        <span class="comment">// 1. calculate difference from nearest point to query point with stepwidth factor x</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        <span class="comment">// and approach the new point</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepR = 0;</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepZ = 0;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepPhi = 0;</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        <span class="comment">// needed to check for convergence</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrdR = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrdZ = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrdRPhi = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span> </div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="comment">// interpolated global correction</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrdR = 0;</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrdRPhi = 0;</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrdZ = 0;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; maxIter; ++iter) {</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>          <span class="comment">// 2. get new point coordinates</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rCurrPos = radius + stepR;</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zCurrPos = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> + stepZ;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiCurrPos = phi + stepPhi;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span> </div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>          <span class="comment">// abort calculation of drift path if electron reached inner/outer field cage or central electrode</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>          <span class="keywordflow">if</span> (rCurrPos &lt;= getRMinSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || rCurrPos &gt;= getRMaxSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || getSide(zCurrPos) != <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>          }</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>          <span class="comment">// interpolate global correction at new point and calculate position of global correction</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>          corrdR = globCorr.<a class="code hl_function" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#ac47ba0536e3125bacc267f613372d569">evaldR</a>(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>          <span class="keywordflow">if</span> (scSCale &amp;&amp; scale != 0) {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>            corrdR += scale * scSCaleInterpolator.evaldR(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>          }</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rNewPos = rCurrPos + corrdR;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span> </div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrPhi = 0;</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>          <span class="keywordflow">if</span> (scSCale &amp;&amp; scale != 0) {</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            corrPhi = scale * scSCaleInterpolator.evaldRPhi(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>          }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>          corrPhi += globCorr.<a class="code hl_function" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a9d2c379302625ac301af5e44e3cca7b2">evaldRPhi</a>(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>          corrPhi /= rCurrPos;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span> </div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>          corrdRPhi = corrPhi * rNewPos; <span class="comment">// normalize to new r coordinate</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiNewPos = phiCurrPos + corrPhi;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>          corrdZ = globCorr.<a class="code hl_function" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a6ce451ab1f382618b762cd0510c77472">evaldZ</a>(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>          <span class="keywordflow">if</span> (scSCale &amp;&amp; scale != 0) {</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>            corrdZ += scale * scSCaleInterpolator.evaldZ(zCurrPos, rCurrPos, phiCurrPos);</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>          }</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zNewPos = zCurrPos + corrdZ;</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span> </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>          <span class="comment">// approach desired coordinate</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>          stepR += (radius - rNewPos) * approachR;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>          stepZ += (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> - zNewPos) * approachZ;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>          stepPhi += (<a class="code hl_variable" href="../../d4/dbd/namespaceo2_1_1math__utils_1_1detail.html#a6165053352ad91e6afb11940eca08c1b">phi</a> - phiNewPos) * approachPhi;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>          <span class="comment">// check for convergence</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrdR = std::abs(corrdR - lastCorrdR);</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrdRZ = std::abs(corrdZ - lastCorrdZ);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrdRPhi = std::abs(corrdRPhi - lastCorrdRPhi);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>          <span class="comment">// stop algorithm if converged</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>          <span class="keywordflow">if</span> (diffCorrdR &lt; diffCorr &amp;&amp; diffCorrdRZ &lt; diffCorr &amp;&amp; diffCorrdRPhi &lt; diffCorr) {</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>          }</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>          lastCorrdR = corrdR;</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>          lastCorrdZ = corrdZ;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>          lastCorrdRPhi = corrdRPhi;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>        <span class="comment">// set global distortions if algorithm converged or iterations exceed max numbers of iterations</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>        <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>          mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdR;</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>          mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdRPhi;</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>          mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdZ;</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>          mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdR;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>          mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdRPhi;</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>          mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -corrdZ;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>        }</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>      }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    }</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>      <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="foldopen" id="foldopen00885" data-start="{" data-end="}">
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0284367d48f7b2fe6362843ffee61264">  885</a></span>        mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>        mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>        mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>      }</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    }</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>  }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>}</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00896" data-start="{" data-end="}">
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa65ad3b3fbfd67af9df3ef0e172ba124">  896</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa65ad3b3fbfd67af9df3ef0e172ba124">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterativeLinearCartesian</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachX, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachY, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>{</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>  calcGlobalDistCorrIterativeLinearCartesian(getGlobalCorrInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), maxIter, approachX, approachY, approachZ, diffCorr, scSCale, scale, Type::Distortions);</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>}</div>
</div>
<div class="foldopen" id="foldopen00900" data-start="{" data-end="}">
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0e5633d230d25b21aafca1ec5f045992">  900</a></span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00902" data-start="{" data-end="}">
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a137526d4029a226573ab125104ae22a6">  902</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa65ad3b3fbfd67af9df3ef0e172ba124">SpaceCharge&lt;DataT&gt;::calcGlobalDistWithGlobalCorrIterativeLinearCartesian</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachX, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachY, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>{</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>    calcGlobalDistWithGlobalCorrIterativeLinearCartesian(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, scSCale, scale, maxIter, approachX, approachY, approachZ, diffCorr);</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>  }</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>}</div>
</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span> </div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00912" data-start="{" data-end="}">
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a4553fcd51a8cf4e85ed6a01b791e6ba7">  912</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a4553fcd51a8cf4e85ed6a01b791e6ba7">SpaceCharge&lt;DataT&gt;::calcGlobalCorrWithGlobalDistIterativeLinearCartesian</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachX, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachY, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>{</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>  calcGlobalDistCorrIterativeLinearCartesian(getGlobalDistInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), maxIter, approachX, approachY, approachZ, diffCorr, scSCale, scale, Type::Corrections);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>}</div>
</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen00918" data-start="{" data-end="}">
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af8ec75cf3aea277824b881b1b5b23c5e">  918</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a4553fcd51a8cf4e85ed6a01b791e6ba7">SpaceCharge&lt;DataT&gt;::calcGlobalCorrWithGlobalDistIterativeLinearCartesian</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachX, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachY, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr)</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>{</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>;</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    calcGlobalCorrWithGlobalDistIterativeLinearCartesian(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, scSCale, scale, maxIter, approachX, approachY, approachZ, diffCorr);</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>  }</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>}</div>
</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::calcGlobalDistCorrIterativeLinearCartesian</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a>&amp; globCorr, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIter, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachX, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachY, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> approachZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorr, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale, <span class="keyword">const</span> Type <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>)</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>{</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = globCorr.<a class="code hl_function" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a2c695f47938da98e89d832edb1d881f1">getSide</a>();</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>    initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>  }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; scSCaleInterpolator = (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) ? scSCale-&gt;mInterpolatorGlobalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] : scSCale-&gt;mInterpolatorGlobalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> = getXFromPolar(radius, phi);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_class" href="../../d1/da0/classint.html">y</a> = getYFromPolar(radius, phi);</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 1; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="foldopen" id="foldopen00952" data-start="{" data-end="}">
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9b795ba44b6b1ea7f444d42069076604">  952</a></span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepX = 0;</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepY = 0;</div>
<div class="foldopen" id="foldopen00956" data-start="{" data-end="}">
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af571ca7cda9c2fc22653dd4a43c110c4">  956</a></span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepZ = 0;</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        <span class="comment">// needed to check for convergence</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrX = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrY = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastCorrZ = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="foldopen" id="foldopen00962" data-start="{" data-end="}">
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a89acd8f67d0813e37753362c2fa6ee6c">  962</a></span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastX = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastY = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lastZ = std::numeric_limits&lt;DataT&gt;::max();</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="foldopen" id="foldopen00966" data-start="{" data-end="}">
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af47cefe85e3f183d786dec4557ac356f">  966</a></span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; maxIter; ++iter) {</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> xCurrPos = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> + stepX;</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> yCurrPos = <a class="code hl_class" href="../../d1/da0/classint.html">y</a> + stepY;</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zCurrPos = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> + stepZ;</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>          <span class="comment">// abort calculation of drift path if electron reached inner/outer field cage or central electrode</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rCurrPos = getRadiusFromCartesian(xCurrPos, yCurrPos);</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>          <span class="keywordflow">if</span> (rCurrPos &lt;= getRMinSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || rCurrPos &gt;= getRMaxSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || getSide(zCurrPos) != <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>          }</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>          <span class="comment">// interpolate global correction at new point and calculate position of global correction</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrX = 0;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrY = 0;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrZ = 0;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>          (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) ? getCorrections(xCurrPos, yCurrPos, zCurrPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ) : getDistortions(xCurrPos, yCurrPos, zCurrPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ);</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span> </div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>          <span class="keywordflow">if</span> (scSCale &amp;&amp; scale != 0) {</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>            <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrXScale = 0;</div>
<div class="foldopen" id="foldopen00985" data-start="{" data-end="}">
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0b12079b87187decbfbe5ebf5218ec8a">  985</a></span>            <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrYScale = 0;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>            <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrZScale = 0;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>            (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) ? scSCale-&gt;<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">getCorrections</a>(xCurrPos, yCurrPos, zCurrPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrXScale, corrYScale, corrZScale) : getDistortions(xCurrPos, yCurrPos, zCurrPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ);</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>            corrX += scale * corrXScale;</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>            corrY += scale * corrYScale;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>            corrZ += scale * corrZScale;</div>
<div class="foldopen" id="foldopen00991" data-start="{" data-end="}">
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2338129071857bf4ed66475581c4f58b">  991</a></span>          }</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span> </div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>          <span class="comment">// check for convergence</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrX = std::abs(corrX - lastCorrX);</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrY = std::abs(corrY - lastCorrY);</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diffCorrZ = std::abs(corrZ - lastCorrZ);</div>
<div class="foldopen" id="foldopen00997" data-start="{" data-end="}">
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af752bf3e3e0bb9f909ebd51525f2dd21">  997</a></span> </div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>          lastCorrX = corrX;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>          lastCorrY = corrY;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>          lastCorrZ = corrZ;</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>          lastX = xCurrPos;</div>
<div class="foldopen" id="foldopen01002" data-start="{" data-end="}">
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aad0b025fd2ed30676b2a23a1f248658a"> 1002</a></span>          lastY = yCurrPos;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>          lastZ = zCurrPos;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>          <span class="comment">// stop algorithm if converged</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>          <span class="keywordflow">if</span> ((diffCorrX &lt; diffCorr) &amp;&amp; (diffCorrY &lt; diffCorr) &amp;&amp; (diffCorrZ &lt; diffCorr)) {</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>            <span class="keywordflow">break</span>;</div>
<div class="foldopen" id="foldopen01008" data-start="{" data-end="}">
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a34b407b5797fe7d20144b0b4b95e5b87"> 1008</a></span>          }</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> xNewPos = xCurrPos + corrX;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> yNewPos = yCurrPos + corrY;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zNewPos = zCurrPos + corrZ;</div>
<div class="foldopen" id="foldopen01013" data-start="{" data-end="}">
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab4541395c1c5f02af28e1a98329d4c0b"> 1013</a></span> </div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>          <span class="comment">// approach desired coordinate</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>          stepX += (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> - xNewPos) * approachX;</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>          stepY += (<a class="code hl_class" href="../../d1/da0/classint.html">y</a> - yNewPos) * approachY;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>          stepZ += (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> - zNewPos) * approachZ;</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        }</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> xNew = lastX + lastCorrX;</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> yNew = lastY + lastCorrY;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusNew = getRadiusFromCartesian(xNew, yNew);</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrdR = -(radiusNew - getRadiusFromCartesian(lastX, lastY));</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span> </div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        <span class="keywordtype">float</span> phiNew = getPhiFromCartesian(xNew, yNew);</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>        <a class="code hl_function" href="../../d9/d2e/namespaceo2_1_1math__utils.html#a6d56daf9a2b8f1a9d654fd52a0b40559">o2::math_utils::bringTo02PiGen</a>(phiNew);</div>
<div class="foldopen" id="foldopen01027" data-start="{" data-end="}">
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f8cbc58786475327fe482b1d1ef6296"> 1027</a></span> </div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>        <span class="keywordtype">float</span> phiLast = getPhiFromCartesian(lastX, lastY);</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>        <a class="code hl_function" href="../../d9/d2e/namespaceo2_1_1math__utils.html#a6d56daf9a2b8f1a9d654fd52a0b40559">o2::math_utils::bringTo02PiGen</a>(phiLast);</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span> </div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaPhi = (phiNew - phiLast);</div>
<div class="foldopen" id="foldopen01032" data-start="{" data-end="}">
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a993d5dccf3d2de1da1aad94bf4018dbb"> 1032</a></span>        <span class="comment">// handle edge cases</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>        <span class="keywordflow">if</span> (deltaPhi &gt; <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3681db29cb4bd2e5e2bc538b416fbb9d">PI</a>) {</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>          deltaPhi -= 2 * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3681db29cb4bd2e5e2bc538b416fbb9d">PI</a>;</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deltaPhi &lt; -<a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3681db29cb4bd2e5e2bc538b416fbb9d">PI</a>) {</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>          deltaPhi += 2 * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3681db29cb4bd2e5e2bc538b416fbb9d">PI</a>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        }</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrdRPhi = -deltaPhi * radiusNew;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="comment">// set global distortions if algorithm converged or iterations exceed max numbers of iterations</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>          mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrdR;</div>
<div class="foldopen" id="foldopen01043" data-start="{" data-end="}">
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb7e3314dadf5e5318890390f933d225"> 1043</a></span>          mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrdRPhi;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>          mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -lastCorrZ;</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>          mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrdR;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>          mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrdRPhi;</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>          mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = -lastCorrZ;</div>
<div class="foldopen" id="foldopen01049" data-start="{" data-end="}">
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a124395d1096003313755205833435610"> 1049</a></span>        }</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>      }</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    }</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="foldopen" id="foldopen01053" data-start="{" data-end="}">
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7ef90c889b90fb5fea40a47e077e02b4"> 1053</a></span>      <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>        mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="foldopen" id="foldopen01057" data-start="{" data-end="}">
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3da8a7835405ea520dffc7a3913f77d9"> 1057</a></span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>        mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>        mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>      }</div>
<div class="foldopen" id="foldopen01062" data-start="{" data-end="}">
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a244ff868007df0f15fff94603c5b005d"> 1062</a></span>    }</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>  }</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>}</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01067" data-start="{" data-end="}">
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582"> 1067</a></span><a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">SpaceCharge&lt;DataT&gt;::getElectricFieldsInterpolator</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="foldopen" id="foldopen01068" data-start="{" data-end="}">
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a69e84193198aa984866eafafb2ca95a9"> 1068</a></span><span class="keyword"></span>{</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>  <span class="keywordflow">if</span> (!mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    LOGP(warning, <span class="stringliteral">&quot;============== E-Fields are not set! ==============&quot;</span>);</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>  }</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>  <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> numFields(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>  <span class="keywordflow">return</span> numFields;</div>
<div class="foldopen" id="foldopen01074" data-start="{" data-end="}">
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a58f16f65295007b95080ab0ecf4f1360"> 1074</a></span>}</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01077" data-start="{" data-end="}">
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754"> 1077</a></span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">SpaceCharge&lt;DataT&gt;::getLocalDistInterpolator</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="keyword"></span>{</div>
<div class="foldopen" id="foldopen01079" data-start="{" data-end="}">
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa5095db124d7dd5e6e5fb8df3778be64"> 1079</a></span>  <span class="keywordflow">if</span> (!mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    LOGP(warning, <span class="stringliteral">&quot;============== local distortions not set! ==============&quot;</span>);</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>  }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>  <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>  <span class="keywordflow">return</span> numFields;</div>
<div class="foldopen" id="foldopen01084" data-start="{" data-end="}">
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25bbfc73f9401b5ff205f040606ea926"> 1084</a></span>}</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span> </div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01087" data-start="{" data-end="}">
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e"> 1087</a></span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">SpaceCharge&lt;DataT&gt;::getLocalCorrInterpolator</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>  <span class="keywordflow">if</span> (!mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="foldopen" id="foldopen01090" data-start="{" data-end="}">
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0d78348508facb2e0ea67163d7f1d02"> 1090</a></span>    LOGP(warning, <span class="stringliteral">&quot;============== local corrections not set!  ==============&quot;</span>);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>  }</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>  <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>}</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span> </div>
<div class="foldopen" id="foldopen01096" data-start="{" data-end="}">
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2372e2d84908cc80db73b3c858c99732"> 1096</a></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01097" data-start="{" data-end="}">
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f"> 1097</a></span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">SpaceCharge&lt;DataT&gt;::getGlobalDistInterpolator</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>  <span class="keywordflow">if</span> (!mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    LOGP(warning, <span class="stringliteral">&quot;============== global distortions not set ==============&quot;</span>);</div>
<div class="foldopen" id="foldopen01101" data-start="{" data-end="}">
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a15baa243dd756629892923993d1ec1bf"> 1101</a></span>  }</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>  <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>}</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span> </div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01107" data-start="{" data-end="}">
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa2fc9ad13284a45fde40ff5b0d921fc6"> 1107</a></span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">SpaceCharge&lt;DataT&gt;::getGlobalCorrInterpolator</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>  <span class="keywordflow">if</span> (!mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    LOGP(warning, <span class="stringliteral">&quot;============== global corrections not set ==============&quot;</span>);</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>  }</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>  <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataT&gt;</a> numFields(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], mGrid3D[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="foldopen" id="foldopen01113" data-start="{" data-end="}">
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a65077bfa3724f61f2a744aa4f12cc45c"> 1113</a></span>  <span class="keywordflow">return</span> numFields;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>}</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span> </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01117" data-start="{" data-end="}">
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1"> 1117</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromFile</a>(TFile&amp; fInp, <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a>)</div>
<div class="foldopen" id="foldopen01118" data-start="{" data-end="}">
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af99823b28ab20c478b66288112dc897b"> 1118</a></span>{</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>  TH3* hisSCDensity3D = (TH3*)fInp.Get(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a>);</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>  fillChargeDensityFromHisto(*hisSCDensity3D);</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>  <span class="keyword">delete</span> hisSCDensity3D;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>}</div>
<div class="foldopen" id="foldopen01123" data-start="{" data-end="}">
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec8eb38222b938a1a4c21ddbd934419a"> 1123</a></span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01125" data-start="{" data-end="}">
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dab3e3390f6b9c6fb8019d45070b96e"> 1125</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dab3e3390f6b9c6fb8019d45070b96e">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromCalDet</a>(<span class="keyword">const</span> std::vector&lt;<a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; calSCDensity3D)</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>{</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>  <span class="keyword">const</span> <span class="keyword">auto</span> hConverted = <a class="code hl_function" href="../../d7/dbe/structo2_1_1tpc_1_1painter.html#a30ee13e309499dfd21d3473e03ba3f9a">o2::tpc::painter::convertCalDetToTH3</a>(calSCDensity3D, <span class="keyword">true</span>, mParamGrid.NRVertices, getRMin(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), getRMax(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), mParamGrid.NPhiVertices, getZMax(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>  fillChargeDensityFromHisto(hConverted);</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>}</div>
</div>
<div class="foldopen" id="foldopen01130" data-start="{" data-end="}">
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db"> 1130</a></span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01132" data-start="{" data-end="}">
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3dd986e654962435fabcf1cd8bfa253c"> 1132</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3dd986e654962435fabcf1cd8bfa253c">SpaceCharge&lt;DataT&gt;::fillChargeFromCalDet</a>(<span class="keyword">const</span> std::vector&lt;<a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; calCharge3D)</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>{</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>  <span class="keyword">auto</span> hConverted = <a class="code hl_function" href="../../d7/dbe/structo2_1_1tpc_1_1painter.html#a30ee13e309499dfd21d3473e03ba3f9a">o2::tpc::painter::convertCalDetToTH3</a>(calCharge3D, <span class="keyword">false</span>, mParamGrid.NRVertices, getRMin(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), getRMax(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), mParamGrid.NPhiVertices, getZMax(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>  normalizeHistoQVEps0(hConverted);</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>  fillChargeDensityFromHisto(hConverted);</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>}</div>
</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01140" data-start="{" data-end="}">
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1"> 1140</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromHisto</a>(<span class="keyword">const</span> TH3&amp; hOrig)</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>{</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsZNew = mParamGrid.NZVertices;</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsRNew = mParamGrid.NRVertices;</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nBinsPhiNew = mParamGrid.NPhiVertices;</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span> </div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>  initContainer(mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>  initContainer(mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>], <span class="keyword">true</span>);</div>
<div class="foldopen" id="foldopen01148" data-start="{" data-end="}">
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6"> 1148</a></span> </div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nBinsZNewTwo = 2 * nBinsZNew;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>  <span class="keyword">const</span> <span class="keyword">auto</span> phiLow = hOrig.GetXaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>  <span class="keyword">const</span> <span class="keyword">auto</span> phiUp = hOrig.GetXaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsX());</div>
<div class="foldopen" id="foldopen01152" data-start="{" data-end="}">
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22"> 1152</a></span>  <span class="keyword">const</span> <span class="keyword">auto</span> rLow = hOrig.GetYaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rUp = hOrig.GetYaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsY());</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>  <span class="keyword">const</span> <span class="keyword">auto</span> zLow = hOrig.GetZaxis()-&gt;GetBinLowEdge(1);</div>
<div class="foldopen" id="foldopen01155" data-start="{" data-end="}">
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e763c27749fc15209e03300f0fa01aa"> 1155</a></span>  <span class="keyword">const</span> <span class="keyword">auto</span> zUp = hOrig.GetZaxis()-&gt;GetBinUpEdge(hOrig.GetNbinsZ());</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dim = 3;</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="../../d2/d14/Detectors_2TPC_2qc_2src_2PID_8cxx.html#a86c73ab6f37eae94aef9f27a7e9e2fc0">bins</a>[dim]{nBinsPhiNew, nBinsRNew, nBinsZNewTwo};</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>  <span class="keywordtype">double</span> xmin[dim]{phiLow, rLow, zLow};</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>  <span class="keywordtype">double</span> xmax[dim]{phiUp, rUp, zUp};</div>
<div class="foldopen" id="foldopen01161" data-start="{" data-end="}">
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a24673a83786df4727afdb12165622b5f"> 1161</a></span>  <span class="keyword">const</span> THnSparseF hRebin(<span class="stringliteral">&quot;hTmp&quot;</span>, <span class="stringliteral">&quot;hTmp&quot;</span>, dim, <a class="code hl_variable" href="../../d2/d14/Detectors_2TPC_2qc_2src_2PID_8cxx.html#a86c73ab6f37eae94aef9f27a7e9e2fc0">bins</a>, xmin, xmax);</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span> </div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinPhi = 1; iBinPhi &lt;= nBinsPhiNew; ++iBinPhi) {</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    <span class="keyword">const</span> <span class="keyword">auto</span> phiLowEdge = hRebin.GetAxis(0)-&gt;GetBinLowEdge(iBinPhi);</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <span class="keyword">const</span> <span class="keyword">auto</span> phiUpEdge = hRebin.GetAxis(0)-&gt;GetBinUpEdge(iBinPhi);</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span> </div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> phiLowBinOrig = hOrig.GetXaxis()-&gt;FindBin(phiLowEdge);</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> phiUpBinOrig = hOrig.GetXaxis()-&gt;FindBin(phiUpEdge);</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> </div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <span class="comment">// calculate the weights (area of original bin lies in the new bin / binwidthOrig) of the first and last bins</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>    <span class="keyword">const</span> <span class="keyword">auto</span> binWidthPhiOrig = hOrig.GetXaxis()-&gt;GetBinWidth(phiLowBinOrig);</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightPhi = std::abs(phiLowEdge - hOrig.GetXaxis()-&gt;GetBinUpEdge(phiLowBinOrig)) / binWidthPhiOrig;</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightPhi = std::abs(phiUpEdge - hOrig.GetXaxis()-&gt;GetBinLowEdge(phiUpBinOrig)) / binWidthPhiOrig;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span> </div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinR = 1; iBinR &lt;= nBinsRNew; ++iBinR) {</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>      <span class="keyword">const</span> <span class="keyword">auto</span> rLowEdge = hRebin.GetAxis(1)-&gt;GetBinLowEdge(iBinR);</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>      <span class="keyword">const</span> <span class="keyword">auto</span> rUpEdge = hRebin.GetAxis(1)-&gt;GetBinUpEdge(iBinR);</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span> </div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> rLowBinOrig = hOrig.GetYaxis()-&gt;FindBin(rLowEdge);</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> rUpBinOrig = hOrig.GetYaxis()-&gt;FindBin(rUpEdge);</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span> </div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>      <span class="comment">// calculate the weights (area of original bin lies in the new bin / binwidthOrig) of the first and last bins</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>      <span class="keyword">const</span> <span class="keyword">auto</span> binWidthROrig = hOrig.GetYaxis()-&gt;GetBinWidth(rLowBinOrig);</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>      <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightR = std::abs(rLowEdge - hOrig.GetYaxis()-&gt;GetBinUpEdge(rLowBinOrig)) / binWidthROrig;</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>      <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightR = std::abs(rUpEdge - hOrig.GetYaxis()-&gt;GetBinLowEdge(rUpBinOrig)) / binWidthROrig;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBinZ = 1; iBinZ &lt;= nBinsZNewTwo; ++iBinZ) {</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        <span class="keyword">const</span> <span class="keyword">auto</span> zLowEdge = hRebin.GetAxis(2)-&gt;GetBinLowEdge(iBinZ);</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>        <span class="keyword">const</span> <span class="keyword">auto</span> zUpEdge = hRebin.GetAxis(2)-&gt;GetBinUpEdge(iBinZ);</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>        <span class="keyword">const</span> <span class="keyword">auto</span> zCenter = hRebin.GetAxis(2)-&gt;GetBinCenter(iBinZ);</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>        <span class="keywordtype">int</span> zLowBinOrig = hOrig.GetZaxis()-&gt;FindBin(zLowEdge);</div>
<div class="foldopen" id="foldopen01194" data-start="{" data-end="}">
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2fa1642b32fac6f01ca4f04500c341d1"> 1194</a></span>        <span class="keywordtype">int</span> zUpBinOrig = hOrig.GetZaxis()-&gt;FindBin(zUpEdge);</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> currside = getSide(zCenter); <span class="comment">// set the side of the current z-bin</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        <span class="comment">// get the side of the lowest and uppest bin from the orig histo</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> sideLowOrig = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zLowBinOrig));</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> sideUpOrig = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zUpBinOrig));</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>        <span class="comment">// make bounds/side check of the zLowBinOrig and zUpBinOrig bins. They must be on the same side as the currside!!!</span></div>
<div class="foldopen" id="foldopen01201" data-start="{" data-end="}">
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa631e1ae6ea6fc0b1eb627f7ac8fe2a2"> 1201</a></span>        <span class="keywordflow">if</span> (currside != sideLowOrig &amp;&amp; zLowBinOrig != zUpBinOrig) {</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>          <span class="comment">// if the lower bins from the orig histo are not on the same side as the rebinned increase the binnumber until they are on the same side</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>          <span class="keywordtype">bool</span> notequal = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>          <span class="keywordflow">do</span> {</div>
<div class="foldopen" id="foldopen01205" data-start="{" data-end="}">
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad7c1d42e2cd3ecd129d958b2b1759e05"> 1205</a></span>            zLowBinOrig += 1;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>            <span class="keywordflow">if</span> (zLowBinOrig &gt; zUpBinOrig) {</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>              LOGP(warning, <span class="stringliteral">&quot;SOMETHING WENT WRONG: SETTING BINS TO: {}&quot;</span>, zUpBinOrig);</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>              zLowBinOrig = zUpBinOrig;</div>
<div class="foldopen" id="foldopen01209" data-start="{" data-end="}">
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dfcb180115bfd99f41b8e144a6142e4"> 1209</a></span>              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>            }</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> sideTmp = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zLowBinOrig));</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>            <span class="keywordflow">if</span> (sideTmp == currside) {</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>            }</div>
<div class="foldopen" id="foldopen01215" data-start="{" data-end="}">
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3dfc2263f84e647902150e801ed7d39"> 1215</a></span>          } <span class="keywordflow">while</span> (notequal);</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>        }</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        <span class="keywordflow">if</span> (currside != sideUpOrig &amp;&amp; zLowBinOrig != zUpBinOrig) {</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>          <span class="comment">// if the upper bins from the orig histo are not on the same side as the rebinned increase the binnumber until they are on the same side</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>          <span class="keywordtype">bool</span> notequal = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>          <span class="keywordflow">do</span> {</div>
<div class="foldopen" id="foldopen01222" data-start="{" data-end="}">
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10fcb62febc447a733c8eb5975e8a40e"> 1222</a></span>            zUpBinOrig -= 1;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>            <span class="keywordflow">if</span> (zUpBinOrig &lt; zLowBinOrig) {</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>              LOGP(warning, <span class="stringliteral">&quot;SOMETHING WENT WRONG: SETTING BINS TO: {}&quot;</span>, zLowBinOrig);</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>              zUpBinOrig = zLowBinOrig;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>            }</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> sideTmp = getSide(hOrig.GetZaxis()-&gt;GetBinCenter(zUpBinOrig));</div>
<div class="foldopen" id="foldopen01229" data-start="{" data-end="}">
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f23362f9672c1699bfc58e970c4937b"> 1229</a></span>            <span class="keywordflow">if</span> (sideTmp == currside) {</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>              notequal = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>            }</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>          } <span class="keywordflow">while</span> (notequal);</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        }</div>
<div class="foldopen" id="foldopen01234" data-start="{" data-end="}">
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a97ac150a6f1d354e6b104989d63e313b"> 1234</a></span> </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>        <span class="keyword">const</span> <span class="keyword">auto</span> binWidthZOrig = hOrig.GetZaxis()-&gt;GetBinWidth(zLowBinOrig);</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>        <span class="keyword">const</span> <span class="keyword">auto</span> lowerBinWeightZ = std::abs(zLowEdge - hOrig.GetZaxis()-&gt;GetBinUpEdge(zLowBinOrig)) / binWidthZOrig;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>        <span class="keyword">const</span> <span class="keyword">auto</span> upperBinWeightZ = std::abs(zUpEdge - hOrig.GetZaxis()-&gt;GetBinLowEdge(zUpBinOrig)) / binWidthZOrig;</div>
<div class="foldopen" id="foldopen01238" data-start="{" data-end="}">
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a645b39cfd808df71f11e9608c61c0830"> 1238</a></span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        <span class="comment">// get the mean value of the original histogram of the found bin range</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> = 0;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> sumW = 0;</div>
<div class="foldopen" id="foldopen01242" data-start="{" data-end="}">
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0286a3f4f1f512226d73e758165be16"> 1242</a></span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPhi = phiLowBinOrig; iPhi &lt;= phiUpBinOrig; ++iPhi) {</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> weightPhi = 1;</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>          <span class="keywordflow">if</span> (iPhi == phiLowBinOrig) {</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>            weightPhi = lowerBinWeightPhi;</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iPhi == phiUpBinOrig) {</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            weightPhi = upperBinWeightPhi;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>          }</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span> </div>
<div class="foldopen" id="foldopen01250" data-start="{" data-end="}">
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6e77426db84413f7e5e1a698f493a036"> 1250</a></span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = rLowBinOrig; iR &lt;= rUpBinOrig; ++iR) {</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>            <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> weightR = 1;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>            <span class="keywordflow">if</span> (iR == rLowBinOrig) {</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>              weightR = lowerBinWeightR;</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iR == rUpBinOrig) {</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>              weightR = upperBinWeightR;</div>
<div class="foldopen" id="foldopen01256" data-start="{" data-end="}">
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad10b30bfbc4b208375b11ec43415ddb4"> 1256</a></span>            }</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = zLowBinOrig; iZ &lt;= zUpBinOrig; ++iZ) {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>              <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> weightZ = 1;</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>              <span class="keywordflow">if</span> (iZ == zLowBinOrig) {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>                weightZ = lowerBinWeightZ;</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iZ == zUpBinOrig) {</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>                weightZ = upperBinWeightZ;</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>              }</div>
<div class="foldopen" id="foldopen01265" data-start="{" data-end="}">
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10e3026161c8aa2eaa1982be85d1cd6e"> 1265</a></span>              <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a> = hOrig.GetBinContent(iPhi, iR, iZ);</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>              <span class="comment">// if(val==0){</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>              <span class="comment">// what to do now???</span></div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>              <span class="comment">// }</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>              <span class="keyword">const</span> <span class="keyword">auto</span> totalWeight = weightPhi * weightR * weightZ;</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>              <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> += <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a> * totalWeight;</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>              sumW += totalWeight;</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>            }</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>          }</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        }</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a> /= sumW;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>        <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iBinZ &gt; mParamGrid.NZVertices) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> : <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>::<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">C</a>;</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> iZ = (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>) ? (iBinZ - mParamGrid.NZVertices - 1) : (mParamGrid.NZVertices - iBinZ);</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>        mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iBinR - 1, iBinPhi - 1) = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">sum</a>;</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>      }</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>    }</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>  }</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>}</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span> </div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="foldopen" id="foldopen01286" data-start="{" data-end="}">
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa585f3a2ce68bf3bd40768aa377aa855"> 1286</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">SpaceCharge&lt;DataT&gt;::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">SpaceCharge&lt;DataT&gt;::Type</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> ElectricFields&amp; formulaStruct)</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>{</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>    initContainer(mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    initContainer(mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    initContainer(mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>    initContainer(mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>    initContainer(mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>    initContainer(mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>  }</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>  <span class="comment">// calculate local distortions/corrections for each vertex in the tpc</span></div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>        <span class="comment">// set z coordinate depending on distortions or correction calculation</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0 = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ + 1, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1 = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ + 1, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span> </div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> drTmp = 0;   <span class="comment">// local distortion dR</span></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dPhiTmp = 0; <span class="comment">// local distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dzTmp = 0;   <span class="comment">// local distortion dZ</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span> </div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSize = (z1 - z0) / sSteps; <span class="comment">// the distortions are calculated by leting the elctron drift this distance in z direction</span></div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; sSteps; ++iter) {</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0Tmp = (z0 + iter * stepSize + dzTmp); <span class="comment">// starting z position</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1Tmp = (z0Tmp + stepSize);             <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span> </div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span> </div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusTmp = regulateR(radius + drTmp, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current radial position</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiTmp = regulatePhi(phi + dPhiTmp, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);   <span class="comment">// current phi position</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>          <span class="comment">// calculate distortions/corrections</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>          calcDistCorr(radiusTmp, phiTmp, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct, <span class="keyword">true</span>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>          <span class="comment">// add temp distortions to local distortions</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>          drTmp += ddR;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>          dPhiTmp += ddPhi;</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>          dzTmp += ddZ;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        }</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span> </div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>        <span class="comment">// store local distortions/corrections</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>        <span class="keywordflow">switch</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>            mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = drTmp;</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dPhiTmp * radius;</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>            mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dzTmp;</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span> </div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>            mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drTmp;</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>            mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dPhiTmp * radius;</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>            mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzTmp;</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>        }</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>      }</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>      <span class="comment">// extrapolate local distortion/correction to last/first bin using legendre polynoms with x0=0, x1=1, x2=2 and x=-1. This has to be done to ensure correct interpolation in the last,second last/first,second bin!</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>      <span class="keywordflow">switch</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>        <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>          mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>          mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>          mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span> </div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>        <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>          mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>          mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>          mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>      }</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    }</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>  }</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>}</div>
</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span> </div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="foldopen" id="foldopen01370" data-start="{" data-end="}">
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f"> 1370</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">SpaceCharge&lt;DataT&gt;::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> ElectricFields&amp; formulaStruct)</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>{</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>  initContainer(mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>  initContainer(mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>  initContainer(mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>  initContainer(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>  initContainer(mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>  initContainer(mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>  <span class="comment">// calculate local distortion/correction vector for each vertex in the tpc</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField = getEzField(formulaStruct.getSide());</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> er = mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ez0 = mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ephi = mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi);</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ez = getSign(formulaStruct.getSide()) * 1. / (ezField + ez0);</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> erez = er * ez;</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ephiez = ephi * ez;</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span> </div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> vecdR = mC0 * erez + mC1 * ephiez;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> vecdRPhi = mC0 * ephiez - mC1 * erez;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> vecdZ = -ez0 * <a class="code hl_struct" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">TPCParameters&lt;DataT&gt;::DVDE</a>;</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span> </div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdR;</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdRPhi;</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>        mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = vecdZ;</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>      }</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>    }</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>  }</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>}</div>
</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span> </div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ElectricFields&gt;</div>
<div class="foldopen" id="foldopen01406" data-start="{" data-end="}">
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af8775655acd2df55f4e312a0fd83a70c"> 1406</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7cf35cd4d86df75c69cb3a79697775d7">SpaceCharge&lt;DataT&gt;::calcLocalDistortionsCorrectionsRK4</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">SpaceCharge&lt;DataT&gt;::Type</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>{</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>    initContainer(mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>    initContainer(mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>    initContainer(mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    initContainer(mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>    initContainer(mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>    initContainer(mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>  }</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>  <span class="comment">// see: https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods</span></div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>  <span class="comment">// calculate local distortions/corrections for each vertex in the tpc using Runge Kutta 4 method</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>        <span class="comment">// set z coordinate depending on distortions or correction calculation</span></div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ0 = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? iZ + 1 : iZ;</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZ1 = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? iZ : iZ + 1;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span> </div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ1, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSize = z1 - z0; <span class="comment">// h in the RK4 method</span></div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> absstepSize = std::abs(stepSize);</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span> </div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSizeHalf = 0.5 * stepSize; <span class="comment">// half z bin for RK4</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> absstepSizeHalf = std::abs(stepSizeHalf);</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span> </div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        <span class="comment">// starting position for RK4</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zk1 = z0;</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rk1 = radius;</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phik1 = phi;</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span> </div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k1dR = 0;    <span class="comment">// derivative in r direction</span></div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k1dZ = 0;    <span class="comment">// derivative in z direction</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k1dRPhi = 0; <span class="comment">// derivative in rphi direction</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span> </div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>        <span class="comment">// get derivative on current vertex</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>        <span class="keywordflow">switch</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>            k1dR = getLocalVecCorrR(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>            k1dZ = getLocalVecCorrZ(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>            k1dRPhi = getLocalVecCorrRPhi(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span> </div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>            k1dR = getLocalVecDistR(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>            k1dZ = getLocalVecDistZ(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>            k1dRPhi = getLocalVecDistRPhi(iZ0, iR, iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>        }</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span> </div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>        <span class="comment">// approximate position after half stepSize</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zk2 = zk1 + stepSizeHalf + absstepSizeHalf * k1dZ;</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rk2 = rk1 + absstepSizeHalf * k1dR;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k1dPhi = k1dRPhi / rk1;</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phik2 = phik1 + absstepSizeHalf * k1dPhi;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <span class="comment">// get derivative for new position</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k2dR = 0;</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k2dZ = 0;</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k2dRPhi = 0;</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>        <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk2, rk2, phik2, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k2dZ, k2dR, k2dRPhi) : getLocalDistortionVectorCyl(zk2, rk2, phik2, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k2dZ, k2dR, k2dRPhi);</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span> </div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <span class="comment">// approximate new position</span></div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zk3 = zk1 + stepSizeHalf + absstepSizeHalf * k2dZ;</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rk3 = rk1 + absstepSizeHalf * k2dR;</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k2dPhi = k2dRPhi / rk2;</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phik3 = phik1 + absstepSizeHalf * k2dPhi;</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span> </div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k3dR = 0;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k3dZ = 0;</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k3dRPhi = 0;</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>        <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk3, rk3, phik3, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k3dZ, k3dR, k3dRPhi) : getLocalDistortionVectorCyl(zk3, rk3, phik3, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k3dZ, k3dR, k3dRPhi);</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span> </div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zk4 = zk1 + stepSize + absstepSize * k3dZ;</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rk4 = rk1 + absstepSize * k3dR;</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k3dPhi = k3dRPhi / rk3;</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phik4 = phik1 + absstepSize * k3dPhi;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k4dR = 0;</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k4dZ = 0;</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k4dRPhi = 0;</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>        <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Corrections ? getLocalCorrectionVectorCyl(zk4, rk4, phik4, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k4dZ, k4dR, k4dRPhi) : getLocalDistortionVectorCyl(zk4, rk4, phik4, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, k4dZ, k4dR, k4dRPhi);</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> k4dPhi = k4dRPhi / rk4;</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>        <span class="comment">// RK4 formula. See wikipedia: u = h * 1/6 * (k1 + 2*k2 + 2*k3 + k4)</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepsizeSixth = absstepSize / 6;</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> drRK = stepsizeSixth * (k1dR + 2 * k2dR + 2 * k3dR + k4dR);</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dzRK = stepsizeSixth * (k1dZ + 2 * k2dZ + 2 * k3dZ + k4dZ);</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dphiRK = stepsizeSixth * (k1dPhi + 2 * k2dPhi + 2 * k3dPhi + k4dPhi);</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span> </div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>        <span class="comment">// store local distortions/corrections</span></div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>        <span class="keywordflow">switch</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>          <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>            mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = drRK;</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>            mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dphiRK * radius;</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>            mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ + 1, iR, iPhi) = dzRK;</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span> </div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>          <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>            mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drRK;</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>            mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dphiRK * radius;</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>            mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzRK;</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>        }</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>      }</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>      <span class="comment">// extrapolate local distortion/correction to last/first bin using legendre polynoms with x0=0, x1=1, x2=2 and x=-1. This has to be done to ensure correct interpolation in the last,second last/first,second bin!</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>      <span class="keywordflow">switch</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>) {</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        <span class="keywordflow">case</span> Type::Corrections:</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>          mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>          mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>          mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](0, iR, iPhi) = 3 * (mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](1, iR, iPhi) - mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](2, iR, iPhi)) + mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](3, iR, iPhi);</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span> </div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        <span class="keywordflow">case</span> Type::Distortions:</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>          mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>          mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>          mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 1, iR, iPhi) = 3 * (mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 2, iR, iPhi) - mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 3, iR, iPhi)) + mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](mParamGrid.NZVertices - 4, iR, iPhi);</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>      }</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    }</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>  }</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>}</div>
</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span> </div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="foldopen" id="foldopen01537" data-start="{" data-end="}">
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03"> 1537</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">SpaceCharge&lt;DataT&gt;::calcGlobalDistortions</a>(<span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations)</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>{</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>  initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>  initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>  initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSize = formulaStruct.getID() == 2 ? getGridSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : getGridSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / sSteps; <span class="comment">// if one used local distortions then no smaller stepsize is needed. if electric fields are used then smaller stepsize can be used</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>  <span class="comment">// loop over tpc volume and let the electron drift from each vertex to the readout of the tpc</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> r0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices - 1; ++iZ) {</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// the electron starts at z0, r0, phi0</span></div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> drDist = 0.0;                    <span class="comment">// global distortion dR</span></div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dPhiDist = 0.0;                  <span class="comment">// global distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dzDist = 0.0;                    <span class="comment">// global distortion dZ</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>        <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span> </div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>          <span class="keywordflow">if</span> (iter &gt; maxIterations) {</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>            LOGP(error, <span class="stringliteral">&quot;Aborting calculation of distortions for iZ: {}, iR: {}, iPhi: {} due to iteration &#39;{}&#39; &gt; maxIterations &#39;{}&#39;!&quot;</span>, iZ, iR, iPhi, iter, maxIterations);</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>          }</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0Tmp = z0 + dzDist + iter * stepSize; <span class="comment">// starting z position</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span> </div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>          <span class="comment">// do not do check for first iteration</span></div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>          <span class="keywordflow">if</span> ((getSide(z0Tmp) != <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) &amp;&amp; iter) {</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>            LOGP(error, <span class="stringliteral">&quot;Aborting calculation of distortions for iZ: {}, iR: {}, iPhi: {} due to change in the sides!&quot;</span>, iZ, iR, iPhi);</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>          }</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span> </div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1Tmp = z0Tmp + stepSize;                 <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = regulateR(r0 + drDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);    <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = regulatePhi(phi0 + dPhiDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span> </div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span> </div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>          <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>          processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct);</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span> </div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>          <span class="comment">// if one uses local distortions the interpolated value for the last bin has to be scaled.</span></div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>          <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the last bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>          <span class="keyword">const</span> <span class="keywordtype">bool</span> checkReached = <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? z1Tmp &gt;= getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : z1Tmp &lt;= getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>          <span class="keywordflow">if</span> (formulaStruct.getID() == 2 &amp;&amp; checkReached) {</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fac = std::abs((getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - z0Tmp) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>            ddR *= fac;</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>            ddZ *= fac;</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>            ddPhi *= fac;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>          }</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span> </div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>          <span class="comment">// add local distortions to global distortions</span></div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>          drDist += ddR;</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>          dPhiDist += ddPhi;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>          dzDist += ddZ;</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span> </div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>          <span class="comment">// set loop to exit if the readout is reached and approximate distortion of &#39;missing&#39; (one never ends exactly on the readout: z1Tmp + ddZ != ZMAX) drift distance.</span></div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>          <span class="comment">// approximation is done by the current calculated values of the distortions and scaled linear to the &#39;missing&#39; distance.</span></div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>          <span class="keywordflow">if</span> (checkReached) {</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaZ = getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - endPoint; <span class="comment">// distance from last point to read out</span></div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diff = endPoint - z0Tmp;</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fac = diff != 0 ? std::abs(deltaZ / diff) : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>            drDist += ddR * fac;</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>            dPhiDist += ddPhi * fac;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>            dzDist += ddZ * fac;</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>          }</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>          ++iter;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        }</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        <span class="comment">// store global distortions</span></div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = drDist;</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>        mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dPhiDist * r0;</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = dzDist;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>      }</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>    }</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>  }</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>}</div>
</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span> </div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Formulas&gt;</div>
<div class="foldopen" id="foldopen01621" data-start="{" data-end="}">
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a86726163643882853c8750b6abe96662"> 1621</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">SpaceCharge&lt;DataT&gt;::calcGlobalCorrections</a>(<span class="keyword">const</span> Formulas&amp; formulaStruct, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>)</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>{</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>  <span class="keyword">using </span>timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>  <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = formulaStruct.getSide();</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>  initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>  initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>  initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span> </div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iSteps = formulaStruct.getID() == 2 ? 1 : sSteps; <span class="comment">// if one used local corrections no step width is needed. since it is already used for calculation of the local corrections</span></div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSize = -getGridSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / iSteps;</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span><span class="comment">// loop over tpc volume and let the electron drift from each vertex to the readout of the tpc</span></div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span> </div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> r0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> drCorr = 0;</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dPhiCorr = 0;</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dzCorr = 0;</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>      <span class="keywordtype">bool</span> isOutOfVolume = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span> </div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>      <span class="comment">// start at the readout and follow electron towards central electrode</span></div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = mParamGrid.NZVertices - 1; iZ &gt;= 1; --iZ) {</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0 = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// the electron starts at z0, r0, phi0</span></div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>        <span class="comment">// flag which is set when the central electrode is reached. if the central electrode is reached the calculation of the global corrections is aborted and the value set is the last calculated value.</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>        <span class="keywordtype">bool</span> centralElectrodeReached = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; iSteps; ++iter) {</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>          <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> != 3) &amp;&amp; (centralElectrodeReached || isOutOfVolume)) {</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>          }</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = r0 + drCorr;                        <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = phi0 + dPhiCorr;                       <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0Tmp = z0 + dzCorr + iter * stepSize; <span class="comment">// starting z position</span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1Tmp = z0Tmp + stepSize;                    <span class="comment">// follow electron from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span> </div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>          <span class="comment">// restrict to inner TPC volume</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>          <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> != 3) {</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>            radius = regulateR(radius, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>            phi = regulatePhi(phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>            z1Tmp = regulateZ(z1Tmp, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>          }</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span> </div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddR = 0;   <span class="comment">// distortion dR for z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span> </div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>          <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>          processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, formulaStruct);</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span> </div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>          <span class="comment">// if one uses local corrections the interpolated value for the first bin has to be scaled.</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>          <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the first bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>          centralElectrodeReached = getSign(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * z1Tmp &lt;= getZMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>          <span class="keywordflow">if</span> (formulaStruct.getID() == 2 &amp;&amp; centralElectrodeReached) {</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fac = (z0Tmp - getZMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)) * getInvSpacingZ(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>            ddR *= fac;</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>            ddZ *= fac;</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>            ddPhi *= fac;</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>          }</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span> </div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>          <span class="comment">// calculate current r and z position after correction</span></div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rCurr = r0 + drCorr + ddR;</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zCurr = z0Tmp + dzCorr + ddZ + stepSize;</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span> </div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>          <span class="comment">// check if current position lies in the TPC volume if not the electron gets corrected outside of the TPC volume and the calculation of the following corrections can be skipped</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>          <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> != 3) &amp;&amp; (rCurr &lt;= getRMinSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || rCurr &gt;= getRMaxSim(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || (std::abs(zCurr) &gt; 1.2 * std::abs(getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))))) {</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>            isOutOfVolume = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>          }</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span> </div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>          <span class="comment">// add local corrections to global corrections</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>          drCorr += ddR;</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>          dPhiCorr += ddPhi;</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>          dzCorr += ddZ;</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span> </div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>          <span class="comment">// set loop to exit if the central electrode is reached and approximate correction of &#39;missing&#39; (one never ends exactly on the central electrode: z1Tmp + ddZ != ZMIN) distance.</span></div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>          <span class="comment">// approximation is done by the current calculated values of the corrections and scaled linear to the &#39;missing&#39; distance deltaZ. (NOT TESTED)</span></div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>          <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> != 3) &amp;&amp; centralElectrodeReached) {</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaZ = endPoint - getZMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diff = z0Tmp - endPoint;</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fac = diff != 0 ? deltaZ / diff : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>            drCorr += ddR * fac;</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            dPhiCorr += ddPhi * fac;</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>            dzCorr += ddZ * fac;</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>          }</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>        }</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        <span class="comment">// store global corrections</span></div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>        <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 1 || <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 2) &amp;&amp; (centralElectrodeReached || isOutOfVolume)) {</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>          mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = -1;</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>          mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = -1;</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>          mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = -1;</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>          mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = drCorr;</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>          mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = dPhiCorr * r0;</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>          mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ - 1, iR, iPhi) = dzCorr;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>        }</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>      }</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>    }</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span> </div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>    <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> != 0) {</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>      <span class="comment">// fill / extrapolate out of volume values along r</span></div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = mParamGrid.NZVertices - 1; iZ &gt;= 0; --iZ) {</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>        <span class="comment">// from middle of the radius to IFC</span></div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = (mParamGrid.NRVertices / 2); iR &gt;= 0; --iR) {</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>          <span class="keywordflow">if</span> ((mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1) &amp;&amp; (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1) &amp;&amp; (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1)) {</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>            <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUp = iR + 1;</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>            <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 1) {</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>              <span class="comment">// just replace with last valid number (assumption: values at iR==mParamGrid.NRVertices / 2 are valid)</span></div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>              mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>              mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>              mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 2) {</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>              <span class="comment">// extrapolate values</span></div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>              <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUpTwo = iR + 2;</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>              <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUpThree = iR + 3;</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>              mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>              mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>              mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>            }</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>          }</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>        }</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>        <span class="comment">// from middle of the radius to OFC</span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = (mParamGrid.NRVertices / 2); iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>          <span class="keywordflow">if</span> ((mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1) &amp;&amp; (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1) &amp;&amp; (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) == -1)) {</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>            <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUp = iR - 1;</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>            <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 1) {</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>              <span class="comment">// just replace with last valid number (assumption: values at iR==mParamGrid.NRVertices / 2 are valid)</span></div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>              mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>              mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>              mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi);</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 2) {</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>              <span class="comment">// extrapolate values</span></div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>              <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUpTwo = iR - 2;</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>              <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRUpThree = iR - 3;</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>              mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>              mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>              mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = 3 * (mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUp, iPhi) - mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpTwo, iPhi)) + mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRUpThree, iPhi);</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>            }</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>          }</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>        }</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>      }</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>    }</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>  }</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>  <span class="comment">// set flag that global corrections are set to true</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>  <span class="keyword">auto</span> stop = timer::now();</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>  std::chrono::duration&lt;float&gt; <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> totalTime = <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count();</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>  LOGP(detail, <span class="stringliteral">&quot;calcGlobalCorrections took {}s&quot;</span>, totalTime);</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>}</div>
</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span> </div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01775" data-start="{" data-end="}">
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881"> 1775</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881">SpaceCharge&lt;DataT&gt;::correctElectron</a>(<a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a>&amp; point)</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>{</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrX{};</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrY{};</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrZ{};</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(point.Z());</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span> </div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>  <span class="comment">// get the distortions for input coordinate</span></div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>  getCorrections(point.X(), point.Y(), point.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ);</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>  <span class="comment">// set distorted coordinates</span></div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>  point.SetXYZ(point.X() + corrX, point.Y() + corrY, point.Y() + corrY);</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>}</div>
</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span> </div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01790" data-start="{" data-end="}">
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec913e3cee7451e5101682da4d706e0b"> 1790</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec913e3cee7451e5101682da4d706e0b">SpaceCharge&lt;DataT&gt;::distortElectron</a>(<a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a>&amp; point, <span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>* scSCale, <span class="keywordtype">float</span> scale)<span class="keyword"> const</span></div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distX{};</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distY{};</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distZ{};</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(point.Z());</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>  <span class="comment">// get the distortions for input coordinate</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>  getDistortions(point.X(), point.Y(), point.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distX, distY, distZ);</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span> </div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distXTmp{};</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distYTmp{};</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distZTmp{};</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span> </div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>  <span class="comment">// scale distortions if requested</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>  <span class="keywordflow">if</span> (scSCale &amp;&amp; scale != 0) {</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>    scSCale-&gt;<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">getDistortions</a>(point.X() + distX, point.Y() + distY, point.Z() + distZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distXTmp, distYTmp, distZTmp);</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>    distX += distXTmp * scale;</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>    distY += distYTmp * scale;</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    distZ += distZTmp * scale;</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>  }</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span> </div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>  <a class="code hl_define" href="../../df/d21/GPUCommonDef_8h.html#a0117e1486062f932ded994de0d587344">GPUCA_DEBUG_STREAMER_CHECK</a>(<span class="keywordflow">if</span> (o2::utils::DebugStreamer::checkStream(<a class="code hl_enumvalue" href="../../d0/d28/namespaceo2_1_1utils.html#ab00bdc0f94fa861734930fc91cf67e14ad7118865304df8cdfc1d7f6fb8e345eb">o2::utils::StreamFlags::streamDistortionsSC</a>)) {</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>(point);</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>    <span class="keywordtype">float</span> phi = std::atan2(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.Y(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.X());</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    <span class="keywordflow">if</span> (phi &lt; 0.) {</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>      phi += <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a46d4efacb76f289c08e855e8325c8bc9">TWOPI</a>;</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>    }</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> secNum = std::floor(phi / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a64ab5278b1755af95e5ecd8d36409612">SECPHIWIDTH</a>);</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>    <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sector(secNum + (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.Z() &lt; 0) * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>);</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>    <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> lPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7962684772bd8bf62a60941ea4312cb2">Mapper::GlobalToLocal</a>(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>, sector);</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span> </div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>    o2::utils::DebugStreamer::instance()-&gt;getStreamer(<span class="stringliteral">&quot;debug_distortElectron&quot;</span>, <span class="stringliteral">&quot;UPDATE&quot;</span>) &lt;&lt; o2::utils::DebugStreamer::instance()-&gt;getUniqueTreeName(<span class="stringliteral">&quot;debug_distortElectron&quot;</span>).data()</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;pos=&quot;</span> &lt;&lt; <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a></div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;lPos=&quot;</span> &lt;&lt; lPos</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;phi=&quot;</span> &lt;&lt; phi</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;secNum=&quot;</span> &lt;&lt; secNum</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distX=&quot;</span> &lt;&lt; distX</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distY=&quot;</span> &lt;&lt; distY</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distZ=&quot;</span> &lt;&lt; distZ</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distXDer=&quot;</span> &lt;&lt; distXTmp</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distYDer=&quot;</span> &lt;&lt; distYTmp</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;distZDer=&quot;</span> &lt;&lt; distZTmp</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;scale=&quot;</span> &lt;&lt; scale</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>                                                                                         &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>  })</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span> </div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>  <span class="comment">// set distorted coordinates</span></div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>  point.SetXYZ(point.X() + distX, point.Y() + distY, point.Z() + distZ);</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>}</div>
</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span> </div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01841" data-start="{" data-end="}">
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d"> 1841</a></span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">SpaceCharge&lt;DataT&gt;::getDensityCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>  <span class="keywordflow">return</span> mInterpolatorDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>}</div>
</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span> </div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01847" data-start="{" data-end="}">
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5122f33cc90c828f2fa7284a4b04d043"> 1847</a></span>std::vector&lt;float&gt; <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">SpaceCharge&lt;DataT&gt;::getDensityCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>  std::vector&lt;float&gt; density(nPoints);</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>    density[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = getDensityCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>  }</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>  <span class="keywordflow">return</span> density;</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>}</div>
</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span> </div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01859" data-start="{" data-end="}">
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48"> 1859</a></span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">SpaceCharge&lt;DataT&gt;::getPotentialCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>  <span class="keywordflow">return</span> mInterpolatorPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>}</div>
</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span> </div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01865" data-start="{" data-end="}">
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a60da58dfd88a8fc17474ed206ef6ff9e"> 1865</a></span>std::vector&lt;float&gt; <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">SpaceCharge&lt;DataT&gt;::getPotentialCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>  std::vector&lt;float&gt; potential(nPoints);</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>    potential[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = getPotentialCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>  }</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>  <span class="keywordflow">return</span> potential;</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span>}</div>
</div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span> </div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01877" data-start="{" data-end="}">
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043"> 1877</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043">SpaceCharge&lt;DataT&gt;::getElectricFieldsCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; eZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; eR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ePhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>  eZ = mInterpolatorEField[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalFieldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>  eR = mInterpolatorEField[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalFieldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>  ePhi = mInterpolatorEField[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evalFieldPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>}</div>
</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span> </div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01885" data-start="{" data-end="}">
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2"> 1885</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">SpaceCharge&lt;DataT&gt;::getLocalCorrectionsCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lcorrZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lcorrR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lcorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>  lcorrZ = mInterpolatorLocalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>  lcorrR = mInterpolatorLocalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>  lcorrRPhi = mInterpolatorLocalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>}</div>
</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span> </div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01893" data-start="{" data-end="}">
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae4eb9dfe90bd58959447c41842b400b5"> 1893</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">SpaceCharge&lt;DataT&gt;::getLocalCorrectionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lcorrZ, std::vector&lt;DataT&gt;&amp; lcorrR, std::vector&lt;DataT&gt;&amp; lcorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>  lcorrZ.resize(nPoints);</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>  lcorrR.resize(nPoints);</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>  lcorrRPhi.resize(nPoints);</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>    getLocalCorrectionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, lcorrZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lcorrR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lcorrRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>  }</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>}</div>
</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span> </div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01906" data-start="{" data-end="}">
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676"> 1906</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">SpaceCharge&lt;DataT&gt;::getCorrectionsCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>  corrZ = mInterpolatorGlobalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span>  corrR = mInterpolatorGlobalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span>  corrRPhi = mInterpolatorGlobalCorr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>}</div>
</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span> </div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01914" data-start="{" data-end="}">
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abdb871166e6604ba577957b30c8075c4"> 1914</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">SpaceCharge&lt;DataT&gt;::getCorrectionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; corrZ, std::vector&lt;DataT&gt;&amp; corrR, std::vector&lt;DataT&gt;&amp; corrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>  corrZ.resize(nPoints);</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>  corrR.resize(nPoints);</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>  corrRPhi.resize(nPoints);</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>    getCorrectionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], corrR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], corrRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>  }</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>}</div>
</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span> </div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01927" data-start="{" data-end="}">
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176"> 1927</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">SpaceCharge&lt;DataT&gt;::getCorrections</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrX, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrY, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; corrZ)<span class="keyword"> const</span></div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>  <span class="keywordflow">if</span> (mUseAnaDistCorr) {</div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>    getCorrectionsAnalytical(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrX, corrY, corrZ);</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>    <span class="comment">// convert cartesian to polar</span></div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = getRadiusFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = getPhiFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>    <a class="code hl_function" href="../../d4/dbd/namespaceo2_1_1math__utils_1_1detail.html#a06b6251b62a6bc134449253ce0046663">o2::math_utils::detail::bringTo02PiGen</a>(phi);</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span> </div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrR{};</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrRPhi{};</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>    getCorrectionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ, corrR, corrRPhi);</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span> </div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>    <span class="comment">// Calculate corrected position</span></div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusCorr = radius + corrR;</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiCorr = phi + corrRPhi / radius;</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span> </div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>    corrX = getXFromPolar(radiusCorr, phiCorr) - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>; <span class="comment">// difference between corrected and original x coordinate</span></div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>    corrY = getYFromPolar(radiusCorr, phiCorr) - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>; <span class="comment">// difference between corrected and original y coordinate</span></div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>  }</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>}</div>
</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span> </div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01951" data-start="{" data-end="}">
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86"> 1951</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">SpaceCharge&lt;DataT&gt;::getLocalDistortionsCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ldistZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ldistR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ldistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>  ldistZ = mInterpolatorLocalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>  ldistR = mInterpolatorLocalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>  ldistRPhi = mInterpolatorLocalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>}</div>
</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span> </div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01959" data-start="{" data-end="}">
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac34ea9c44d2f1e891f86a5dde307749e"> 1959</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">SpaceCharge&lt;DataT&gt;::getLocalDistortionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; ldistZ, std::vector&lt;DataT&gt;&amp; ldistR, std::vector&lt;DataT&gt;&amp; ldistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>  ldistZ.resize(nPoints);</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>  ldistR.resize(nPoints);</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>  ldistRPhi.resize(nPoints);</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>    getLocalDistortionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, ldistZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], ldistR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], ldistRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span>  }</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>}</div>
</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span> </div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01972" data-start="{" data-end="}">
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f"> 1972</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">SpaceCharge&lt;DataT&gt;::getLocalDistortionVectorCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lvecdistZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lvecdistR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lvecdistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>  lvecdistZ = mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>  lvecdistR = mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>  lvecdistRPhi = mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>}</div>
</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span> </div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01980" data-start="{" data-end="}">
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25ce586cf19f34be49b0c1dbba57c79d"> 1980</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">SpaceCharge&lt;DataT&gt;::getLocalDistortionVectorCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lvecdistZ, std::vector&lt;DataT&gt;&amp; lvecdistR, std::vector&lt;DataT&gt;&amp; lvecdistRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>  lvecdistZ.resize(nPoints);</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>  lvecdistR.resize(nPoints);</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>  lvecdistRPhi.resize(nPoints);</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>    getLocalDistortionVectorCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, lvecdistZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lvecdistR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lvecdistRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>  }</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>}</div>
</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span> </div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen01993" data-start="{" data-end="}">
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8"> 1993</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">SpaceCharge&lt;DataT&gt;::getLocalCorrectionVectorCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lveccorrZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lveccorrR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; lveccorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>  lveccorrZ = -mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>  lveccorrR = -mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>  lveccorrRPhi = -mInterpolatorLocalVecDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>}</div>
</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span> </div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02001" data-start="{" data-end="}">
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7a1077333667739133b0ed53354294d5"> 2001</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">SpaceCharge&lt;DataT&gt;::getLocalCorrectionVectorCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; lveccorrZ, std::vector&lt;DataT&gt;&amp; lveccorrR, std::vector&lt;DataT&gt;&amp; lveccorrRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>  lveccorrZ.resize(nPoints);</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>  lveccorrR.resize(nPoints);</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>  lveccorrRPhi.resize(nPoints);</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>    getLocalCorrectionVectorCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, lveccorrZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lveccorrR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], lveccorrRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>  }</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span>}</div>
</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span> </div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02014" data-start="{" data-end="}">
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797"> 2014</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">SpaceCharge&lt;DataT&gt;::getDistortionsCyl</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distZ, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>  distZ = mInterpolatorGlobalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>  distR = mInterpolatorGlobalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldR(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>  distRPhi = mInterpolatorGlobalDist[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].evaldRPhi(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi);</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>}</div>
</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span> </div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02022" data-start="{" data-end="}">
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb0e50f91355e2e621479f2beffec4bd"> 2022</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">SpaceCharge&lt;DataT&gt;::getDistortionsCyl</a>(<span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <span class="keyword">const</span> std::vector&lt;DataT&gt;&amp; phi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::vector&lt;DataT&gt;&amp; distZ, std::vector&lt;DataT&gt;&amp; distR, std::vector&lt;DataT&gt;&amp; distRPhi)<span class="keyword"> const</span></div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>  <span class="keyword">const</span> <span class="keyword">auto</span> nPoints = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>.size();</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>  distZ.resize(nPoints);</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>  distR.resize(nPoints);</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>  distRPhi.resize(nPoints);</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>    getDistortionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], phi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distZ[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], distR[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>], distRPhi[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>  }</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>}</div>
</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span> </div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02035" data-start="{" data-end="}">
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032"> 2035</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">SpaceCharge&lt;DataT&gt;::getDistortions</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distX, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distY, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distZ)<span class="keyword"> const</span></div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zClamped = regulateZ(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span> </div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>  <span class="keywordflow">if</span> (mUseAnaDistCorr) {</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>    getDistortionsAnalytical(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, zClamped, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distX, distY, distZ);</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    <span class="comment">// convert cartesian to polar</span></div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = getRadiusFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = getPhiFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span> </div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distR{};</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distRPhi{};</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rClamped = regulateR(radius, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>    getDistortionsCyl(zClamped, rClamped, phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distZ, distR, distRPhi);</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span> </div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>    <span class="comment">// Calculate distorted position</span></div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusDist = rClamped + distR;</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiDist = phi + distRPhi / rClamped;</div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span> </div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>    distX = getXFromPolar(radiusDist, phiDist) - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>; <span class="comment">// difference between distorted and original x coordinate</span></div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>    distY = getYFromPolar(radiusDist, phiDist) - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>; <span class="comment">// difference between distorted and original y coordinate</span></div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>  }</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>}</div>
</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span> </div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a92d6d29cf16721a3aa7772cbc9b3e0a7">SpaceCharge&lt;DataT&gt;::getDistortionsCorrectionsAnalytical</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distX, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distY, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; distZ, <span class="keyword">const</span> <span class="keywordtype">bool</span> dist)<span class="keyword"> const</span></div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>);</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>  <span class="keywordtype">float</span> phi = std::atan2(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.Y(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.X());</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>  <span class="keywordflow">if</span> (phi &lt; 0.) {</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>    phi += <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a46d4efacb76f289c08e855e8325c8bc9">TWOPI</a>;</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span>  }</div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> secNum = std::floor(phi / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a64ab5278b1755af95e5ecd8d36409612">SECPHIWIDTH</a>);</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sector(secNum + (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.Z() &lt; 0) * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>);</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> lPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7962684772bd8bf62a60941ea4312cb2">Mapper::GlobalToLocal</a>(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>, sector);</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span> </div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>  <span class="comment">// convert dlx and dlY to r, rPhi</span></div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dlX = dist ? mAnaDistCorr.getDistortionsLX(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : mAnaDistCorr.getCorrectionsLX(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dlY = dist ? mAnaDistCorr.getDistortionsLY(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : mAnaDistCorr.getCorrectionsLY(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dlZ = dist ? mAnaDistCorr.getDistortionsLZ(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : mAnaDistCorr.getCorrectionsLZ(lPos.X(), lPos.Y(), lPos.Z(), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span> </div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>  <span class="comment">// convert distortios in local coordinates to global coordinates</span></div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>  <span class="comment">// distorted local position</span></div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> lPosDist(lPos.X() + dlX, lPos.Y() + dlY, lPos.Z() + dlZ);</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span> </div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>  <span class="comment">// calc global position</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>  <span class="keyword">const</span> <span class="keyword">auto</span> globalPosDist = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ac3a82fbb8b2684194432dd095da3abfb">Mapper::LocalToGlobal</a>(lPosDist, sector);</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>  distX = globalPosDist.X() - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>;</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>  distY = globalPosDist.Y() - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a>;</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>  distZ = globalPosDist.Z() - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>;</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span> </div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>  <a class="code hl_define" href="../../df/d21/GPUCommonDef_8h.html#a0117e1486062f932ded994de0d587344">GPUCA_DEBUG_STREAMER_CHECK</a>(<span class="keywordflow">if</span> (o2::utils::DebugStreamer::checkStream(<a class="code hl_enumvalue" href="../../d0/d28/namespaceo2_1_1utils.html#ab00bdc0f94fa861734930fc91cf67e14ad7118865304df8cdfc1d7f6fb8e345eb">o2::utils::StreamFlags::streamDistortionsSC</a>)) {</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>    o2::utils::DebugStreamer::instance()-&gt;getStreamer(<span class="stringliteral">&quot;debug_distortions_analytical&quot;</span>, <span class="stringliteral">&quot;UPDATE&quot;</span>) &lt;&lt; o2::utils::DebugStreamer::instance()-&gt;getUniqueTreeName(<span class="stringliteral">&quot;debug_distortions_analytical&quot;</span>).data()</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;pos=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a>*<span class="keyword">&gt;</span>(&amp;<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>))</div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;lPos=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a>*<span class="keyword">&gt;</span>(&amp;lPos))</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;dlX=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;dlX))</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;dlY=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;dlY))</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;dlZ=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;dlZ))</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;distX=&quot;</span> &lt;&lt; distX</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;distY=&quot;</span> &lt;&lt; distY</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;distZ=&quot;</span> &lt;&lt; distZ</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>                                                                                                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>  })</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>}</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span> </div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02102" data-start="{" data-end="}">
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4"> 2102</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4">SpaceCharge&lt;DataT&gt;::init</a>()</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>{</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>  <span class="keyword">using </span>timer = std::chrono::high_resolution_clock;</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>  <span class="keywordflow">if</span> (!mInitLookUpTables) {</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>    <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a> = timer::now();</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>    <span class="keyword">auto</span> o2field = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a>*<span class="keyword">&gt;</span>(TGeoGlobalMagField::Instance()-&gt;GetField());</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> bzField = o2field-&gt;<a class="code hl_function" href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">solenoidField</a>(); <span class="comment">// magnetic field in kGauss</span></div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>    <span class="keyword">auto</span>&amp; gasParam = <a class="code hl_function" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">ParameterGas::Instance</a>();</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>    <span class="keywordtype">float</span> vDrift = gasParam.DriftV; <span class="comment">// drift velocity in cm/us</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a> = 1.;</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> t2 = 1.;</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> omegaTau = -10. * bzField * vDrift / std::abs(getEzField(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>    setOmegaTauT1T2(omegaTau, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a>, t2);</div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>    <span class="keywordflow">if</span> (mUseInitialSCDensity) {</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>      <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a1ef7964b771b9b29688dfa8810b27d00">LOG</a>(warning) &lt;&lt; <span class="stringliteral">&quot;mUseInitialSCDensity&quot;</span> &lt;&lt; mUseInitialSCDensity;</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>      calculateDistortionsCorrections(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>);</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>      calculateDistortionsCorrections(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>);</div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>      mInitLookUpTables = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>    }</div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>    <span class="keyword">auto</span> stop = timer::now();</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>    std::chrono::duration&lt;float&gt; <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a> = stop - <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a>;</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>    LOGP(info, <span class="stringliteral">&quot;Total Time Distortions and Corrections for A and C Side: {}&quot;</span>, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a>.count());</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span>  }</div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>}</div>
</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span> </div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02131" data-start="{" data-end="}">
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642"> 2131</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642">SpaceCharge&lt;DataT&gt;::setDistortionLookupTables</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdZ, <span class="keyword">const</span> <a class="code hl_class" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdR, <span class="keyword">const</span> <a class="code hl_class" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">DataContainer</a>&amp; distdRPhi, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>{</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>  mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdR;</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>  mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdZ;</div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>  mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] = distdRPhi;</div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>}</div>
</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span> </div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::integrateEFieldsRoot</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1z, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2z, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntErOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntEPhiOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntDeltaEz, <span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>  <a class="code hl_class" href="../../d5/d1a/classTF1.html">TF1</a> fErOverEz(</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>    <span class="stringliteral">&quot;fErOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code hl_function" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalFieldR(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) / (formulaStruct.evalFieldZ(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) + ezField)); }, p1z, p2z, 1);</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>  localIntErOverEz = <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(fErOverEz.Integral(p1z, p2z));</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span> </div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>  <a class="code hl_class" href="../../d5/d1a/classTF1.html">TF1</a> fEphiOverEz(</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>    <span class="stringliteral">&quot;fEPhiOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code hl_function" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalFieldPhi(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) / (formulaStruct.evalFieldZ(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) + ezField)); }, p1z, p2z, 1);</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>  localIntEPhiOverEz = <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(fEphiOverEz.Integral(p1z, p2z));</div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span> </div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>  <a class="code hl_class" href="../../d5/d1a/classTF1.html">TF1</a> fEz(</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>    <span class="stringliteral">&quot;fEZOverEz&quot;</span>, [&amp;](<span class="keywordtype">double</span>* <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">double</span>* p) { (<a class="code hl_function" href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>)p; <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(formulaStruct.evalFieldZ(<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[0]), p1r, p1phi) - ezField); }, p1z, p2z, 1);</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>  localIntDeltaEz = getSign(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(fEz.Integral(p1z, p2z));</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>}</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span> </div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::integrateEFieldsTrapezoidal</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1z, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2z, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntErOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntEPhiOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntDeltaEz, <span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>  <span class="comment">//========trapezoidal rule see: https://en.wikipedia.org/wiki/Trapezoidal_rule ==============</span></div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder0 = formulaStruct.evalFieldR(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez0 = formulaStruct.evalFieldZ(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi0 = formulaStruct.evalFieldPhi(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span> </div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder1 = formulaStruct.evalFieldR(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez1 = formulaStruct.evalFieldZ(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi1 = formulaStruct.evalFieldPhi(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span> </div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ0 = isCloseToZero(ezField, fieldez0) ? 0 : 1. / (ezField + fieldez0);</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ1 = isCloseToZero(ezField, fieldez1) ? 0 : 1. / (ezField + fieldez1);</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span> </div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaX = 0.5 * (p2z - p1z);</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>  localIntErOverEz = deltaX * (fielder0 * eZ0 + fielder1 * eZ1);</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>  localIntEPhiOverEz = deltaX * (fieldephi0 * eZ0 + fieldephi1 * eZ1);</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span>  localIntDeltaEz = getSign(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * deltaX * (fieldez0 + fieldez1);</div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>}</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span> </div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::integrateEFieldsSimpson</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1z, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2z, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntErOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntEPhiOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntDeltaEz, <span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>  <span class="comment">//==========simpsons rule see: https://en.wikipedia.org/wiki/Simpson%27s_rule =============================</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder0 = formulaStruct.evalFieldR(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez0 = formulaStruct.evalFieldZ(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi0 = formulaStruct.evalFieldPhi(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span> </div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder1 = formulaStruct.evalFieldR(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez1 = formulaStruct.evalFieldZ(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi1 = formulaStruct.evalFieldPhi(p2z, p1r, p1phi);</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span> </div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaX = p2z - p1z;</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> xk2N = (p2z - <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(0.5) * deltaX);</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField2 = formulaStruct.evalFieldZ(xk2N, p1r, p1phi);</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField2Denominator = isCloseToZero(ezField, ezField2) ? 0 : 1. / (ezField + ezField2);</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldSum2ErOverEz = formulaStruct.evalFieldR(xk2N, p1r, p1phi) * ezField2Denominator;</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldSum2EphiOverEz = formulaStruct.evalFieldPhi(xk2N, p1r, p1phi) * ezField2Denominator;</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span> </div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ0 = isCloseToZero(ezField, fieldez0) ? 0 : 1. / (ezField + fieldez0);</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ1 = isCloseToZero(ezField, fieldez1) ? 0 : 1. / (ezField + fieldez1);</div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span> </div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaXSimpsonSixth = deltaX / 6.;</div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>  localIntErOverEz = deltaXSimpsonSixth * (4. * fieldSum2ErOverEz + fielder0 * eZ0 + fielder1 * eZ1);</div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>  localIntEPhiOverEz = deltaXSimpsonSixth * (4. * fieldSum2EphiOverEz + fieldephi0 * eZ0 + fieldephi1 * eZ1);</div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>  localIntDeltaEz = getSign(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * deltaXSimpsonSixth * (4. * ezField2 + fieldez0 + fieldez1);</div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>}</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span> </div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::integrateEFieldsSimpsonIterative</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1z, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2z, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntErOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntEPhiOverEz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; localIntDeltaEz, <span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>  <span class="comment">//==========simpsons rule see: https://en.wikipedia.org/wiki/Simpson%27s_rule =============================</span></div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>  <span class="comment">// const Side side = formulaStruct.getSide();</span></div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>  <span class="comment">// const DataT ezField = getEzField(side);</span></div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2phiSave = regulatePhi(p2phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span> </div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder0 = formulaStruct.evalFieldR(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez0 = formulaStruct.evalFieldZ(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi0 = formulaStruct.evalFieldPhi(p1z, p1r, p1phi);</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span> </div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fielder1 = formulaStruct.evalFieldR(p2z, p2r, p2phiSave);</div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldez1 = formulaStruct.evalFieldZ(p2z, p2r, p2phiSave);</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldephi1 = formulaStruct.evalFieldPhi(p2z, p2r, p2phiSave);</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span> </div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ0Inv = isCloseToZero(ezField, fieldez0) ? 0 : 1. / (ezField + fieldez0);</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ1Inv = isCloseToZero(ezField, fieldez1) ? 0 : 1. / (ezField + fieldez1);</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span> </div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pHalfZ = 0.5 * (p1z + p2z);                              <span class="comment">// dont needs to be regulated since p1z and p2z are already regulated</span></div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pHalfPhiSave = regulatePhi(0.5 * (p1phi + p2phi), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// needs to be regulated since p2phi is not regulated</span></div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pHalfR = 0.5 * (p1r + p2r);</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span> </div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ezField2 = formulaStruct.evalFieldZ(pHalfZ, pHalfR, pHalfPhiSave);</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZHalfInv = (isCloseToZero(ezField, ezField2) | isCloseToZero(ezField, fieldez0) | isCloseToZero(ezField, fieldez1)) ? 0 : 1. / (ezField + ezField2);</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldSum2ErOverEz = formulaStruct.evalFieldR(pHalfZ, pHalfR, pHalfPhiSave);</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fieldSum2EphiOverEz = formulaStruct.evalFieldPhi(pHalfZ, pHalfR, pHalfPhiSave);</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span> </div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaXSimpsonSixth = (p2z - p1z) / 6;</div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>  localIntErOverEz = deltaXSimpsonSixth * (4 * fieldSum2ErOverEz * eZHalfInv + fielder0 * eZ0Inv + fielder1 * eZ1Inv);</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>  localIntEPhiOverEz = deltaXSimpsonSixth * (4 * fieldSum2EphiOverEz * eZHalfInv + fieldephi0 * eZ0Inv + fieldephi1 * eZ1Inv);</div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>  localIntDeltaEz = getSign(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) * deltaXSimpsonSixth * (4 * ezField2 + fieldez0 + fieldez1);</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>}</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span> </div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02242" data-start="{" data-end="}">
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1"> 2242</a></span>std::vector&lt;std::pair&lt;std::vector&lt;o2::math_utils::Point3D&lt;float&gt;&gt;, std::array&lt;DataT, 3&gt;&gt;&gt; <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1">SpaceCharge&lt;DataT&gt;::calculateElectronDriftPath</a>(<span class="keyword">const</span> std::vector&lt;GlobalPosition3D&gt;&amp; elePos, <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints, <span class="keyword">const</span> std::string_view outFile)<span class="keyword"> const</span></div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nElectrons = elePos.size();</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>  std::vector&lt;std::pair&lt;std::vector&lt;o2::math_utils::Point3D&lt;float&gt;&gt;, std::array&lt;DataT, 3&gt;&gt;&gt; electronTracks(nElectrons);</div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span> </div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nElectrons; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>    electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].first.reserve(nSamplingPoints + 1);</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>  }</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span> </div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nElectrons; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0 = elePos[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].Z();</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> r0 = elePos[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].Rho();</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi0 = elePos[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].Phi();</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = getSide(z0);</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>    <span class="keywordflow">if</span> (!mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>      LOGP(warning, <span class="stringliteral">&quot;E-Fields are not set! Calculation of drift path is not possible&quot;</span>);</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>    }</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>    <span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataT&gt;</a> numEFields{getElectricFieldsInterpolator(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)};</div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> stepSize = getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) / nSamplingPoints;</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span> </div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> drDist = 0.0;   <span class="comment">// global distortion dR</span></div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dPhiDist = 0.0; <span class="comment">// global distortion dPhi (multiplication with R has to be done at the end)</span></div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> dzDist = 0.0;   <span class="comment">// global distortion dZ</span></div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z0Tmp = z0 + dzDist + iter * stepSize;     <span class="comment">// starting z position</span></div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1Tmp = regulateZ(z0Tmp + stepSize, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = r0 + drDist;                      <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span> </div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>      <span class="comment">// abort calculation of drift path if electron reached inner/outer field cage or central electrode</span></div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>      <span class="keywordflow">if</span> (radius &lt;= getRMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || radius &gt;= getRMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) || getSide(z0Tmp) != <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) {</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>      }</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span> </div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = regulatePhi(phi0 + dPhiDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>      electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].first.emplace_back(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">GlobalPosition3D</a>(radius * std::cos(phi), radius * std::sin(phi), z0Tmp));</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span> </div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddR = 0;   <span class="comment">// distortion dR for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddPhi = 0; <span class="comment">// distortion dPhi for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddZ = 0;   <span class="comment">// distortion dZ for drift from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span> </div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span>      <span class="comment">// get the distortion from interpolation of local distortions or calculate distortions with the electric field</span></div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>      processGlobalDistCorr(radius, phi, z0Tmp, z1Tmp, ddR, ddPhi, ddZ, numEFields);</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span> </div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>      <span class="comment">// add local distortions to global distortions</span></div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>      drDist += ddR;</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>      dPhiDist += ddPhi;</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>      dzDist += ddZ;</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span> </div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>      <span class="comment">// if one uses local distortions the interpolated value for the last bin has to be scaled.</span></div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>      <span class="comment">// This has to be done because of the interpolated value is defined for a drift length of one z bin, but in the last bin the distance to the readout can be smaller than one z bin.</span></div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> checkReached = <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? z1Tmp &gt;= getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) : z1Tmp &lt;= getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span> </div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>      <span class="comment">// set loop to exit if the readout is reached and approximate distortion of &#39;missing&#39; (one never ends exactly on the readout: z1Tmp + ddZ != ZMAX) drift distance.</span></div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>      <span class="comment">// approximation is done by the current calculated values of the distortions and scaled linear to the &#39;missing&#39; distance.</span></div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>      <span class="keywordflow">if</span> (checkReached) {</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> endPoint = z1Tmp + ddZ;</div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> deltaZ = getZMax(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) - endPoint; <span class="comment">// distance from last point to read out</span></div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> diff = endPoint - z0Tmp;</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> fac = diff != 0 ? std::abs(deltaZ / diff) : 0; <span class="comment">// approximate the distortions for the &#39;missing&#39; distance deltaZ</span></div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>        drDist += ddR * fac;</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>        dPhiDist += ddPhi * fac;</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>        dzDist += ddZ * fac;</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> z1TmpEnd = regulateZ(z0Tmp + stepSize, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>); <span class="comment">// electron drifts from z0Tmp to z1Tmp</span></div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusEnd = regulateR(r0 + drDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);     <span class="comment">// current radial position of the electron</span></div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiEnd = regulatePhi(phi0 + dPhiDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);  <span class="comment">// current phi position of the electron</span></div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>        electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].first.emplace_back(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">GlobalPosition3D</a>(radiusEnd * std::cos(phiEnd), radiusEnd * std::sin(phiEnd), z1TmpEnd));</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>      }</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>      ++iter;</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>    }</div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>    electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].second = std::array&lt;DataT, 3&gt;{drDist, dPhiDist * r0, dzDist};</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>  }</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>  <span class="keywordflow">if</span> (!outFile.empty()) {</div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>    dumpElectronTracksToTree(electronTracks, nSamplingPoints, outFile.data());</div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>  }</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>  <span class="keywordflow">return</span> electronTracks;</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>}</div>
</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span> </div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::dumpElectronTracksToTree</a>(<span class="keyword">const</span> std::vector&lt;std::pair&lt;std::vector&lt;<a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">o2::math_utils::Point3D&lt;float&gt;</a>&gt;, std::array&lt;DataT, 3&gt;&gt;&gt;&amp; electronTracks, <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints, <span class="keyword">const</span> <span class="keywordtype">char</span>* outFile)<span class="keyword"> const</span></div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>  <a class="code hl_class" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a> pcstream(outFile, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>  pcstream.GetFile()-&gt;cd();</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span> </div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>  <span class="keyword">auto</span>&amp; gasParam = <a class="code hl_function" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">ParameterGas::Instance</a>();</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>  <span class="keyword">auto</span>&amp; eleParam = <a class="code hl_function" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">ParameterElectronics::Instance</a>();</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span> </div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; electronTracks.size(); ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>    <span class="keyword">auto</span> electronPath = electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].first;</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints = electronPath.size();</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>    <span class="keywordflow">if</span> (electronPath.empty()) {</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>      LOGP(warning, <span class="stringliteral">&quot;Track is empty. Continue to next track.&quot;</span>);</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>    }</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>    std::vector&lt;float&gt; relDriftVel;</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>    relDriftVel.reserve(nPoints);</div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span> </div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPoint = 0; iPoint &lt; (nPoints - 2); ++iPoint) {</div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> relDriftVelTmp = (electronPath[iPoint + 1].Z() - electronPath[iPoint].Z()) / getZMax(getSide(electronPath[iPoint].Z())) * nSamplingPoints; <span class="comment">// comparison of drift distance without distortions and with distortions (rel. drift velocity)</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>      relDriftVel.emplace_back(std::abs(relDriftVelTmp));</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>    }</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span> </div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>    <span class="comment">// just copy the last value to avoid wrong values</span></div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>    relDriftVel.emplace_back(relDriftVel.back());</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>    relDriftVel.emplace_back(relDriftVel.back());</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span> </div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distR = electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].second[0];</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distRPhi = electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].second[1];</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distZ = electronTracks[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].second[2];</div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span> </div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> driftTime = std::abs(getZMax(getSide(electronPath.front().Z())) - (distZ + electronPath.front().Z())) / gasParam.DriftV;</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> timeBin = driftTime / eleParam.ZbinWidth;</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span> </div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>    pcstream &lt;&lt; <span class="stringliteral">&quot;drift&quot;</span></div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>             &lt;&lt; <span class="stringliteral">&quot;electronPath=&quot;</span> &lt;&lt; electronPath</div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>             &lt;&lt; <span class="stringliteral">&quot;relDriftVel.=&quot;</span> &lt;&lt; relDriftVel <span class="comment">// relative drift velocity in z direction</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>             &lt;&lt; <span class="stringliteral">&quot;distR=&quot;</span> &lt;&lt; distR</div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>             &lt;&lt; <span class="stringliteral">&quot;distRPhi=&quot;</span> &lt;&lt; distRPhi</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>             &lt;&lt; <span class="stringliteral">&quot;distZ=&quot;</span> &lt;&lt; distZ</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>             &lt;&lt; <span class="stringliteral">&quot;driftTime=&quot;</span> &lt;&lt; driftTime</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>             &lt;&lt; <span class="stringliteral">&quot;timeBin=&quot;</span> &lt;&lt; timeBin</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>             &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>  }</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>  pcstream.Close();</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>}</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span> </div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02371" data-start="{" data-end="}">
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6"> 2371</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6">SpaceCharge&lt;DataT&gt;::makeElectronDriftPathGif</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* inpFile, TH2F&amp; hDummy, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> gifSpeed, <span class="keyword">const</span> <span class="keywordtype">int</span> maxsamplingpoints, <span class="keyword">const</span> <span class="keywordtype">char</span>* outName)</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>{</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>  <span class="comment">// read in the tree and convert to vector of std::vector&lt;o2::tpc::GlobalPosition3D&gt;</span></div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>  TFile fInp(inpFile, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>  TTree* <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a> = (TTree*)fInp.Get(<span class="stringliteral">&quot;drift&quot;</span>);</div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>  std::vector&lt;o2::tpc::GlobalPosition3D&gt;* electronPathTree = <span class="keyword">new</span> std::vector&lt;o2::tpc::GlobalPosition3D&gt;;</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>  <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>-&gt;SetBranchAddress(<span class="stringliteral">&quot;electronPath&quot;</span>, &amp;electronPathTree);</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span> </div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>  std::vector&lt;std::vector&lt;o2::tpc::GlobalPosition3D&gt;&gt; electronPaths;</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>  std::vector&lt;o2::tpc::GlobalPosition3D&gt; elePosTmp;</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> entries = <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>-&gt;GetEntriesFast();</div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; entries; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>    <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>-&gt;GetEntry(<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>);</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>    electronPaths.emplace_back(*electronPathTree);</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>  }</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>  <span class="keyword">delete</span> electronPathTree;</div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>  fInp.Close();</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span> </div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>  TCanvas can(<span class="stringliteral">&quot;canvas&quot;</span>, <span class="stringliteral">&quot;canvas&quot;</span>, 1000, 600);</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>  can.SetTopMargin(0.04f);</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span>  can.SetRightMargin(0.04f);</div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>  can.SetBottomMargin(0.12f);</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span>  can.SetLeftMargin(0.11f);</div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span> </div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nElectrons = electronPaths.size();</div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>  std::vector&lt;int&gt; indexStartEle(nElectrons);</div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>  std::vector&lt;int&gt; countReadoutReached(nElectrons);</div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span> </div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>  <span class="comment">// define colors of electrons</span></div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>  <span class="keyword">const</span> std::vector&lt;int&gt; colorsPalette{kViolet + 2, kViolet + 1, kViolet, kViolet - 1, kGreen + 3, kGreen + 2, kGreen + 1, kOrange - 1, kOrange, kOrange + 1, kOrange + 2, kRed - 1, kRed, kRed + 1, kRed + 2, kBlue - 1, kBlue, kBlue + 1, kBlue + 2};</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span> </div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>  <span class="comment">// create for each electron an individual graph</span></div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxPoints = 0;</div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>  std::vector&lt;TGraph&gt; gr(nElectrons);</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nElectrons; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>    gr[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].SetMarkerColor(colorsPalette[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> % colorsPalette.size()]);</div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span> </div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span>    <span class="keywordflow">if</span> (electronPaths[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a>() &gt; maxPoints) {</div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span>      maxPoints = electronPaths[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].size();</div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>    }</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>  }</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span> </div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pointsPerIteration = maxPoints / <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(maxsamplingpoints);</div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>  std::vector&lt;DataT&gt; zRemainder(nElectrons);</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span> </div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; graph : gr) {</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>      graph.Set(0);</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span>    }</div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span> </div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iEle = 0; iEle &lt; nElectrons; ++iEle) {</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> nSamplingPoints = electronPaths[iEle].size();</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints = std::round(pointsPerIteration + zRemainder[iEle]);</div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span>      zRemainder[iEle] = pointsPerIteration - nPoints;</div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; electronPath = electronPaths[iEle];</div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span> </div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span>      <span class="keywordflow">if</span> (nPoints == 0 &amp;&amp; countReadoutReached[iEle] == 0) {</div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> indexPoint = indexStartEle[iEle];</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = electronPath[indexPoint].Rho();</div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = electronPath[indexPoint].Z();</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = electronPath[indexPoint].Phi();</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span>        <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 ? gr[iEle].AddPoint(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius) : gr[iEle].AddPoint(phi, radius);</div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>      }</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span> </div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPoint = 0; iPoint &lt; nPoints; ++iPoint) {</div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> indexPoint = indexStartEle[iEle];</div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span>        <span class="keywordflow">if</span> (indexPoint &gt;= nSamplingPoints) {</div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span>          countReadoutReached[iEle] = 1;</div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span>        }</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span> </div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = electronPath[indexPoint].Rho();</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = electronPath[indexPoint].Z();</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = electronPath[indexPoint].Phi();</div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>        <span class="keywordflow">if</span> (iPoint == nPoints / 2) {</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>          <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 ? gr[iEle].AddPoint(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius) : gr[iEle].AddPoint(phi, radius);</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>        }</div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span>        ++indexStartEle[iEle];</div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>      }</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>    }</div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span>    hDummy.Draw();</div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; graph : gr) {</div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>      <span class="keywordflow">if</span> (graph.GetN() &gt; 0) {</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>        graph.Draw(<span class="stringliteral">&quot;P SAME&quot;</span>);</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>      }</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>    }</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span>    can.Print(Form(<span class="stringliteral">&quot;%s.gif+%i&quot;</span>, outName, gifSpeed));</div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span> </div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> sumReadoutReached = std::accumulate(countReadoutReached.begin(), countReadoutReached.end(), 0);</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>    <span class="keywordflow">if</span> (sumReadoutReached == nElectrons) {</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>    }</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>  }</div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span> </div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span>  can.Print(Form(<span class="stringliteral">&quot;%s.gif++&quot;</span>, outName));</div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>}</div>
</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span> </div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02469" data-start="{" data-end="}">
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0b12079b87187decbfbe5ebf5218ec8a"> 2469</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0b12079b87187decbfbe5ebf5218ec8a">SpaceCharge&lt;DataT&gt;::dumpToTree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* outFileName, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> nZPoints, <span class="keyword">const</span> <span class="keywordtype">int</span> nRPoints, <span class="keyword">const</span> <span class="keywordtype">int</span> nPhiPoints, <span class="keyword">const</span> <span class="keywordtype">bool</span> randomize)<span class="keyword"> const</span></div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiSpacing = GridProp::getGridSpacingPhi(nPhiPoints) * (<a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">MGParameters::normalizeGridToNSector</a> / double(<a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>));</div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rSpacing = GridProp::getGridSpacingR(nRPoints);</div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zSpacing = <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? GridProp::getGridSpacingZ(nZPoints) : -GridProp::getGridSpacingZ(nZPoints);</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span> </div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span>  std::uniform_real_distribution&lt;DataT&gt; uniR(-rSpacing / 2, rSpacing / 2);</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>  std::uniform_real_distribution&lt;DataT&gt; uniPhi(-phiSpacing / 2, phiSpacing / 2);</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span> </div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>  std::vector&lt;std::vector&lt;float&gt;&gt; phiPosOut(nPhiPoints);</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>  std::vector&lt;std::vector&lt;float&gt;&gt; rPosOut(nPhiPoints);</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span>  std::vector&lt;std::vector&lt;float&gt;&gt; zPosOut(nPhiPoints);</div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>  std::vector&lt;std::vector&lt;int&gt;&gt; iPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>  std::vector&lt;std::vector&lt;int&gt;&gt; iROut(nPhiPoints);</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>  std::vector&lt;std::vector&lt;int&gt;&gt; iZOut(nPhiPoints);</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>  std::vector&lt;std::vector&lt;float&gt;&gt; densityOut(nPhiPoints);</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>  std::vector&lt;std::vector&lt;float&gt;&gt; potentialOut(nPhiPoints);</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>  std::vector&lt;std::vector&lt;float&gt;&gt; eZOut(nPhiPoints);</div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span>  std::vector&lt;std::vector&lt;float&gt;&gt; eROut(nPhiPoints);</div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ePhiOut(nPhiPoints);</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>  std::vector&lt;std::vector&lt;float&gt;&gt; distZOut(nPhiPoints);</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>  std::vector&lt;std::vector&lt;float&gt;&gt; distROut(nPhiPoints);</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span>  std::vector&lt;std::vector&lt;float&gt;&gt; distRPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrZOut(nPhiPoints);</div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrROut(nPhiPoints);</div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrRPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span>  std::vector&lt;std::vector&lt;float&gt;&gt; lcorrZOut(nPhiPoints);</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span>  std::vector&lt;std::vector&lt;float&gt;&gt; lcorrROut(nPhiPoints);</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span>  std::vector&lt;std::vector&lt;float&gt;&gt; lcorrRPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ldistZOut(nPhiPoints);</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ldistROut(nPhiPoints);</div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ldistRPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>  std::vector&lt;std::vector&lt;float&gt;&gt; xOut(nPhiPoints);</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>  std::vector&lt;std::vector&lt;float&gt;&gt; yOut(nPhiPoints);</div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>  std::vector&lt;std::vector&lt;float&gt;&gt; bROut(nPhiPoints);</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>  std::vector&lt;std::vector&lt;float&gt;&gt; bZOut(nPhiPoints);</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>  std::vector&lt;std::vector&lt;float&gt;&gt; bPhiOut(nPhiPoints);</div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>  std::vector&lt;std::vector&lt;LocalPosition3D&gt;&gt; lPosOut(nPhiPoints);</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>  std::vector&lt;std::vector&lt;int&gt;&gt; sectorOut(nPhiPoints);</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>  std::vector&lt;std::vector&lt;size_t&gt;&gt; globalIdxOut(nPhiPoints);</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>  std::vector&lt;std::vector&lt;bool&gt;&gt; isOnPadPlane(nPhiPoints);</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span> </div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iPhi = 0; iPhi &lt; nPhiPoints; ++iPhi) {</div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints = nZPoints * nRPoints;</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span>    phiPosOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>    rPosOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>    zPosOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span>    iPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span>    iROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>    iZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span>    densityOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>    potentialOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>    eZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>    eROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>    ePhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>    distZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span>    distROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span>    distRPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span>    corrZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span>    corrROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>    corrRPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>    lcorrZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>    lcorrROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span>    lcorrRPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span>    ldistZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>    ldistROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>    ldistRPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>    xOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>    yOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span>    bROut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>    bZOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span>    bPhiOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span>    lPosOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>    sectorOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>    globalIdxOut[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>    isOnPadPlane[iPhi].reserve(nPoints);</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span> </div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>    std::mt19937 rng(std::random_device{}());</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiPos = iPhi * phiSpacing;</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = 0; iR &lt; nRPoints; ++iR) {</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>      <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> rPos = getRMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + iR * rSpacing;</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = 0; iZ &lt; nZPoints; ++iZ) {</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zPos = getZMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + iZ * zSpacing;</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>        <span class="keywordflow">if</span> (randomize) {</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span>          phiPos += uniPhi(rng);</div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>          o2::math_utils::detail::bringTo02PiGen&lt;DataT&gt;(phiPos);</div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>          rPos += uniR(rng);</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>        }</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span> </div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> density = getDensityCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> potential = getPotentialCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span> </div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distZ{};</div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distR{};</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distRPhi{};</div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>        getDistortionsCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, distZ, distR, distRPhi);</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span> </div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ldistZ{};</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ldistR{};</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ldistRPhi{};</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>        getLocalDistortionsCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, ldistZ, ldistR, ldistRPhi);</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span> </div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>        <span class="comment">// get average distortions</span></div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrZ{};</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrR{};</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrRPhi{};</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span>        <span class="comment">// getCorrectionsCyl(zPos, rPos, phiPos, side, corrZ, corrR, corrRPhi);</span></div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span> </div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zDistorted = zPos + distZ;</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radiusDistorted = rPos + distR;</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiDistorted = regulatePhi(phiPos + distRPhi / rPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>        getCorrectionsCyl(zDistorted, radiusDistorted, phiDistorted, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ, corrR, corrRPhi);</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span>        corrRPhi *= rPos / radiusDistorted;</div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span> </div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lcorrZ{};</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lcorrR{};</div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> lcorrRPhi{};</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>        getLocalCorrectionsCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, lcorrZ, lcorrR, lcorrRPhi);</div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span> </div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>        <span class="comment">// get average distortions</span></div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ{};</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eR{};</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ePhi{};</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span>        getElectricFieldsCyl(zPos, rPos, phiPos, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, eZ, eR, ePhi);</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span> </div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>        <span class="comment">// global coordinates</span></div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> = getXFromPolar(rPos, phiPos);</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_class" href="../../d1/da0/classint.html">y</a> = getYFromPolar(rPos, phiPos);</div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span> </div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>        <span class="comment">// b field</span></div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> bR = mBField.evalFieldR(zPos, rPos, phiPos);</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> bZ = mBField.evalFieldZ(zPos, rPos, phiPos);</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> bPhi = mBField.evalFieldPhi(zPos, rPos, phiPos);</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span> </div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span>        <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, zPos);</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> secNum = std::floor(phiPos / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a64ab5278b1755af95e5ecd8d36409612">SECPHIWIDTH</a>);</div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>        <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sector(secNum + (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>.Z() &lt; 0) * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>);</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>        <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> lPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7962684772bd8bf62a60941ea4312cb2">Mapper::GlobalToLocal</a>(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>, sector);</div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span> </div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>        phiPosOut[iPhi].emplace_back(phiPos);</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span>        rPosOut[iPhi].emplace_back(rPos);</div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>        zPosOut[iPhi].emplace_back(zPos);</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>        iPhiOut[iPhi].emplace_back(iPhi);</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span>        iROut[iPhi].emplace_back(iR);</div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>        iZOut[iPhi].emplace_back(iZ);</div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span>        <span class="keywordflow">if</span> (mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>          densityOut[iPhi].emplace_back(density);</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>        }</div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>        <span class="keywordflow">if</span> (mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span>          potentialOut[iPhi].emplace_back(potential);</div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>        }</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>        <span class="keywordflow">if</span> (mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>          eZOut[iPhi].emplace_back(eZ);</div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>          eROut[iPhi].emplace_back(eR);</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>          ePhiOut[iPhi].emplace_back(ePhi);</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>        }</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>        <span class="keywordflow">if</span> (mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span>          distZOut[iPhi].emplace_back(distZ);</div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>          distROut[iPhi].emplace_back(distR);</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span>          distRPhiOut[iPhi].emplace_back(distRPhi);</div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>        }</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span>        <span class="keywordflow">if</span> (mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span>          corrZOut[iPhi].emplace_back(corrZ);</div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>          corrROut[iPhi].emplace_back(corrR);</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>          corrRPhiOut[iPhi].emplace_back(corrRPhi);</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span>        }</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span>        <span class="keywordflow">if</span> (mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span>          lcorrZOut[iPhi].emplace_back(lcorrZ);</div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>          lcorrROut[iPhi].emplace_back(lcorrR);</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>          lcorrRPhiOut[iPhi].emplace_back(lcorrRPhi);</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>        }</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>        <span class="keywordflow">if</span> (mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>          ldistZOut[iPhi].emplace_back(ldistZ);</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>          ldistROut[iPhi].emplace_back(ldistR);</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span>          ldistRPhiOut[iPhi].emplace_back(ldistRPhi);</div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span>        }</div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span>        xOut[iPhi].emplace_back(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>);</div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>        yOut[iPhi].emplace_back(<a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span>        bROut[iPhi].emplace_back(bR);</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span>        bZOut[iPhi].emplace_back(bZ);</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span>        bPhiOut[iPhi].emplace_back(bPhi);</div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span>        lPosOut[iPhi].emplace_back(lPos);</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>        sectorOut[iPhi].emplace_back(sector);</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx = (iZ + nZPoints * (iR + iPhi * nRPoints));</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>        globalIdxOut[iPhi].emplace_back(idx);</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span> </div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> xDist = getXFromPolar(radiusDistorted, phiDistorted);</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> yDist = getYFromPolar(radiusDistorted, phiDistorted);</div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span>        <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a> posTmp(xDist, yDist, zPos);</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>        <span class="keyword">const</span> <a class="code hl_class" href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html">DigitPos</a> digiPadPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">o2::tpc::Mapper::instance</a>().<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a4d8f001eec24323357692770a7bc31cb">findDigitPosFromGlobalPosition</a>(posTmp);</div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>        isOnPadPlane[iPhi].emplace_back(digiPadPos.<a class="code hl_function" href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html#a7eabbba4318a10e7c85e661a9aeb42d6">isValid</a>());</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>      }</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span>    }</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span>  }</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span> </div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span>  <span class="keywordflow">if</span> (ROOT::IsImplicitMTEnabled() &amp;&amp; (ROOT::GetThreadPoolSize() != sNThreads)) {</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>    ROOT::DisableImplicitMT();</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>  }</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span>  ROOT::EnableImplicitMT(sNThreads);</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>  ROOT::RDataFrame dFrame(nPhiPoints);</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span> </div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>  TStopwatch timer;</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>  <span class="keyword">auto</span> dfStore = dFrame.DefineSlotEntry(<span class="stringliteral">&quot;x&quot;</span>, [&amp;xOut = xOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> xOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;y&quot;</span>, [&amp;yOut = yOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> yOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;phi&quot;</span>, [&amp;phiPosOut = phiPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> phiPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;r&quot;</span>, [&amp;rPosOut = rPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> rPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;z&quot;</span>, [&amp;zPosOut = zPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> zPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;iPhi&quot;</span>, [&amp;iPhiOut = iPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> iPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;iR&quot;</span>, [&amp;iROut = iROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> iROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;iZ&quot;</span>, [&amp;iZOut = iZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> iZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;lPos&quot;</span>, [&amp;lPosOut = lPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;sector&quot;</span>, [&amp;sectorOut = sectorOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> sectorOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;scdensity&quot;</span>, [&amp;densityOut = densityOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> densityOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;potential&quot;</span>, [&amp;potentialOut = potentialOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> potentialOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;eZ&quot;</span>, [&amp;eZOut = eZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> eZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;eR&quot;</span>, [&amp;eROut = eROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> eROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ePhi&quot;</span>, [&amp;ePhiOut = ePhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ePhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;distZ&quot;</span>, [&amp;distZOut = distZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> distZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;distR&quot;</span>, [&amp;distROut = distROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> distROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;distRPhi&quot;</span>, [&amp;distRPhiOut = distRPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> distRPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrZ&quot;</span>, [&amp;corrZOut = corrZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrR&quot;</span>, [&amp;corrROut = corrROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrRPhi&quot;</span>, [&amp;corrRPhiOut = corrRPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrRPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;lcorrZ&quot;</span>, [&amp;lcorrZOut = lcorrZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lcorrZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;lcorrR&quot;</span>, [&amp;lcorrROut = lcorrROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lcorrROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;lcorrRPhi&quot;</span>, [&amp;lcorrRPhiOut = lcorrRPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lcorrRPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ldistZ&quot;</span>, [&amp;ldistZOut = ldistZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ldistZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ldistR&quot;</span>, [&amp;ldistROut = ldistROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ldistROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ldistRPhi&quot;</span>, [&amp;ldistRPhiOut = ldistRPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ldistRPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;bR&quot;</span>, [&amp;bROut = bROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> bROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;bZ&quot;</span>, [&amp;bZOut = bZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> bZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;bPhi&quot;</span>, [&amp;bPhiOut = bPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> bPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;globalIndex&quot;</span>, [&amp;globalIdxOut = globalIdxOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> globalIdxOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;isOnPadPlane&quot;</span>, [&amp;isOnPadPlane = isOnPadPlane](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> isOnPadPlane[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>  dfStore.Snapshot(<span class="stringliteral">&quot;tree&quot;</span>, outFileName);</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>  timer.Print(<span class="stringliteral">&quot;u&quot;</span>);</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span>}</div>
</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span> </div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02709" data-start="{" data-end="}">
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2338129071857bf4ed66475581c4f58b"> 2709</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0b12079b87187decbfbe5ebf5218ec8a">SpaceCharge&lt;DataT&gt;::dumpToTree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* outFileName, <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a>&amp; sector, <span class="keyword">const</span> <span class="keywordtype">int</span> nZPoints)<span class="keyword"> const</span></div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = sector.<a class="code hl_function" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#a0cbc050672c8d917aeca484baf230125">side</a>();</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zSpacing = (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>) ? GridProp::getGridSpacingZ(nZPoints) : -GridProp::getGridSpacingZ(nZPoints);</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>  <span class="keyword">const</span> <a class="code hl_class" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html">Mapper</a>&amp; mapper = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">Mapper::instance</a>();</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span> </div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nPads = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9441e037bf1815fc668c4cdda5090cfb">Mapper::getPadsInSector</a>();</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>  std::vector&lt;std::vector&lt;float&gt;&gt; phiPosOut(nZPoints);</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span>  std::vector&lt;std::vector&lt;float&gt;&gt; rPosOut(nZPoints);</div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span>  std::vector&lt;std::vector&lt;float&gt;&gt; zPosOut(nZPoints);</div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span>  std::vector&lt;std::vector&lt;int&gt;&gt; rowOut(nZPoints);</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span>  std::vector&lt;std::vector&lt;float&gt;&gt; lxOut(nZPoints);</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span>  std::vector&lt;std::vector&lt;float&gt;&gt; lyOut(nZPoints);</div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span>  std::vector&lt;std::vector&lt;float&gt;&gt; xOut(nZPoints);</div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span>  std::vector&lt;std::vector&lt;float&gt;&gt; yOut(nZPoints);</div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrZOut(nZPoints);</div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrROut(nZPoints);</div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span>  std::vector&lt;std::vector&lt;float&gt;&gt; corrRPhiOut(nZPoints);</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>  std::vector&lt;std::vector&lt;float&gt;&gt; erOut(nZPoints);</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ezOut(nZPoints);</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span>  std::vector&lt;std::vector&lt;float&gt;&gt; ephiOut(nZPoints);</div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span>  std::vector&lt;std::vector&lt;float&gt;&gt; potentialOut(nZPoints);</div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span>  std::vector&lt;std::vector&lt;int&gt;&gt; izOut(nZPoints);</div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span>  std::vector&lt;std::vector&lt;size_t&gt;&gt; globalIdxOut(nZPoints);</div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span> </div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iZ = 0; iZ &lt; nZPoints; ++iZ) {</div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span>    phiPosOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span>    rPosOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>    zPosOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span>    corrZOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span>    corrROut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span>    corrRPhiOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span>    rowOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span>    lxOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span>    lyOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span>    xOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span>    yOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span>    erOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span>    ezOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span>    ephiOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>    izOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span>    potentialOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span>    globalIdxOut[iZ].reserve(nPads);</div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span> </div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> zPos = getZMin(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>) + iZ * zSpacing;</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region = 0; region &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a93c1a24bcb03c518c9b819b5aa45e45d">Mapper::NREGIONS</a>; ++region) {</div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> irow = 0; irow &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a85df553b7561b5281a061228ab409fc5">Mapper::ROWSPERREGION</a>[region]; ++irow) {</div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ipad = 0; ipad &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a57665f936edb24da92b1d2be8ded708a">Mapper::PADSPERROW</a>[region][irow]; ++ipad) {</div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>          <a class="code hl_class" href="../../d3/dd6/classunsigned_01short.html">GlobalPadNumber</a> globalpad = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a15f4e85c6dda93a9e623a9ff9524eac6">Mapper::getGlobalPadNumber</a>(irow, ipad, region);</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span>          <span class="keyword">const</span> <a class="code hl_class" href="../../d2/db4/classROOT_1_1Math_1_1PositionVector2D.html">PadCentre</a>&amp; padcentre = mapper.<a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ab295f3e4892ba86df925979d99d82d66">padCentre</a>(globalpad);</div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span>          <span class="keyword">auto</span> lx = padcentre.X();</div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>          <span class="keyword">auto</span> ly = padcentre.Y();</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span>          <span class="comment">// local to global</span></div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>          <span class="keyword">auto</span> globalPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ac3a82fbb8b2684194432dd095da3abfb">Mapper::LocalToGlobal</a>(padcentre, sector);</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span>          <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> = globalPos.X();</div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span>          <span class="keyword">auto</span> <a class="code hl_class" href="../../d1/da0/classint.html">y</a> = globalPos.Y();</div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span> </div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span>          <span class="keyword">auto</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a> = getRadiusFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>          <span class="keyword">auto</span> phi = getPhiFromCartesian(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrZ{};</div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrR{};</div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrRPhi{};</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span>          getCorrectionsCyl(zPos, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, corrZ, corrR, corrRPhi);</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span> </div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eZ{};</div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> eR{};</div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span>          <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ePhi{};</div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span>          getElectricFieldsCyl(zPos, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, eZ, eR, ePhi);</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span> </div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span>          potentialOut[iZ].emplace_back(getPotentialCyl(zPos, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, phi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>          erOut[iZ].emplace_back(eR);</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span>          ezOut[iZ].emplace_back(eZ);</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span>          ephiOut[iZ].emplace_back(ePhi);</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span>          phiPosOut[iZ].emplace_back(phi);</div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span>          rPosOut[iZ].emplace_back(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>);</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span>          zPosOut[iZ].emplace_back(zPos);</div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span>          corrZOut[iZ].emplace_back(corrZ);</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span>          corrROut[iZ].emplace_back(corrR);</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>          corrRPhiOut[iZ].emplace_back(corrRPhi);</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span>          rowOut[iZ].emplace_back(irow + <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a04ba2b657cef66b28f117b0340dc353f">Mapper::ROWOFFSET</a>[region]);</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span>          lxOut[iZ].emplace_back(lx);</div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span>          lyOut[iZ].emplace_back(ly);</div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>          xOut[iZ].emplace_back(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>);</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span>          yOut[iZ].emplace_back(<a class="code hl_class" href="../../d1/da0/classint.html">y</a>);</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span>          izOut[iZ].emplace_back(iZ);</div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span>          <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx = globalpad + <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9441e037bf1815fc668c4cdda5090cfb">Mapper::getPadsInSector</a>() * iZ;</div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span>          globalIdxOut[iZ].emplace_back(idx);</div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span>        }</div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span>      }</div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span>    }</div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"> 2800</span>  }</div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span> </div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span>  <span class="keywordflow">if</span> (ROOT::IsImplicitMTEnabled() &amp;&amp; (ROOT::GetThreadPoolSize() != sNThreads)) {</div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span>    ROOT::DisableImplicitMT();</div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span>  }</div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span>  ROOT::EnableImplicitMT(sNThreads);</div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span>  ROOT::RDataFrame dFrame(nZPoints);</div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span> </div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span>  TStopwatch timer;</div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span>  <span class="keyword">auto</span> dfStore = dFrame.DefineSlotEntry(<span class="stringliteral">&quot;phi&quot;</span>, [&amp;phiPosOut = phiPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> phiPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;r&quot;</span>, [&amp;rPosOut = rPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> rPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;z&quot;</span>, [&amp;zPosOut = zPosOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> zPosOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;iz&quot;</span>, [&amp;izOut = izOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> izOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrZ&quot;</span>, [&amp;corrZOut = corrZOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrZOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrR&quot;</span>, [&amp;corrROut = corrROut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrROut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;corrRPhi&quot;</span>, [&amp;corrRPhiOut = corrRPhiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> corrRPhiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;row&quot;</span>, [&amp;rowOut = rowOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> rowOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;lx&quot;</span>, [&amp;lxOut = lxOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lxOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ly&quot;</span>, [&amp;lyOut = lyOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> lyOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;x&quot;</span>, [&amp;xOut = xOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> xOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;y&quot;</span>, [&amp;yOut = yOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> yOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;er&quot;</span>, [&amp;erOut = erOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> erOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ez&quot;</span>, [&amp;ezOut = ezOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ezOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;ephi&quot;</span>, [&amp;ephiOut = ephiOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> ephiOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;potential&quot;</span>, [&amp;potentialOut = potentialOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> potentialOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;globalIndex&quot;</span>, [&amp;globalIdxOut = globalIdxOut](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> globalIdxOut[<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>]; });</div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span>  dfStore.Snapshot(<span class="stringliteral">&quot;tree&quot;</span>, outFileName);</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span>  timer.Print(<span class="stringliteral">&quot;u&quot;</span>);</div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span>}</div>
</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span> </div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02831" data-start="{" data-end="}">
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22"> 2831</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22">SpaceCharge&lt;DataT&gt;::normalizeHistoQVEps0</a>(TH3&amp; histoIonsPhiRZ)</div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span>{</div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span>  <span class="keyword">const</span> <span class="keyword">auto</span> deltaPhi = histoIonsPhiRZ.GetXaxis()-&gt;GetBinWidth(1);</div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span>  <span class="keyword">const</span> <span class="keyword">auto</span> deltaZ = histoIonsPhiRZ.GetZaxis()-&gt;GetBinWidth(1);</div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span>  <span class="keyword">const</span> <span class="keyword">auto</span> fac = deltaPhi * deltaZ * <a class="code hl_struct" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">o2::tpc::TPCParameters&lt;DataT&gt;::E0</a> / (2 * 100 * TMath::Qe()); <span class="comment">// 100 to normalize to cm: vacuum permittivity [As/(Vcm)]</span></div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a> = 1; <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a> &lt;= histoIonsPhiRZ.GetNbinsY(); ++<a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>) {</div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span>    <span class="keyword">const</span> <span class="keyword">auto</span> r0 = histoIonsPhiRZ.GetYaxis()-&gt;GetBinLowEdge(<a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>);</div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span>    <span class="keyword">const</span> <span class="keyword">auto</span> r1 = histoIonsPhiRZ.GetYaxis()-&gt;GetBinUpEdge(<a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>);</div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span>    <span class="keyword">const</span> <span class="keyword">auto</span> norm = fac * (r1 * r1 - r0 * r0);</div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi = 1; iphi &lt;= histoIonsPhiRZ.GetNbinsX(); ++iphi) {</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iz = 1; iz &lt;= histoIonsPhiRZ.GetNbinsZ(); ++iz) {</div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span>        <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#a3a5a5583cf997a469e4210b22aee42de">charge</a> = histoIonsPhiRZ.GetBinContent(iphi, <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, iz);</div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span>        histoIonsPhiRZ.SetBinContent(iphi, <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, iz, <a class="code hl_variable" href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#a3a5a5583cf997a469e4210b22aee42de">charge</a> / norm);</div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span>      }</div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span>    }</div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span>  }</div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span>}</div>
</div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span> </div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02850" data-start="{" data-end="}">
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7ef90c889b90fb5fea40a47e077e02b4"> 2850</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7ef90c889b90fb5fea40a47e077e02b4">SpaceCharge&lt;DataT&gt;::dumpAnalyticalCorrectionsDistortions</a>(TFile&amp; outf)<span class="keyword"> const</span></div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span>  <span class="keywordflow">if</span> (!mAnaDistCorr.isValid()) {</div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span>    LOGP(info, <span class="stringliteral">&quot;============== analytical functions are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>  }</div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>  <span class="keywordtype">bool</span> isOK = outf.WriteObject(&amp;mAnaDistCorr, <span class="stringliteral">&quot;analyticalDistCorr&quot;</span>);</div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span>  <span class="keywordflow">return</span> isOK;</div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span>}</div>
</div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span> </div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02861" data-start="{" data-end="}">
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3da8a7835405ea520dffc7a3913f77d9"> 2861</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3da8a7835405ea520dffc7a3913f77d9">SpaceCharge&lt;DataT&gt;::setAnalyticalCorrectionsDistortionsFromFile</a>(std::string_view inpf)</div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span>{</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>  TFile fIn(inpf.data(), <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> containsFormulas = fIn.GetListOfKeys()-&gt;Contains(<span class="stringliteral">&quot;analyticalDistCorr&quot;</span>);</div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span>  <span class="keywordflow">if</span> (!containsFormulas) {</div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span>    LOGP(info, <span class="stringliteral">&quot;============== analytical functions are not stored! returning ==============&quot;</span>);</div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span>  }</div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span>  LOGP(info, <span class="stringliteral">&quot;Using analytical corrections and distortions&quot;</span>);</div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span>  setUseAnalyticalDistCorr(<span class="keyword">true</span>);</div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span>  <a class="code hl_class" href="../../d7/d95/classo2_1_1tpc_1_1AnalyticalDistCorr.html">AnalyticalDistCorr&lt;DataT&gt;</a>* form = (<a class="code hl_class" href="../../d7/d95/classo2_1_1tpc_1_1AnalyticalDistCorr.html">AnalyticalDistCorr&lt;DataT&gt;</a>*)fIn.Get(<span class="stringliteral">&quot;analyticalDistCorr&quot;</span>);</div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span>  mAnaDistCorr = *form;</div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span>  <span class="keyword">delete</span> form;</div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span>}</div>
</div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span> </div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::langevinCylindricalE</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddPhi, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddZ, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntErOverEz, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntEPhiOverEz, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntDeltaEz)<span class="keyword"> const</span></div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span>  <span class="comment">// calculated distortions/correction with the formula described in https://edms.cern.ch/ui/file/1108138/1/ALICE-INT-2010-016.pdf page 7.</span></div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span>  ddR = mC0 * localIntErOverEz + mC1 * localIntEPhiOverEz;</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span>  ddPhi = (mC0 * localIntEPhiOverEz - mC1 * localIntErOverEz) / radius;</div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span>  ddZ = -localIntDeltaEz * <a class="code hl_struct" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">TPCParameters&lt;DataT&gt;::DVDE</a>;</div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span>}</div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span> </div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::langevinCylindricalB</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddPhi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntBrOverBz, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntBPhiOverBz)<span class="keyword"> const</span></div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span>  <span class="comment">// calculated distortions/correction with the formula described in https://edms.cern.ch/ui/file/1108138/1/ALICE-INT-2010-016.pdf page 7.</span></div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span>  ddR = mC2 * localIntBrOverBz - mC1 * localIntBPhiOverBz;</div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span>  ddPhi = (mC2 * localIntBPhiOverBz + mC1 * localIntBrOverBz) / radius;</div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span>}</div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span> </div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen02894" data-start="{" data-end="}">
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0e5633d230d25b21aafca1ec5f045992"> 2894</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0e5633d230d25b21aafca1ec5f045992">SpaceCharge&lt;DataT&gt;::initBField</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> field)</div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>{</div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span>  <span class="keyword">const</span> std::unordered_map&lt;int, std::pair&lt;int, int&gt;&gt; field_to_current = {{2, {12000, 6000}},</div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span>                                                                         {5, {30000, 6000}},</div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span>                                                                         {-2, {-12000, -6000}},</div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span>                                                                         {-5, {-30000, -6000}},</div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span>                                                                         {0, {0, 0}}};</div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span>  <span class="keyword">auto</span> currents_iter = field_to_current.find(field);</div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span>  <span class="keywordflow">if</span> (currents_iter == field_to_current.end()) {</div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span>    <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a1ef7964b771b9b29688dfa8810b27d00">LOG</a>(error) &lt;&lt; <span class="stringliteral">&quot; Could not lookup currents for fieldvalue &quot;</span> &lt;&lt; field;</div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span>  }</div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span>  mBField.setBField(field);</div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>  <a class="code hl_class" href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html">o2::parameters::GRPMagField</a> magField;</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span>  magField.<a class="code hl_function" href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#af6084138aa46bb722dec64109c0a58d5">setL3Current</a>((*currents_iter).second.first);</div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span>  magField.<a class="code hl_function" href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#a7d1fe73476cc732643952bb2072932b3">setDipoleCurrent</a>((*currents_iter).second.second);</div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>  setBFields(magField);</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span>}</div>
</div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span> </div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::setBFields</a>(<a class="code hl_class" href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html">o2::parameters::GRPMagField</a>&amp; magField)</div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span>{</div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> bzField = <a class="code hl_class" href="../../d1/da0/classint.html">int</a>(magField.<a class="code hl_function" href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#a1a2145ff216c627103fce6bab7ae095c">getNominalL3Field</a>());</div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span>  <span class="keyword">auto</span>&amp; gasParam = <a class="code hl_function" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">ParameterGas::Instance</a>();</div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span>  <span class="keywordtype">float</span> vDrift = gasParam.DriftV; <span class="comment">// drift velocity in cm/us</span></div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> omegaTau = -10. * bzField * vDrift / std::abs(getEzField(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>));</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span>  LOGP(detail, <span class="stringliteral">&quot;Setting omegaTau to {} for {}kG&quot;</span>, omegaTau, bzField);</div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a> = 1.;</div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> t2 = 1.;</div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span>  setOmegaTauT1T2(omegaTau, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a>, t2);</div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span>}</div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span> </div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Fields&gt;</div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::calcDistCorr</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1r, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1phi, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p1z, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> p2z, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddR, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddPhi, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; ddZ, <span class="keyword">const</span> Fields&amp; formulaStruct, <span class="keyword">const</span> <span class="keywordtype">bool</span> localDistCorr, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"> 2930</span>  <span class="comment">// see: https://edms.cern.ch/ui/file/1108138/1/ALICE-INT-2010-016.pdf</span></div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span>  <span class="comment">// needed for calculation of distortions/corrections</span></div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntErOverEz = 0;   <span class="comment">// integral_p1z^p2z Er/Ez dz</span></div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntEPhiOverEz = 0; <span class="comment">// integral_p1z^p2z Ephi/Ez dz</span></div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntDeltaEz = 0;    <span class="comment">// integral_p1z^p2z Ez dz</span></div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span> </div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntBrOverBz = 0;   <span class="comment">// integral_p1z^p2z Br/Bz dz</span></div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntBPhiOverBz = 0; <span class="comment">// integral_p1z^p2z Bphi/Bz dz</span></div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> localIntDeltaBz = 0;    <span class="comment">// integral_p1z^p2z Bz dz</span></div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddRExB = 0;</div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>  <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> ddPhiExB = 0;</div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span> </div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>  <span class="comment">// there are differentnumerical integration strategys implements. for details see each function.</span></div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span>  <span class="keywordflow">switch</span> (sNumericalIntegrationStrategy) {</div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span>    <span class="keywordflow">case</span> IntegrationStrategy::SimpsonIterative:                                                         <span class="comment">// iterative simpson integration (should be more precise at least for the analytical E-Field case but takes alot more time than normal simpson integration)</span></div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; sSimpsonNIteratives; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {                                                   <span class="comment">// TODO define a convergence criterion to abort the algorithm earlier for speed up.</span></div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> tmpZ = localDistCorr ? (p2z + ddZ) : regulateZ(p2z + ddZ, formulaStruct.getSide()); <span class="comment">// dont regulate for local distortions/corrections! (to get same result as using electric field at last/first bin)</span></div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span>        <span class="keywordflow">if</span> (mSimEDistortions) {</div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span>          integrateEFieldsSimpsonIterative(p1r, p1r + ddR + ddRExB, p1phi, p1phi + ddPhi + ddPhiExB, p1z, tmpZ, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz, formulaStruct, getEzField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span>          langevinCylindricalE(ddR, ddPhi, ddZ, (p1r + 0.5 * (ddR + ddRExB)), localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz); <span class="comment">// using the mean radius &#39;(p1r + 0.5 * ddR)&#39; for calculation of distortions/corections</span></div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>        }</div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span>        <span class="keywordflow">if</span> (mSimExBMisalignment) {</div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span>          integrateEFieldsSimpsonIterative(p1r, p1r + ddR + ddRExB, p1phi, p1phi + ddPhi + ddPhiExB, p1z, tmpZ, localIntBrOverBz, localIntBPhiOverBz, localIntDeltaBz, mBField, 0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span>          langevinCylindricalB(ddRExB, ddPhiExB, (p1r + 0.5 * (ddR + ddRExB)), localIntBrOverBz, localIntBPhiOverBz);</div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span>        }</div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span>      }</div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span>    <span class="keywordflow">case</span> IntegrationStrategy::Simpson: <span class="comment">// simpson integration</span></div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span>      <span class="keywordflow">if</span> (mSimEDistortions) {</div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span>        integrateEFieldsSimpson(p1r, p1phi, p1z, p2z, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz, formulaStruct, getEzField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span>        langevinCylindricalE(ddR, ddPhi, ddZ, p1r, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz);</div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span>      }</div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span>      <span class="keywordflow">if</span> (mSimExBMisalignment) {</div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span>        integrateEFieldsSimpson(p1r, p1phi, p1z, p2z, localIntBrOverBz, localIntBPhiOverBz, localIntDeltaBz, mBField, 0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span>        langevinCylindricalB(ddRExB, ddPhiExB, p1r, localIntBrOverBz, localIntBPhiOverBz);</div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span>      }</div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>    <span class="keywordflow">case</span> IntegrationStrategy::Trapezoidal: <span class="comment">// trapezoidal integration (fastest)</span></div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span>      <span class="keywordflow">if</span> (mSimEDistortions) {</div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span>        integrateEFieldsTrapezoidal(p1r, p1phi, p1z, p2z, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz, formulaStruct, getEzField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span>        langevinCylindricalE(ddR, ddPhi, ddZ, p1r, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz);</div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span>      }</div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span>      <span class="keywordflow">if</span> (mSimExBMisalignment) {</div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>        integrateEFieldsTrapezoidal(p1r, p1phi, p1z, p2z, localIntBrOverBz, localIntBPhiOverBz, localIntDeltaBz, mBField, 0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span>        langevinCylindricalB(ddRExB, ddPhiExB, p1r, localIntBrOverBz, localIntBPhiOverBz);</div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>      }</div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>    <span class="keywordflow">case</span> IntegrationStrategy::Root: <span class="comment">// using integration implemented in ROOT (slow)</span></div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span>      <span class="keywordflow">if</span> (mSimEDistortions) {</div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span>        integrateEFieldsRoot(p1r, p1phi, p1z, p2z, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz, formulaStruct, getEzField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span>        langevinCylindricalE(ddR, ddPhi, ddZ, p1r, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz);</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span>      }</div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>      <span class="keywordflow">if</span> (mSimExBMisalignment) {</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>        integrateEFieldsRoot(p1r, p1phi, p1z, p2z, localIntBrOverBz, localIntBPhiOverBz, localIntDeltaBz, mBField, 0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>        langevinCylindricalB(ddRExB, ddPhiExB, p1r, localIntBrOverBz, localIntBPhiOverBz);</div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>      }</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>      <span class="keywordflow">if</span> (mSimEDistortions) {</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>        integrateEFieldsSimpson(p1r, p1phi, p1z, p2z, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz, formulaStruct, getEzField(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>), <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>        langevinCylindricalE(ddR, ddPhi, ddZ, p1r, localIntErOverEz, localIntEPhiOverEz, localIntDeltaEz);</div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>      }</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>      <span class="keywordflow">if</span> (mSimExBMisalignment) {</div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>        integrateEFieldsSimpson(p1r, p1phi, p1z, p2z, localIntBrOverBz, localIntBPhiOverBz, localIntDeltaBz, mBField, 0, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>        langevinCylindricalB(ddRExB, ddPhiExB, p1r, localIntBrOverBz, localIntBPhiOverBz);</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span>      }</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>  }</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span> </div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span>  <a class="code hl_define" href="../../df/d21/GPUCommonDef_8h.html#a0117e1486062f932ded994de0d587344">GPUCA_DEBUG_STREAMER_CHECK</a>(<span class="keywordflow">if</span> (o2::utils::DebugStreamer::checkStream(<a class="code hl_enumvalue" href="../../d0/d28/namespaceo2_1_1utils.html#ab00bdc0f94fa861734930fc91cf67e14ad7118865304df8cdfc1d7f6fb8e345eb">o2::utils::StreamFlags::streamDistortionsSC</a>)) {</div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span>    o2::utils::DebugStreamer::instance()-&gt;getStreamer(<span class="stringliteral">&quot;debug_calcDistCorr&quot;</span>, <span class="stringliteral">&quot;UPDATE&quot;</span>) &lt;&lt; o2::utils::DebugStreamer::instance()-&gt;getUniqueTreeName(<span class="stringliteral">&quot;debug_calcDistCorr&quot;</span>).data()</div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;p1r=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;p1r))</div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;p1phi=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;p1phi))</div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;p1z=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;p1z))</div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;p2z=&quot;</span> &lt;&lt; (*<span class="keyword">const_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>*<span class="keyword">&gt;</span>(&amp;p2z))</div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntErOverEz=&quot;</span> &lt;&lt; localIntErOverEz</div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntEPhiOverEz=&quot;</span> &lt;&lt; localIntEPhiOverEz</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntDeltaEz=&quot;</span> &lt;&lt; localIntDeltaEz</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;ddR=&quot;</span> &lt;&lt; ddR</div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;ddPhi=&quot;</span> &lt;&lt; ddPhi</div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;ddZ=&quot;</span> &lt;&lt; ddZ</div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntBrOverBz=&quot;</span> &lt;&lt; localIntBrOverBz</div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntBPhiOverBz=&quot;</span> &lt;&lt; localIntBPhiOverBz</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;localIntDeltaBz=&quot;</span> &lt;&lt; localIntDeltaBz</div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;ddRExB=&quot;</span> &lt;&lt; ddRExB</div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;ddPhiExB=&quot;</span> &lt;&lt; ddPhiExB</div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>                                                                                      &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span>  })</div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span> </div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span>  ddR += ddRExB;</div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span>  ddPhi += ddPhiExB;</div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span>}</div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span> </div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03023" data-start="{" data-end="}">
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af752bf3e3e0bb9f909ebd51525f2dd21"> 3023</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af752bf3e3e0bb9f909ebd51525f2dd21">SpaceCharge&lt;DataT&gt;::dumpElectricFields</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span>  <span class="keywordflow">if</span> (!mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>    LOGP(info, <span class="stringliteral">&quot;============== E-Fields are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>  }</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;fieldEr_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;fieldEz_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;fieldEphi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span>}</div>
</div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span> </div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03038" data-start="{" data-end="}">
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aad0b025fd2ed30676b2a23a1f248658a"> 3038</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aad0b025fd2ed30676b2a23a1f248658a">SpaceCharge&lt;DataT&gt;::setElectricFieldsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span>{</div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span>  std::string_view treeEr{fmt::format(<span class="stringliteral">&quot;fieldEr_side{}&quot;</span>, sideName)};</div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treeEr)) {</div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span>  }</div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span>  initContainer(mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>  initContainer(mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span>  initContainer(mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span>  mElectricFieldEr[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treeEr, sNThreads);</div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>  mElectricFieldEz[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;fieldEz_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>  mElectricFieldEphi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;fieldEphi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span>}</div>
</div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span> </div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03055" data-start="{" data-end="}">
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a124395d1096003313755205833435610"> 3055</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a124395d1096003313755205833435610">SpaceCharge&lt;DataT&gt;::dumpGlobalDistortions</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>  <span class="keywordflow">if</span> (!mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span>    LOGP(info, <span class="stringliteral">&quot;============== global distortions are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>  }</div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;distR_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;distZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;distRphi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>}</div>
</div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span> </div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03070" data-start="{" data-end="}">
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a244ff868007df0f15fff94603c5b005d"> 3070</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a244ff868007df0f15fff94603c5b005d">SpaceCharge&lt;DataT&gt;::setGlobalDistortionsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span>{</div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>  std::string_view <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>{fmt::format(<span class="stringliteral">&quot;distR_side{}&quot;</span>, sideName)};</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>)) {</div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span>  }</div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>  initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span>  initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>  initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span>  mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>, sNThreads);</div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span>  mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;distZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span>  mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;distRphi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>}</div>
</div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span> </div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataTIn&gt;</div>
<div class="foldopen" id="foldopen03088" data-start="{" data-end="}">
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a69e84193198aa984866eafafb2ca95a9"> 3088</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a244ff868007df0f15fff94603c5b005d">SpaceCharge&lt;DataT&gt;::setGlobalDistortionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"> 3089</span>{</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>  initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>  initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>  initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span>  mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;distR_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>  mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;distZ_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>  mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;distRphi_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span>}</div>
</div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span> </div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03100" data-start="{" data-end="}">
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a58f16f65295007b95080ab0ecf4f1360"> 3100</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a58f16f65295007b95080ab0ecf4f1360">SpaceCharge&lt;DataT&gt;::dumpGlobalCorrections</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span>  <span class="keywordflow">if</span> (!mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span>    LOGP(info, <span class="stringliteral">&quot;============== global corrections are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>  }</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>}</div>
</div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span> </div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03115" data-start="{" data-end="}">
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25bbfc73f9401b5ff205f040606ea926"> 3115</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25bbfc73f9401b5ff205f040606ea926">SpaceCharge&lt;DataT&gt;::setGlobalCorrectionsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>{</div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>  }</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span> </div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>  initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span>  initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>  initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>  mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span>  mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>  mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span>}</div>
</div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span> </div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataTIn&gt;</div>
<div class="foldopen" id="foldopen03134" data-start="{" data-end="}">
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0d78348508facb2e0ea67163d7f1d02"> 3134</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25bbfc73f9401b5ff205f040606ea926">SpaceCharge&lt;DataT&gt;::setGlobalCorrectionsFromFile</a>(TFile&amp; inpf, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span>{</div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span>  initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>  initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>  initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span>  mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span>  mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span>  mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template initFromFile&lt;DataTIn&gt;(inpf, fmt::format(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span>}</div>
</div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span> </div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03146" data-start="{" data-end="}">
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2372e2d84908cc80db73b3c858c99732"> 3146</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2372e2d84908cc80db73b3c858c99732">SpaceCharge&lt;DataT&gt;::dumpLocalCorrections</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>  <span class="keywordflow">if</span> (!mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>    LOGP(info, <span class="stringliteral">&quot;============== local corrections are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>  }</div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdR = mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;lcorrR_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdZ = mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;lcorrZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lCorrdRPhi = mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;lcorrRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>  <span class="keywordflow">return</span> lCorrdR + lCorrdZ + lCorrdRPhi;</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>}</div>
</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span> </div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03161" data-start="{" data-end="}">
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a15baa243dd756629892923993d1ec1bf"> 3161</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a15baa243dd756629892923993d1ec1bf">SpaceCharge&lt;DataT&gt;::setLocalCorrectionsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span>{</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;lcorrR_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span>  }</div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span>  initContainer(mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span>  initContainer(mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span>  initContainer(mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdR = mLocalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdZ = mLocalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;lcorrZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lCorrdRPhi = mLocalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;lcorrRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span>}</div>
</div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span> </div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03178" data-start="{" data-end="}">
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa2fc9ad13284a45fde40ff5b0d921fc6"> 3178</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa2fc9ad13284a45fde40ff5b0d921fc6">SpaceCharge&lt;DataT&gt;::dumpLocalDistortions</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>  <span class="keywordflow">if</span> (!mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>    LOGP(info, <span class="stringliteral">&quot;============== local distortions are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>  }</div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdR = mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;ldistR_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdZ = mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;ldistZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lDistdRPhi = mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;ldistRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span>  <span class="keywordflow">return</span> lDistdR + lDistdZ + lDistdRPhi;</div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>}</div>
</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span> </div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03193" data-start="{" data-end="}">
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a65077bfa3724f61f2a744aa4f12cc45c"> 3193</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a65077bfa3724f61f2a744aa4f12cc45c">SpaceCharge&lt;DataT&gt;::dumpLocalDistCorrVectors</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>  <span class="keywordflow">if</span> (!mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>    LOGP(info, <span class="stringliteral">&quot;============== local distortion vectors are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span>  }</div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdR = mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;lvecdistR_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdZ = mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;lvecdistZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lVecDistdRPhi = mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, fmt::format(<span class="stringliteral">&quot;lvecdistRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>  <span class="keywordflow">return</span> lVecDistdR + lVecDistdZ + lVecDistdRPhi;</div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>}</div>
</div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span> </div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03208" data-start="{" data-end="}">
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af99823b28ab20c478b66288112dc897b"> 3208</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af99823b28ab20c478b66288112dc897b">SpaceCharge&lt;DataT&gt;::setLocalDistortionsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>{</div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;ldistR_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span>  }</div>
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"> 3215</span>  initContainer(mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span>  initContainer(mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>  initContainer(mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdR = mLocalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdZ = mLocalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;ldistZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lDistdRPhi = mLocalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;ldistRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span>}</div>
</div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span> </div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03225" data-start="{" data-end="}">
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec8eb38222b938a1a4c21ddbd934419a"> 3225</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec8eb38222b938a1a4c21ddbd934419a">SpaceCharge&lt;DataT&gt;::setLocalDistCorrVectorsFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>{</div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;lvecdistR_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span>  }</div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span>  initContainer(mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span>  initContainer(mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span>  initContainer(mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdR = mLocalVecDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdZ = mLocalVecDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;lvecdistZ_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lVecDistdRPhi = mLocalVecDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, fmt::format(<span class="stringliteral">&quot;lvecdistRPhi_side{}&quot;</span>, sideName), sNThreads);</div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span>}</div>
</div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span> </div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03242" data-start="{" data-end="}">
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a34b407b5797fe7d20144b0b4b95e5b87"> 3242</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a34b407b5797fe7d20144b0b4b95e5b87">SpaceCharge&lt;DataT&gt;::dumpPotential</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span>  <span class="keywordflow">if</span> (!mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>    LOGP(info, <span class="stringliteral">&quot;============== potential not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>  }</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>  <span class="keywordtype">int</span> status = mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;potential_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)), sNThreads);</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span>  <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span>}</div>
</div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span> </div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03254" data-start="{" data-end="}">
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab4541395c1c5f02af28e1a98329d4c0b"> 3254</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab4541395c1c5f02af28e1a98329d4c0b">SpaceCharge&lt;DataT&gt;::setPotentialFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span>{</div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;potential_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>  }</div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span>  mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"> 3263</span>}</div>
</div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span> </div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03266" data-start="{" data-end="}">
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f8cbc58786475327fe482b1d1ef6296"> 3266</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f8cbc58786475327fe482b1d1ef6296">SpaceCharge&lt;DataT&gt;::dumpDensity</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span>  <span class="keywordflow">if</span> (!mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span>    LOGP(info, <span class="stringliteral">&quot;============== space charge density are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span>  }</div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span>  <span class="keywordtype">int</span> status = mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].writeToFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, option, fmt::format(<span class="stringliteral">&quot;density_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)), sNThreads);</div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>  dumpMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span>  <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span>}</div>
</div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span> </div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03278" data-start="{" data-end="}">
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a24673a83786df4727afdb12165622b5f"> 3278</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a24673a83786df4727afdb12165622b5f">SpaceCharge&lt;DataT&gt;::checkGridFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, std::string_view <a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>)</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span>{</div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> nr, nz, nphi;</div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span>  <span class="keywordflow">if</span> (!DataContainer::getVertices(<a class="code hl_function" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a>, <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, nr, nz, nphi)) {</div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>  }</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span> </div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span>  <span class="comment">// check if stored grid definition and current grid definition is the same</span></div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span>  <span class="keywordflow">if</span> ((mParamGrid.NRVertices != nr) || (mParamGrid.NZVertices != nz) || (mParamGrid.NPhiVertices != nphi)) {</div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span>    LOGP(info, <span class="stringliteral">&quot;Different number of vertices found in input file. Initializing new space charge object with nR {} nZ {} nPhi {} vertices&quot;</span>, nr, nz, nphi);</div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span>    <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a> scTmp(mBField.getBField(), nz, nr, nphi, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>    scTmp.mC0 = mC0;</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span>    scTmp.mC1 = mC1;</div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span>    scTmp.mC2 = mC2;</div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span>    *<span class="keyword">this</span> = std::move(scTmp);</div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>  }</div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>}</div>
</div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span> </div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03298" data-start="{" data-end="}">
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a993d5dccf3d2de1da1aad94bf4018dbb"> 3298</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a993d5dccf3d2de1da1aad94bf4018dbb">SpaceCharge&lt;DataT&gt;::setDensityFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span>{</div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span>  <span class="keyword">const</span> std::string_view treename{fmt::format(<span class="stringliteral">&quot;density_side{}&quot;</span>, getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>))};</div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>  <span class="keywordflow">if</span> (!checkGridFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename)) {</div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span>  }</div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>  mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].initFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, treename, sNThreads);</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span>  readMetaData(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span>}</div>
</div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span> </div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03310" data-start="{" data-end="}">
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa5095db124d7dd5e6e5fb8df3778be64"> 3310</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a58f16f65295007b95080ab0ecf4f1360">SpaceCharge&lt;DataT&gt;::dumpGlobalCorrections</a>(TFile&amp; outf, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>  <span class="keywordflow">if</span> (!mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getNDataPoints()) {</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span>    LOGP(info, <span class="stringliteral">&quot;============== global corrections are not set! returning ==============&quot;</span>);</div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>  }</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>  <span class="keyword">const</span> std::string sideName = getSideName(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> er = mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template writeToFile&lt;float&gt;(outf, fmt::format(<span class="stringliteral">&quot;corrR_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ez = mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template writeToFile&lt;float&gt;(outf, fmt::format(<span class="stringliteral">&quot;corrZ_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"> 3319</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ephi = mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].template writeToFile&lt;float&gt;(outf, fmt::format(<span class="stringliteral">&quot;corrRPhi_side{}&quot;</span>, sideName).<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>());</div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>  <span class="keywordflow">return</span> er + ez + ephi;</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span>}</div>
</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span> </div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03324" data-start="{" data-end="}">
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9b795ba44b6b1ea7f444d42069076604"> 3324</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9b795ba44b6b1ea7f444d42069076604">SpaceCharge&lt;DataT&gt;::dumpToFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, std::string_view option)<span class="keyword"> const</span></div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>  <span class="keywordflow">if</span> (option == <span class="stringliteral">&quot;RECREATE&quot;</span>) {</div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span>    <span class="comment">// delete the file</span></div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span>    gSystem-&gt;Unlink(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>.data());</div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span>  }</div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span>  dumpElectricFields(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>  dumpPotential(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span>  dumpDensity(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span>  dumpGlobalDistortions(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span>  dumpGlobalCorrections(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span>  dumpLocalCorrections(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span>  dumpLocalDistortions(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span>  dumpLocalDistCorrVectors(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span>}</div>
</div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span> </div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03341" data-start="{" data-end="}">
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af571ca7cda9c2fc22653dd4a43c110c4"> 3341</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9b795ba44b6b1ea7f444d42069076604">SpaceCharge&lt;DataT&gt;::dumpToFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span>  <a class="code hl_function" href="../../d2/dba/CathodeSegmentationLong_8cxx.html#a21eb5ade2031321b2b8a98fd3749ed43">dumpToFile</a>(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span>  <a class="code hl_function" href="../../d2/dba/CathodeSegmentationLong_8cxx.html#a21eb5ade2031321b2b8a98fd3749ed43">dumpToFile</a>(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>, <span class="stringliteral">&quot;UPDATE&quot;</span>);</div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>}</div>
</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span> </div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03348" data-start="{" data-end="}">
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a89acd8f67d0813e37753362c2fa6ee6c"> 3348</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a89acd8f67d0813e37753362c2fa6ee6c">SpaceCharge&lt;DataT&gt;::dumpMetaData</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, std::string_view option, <span class="keyword">const</span> <span class="keywordtype">bool</span> overwriteExisting)<span class="keyword"> const</span></div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span>  TFile <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>.data(), option.data());</div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>  <span class="keywordflow">if</span> (!overwriteExisting &amp;&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>.GetListOfKeys()-&gt;Contains(<span class="stringliteral">&quot;meta&quot;</span>)) {</div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span>  }</div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>  <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>.Close();</div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span> </div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span>  <span class="comment">// create meta objects</span></div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span>  std::vector&lt;float&gt; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a>{<span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(mC0), <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(mC1), <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(mC2)};</div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span>  <span class="keyword">auto</span> helperA = mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>].getHelper();</div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span>  <span class="keyword">auto</span> helperC = mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>].getHelper();</div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span> </div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span>  <span class="comment">// define dataframe</span></div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>  ROOT::RDataFrame dFrame(1);</div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span>  <span class="keyword">auto</span> dfStore = dFrame.DefineSlotEntry(<span class="stringliteral">&quot;paramsC&quot;</span>, [&amp;<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a> = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a>](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a>; });</div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;grid_A&quot;</span>, [&amp;helperA = helperA](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> helperA; });</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;grid_C&quot;</span>, [&amp;helperC = helperC](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> helperC; });</div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;BField&quot;</span>, [field = mBField.getBField()](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { return field; });</div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span>  dfStore = dfStore.DefineSlotEntry(<span class="stringliteral">&quot;metaInf&quot;</span>, [meta = mMeta](<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, ULong64_t <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a>) { <span class="keywordflow">return</span> meta; });</div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span> </div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span>  <span class="comment">// write to TTree</span></div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span>  ROOT::RDF::RSnapshotOptions opt;</div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>  opt.fMode = option;</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span>  opt.fOverwriteIfExists = <span class="keyword">true</span>; <span class="comment">// overwrite if already exists</span></div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span>  dfStore.Snapshot(<span class="stringliteral">&quot;meta&quot;</span>, <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, {<span class="stringliteral">&quot;paramsC&quot;</span>, <span class="stringliteral">&quot;grid_A&quot;</span>, <span class="stringliteral">&quot;grid_C&quot;</span>, <span class="stringliteral">&quot;BField&quot;</span>, <span class="stringliteral">&quot;metaInf&quot;</span>}, opt);</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>}</div>
</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span> </div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03377" data-start="{" data-end="}">
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af47cefe85e3f183d786dec4557ac356f"> 3377</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af47cefe85e3f183d786dec4557ac356f">SpaceCharge&lt;DataT&gt;::readMetaData</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>)</div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>{</div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span>  <span class="keywordflow">if</span> (mReadMetaData) {</div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span>  }</div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span> </div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span>  <span class="comment">// check if TTree exists</span></div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>  TFile <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>.data(), <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>  <span class="keywordflow">if</span> (!<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>.GetListOfKeys()-&gt;Contains(<span class="stringliteral">&quot;meta&quot;</span>)) {</div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>  }</div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span>  <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a>.Close();</div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span> </div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>  <span class="keyword">auto</span> readMeta = [&amp;mC0 = mC0, &amp;mC1 = mC1, &amp;mC2 = mC2, &amp;mGrid3D = mGrid3D, &amp;mBField = mBField](<span class="keyword">const</span> std::vector&lt;float&gt;&amp; paramsC, <span class="keyword">const</span> <a class="code hl_struct" href="../../d1/d04/structo2_1_1tpc_1_1RegularGridHelper.html">RegularGridHelper&lt;double&gt;</a>&amp; gridA, <span class="keyword">const</span> <a class="code hl_struct" href="../../d1/d04/structo2_1_1tpc_1_1RegularGridHelper.html">RegularGridHelper&lt;double&gt;</a>&amp; gridC, <span class="keywordtype">int</span> field) {</div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span>    mC0 = paramsC[0];</div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span>    mC1 = paramsC[1];</div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span>    mC2 = paramsC[2];</div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>    mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>] = <a class="code hl_class" href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">RegularGrid3D&lt;DataT&gt;</a>(gridA.zmin, gridA.rmin, gridA.phimin, gridA.spacingZ, gridA.spacingR, gridA.spacingPhi, gridA.params);</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>    mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>] = <a class="code hl_class" href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">RegularGrid3D&lt;DataT&gt;</a>(gridC.zmin, gridC.rmin, gridC.phimin, gridC.spacingZ, gridC.spacingR, gridC.spacingPhi, gridC.params);</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span>    mBField.setBField(field);</div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span>  };</div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span> </div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span>  ROOT::RDataFrame dFrame(<span class="stringliteral">&quot;meta&quot;</span>, <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>);</div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span>  dFrame.Foreach(readMeta, {<span class="stringliteral">&quot;paramsC&quot;</span>, <span class="stringliteral">&quot;grid_A&quot;</span>, <span class="stringliteral">&quot;grid_C&quot;</span>, <span class="stringliteral">&quot;BField&quot;</span>});</div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span> </div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="../../d4/d67/VariantJSONHelpers_8cxx.html#a506e5407bcc583441afe6823fe8f0854">cols</a> = dFrame.GetColumnNames();</div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span>  <span class="keywordflow">if</span> (std::find(<a class="code hl_variable" href="../../d4/d67/VariantJSONHelpers_8cxx.html#a506e5407bcc583441afe6823fe8f0854">cols</a>.begin(), <a class="code hl_variable" href="../../d4/d67/VariantJSONHelpers_8cxx.html#a506e5407bcc583441afe6823fe8f0854">cols</a>.end(), <span class="stringliteral">&quot;metaInf&quot;</span>) != <a class="code hl_variable" href="../../d4/d67/VariantJSONHelpers_8cxx.html#a506e5407bcc583441afe6823fe8f0854">cols</a>.end()) {</div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span>    <span class="keyword">auto</span> readMetaInf = [&amp;mMeta = mMeta](<span class="keyword">const</span> <a class="code hl_struct" href="../../d1/d58/structo2_1_1tpc_1_1SCMetaData.html">SCMetaData</a>&amp; meta) {</div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>      mMeta = meta;</div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span>    };</div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span>    dFrame.Foreach(readMetaInf, {<span class="stringliteral">&quot;metaInf&quot;</span>});</div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>  }</div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span> </div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>  LOGP(info, <span class="stringliteral">&quot;Setting meta data: mC0={}  mC1={}  mC2={}&quot;</span>, mC0, mC1, mC2);</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span>  mReadMetaData = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span>}</div>
</div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span> </div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03415" data-start="{" data-end="}">
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25aed0bc6b816140e1618c3d350f030e"> 3415</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25aed0bc6b816140e1618c3d350f030e">SpaceCharge&lt;DataT&gt;::setSimNSector</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nSectors)</div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span>{</div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span>  LOGP(warning, <span class="stringliteral">&quot;Use this feature only if you know what you are doing!&quot;</span>);</div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>  <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">o2::tpc::MGParameters::normalizeGridToNSector</a> = nSectors;</div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span>  <a class="code hl_class" href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">RegularGrid</a> gridTmp[FNSIDES]{{GridProp::ZMIN, GridProp::RMIN, GridProp::PHIMIN, getSign(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>) * GridProp::getGridSpacingZ(mParamGrid.NZVertices), GridProp::getGridSpacingR(mParamGrid.NRVertices), GridProp::getGridSpacingPhi(mParamGrid.NPhiVertices) / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a> * nSectors, mParamGrid},</div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>                               {GridProp::ZMIN, GridProp::RMIN, GridProp::PHIMIN, getSign(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>) * GridProp::getGridSpacingZ(mParamGrid.NZVertices), GridProp::getGridSpacingR(mParamGrid.NRVertices), GridProp::getGridSpacingPhi(mParamGrid.NPhiVertices) / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a> * nSectors, mParamGrid}};</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span>  mGrid3D[0] = gridTmp[0];</div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span>  mGrid3D[1] = gridTmp[1];</div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>}</div>
</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span> </div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03426" data-start="{" data-end="}">
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7f9c51c9aa6ca12682cb72e81662d2c5"> 3426</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7f9c51c9aa6ca12682cb72e81662d2c5">SpaceCharge&lt;DataT&gt;::unsetSimNSector</a>()</div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span>{</div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span>  <a class="code hl_variable" href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">o2::tpc::MGParameters::normalizeGridToNSector</a> = <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span>}</div>
</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span> </div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03432" data-start="{" data-end="}">
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac28fa8c5e945011ca2b459a9578ca3e3"> 3432</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac28fa8c5e945011ca2b459a9578ca3e3">SpaceCharge&lt;DataT&gt;::setFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>{</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span>  setDensityFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span>  setPotentialFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>  setElectricFieldsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span>  setLocalDistortionsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span>  setLocalCorrectionsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span>  setGlobalDistortionsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span>  setGlobalCorrectionsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span>  setLocalDistCorrVectorsFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span>}</div>
</div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span> </div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03445" data-start="{" data-end="}">
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aab2fffb39681caafbafaea6d8b8cd11c"> 3445</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac28fa8c5e945011ca2b459a9578ca3e3">SpaceCharge&lt;DataT&gt;::setFromFile</a>(std::string_view <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>)</div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span>{</div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span>  setFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>);</div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span>  setFromFile(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>);</div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span>}</div>
</div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span> </div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::initContainer</a>(DataContainer&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> initMem)</div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>{</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>  <span class="keywordflow">if</span> (!<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>.getNDataPoints()) {</div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span>    <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>.setGrid(getNZVertices(), getNRVertices(), getNPhiVertices(), initMem);</div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span>  }</div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span>}</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span> </div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03460" data-start="{" data-end="}">
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0284367d48f7b2fe6362843ffee61264"> 3460</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0284367d48f7b2fe6362843ffee61264">SpaceCharge&lt;DataT&gt;::setOmegaTauT1T2</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> omegaTau, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> t2)</div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span>{</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> wt0 = t2 * omegaTau;</div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> wt02 = wt0 * wt0;</div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span>  mC0 = 1 / (1 + wt02);</div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> wt1 = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a> * omegaTau;</div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span>  mC1 = wt1 / (1 + wt1 * wt1);</div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span>  mC2 = wt02 / (1 + wt02);</div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span>}</div>
</div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span> </div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03471" data-start="{" data-end="}">
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08b328d8f063ff0af239e81ad3bbcceb"> 3471</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08b328d8f063ff0af239e81ad3bbcceb">SpaceCharge&lt;DataT&gt;::addChargeDensity</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>&amp; otherSC)</div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span>{</div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> sameGrid = (getNPhiVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a39e65fb4ba2b852a12662592073e50bc">getNPhiVertices</a>()) &amp;&amp; (getNRVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa30b36f2b70ca17375aa56eb554b0b15">getNRVertices</a>()) &amp;&amp; (getNZVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aefb573766d973254ec466cadcb6b8a05">getNZVertices</a>());</div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span>  <span class="keywordflow">if</span> (!sameGrid) {</div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span>    LOGP(warning, <span class="stringliteral">&quot;Space charge objects have different grid definition&quot;</span>);</div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>  }</div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span> </div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>  mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>] += otherSC.mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>];</div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span>  mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>] += otherSC.mDensity[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>];</div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span>}</div>
</div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span> </div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03484" data-start="{" data-end="}">
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a132f8becaf90d84135c890e606e60dda"> 3484</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a132f8becaf90d84135c890e606e60dda">SpaceCharge&lt;DataT&gt;::addGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>&amp; otherSC, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>{</div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> sameGrid = (getNPhiVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a39e65fb4ba2b852a12662592073e50bc">getNPhiVertices</a>()) &amp;&amp; (getNRVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa30b36f2b70ca17375aa56eb554b0b15">getNRVertices</a>()) &amp;&amp; (getNZVertices() == otherSC.<a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aefb573766d973254ec466cadcb6b8a05">getNZVertices</a>());</div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span>  <span class="keywordflow">if</span> (!sameGrid) {</div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>    LOGP(warning, <span class="stringliteral">&quot;Space charge objects have different grid definition&quot;</span>);</div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span>  }</div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span> </div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span>  mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] += otherSC.mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span>  mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] += otherSC.mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>  mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] += otherSC.mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>}</div>
</div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span> </div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03498" data-start="{" data-end="}">
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e321cf1e55b8bd151d3820b538289db"> 3498</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromHisto</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="keyword">const</span> <span class="keywordtype">char</span>* nameA, <span class="keyword">const</span> <span class="keywordtype">char</span>* nameC)</div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span>{</div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span>  TFile fInp(<a class="code hl_variable" href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a>, <span class="stringliteral">&quot;READ&quot;</span>);</div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span>  TH3F* hSCA = (TH3F*)fInp.Get(nameA);</div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>  TH3F* hSCC = (TH3F*)fInp.Get(nameC);</div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span>  <span class="keywordflow">if</span> (!hSCA) {</div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>    LOGP(error, <span class="stringliteral">&quot;Histogram {} not found&quot;</span>, nameA);</div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span>  }</div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span>  <span class="keywordflow">if</span> (!hSCC) {</div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"> 3507</span>    LOGP(error, <span class="stringliteral">&quot;Histogram {} not found&quot;</span>, nameC);</div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span>  }</div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span>  fillChargeDensityFromHisto(*hSCA, *hSCC);</div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span>}</div>
</div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span> </div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03513" data-start="{" data-end="}">
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab9f3a77b792d579957eeab75f811e023"> 3513</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">SpaceCharge&lt;DataT&gt;::fillChargeDensityFromHisto</a>(<span class="keyword">const</span> TH3&amp; hisSCDensity3D_A, <span class="keyword">const</span> TH3&amp; hisSCDensity3D_C)</div>
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"> 3514</span>{</div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nPhiBinsTmp = hisSCDensity3D_A.GetXaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nRBinsTmp = hisSCDensity3D_A.GetYaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nZBins = hisSCDensity3D_A.GetZaxis()-&gt;GetNbins();</div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>  <span class="keyword">const</span> <span class="keyword">auto</span> phiLow = hisSCDensity3D_A.GetXaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span>  <span class="keyword">const</span> <span class="keyword">auto</span> phiUp = hisSCDensity3D_A.GetXaxis()-&gt;GetBinUpEdge(nPhiBinsTmp);</div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rLow = hisSCDensity3D_A.GetYaxis()-&gt;GetBinLowEdge(1);</div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rUp = hisSCDensity3D_A.GetYaxis()-&gt;GetBinUpEdge(nRBinsTmp);</div>
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"> 3522</span>  <span class="keyword">const</span> <span class="keyword">auto</span> zUp = hisSCDensity3D_A.GetZaxis()-&gt;GetBinUpEdge(nZBins);</div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span> </div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>  TH3F hisSCMerged(<span class="stringliteral">&quot;hisMerged&quot;</span>, <span class="stringliteral">&quot;hisMerged&quot;</span>, nPhiBinsTmp, phiLow, phiUp, nRBinsTmp, rLow, rUp, 2 * nZBins, -zUp, zUp);</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span> </div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; FNSIDES; ++iside) {</div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hSC = (iside == 0) ? hisSCDensity3D_A : hisSCDensity3D_C;</div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iz = 1; iz &lt;= nZBins; ++iz) {</div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> izTmp = (iside == 0) ? (nZBins + iz) : iz;</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a> = 1; <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a> &lt;= nRBinsTmp; ++<a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>) {</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi = 1; iphi &lt;= nPhiBinsTmp; ++iphi) {</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span>          hisSCMerged.SetBinContent(iphi, <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, izTmp, hSC.GetBinContent(iphi, <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, iz));</div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span>        }</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>      }</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span>    }</div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span>  }</div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>  fillChargeDensityFromHisto(hisSCMerged);</div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span>}</div>
</div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span> </div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03542" data-start="{" data-end="}">
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8b1c785c09f42829bc9c20ee6b2d2c58"> 3542</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8b1c785c09f42829bc9c20ee6b2d2c58">SpaceCharge&lt;DataT&gt;::convertIDCsToCharge</a>(std::vector&lt;<a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; idcZero, <span class="keyword">const</span> <a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&amp; mapIBF, <span class="keyword">const</span> <span class="keywordtype">float</span> ionDriftTimeMS, <span class="keyword">const</span> <span class="keywordtype">bool</span> normToPadArea)</div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span>{</div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>  <span class="comment">// 1. integration time per IDC interval in ms</span></div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nOrbits = 12;</div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> idcIntegrationTimeMS = (nOrbits * <a class="code hl_variable" href="../../d5/d46/namespaceo2_1_1constants_1_1lhc.html#a2f0abc5677ddad18a3448a16bc191937">o2::constants::lhc::LHCOrbitMUS</a>) / 1e3;</div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span> </div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span>  <span class="comment">// number of time stamps for each integration interval (5346) (see: IDCSim.h getNTimeStampsPerIntegrationInterval())</span></div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nTimeStampsPerIDCInterval{(<a class="code hl_variable" href="../../d5/d46/namespaceo2_1_1constants_1_1lhc.html#a296bf820b93d969ac714d0aa4ea82d7c">o2::constants::lhc::LHCMaxBunches</a> * nOrbits) / <a class="code hl_variable" href="../../d5/da0/namespaceo2_1_1tpc_1_1constants.html#aafb14a7cd1b982bce14d282d9dcfebaf">o2::tpc::constants::LHCBCPERTIMEBIN</a>};</div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span> </div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nIDCSlices = idcZero.size();</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>  <span class="comment">// IDCs are normalized for each interval to 5346 time bins</span></div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span>  <span class="comment">// IDC0 = &lt;IDC&gt; per ms = 5346 / ~1ms</span></div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> idcsPerMS = nTimeStampsPerIDCInterval / idcIntegrationTimeMS;</div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span> </div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span>  <span class="comment">// length of one z slice on ms</span></div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> lengthZSliceMS = ionDriftTimeMS / nIDCSlices;</div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span> </div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>  <span class="comment">// IDCs for one z slice</span></div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> scaleToIonDrift = lengthZSliceMS * idcsPerMS;</div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span> </div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span>  <span class="comment">// get conversion factor from ADC to electrons (see: SAMPAProcessing::getADCvalue())</span></div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span>  <span class="keyword">const</span> <span class="keyword">static</span> <a class="code hl_struct" href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html">ParameterElectronics</a>&amp; parameterElectronics = <a class="code hl_function" href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">ParameterElectronics::Instance</a>();</div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> conversionADCToEle = parameterElectronics.<a class="code hl_variable" href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#aa8489337f7572584b43993fe1db33c13">ElectronCharge</a> * 1.e15 * parameterElectronics.<a class="code hl_variable" href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#afd173cc796cf70490714b86310274ccd">ChipGain</a> * parameterElectronics.<a class="code hl_variable" href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#a2c55cef75e9f1fd8c3c68d6d5ff5ecbb">ADCsaturation</a> / parameterElectronics.<a class="code hl_variable" href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#a24b4febac39d03dcc5ffd94729979a4c">ADCdynamicRange</a>;</div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span> </div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> conversionFactor = scaleToIonDrift / conversionADCToEle;</div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>  LOGP(info, <span class="stringliteral">&quot;Converting IDCs to space-charge density with conversion factor of {}&quot;</span>, conversionFactor);</div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span> </div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; calIDC : idcZero) {</div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span>    <span class="keywordflow">if</span> (normToPadArea) {</div>
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"> 3571</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sector = 0; sector &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a8e4affb36cdb57afa32449379d43aef7">Mapper::NSECTORS</a>; ++sector) {</div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region = 0; region &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a93c1a24bcb03c518c9b819b5aa45e45d">Mapper::NREGIONS</a>; ++region) {</div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> lrow = 0; lrow &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a85df553b7561b5281a061228ab409fc5">Mapper::ROWSPERREGION</a>[region]; ++lrow) {</div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pad = 0; pad &lt; <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a57665f936edb24da92b1d2be8ded708a">Mapper::PADSPERROW</a>[region][lrow]; ++pad) {</div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>              <span class="keyword">const</span> <span class="keywordtype">int</span> globalPad = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a15f4e85c6dda93a9e623a9ff9524eac6">Mapper::getGlobalPadNumber</a>(lrow, pad, region);</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>              <span class="keywordtype">float</span> idcTmp = calIDC.getValue(sector, globalPad);</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span>              calIDC.setValue(sector, globalPad, conversionFactor * idcTmp / <a class="code hl_variable" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a71cfd167b4833c06ffc20c062555af63">Mapper::INVPADAREA</a>[region]);</div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span>            }</div>
<div class="line"><a id="l03579" name="l03579"></a><span class="lineno"> 3579</span>          }</div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span>        }</div>
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"> 3581</span>      }</div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span>      calIDC *= conversionFactor;</div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span>    }</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span>    <span class="comment">// take IBF into account</span></div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>    calIDC *= mapIBF;</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span>    calIDC *= 0.01f; <span class="comment">// ibf values are in %</span></div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span>  }</div>
<div class="line"><a id="l03589" name="l03589"></a><span class="lineno"> 3589</span>}</div>
</div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span> </div>
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"> 3591</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03592" data-start="{" data-end="}">
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82913fcf78fb8274be5a8c19d21201f0"> 3592</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82913fcf78fb8274be5a8c19d21201f0">SpaceCharge&lt;DataT&gt;::fillChargeFromIDCs</a>(std::vector&lt;<a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&gt;&amp; idcZero, <span class="keyword">const</span> <a class="code hl_class" href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">CalDet&lt;float&gt;</a>&amp; mapIBF, <span class="keyword">const</span> <span class="keywordtype">float</span> ionDriftTimeMS, <span class="keyword">const</span> <span class="keywordtype">bool</span> normToPadArea)</div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span>{</div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span>  convertIDCsToCharge(idcZero, mapIBF, ionDriftTimeMS, normToPadArea);</div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"> 3595</span>  fillChargeFromCalDet(idcZero);</div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>}</div>
</div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span> </div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::initRodAlignmentVoltages</a>(<span class="keyword">const</span> MisalignmentType misalignmentType, <span class="keyword">const</span> FCType fcType, <span class="keyword">const</span> <span class="keywordtype">int</span> sector, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> deltaPot)</div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span>{</div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>  <span class="comment">// see also original implementation in AliTPCFCVoltError3D::InitFCVoltError3D (https://github.com/alisw/AliRoot/blob/master/TPC/TPCbase/AliTPCFCVoltError3D.h)</span></div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span> </div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iside = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>  initContainer(mPotential[iside], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> phiVerticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span>  <span class="keywordtype">int</span> phiVerticesEnd = phiVerticesPerSector;</div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span> </div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>  <span class="keywordflow">if</span> (misalignmentType == MisalignmentType::RodShift) {</div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> rodDiameter = 1; <span class="comment">// 1 cm SET SOMEWEHERE ELSE</span></div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> rodRadius = rodDiameter / 2;</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> radiusTmp = (fcType == FCType::IFC) ? <a class="code hl_struct" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">TPCParameters&lt;DataT&gt;::IFCRADIUS</a> : <a class="code hl_struct" href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">TPCParameters</a>&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&gt;::OFCRADIUS;</div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span>    <span class="keywordtype">int</span> nPhiVerticesPerRod = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(rodRadius * mParamGrid.NPhiVertices / (<a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a46d4efacb76f289c08e855e8325c8bc9">TWOPI</a> * radiusTmp) + 0.5);</div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span>    <span class="keywordflow">if</span> (nPhiVerticesPerRod == 0) {</div>
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"> 3614</span>      nPhiVerticesPerRod = 1;</div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span>    }</div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span>    phiVerticesEnd = nPhiVerticesPerRod;</div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span>  }</div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span> </div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> phiStart = sector * phiVerticesPerSector;</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> phiEnd = phiStart + phiVerticesEnd;</div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nRVertex = (fcType == FCType::IFC) ? 0 : (mParamGrid.NRVertices - 1);</div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = phiStart; iPhi &lt; phiEnd; ++iPhi) {</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiSector = iPhi % phiVerticesPerSector;</div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span> </div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span>    <span class="keywordtype">float</span> potentialSector = 0;</div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span>    <span class="keywordtype">float</span> potentialLastSector = 0;</div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>    <span class="keywordflow">if</span> ((misalignmentType == MisalignmentType::ShiftedClip) || (misalignmentType == MisalignmentType::RodShift)) {</div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> potentialShiftedClips = deltaPot - iPhiSector * deltaPot / phiVerticesEnd;</div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span>      potentialSector = potentialShiftedClips;</div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"> 3630</span>      potentialLastSector = potentialShiftedClips;</div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (misalignmentType == MisalignmentType::RotatedClip) {</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span>      <span class="comment">// set to zero for first vertex</span></div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>      <span class="keywordflow">if</span> (iPhiSector == 0) {</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span>        potentialSector = 0;</div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span>        potentialLastSector = 0;</div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> potentialRotatedClip = -deltaPot + (iPhiSector - 1) * deltaPot / (phiVerticesPerSector - 2);</div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>        potentialSector = potentialRotatedClip;</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>        potentialLastSector = -potentialRotatedClip;</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span>      }</div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span>    }</div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"> 3642</span> </div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span>      mPotential[iside](iZ, nRVertex, iPhi) += potentialSector;</div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>      <span class="keywordflow">if</span> (iPhiSector &gt; 0) {</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiMirror = ((phiStart - iPhiSector) + mParamGrid.NPhiVertices) % mParamGrid.NPhiVertices;</div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span>        mPotential[iside](iZ, nRVertex, iPhiMirror) += potentialLastSector;</div>
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"> 3648</span>      }</div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span>    }</div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span>  }</div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span>}</div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span> </div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03654" data-start="{" data-end="}">
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a652634045c7a547e94854b3a43fefef4"> 3654</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a652634045c7a547e94854b3a43fefef4">SpaceCharge&lt;DataT&gt;::addBoundaryPotential</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>&amp; <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> scaling)</div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>{</div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>].getData().empty()) {</div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span>    LOGP(info, <span class="stringliteral">&quot;Other space-charge object is empty!&quot;</span>);</div>
<div class="line"><a id="l03658" name="l03658"></a><span class="lineno"> 3658</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"> 3659</span>  }</div>
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"> 3660</span> </div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span>  <span class="keywordflow">if</span> ((mParamGrid.NRVertices != <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NRVertices) || (mParamGrid.NZVertices != <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NZVertices) || (mParamGrid.NPhiVertices != <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NPhiVertices)) {</div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>    LOGP(info, <span class="stringliteral">&quot;Different number of vertices found in input file. Initializing new space charge object with nR {} nZ {} nPhi {} vertices&quot;</span>, <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NRVertices, <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NZVertices, <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NPhiVertices);</div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span>    <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a> scTmp(mBField.getBField(), <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NZVertices, <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NRVertices, <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mParamGrid.NPhiVertices, <span class="keyword">false</span>);</div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>    scTmp.mC0 = mC0;</div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>    scTmp.mC1 = mC1;</div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>    scTmp.mC2 = mC2;</div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>    *<span class="keyword">this</span> = std::move(scTmp);</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>  }</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span> </div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span> </div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRFirst = 0;</div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRFirst, iPhi) += scaling * <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRFirst, iPhi);</div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span> </div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRLast = mParamGrid.NRVertices - 1;</div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRLast, iPhi) += scaling * <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRLast, iPhi);</div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>    }</div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>  }</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span> </div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZFirst = 0;</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZFirst, iR, iPhi) += scaling * <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZFirst, iR, iPhi);</div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span> </div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZLast = mParamGrid.NZVertices - 1;</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>      mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZLast, iR, iPhi) += scaling * <a class="code hl_variable" href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a>.mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZLast, iR, iPhi);</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span>    }</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>  }</div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span>}</div>
</div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span> </div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03694" data-start="{" data-end="}">
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af621105fd13f9cbfbd1ec260eac9ab71"> 3694</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af621105fd13f9cbfbd1ec260eac9ab71">SpaceCharge&lt;DataT&gt;::resetBoundaryPotentialToZeroInRangeZ</a>(<span class="keywordtype">float</span> <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a>, <span class="keywordtype">float</span> <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"> 3695</span>{</div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> zMaxAbs = std::abs(<a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>);</div>
<div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iZ = 1; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = std::abs(<a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>      <span class="keywordflow">if</span> ((<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> &lt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a>) || (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> &gt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>)) {</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRFirst = 0;</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span>        mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRFirst, iPhi) = 0;</div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span> </div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> iRLast = mParamGrid.NRVertices - 1;</div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>        mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iRLast, iPhi) = 0;</div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>      }</div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>    }</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>  }</div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span> </div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZFirst = 0;</div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> zFirst = std::abs(<a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZFirst, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span>      <span class="keywordflow">if</span> ((zFirst &lt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a>) || (zFirst &gt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>)) {</div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>        mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZFirst, iR, iPhi) = 0;</div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>      }</div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span> </div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> iZLast = mParamGrid.NZVertices - 1;</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> zLast = std::abs(<a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZLast, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>));</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>      <span class="keywordflow">if</span> ((zLast &lt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a>) || (zLast &gt; <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a>)) {</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>        mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZLast, iR, iPhi) = 0;</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>      }</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>    }</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>  }</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>}</div>
</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span> </div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03728" data-start="{" data-end="}">
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2fa1642b32fac6f01ca4f04500c341d1"> 3728</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2fa1642b32fac6f01ca4f04500c341d1">SpaceCharge&lt;DataT&gt;::setIFCChargeUpRisingPot</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> deltaPot, <span class="keyword">const</span> <span class="keywordtype">float</span> zMaxDeltaPot, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> zStart, <span class="keyword">const</span> <span class="keywordtype">float</span> offs, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span>{</div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>  std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt; chargeUpIFCLinear = [zStart, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, offs, deltaPot, zMaxDeltaPot](<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>) {</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> absZ = std::abs(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>);</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> absZMaxDeltaPot = std::abs(zMaxDeltaPot);</div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>    <span class="keywordflow">if</span> ((absZ &lt;= absZMaxDeltaPot) &amp;&amp; (absZ &gt;= zStart)) {</div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>      <span class="comment">// 1/x</span></div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>      <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 1) {</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> offsZ = 1;</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> zMaxDeltaPotTmp = zMaxDeltaPot - zStart + offsZ;</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> = deltaPot / (1 / offsZ - 1 / zMaxDeltaPotTmp);</div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> = -<a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / zMaxDeltaPotTmp;</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> absZShifted = zMaxDeltaPotTmp - (absZ - zStart);</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pot = <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> + <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / absZShifted;</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>        <span class="keywordflow">return</span> pot;</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 || <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 4) {</div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>        <span class="comment">// linearly rising potential</span></div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(deltaPot / (absZMaxDeltaPot - zStart) * (absZ - zStart) + offs);</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 2) {</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span>        <span class="comment">// flat</span></div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(deltaPot);</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 3) {</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span>        <span class="comment">// linear falling</span></div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(-deltaPot / (absZMaxDeltaPot - zStart) * (absZ - zStart) + deltaPot);</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(0);</div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span>      }</div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 4) {</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>      <span class="comment">// flat no z dependence</span></div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>      <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(offs);</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>      <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(0);</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>    }</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>  };</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>  setPotentialBoundaryInnerRadius(chargeUpIFCLinear, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>}</div>
</div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span> </div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03766" data-start="{" data-end="}">
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa631e1ae6ea6fc0b1eb627f7ac8fe2a2"> 3766</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa631e1ae6ea6fc0b1eb627f7ac8fe2a2">SpaceCharge&lt;DataT&gt;::setIFCChargeUpFallingPot</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> deltaPot, <span class="keyword">const</span> <span class="keywordtype">float</span> zMaxDeltaPot, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> zEnd, <span class="keyword">const</span> <span class="keywordtype">float</span> offs, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>{</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>  std::function&lt;<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(<a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>)&gt; chargeUpIFCLinear = [zEnd, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, offs, <a class="code hl_variable" href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a> = getZMax(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>), deltaPot, zMaxDeltaPot](<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>) {</div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> absZ = std::abs(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>);</div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> absZMaxDeltaPot = std::abs(zMaxDeltaPot);</div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span> </div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../dd/d8d/namespaceo2_1_1framework.html#a3a2fc3abf9432c8fb87a3871962852de">check</a> = (absZ &gt;= absZMaxDeltaPot);</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>    <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 || <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 3) {</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span>      <a class="code hl_function" href="../../dd/d8d/namespaceo2_1_1framework.html#a3a2fc3abf9432c8fb87a3871962852de">check</a> = (absZ &gt;= absZMaxDeltaPot);</div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span>    }</div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span> </div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../dd/d8d/namespaceo2_1_1framework.html#a3a2fc3abf9432c8fb87a3871962852de">check</a> &amp;&amp; (absZ &lt;= zEnd)) {</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span>      <span class="comment">// 1/x dependency</span></div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span>      <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 1) {</div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> = (deltaPot - offs) / (1 / zMaxDeltaPot - 1 / zEnd);</div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> = offs - <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / zEnd;</div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pot = <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> + <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / absZ;</div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span>        <span class="keywordflow">return</span> pot;</div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 2) {</div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span>        <span class="comment">// 1/x dependency steep fall off!</span></div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> offsZ = 1 + offs;</div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> zEndTmp = zEnd - zMaxDeltaPot + offsZ;</div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> = deltaPot / (1 / offsZ - 1 / zEndTmp);</div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> = -<a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / zEndTmp;</div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> absZShifted = absZ - zMaxDeltaPot + offsZ;</div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> pot = <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a> + <a class="code hl_function" href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a> / absZShifted;</div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span>        <span class="keywordflow">return</span> pot;</div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 0 || <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 3) {</div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span>        <span class="comment">// linearly falling potential</span></div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> zPos = absZ - zEnd;</div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span>        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a><span class="keyword">&gt;</span>(deltaPot / (absZMaxDeltaPot - zEnd) * zPos + offs);</div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(0);</div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span>      }</div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == 3) {</div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span>      <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(offs);</div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03803" name="l03803"></a><span class="lineno"> 3803</span>      <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>(0);</div>
<div class="line"><a id="l03804" name="l03804"></a><span class="lineno"> 3804</span>    }</div>
<div class="line"><a id="l03805" name="l03805"></a><span class="lineno"> 3805</span>  };</div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span>  setPotentialBoundaryInnerRadius(chargeUpIFCLinear, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"> 3807</span>}</div>
</div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span> </div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03810" data-start="{" data-end="}">
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad7c1d42e2cd3ecd129d958b2b1759e05"> 3810</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad7c1d42e2cd3ecd129d958b2b1759e05">SpaceCharge&lt;DataT&gt;::setGlobalCorrections</a>(<span class="keyword">const</span> std::function&lt;<span class="keywordtype">void</span>(<span class="keywordtype">int</span> sector, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCz)&gt;&amp; gCorr, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span>{</div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span>  setGlobalDistCorr(Type::Corrections, gCorr, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span>}</div>
</div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span> </div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03816" data-start="{" data-end="}">
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dfcb180115bfd99f41b8e144a6142e4"> 3816</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dfcb180115bfd99f41b8e144a6142e4">SpaceCharge&lt;DataT&gt;::setGlobalDistortions</a>(<span class="keyword">const</span> std::function&lt;<span class="keywordtype">void</span>(<span class="keywordtype">int</span> sector, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCz)&gt;&amp; gDist, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span>{</div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span>  setGlobalDistCorr(Type::Distortions, gDist, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03819" name="l03819"></a><span class="lineno"> 3819</span>}</div>
</div>
<div class="line"><a id="l03820" name="l03820"></a><span class="lineno"> 3820</span> </div>
<div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::setGlobalDistCorr</a>(<span class="keyword">const</span> Type <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> std::function&lt;<span class="keywordtype">void</span>(<span class="keywordtype">int</span> sector, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gz, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCx, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCy, <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a>&amp; gCz)&gt;&amp; gFunc, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span>{</div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span>  <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span>    initContainer(mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span>    initContainer(mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span>    initContainer(mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03829" name="l03829"></a><span class="lineno"> 3829</span>    initContainer(mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03830" name="l03830"></a><span class="lineno"> 3830</span>    initContainer(mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03831" name="l03831"></a><span class="lineno"> 3831</span>    initContainer(mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span>  }</div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span> </div>
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"> 3834</span><span class="preprocessor">#pragma omp parallel for num_threads(sNThreads)</span></div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = 0; iPhi &lt; mParamGrid.NPhiVertices; ++iPhi) {</div>
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"> 3836</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> sector = iPhi / (mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>) + (<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a> ? 0 : <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>);</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>    phi = o2::math_utils::detail::toPMPi(phi);</div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span> </div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> = getXFromPolar(radius, phi);</div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_class" href="../../d1/da0/classint.html">y</a> = getYFromPolar(radius, phi);</div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span> </div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span> </div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span>        <span class="comment">// get corrected points</span></div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gCx = 0;</div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gCy = 0;</div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gCz = 0;</div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span>        gFunc(sector, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, gCx, gCy, gCz);</div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gCxCorr = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> + gCx;</div>
<div class="line"><a id="l03854" name="l03854"></a><span class="lineno"> 3854</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> gCyCorr = <a class="code hl_class" href="../../d1/da0/classint.html">y</a> + gCy;</div>
<div class="line"><a id="l03855" name="l03855"></a><span class="lineno"> 3855</span> </div>
<div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span>        <span class="comment">// get corrections</span></div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrR = getRadiusFromCartesian(gCxCorr, gCyCorr) - radius;</div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span>        <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phiDiff = getPhiFromCartesian(gCxCorr, gCyCorr) - phi;</div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span>        phiDiff = o2::math_utils::detail::toPMPi(phiDiff);</div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> corrRPhi = phiDiff * radius;</div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span> </div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span>        <span class="comment">// store corrections</span></div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span>        <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a> == Type::Distortions) {</div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span>          mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrR;</div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span>          mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = gCz;</div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span>          mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrRPhi;</div>
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"> 3867</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span>          mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrR;</div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span>          mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = gCz;</div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span>          mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) = corrRPhi;</div>
<div class="line"><a id="l03871" name="l03871"></a><span class="lineno"> 3871</span>        }</div>
<div class="line"><a id="l03872" name="l03872"></a><span class="lineno"> 3872</span>      }</div>
<div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span>    }</div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span>  }</div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span>}</div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span> </div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03878" data-start="{" data-end="}">
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3dfc2263f84e647902150e801ed7d39"> 3878</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3dfc2263f84e647902150e801ed7d39">SpaceCharge&lt;DataT&gt;::setROCMisalignmentShiftZ</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sector, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> potential)</div>
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"> 3879</span>{</div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span>  setROCMisalignment(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, 2, sector, potential, potential);</div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span>}</div>
</div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span> </div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03884" data-start="{" data-end="}">
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10fcb62febc447a733c8eb5975e8a40e"> 3884</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10fcb62febc447a733c8eb5975e8a40e">SpaceCharge&lt;DataT&gt;::setROCMisalignmentRotationAlongX</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sector, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> potentialMin, <span class="keyword">const</span> <span class="keywordtype">float</span> potentialMax)</div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span>{</div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span>  setROCMisalignment(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, 0, sector, potentialMin, potentialMax);</div>
<div class="line"><a id="l03887" name="l03887"></a><span class="lineno"> 3887</span>}</div>
</div>
<div class="line"><a id="l03888" name="l03888"></a><span class="lineno"> 3888</span> </div>
<div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03890" data-start="{" data-end="}">
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f23362f9672c1699bfc58e970c4937b"> 3890</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f23362f9672c1699bfc58e970c4937b">SpaceCharge&lt;DataT&gt;::setROCMisalignmentRotationAlongY</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sector, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, <span class="keyword">const</span> <span class="keywordtype">float</span> potentialMin, <span class="keyword">const</span> <span class="keywordtype">float</span> potentialMax)</div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span>{</div>
<div class="line"><a id="l03892" name="l03892"></a><span class="lineno"> 3892</span>  setROCMisalignment(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a>, 1, sector, potentialMin, potentialMax);</div>
<div class="line"><a id="l03893" name="l03893"></a><span class="lineno"> 3893</span>}</div>
</div>
<div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span> </div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::setROCMisalignment</a>(<span class="keywordtype">int</span> stackType, <span class="keywordtype">int</span> misalignmentType, <span class="keywordtype">int</span> sector, <span class="keyword">const</span> <span class="keywordtype">float</span> potMin, <span class="keyword">const</span> <span class="keywordtype">float</span> potMax)</div>
<div class="line"><a id="l03897" name="l03897"></a><span class="lineno"> 3897</span>{</div>
<div class="line"><a id="l03898" name="l03898"></a><span class="lineno"> 3898</span>  initContainer(mPotential[<a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a>(sector).<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>()], <span class="keyword">true</span>);</div>
<div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span>  <span class="keyword">const</span> <span class="keyword">auto</span> indPhiTopIROC = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>, <span class="keyword">false</span>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span> </div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span>  <span class="keyword">const</span> <span class="keyword">auto</span> rotationPoints = [](<span class="keyword">const</span> <span class="keywordtype">int</span> regStart, <span class="keyword">const</span> <span class="keywordtype">int</span> regEnd, <span class="keywordtype">int</span> misalignmentType, <span class="keyword">const</span> <span class="keywordtype">float</span> potMax, <span class="keyword">const</span> <span class="keywordtype">float</span> potMin) {</div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span>    <span class="keywordflow">if</span> (misalignmentType == 0) {</div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mapper = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">o2::tpc::Mapper::instance</a>();</div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> radStart = mapper.getPadRegionInfo(regStart).getRadiusFirstRow();</div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; padReg = mapper.getPadRegionInfo(regEnd);</div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> radEnd = padReg.getRadiusFirstRow() + padReg.getPadHeight() * padReg.getNumberOfPadRows() - radStart;</div>
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"> 3907</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> rotationPoint = radStart + radEnd / 2;</div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a8b02c1a703555609b690ce7e9a414e9c">slope</a> = (potMax - potMin) / radEnd;</div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span>      <span class="keywordflow">return</span> std::pair&lt;float, float&gt;{rotationPoint, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a8b02c1a703555609b690ce7e9a414e9c">slope</a>};</div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (misalignmentType == 1) {</div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span>      <span class="keywordflow">return</span> std::pair&lt;float, float&gt;{0, (potMax - potMin) / 100};</div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span>      <span class="keywordflow">return</span> std::pair&lt;float, float&gt;{0, (potMax + potMin) / 2};</div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span>    }</div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span>  };</div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span> </div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span>  <span class="keywordflow">if</span> (stackType == 0) {</div>
<div class="line"><a id="l03918" name="l03918"></a><span class="lineno"> 3918</span>    <span class="keyword">const</span> <span class="keyword">auto</span> deltaPotPar = rotationPoints(0, 3, misalignmentType, potMax, potMin);</div>
<div class="line"><a id="l03919" name="l03919"></a><span class="lineno"> 3919</span>    <span class="keyword">const</span> <span class="keyword">auto</span> indPhiBottomIROC = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>, <span class="keyword">true</span>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span>    fillROCMisalignment(indPhiTopIROC, indPhiBottomIROC, sector, misalignmentType, deltaPotPar);</div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stackType == 1) {</div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span>    <span class="keyword">const</span> <span class="keyword">auto</span> deltaPotPar = rotationPoints(4, 9, misalignmentType, potMax, potMin);</div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span>    <span class="keyword">const</span> <span class="keyword">auto</span> indPhiTopOROC3 = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">GEMstack::OROC3gem</a>, <span class="keyword">false</span>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span>    fillROCMisalignment(indPhiTopOROC3, indPhiTopIROC, sector, misalignmentType, deltaPotPar);</div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stackType == 2) {</div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span>    <span class="keyword">const</span> <span class="keyword">auto</span> deltaPotPar = rotationPoints(0, 9, misalignmentType, potMax, potMin);</div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span>    <span class="keyword">const</span> <span class="keyword">auto</span> indPhiBottomIROC = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">GEMstack::IROCgem</a>, <span class="keyword">true</span>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span>    <span class="keyword">const</span> <span class="keyword">auto</span> indPhiTopOROC3 = getPotentialBoundaryGEMFrameAlongPhiIndices(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">GEMstack::OROC3gem</a>, <span class="keyword">false</span>, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span>    fillROCMisalignment(indPhiTopIROC, indPhiBottomIROC, sector, misalignmentType, deltaPotPar);</div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span>    fillROCMisalignment(indPhiTopOROC3, indPhiTopIROC, sector, misalignmentType, deltaPotPar);</div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span>  }</div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span>}</div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span> </div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span><span class="keywordtype">void</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;::fillROCMisalignment</a>(<span class="keyword">const</span> std::vector&lt;std::pair&lt;size_t, float&gt;&gt;&amp; indicesTop, <span class="keyword">const</span> std::vector&lt;std::pair&lt;size_t, float&gt;&gt;&amp; indicesBottom, <span class="keywordtype">int</span> sector, <span class="keywordtype">int</span> misalignmentType, <span class="keyword">const</span> std::pair&lt;float, float&gt;&amp; deltaPotPar)</div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span>{</div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; indexw : indicesTop) {</div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a> = indexw.first;</div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iZ = <a class="code hl_function" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a7882ef64d7636ef76cc35d856d06d253">DataContainer3D&lt;float&gt;::getIndexZ</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>, getNZVertices(), getNRVertices(), getNPhiVertices());</div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iRStart = <a class="code hl_function" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a067d56172cdb374ae8c3c9bfd3b0efdc">DataContainer3D&lt;float&gt;::getIndexR</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>, getNZVertices(), getNRVertices(), getNPhiVertices());</div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iPhi = <a class="code hl_function" href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a84b1a5d8bcf89a81b4f4d60766e04733">DataContainer3D&lt;float&gt;::getIndexPhi</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a>, getNZVertices(), getNRVertices(), getNPhiVertices());</div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span> </div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> sectorTmp = iPhi / (getNPhiVertices() / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>) + ((sector &gt;= <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>) ? <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a> : 0);</div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span>    <span class="keywordflow">if</span> ((sector != -1) &amp;&amp; (sectorTmp != sector)) {</div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span>    }</div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span>    <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sec(sectorTmp);</div>
<div class="line"><a id="l03948" name="l03948"></a><span class="lineno"> 3948</span> </div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iR = iRStart; iR &gt; 0; --iR) {</div>
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"> 3950</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> currInd = (iZ + getNZVertices() * (iR + iPhi * getNRVertices()));</div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> foundVertexBottom = std::binary_search(indicesBottom.begin(), indicesBottom.end(), std::make_pair(currInd, 0.0f), [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>) { return (a.first &lt; b.first); });</div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span> </div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span>      <span class="keywordflow">if</span> (foundVertexBottom) {</div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span>      }</div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span> </div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span>      <span class="comment">// get local coordinates</span></div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> rPos = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, sec.side());</div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> phiPos = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iPhi, sec.side());</div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> zPos = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">getZVertex</a>(iZ, sec.side());</div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> = getXFromPolar(rPos, phiPos);</div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span>      <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_class" href="../../d1/da0/classint.html">y</a> = getYFromPolar(rPos, phiPos);</div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <a class="code hl_class" href="../../d1/da0/classint.html">y</a>, zPos);</div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">LocalPosition3D</a> lPos = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7962684772bd8bf62a60941ea4312cb2">Mapper::GlobalToLocal</a>(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>, sec);</div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>      <span class="keywordtype">float</span> deltaPot = 0;</div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span>      <span class="keywordflow">if</span> (misalignmentType == 0) {</div>
<div class="line"><a id="l03967" name="l03967"></a><span class="lineno"> 3967</span>        deltaPot = (lPos.X() - deltaPotPar.first) * deltaPotPar.second;</div>
<div class="line"><a id="l03968" name="l03968"></a><span class="lineno"> 3968</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (misalignmentType == 1) {</div>
<div class="line"><a id="l03969" name="l03969"></a><span class="lineno"> 3969</span>        deltaPot = lPos.Y() * deltaPotPar.second;</div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span>        deltaPot = deltaPotPar.second;</div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span>      }</div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span>      mPotential[sec.side()](iZ, iR, iPhi) += deltaPot;</div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span>    }</div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span>  }</div>
<div class="line"><a id="l03976" name="l03976"></a><span class="lineno"> 3976</span>}</div>
<div class="line"><a id="l03977" name="l03977"></a><span class="lineno"> 3977</span> </div>
<div class="line"><a id="l03978" name="l03978"></a><span class="lineno"> 3978</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03979" data-start="{" data-end="}">
<div class="line"><a id="l03979" name="l03979"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a97ac150a6f1d354e6b104989d63e313b"> 3979</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a97ac150a6f1d354e6b104989d63e313b">SpaceCharge&lt;DataT&gt;::subtractGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>&amp; otherSC, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03980" name="l03980"></a><span class="lineno"> 3980</span>{</div>
<div class="line"><a id="l03981" name="l03981"></a><span class="lineno"> 3981</span>  mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03982" name="l03982"></a><span class="lineno"> 3982</span>  mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03983" name="l03983"></a><span class="lineno"> 3983</span>  mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03984" name="l03984"></a><span class="lineno"> 3984</span>}</div>
</div>
<div class="line"><a id="l03985" name="l03985"></a><span class="lineno"> 3985</span> </div>
<div class="line"><a id="l03986" name="l03986"></a><span class="lineno"> 3986</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03987" data-start="{" data-end="}">
<div class="line"><a id="l03987" name="l03987"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a645b39cfd808df71f11e9608c61c0830"> 3987</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a645b39cfd808df71f11e9608c61c0830">SpaceCharge&lt;DataT&gt;::subtractGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataT&gt;</a>&amp; otherSC, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03988" name="l03988"></a><span class="lineno"> 3988</span>{</div>
<div class="line"><a id="l03989" name="l03989"></a><span class="lineno"> 3989</span>  mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalDistdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03990" name="l03990"></a><span class="lineno"> 3990</span>  mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalDistdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03991" name="l03991"></a><span class="lineno"> 3991</span>  mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] -= otherSC.mGlobalDistdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>];</div>
<div class="line"><a id="l03992" name="l03992"></a><span class="lineno"> 3992</span>}</div>
</div>
<div class="line"><a id="l03993" name="l03993"></a><span class="lineno"> 3993</span> </div>
<div class="line"><a id="l03994" name="l03994"></a><span class="lineno"> 3994</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen03995" data-start="{" data-end="}">
<div class="line"><a id="l03995" name="l03995"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0286a3f4f1f512226d73e758165be16"> 3995</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0286a3f4f1f512226d73e758165be16">SpaceCharge&lt;DataT&gt;::scaleCorrections</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l03996" name="l03996"></a><span class="lineno"> 3996</span>{</div>
<div class="line"><a id="l03997" name="l03997"></a><span class="lineno"> 3997</span>  mGlobalCorrdR[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] *= <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>;</div>
<div class="line"><a id="l03998" name="l03998"></a><span class="lineno"> 3998</span>  mGlobalCorrdZ[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] *= <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>;</div>
<div class="line"><a id="l03999" name="l03999"></a><span class="lineno"> 3999</span>  mGlobalCorrdRPhi[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>] *= <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>;</div>
<div class="line"><a id="l04000" name="l04000"></a><span class="lineno"> 4000</span>}</div>
</div>
<div class="line"><a id="l04001" name="l04001"></a><span class="lineno"> 4001</span> </div>
<div class="line"><a id="l04002" name="l04002"></a><span class="lineno"> 4002</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04003" data-start="{" data-end="}">
<div class="line"><a id="l04003" name="l04003"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb7e3314dadf5e5318890390f933d225"> 4003</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb7e3314dadf5e5318890390f933d225">SpaceCharge&lt;DataT&gt;::averageDensityPerSector</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>)</div>
<div class="line"><a id="l04004" name="l04004"></a><span class="lineno"> 4004</span>{</div>
<div class="line"><a id="l04005" name="l04005"></a><span class="lineno"> 4005</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l04006" name="l04006"></a><span class="lineno"> 4006</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l04007" name="l04007"></a><span class="lineno"> 4007</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l04008" name="l04008"></a><span class="lineno"> 4008</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l04009" name="l04009"></a><span class="lineno"> 4009</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = 0; iPhi &lt;= (verticesPerSector / 2); ++iPhi) {</div>
<div class="line"><a id="l04010" name="l04010"></a><span class="lineno"> 4010</span>        <span class="keywordtype">float</span> meanDensity = 0;</div>
<div class="line"><a id="l04011" name="l04011"></a><span class="lineno"> 4011</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; 2; ++iter) {</div>
<div class="line"><a id="l04012" name="l04012"></a><span class="lineno"> 4012</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sec = 0; sec &lt; <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>; ++sec) {</div>
<div class="line"><a id="l04013" name="l04013"></a><span class="lineno"> 4013</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiTmpA = iPhi + sec * verticesPerSector;</div>
<div class="line"><a id="l04014" name="l04014"></a><span class="lineno"> 4014</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiTmpB = ((sec + 1) * verticesPerSector - iPhi) % mParamGrid.NPhiVertices;</div>
<div class="line"><a id="l04015" name="l04015"></a><span class="lineno"> 4015</span>            <span class="keywordflow">if</span> (iter == 0) {</div>
<div class="line"><a id="l04016" name="l04016"></a><span class="lineno"> 4016</span>              meanDensity += mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhiTmpA);</div>
<div class="line"><a id="l04017" name="l04017"></a><span class="lineno"> 4017</span>              meanDensity += mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhiTmpB);</div>
<div class="line"><a id="l04018" name="l04018"></a><span class="lineno"> 4018</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l04019" name="l04019"></a><span class="lineno"> 4019</span>              <span class="keyword">const</span> <span class="keywordtype">float</span> densMean = meanDensity / (2 * <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>);</div>
<div class="line"><a id="l04020" name="l04020"></a><span class="lineno"> 4020</span>              mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhiTmpA) = densMean;</div>
<div class="line"><a id="l04021" name="l04021"></a><span class="lineno"> 4021</span>              mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhiTmpB) = densMean;</div>
<div class="line"><a id="l04022" name="l04022"></a><span class="lineno"> 4022</span>            }</div>
<div class="line"><a id="l04023" name="l04023"></a><span class="lineno"> 4023</span>          }</div>
<div class="line"><a id="l04024" name="l04024"></a><span class="lineno"> 4024</span>        }</div>
<div class="line"><a id="l04025" name="l04025"></a><span class="lineno"> 4025</span>      }</div>
<div class="line"><a id="l04026" name="l04026"></a><span class="lineno"> 4026</span>    }</div>
<div class="line"><a id="l04027" name="l04027"></a><span class="lineno"> 4027</span>  }</div>
<div class="line"><a id="l04028" name="l04028"></a><span class="lineno"> 4028</span>}</div>
</div>
<div class="line"><a id="l04029" name="l04029"></a><span class="lineno"> 4029</span> </div>
<div class="line"><a id="l04030" name="l04030"></a><span class="lineno"> 4030</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04031" data-start="{" data-end="}">
<div class="line"><a id="l04031" name="l04031"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afb60aa556a63b877e6d3e5b25ebc78cd"> 4031</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afb60aa556a63b877e6d3e5b25ebc78cd">SpaceCharge&lt;DataT&gt;::scaleChargeDensitySector</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> scalingFactor, <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sector)</div>
<div class="line"><a id="l04032" name="l04032"></a><span class="lineno"> 4032</span>{</div>
<div class="line"><a id="l04033" name="l04033"></a><span class="lineno"> 4033</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = sector.<a class="code hl_function" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#a0cbc050672c8d917aeca484baf230125">side</a>();</div>
<div class="line"><a id="l04034" name="l04034"></a><span class="lineno"> 4034</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l04035" name="l04035"></a><span class="lineno"> 4035</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l04036" name="l04036"></a><span class="lineno"> 4036</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> sectorInSide = sector % <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l04037" name="l04037"></a><span class="lineno"> 4037</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiFirst = sectorInSide * verticesPerSector;</div>
<div class="line"><a id="l04038" name="l04038"></a><span class="lineno"> 4038</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiLast = iPhiFirst + verticesPerSector;</div>
<div class="line"><a id="l04039" name="l04039"></a><span class="lineno"> 4039</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l04040" name="l04040"></a><span class="lineno"> 4040</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l04041" name="l04041"></a><span class="lineno"> 4041</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = iPhiFirst; iPhi &lt; iPhiLast; ++iPhi) {</div>
<div class="line"><a id="l04042" name="l04042"></a><span class="lineno"> 4042</span>        mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) *= scalingFactor;</div>
<div class="line"><a id="l04043" name="l04043"></a><span class="lineno"> 4043</span>      }</div>
<div class="line"><a id="l04044" name="l04044"></a><span class="lineno"> 4044</span>    }</div>
<div class="line"><a id="l04045" name="l04045"></a><span class="lineno"> 4045</span>  }</div>
<div class="line"><a id="l04046" name="l04046"></a><span class="lineno"> 4046</span>}</div>
</div>
<div class="line"><a id="l04047" name="l04047"></a><span class="lineno"> 4047</span> </div>
<div class="line"><a id="l04048" name="l04048"></a><span class="lineno"> 4048</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04049" data-start="{" data-end="}">
<div class="line"><a id="l04049" name="l04049"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82916266360bee79127c2ca19ad2a330"> 4049</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82916266360bee79127c2ca19ad2a330">SpaceCharge&lt;DataT&gt;::scaleChargeDensityStack</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> scalingFactor, <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">Sector</a> sector, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4ae">GEMstack</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>)</div>
<div class="line"><a id="l04050" name="l04050"></a><span class="lineno"> 4050</span>{</div>
<div class="line"><a id="l04051" name="l04051"></a><span class="lineno"> 4051</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = sector.<a class="code hl_function" href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#a0cbc050672c8d917aeca484baf230125">side</a>();</div>
<div class="line"><a id="l04052" name="l04052"></a><span class="lineno"> 4052</span>  initContainer(mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l04053" name="l04053"></a><span class="lineno"> 4053</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verticesPerSector = mParamGrid.NPhiVertices / <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l04054" name="l04054"></a><span class="lineno"> 4054</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> sectorInSide = sector % <a class="code hl_variable" href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">SECTORSPERSIDE</a>;</div>
<div class="line"><a id="l04055" name="l04055"></a><span class="lineno"> 4055</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiFirst = sectorInSide * verticesPerSector;</div>
<div class="line"><a id="l04056" name="l04056"></a><span class="lineno"> 4056</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> iPhiLast = iPhiFirst + verticesPerSector;</div>
<div class="line"><a id="l04057" name="l04057"></a><span class="lineno"> 4057</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iR = 0; iR &lt; mParamGrid.NRVertices; ++iR) {</div>
<div class="line"><a id="l04058" name="l04058"></a><span class="lineno"> 4058</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> radius = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">getRVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l04059" name="l04059"></a><span class="lineno"> 4059</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iPhi = iPhiFirst; iPhi &lt; iPhiLast; ++iPhi) {</div>
<div class="line"><a id="l04060" name="l04060"></a><span class="lineno"> 4060</span>      <span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> phi = <a class="code hl_function" href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">getPhiVertex</a>(iR, <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>);</div>
<div class="line"><a id="l04061" name="l04061"></a><span class="lineno"> 4061</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">GlobalPosition3D</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>(getXFromPolar(radius, phi), getYFromPolar(radius, phi), ((<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> == <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>) ? 10 : -10));</div>
<div class="line"><a id="l04062" name="l04062"></a><span class="lineno"> 4062</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mapper = <a class="code hl_function" href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">o2::tpc::Mapper::instance</a>();</div>
<div class="line"><a id="l04063" name="l04063"></a><span class="lineno"> 4063</span>      <span class="keyword">const</span> <a class="code hl_class" href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html">o2::tpc::DigitPos</a> digiPadPos = mapper.findDigitPosFromGlobalPosition(<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a>);</div>
<div class="line"><a id="l04064" name="l04064"></a><span class="lineno"> 4064</span>      <span class="keywordflow">if</span> (digiPadPos.<a class="code hl_function" href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html#a7eabbba4318a10e7c85e661a9aeb42d6">isValid</a>() &amp;&amp; digiPadPos.<a class="code hl_function" href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html#a06950864a2d265ac94e158d5588650b0">getCRU</a>().<a class="code hl_function" href="../../d3/d7d/classo2_1_1tpc_1_1CRU.html#a19bab22967ff05f6af451f9d209dcf9d">gemStack</a>() == <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a>) {</div>
<div class="line"><a id="l04065" name="l04065"></a><span class="lineno"> 4065</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iZ = 0; iZ &lt; mParamGrid.NZVertices; ++iZ) {</div>
<div class="line"><a id="l04066" name="l04066"></a><span class="lineno"> 4066</span>          mDensity[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iZ, iR, iPhi) *= scalingFactor;</div>
<div class="line"><a id="l04067" name="l04067"></a><span class="lineno"> 4067</span>        }</div>
<div class="line"><a id="l04068" name="l04068"></a><span class="lineno"> 4068</span>      }</div>
<div class="line"><a id="l04069" name="l04069"></a><span class="lineno"> 4069</span>    }</div>
<div class="line"><a id="l04070" name="l04070"></a><span class="lineno"> 4070</span>  }</div>
<div class="line"><a id="l04071" name="l04071"></a><span class="lineno"> 4071</span>}</div>
</div>
<div class="line"><a id="l04072" name="l04072"></a><span class="lineno"> 4072</span> </div>
<div class="line"><a id="l04073" name="l04073"></a><span class="lineno"> 4073</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04074" data-start="{" data-end="}">
<div class="line"><a id="l04074" name="l04074"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6e77426db84413f7e5e1a698f493a036"> 4074</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6e77426db84413f7e5e1a698f493a036">SpaceCharge&lt;DataT&gt;::initAfterReadingFromFile</a>()</div>
<div class="line"><a id="l04075" name="l04075"></a><span class="lineno"> 4075</span>{</div>
<div class="line"><a id="l04076" name="l04076"></a><span class="lineno"> 4076</span>  mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>] = <a class="code hl_class" href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">RegularGrid</a>(GridProp::ZMIN, GridProp::RMIN, GridProp::PHIMIN, getSign(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">Side::A</a>) * GridProp::getGridSpacingZ(mParamGrid.NZVertices), GridProp::getGridSpacingR(mParamGrid.NRVertices), GridProp::getGridSpacingPhi(mParamGrid.NPhiVertices), mParamGrid);</div>
<div class="line"><a id="l04077" name="l04077"></a><span class="lineno"> 4077</span>  mGrid3D[<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>] = <a class="code hl_class" href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">RegularGrid</a>(GridProp::ZMIN, GridProp::RMIN, GridProp::PHIMIN, getSign(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">Side::C</a>) * GridProp::getGridSpacingZ(mParamGrid.NZVertices), GridProp::getGridSpacingR(mParamGrid.NRVertices), GridProp::getGridSpacingPhi(mParamGrid.NPhiVertices), mParamGrid);</div>
<div class="line"><a id="l04078" name="l04078"></a><span class="lineno"> 4078</span>}</div>
</div>
<div class="line"><a id="l04079" name="l04079"></a><span class="lineno"> 4079</span> </div>
<div class="line"><a id="l04080" name="l04080"></a><span class="lineno"> 4080</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04081" data-start="{" data-end="}">
<div class="line"><a id="l04081" name="l04081"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad10b30bfbc4b208375b11ec43415ddb4"> 4081</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad10b30bfbc4b208375b11ec43415ddb4">SpaceCharge&lt;DataT&gt;::getDCAr</a>(<span class="keywordtype">float</span> tgl, <span class="keyword">const</span> <span class="keywordtype">int</span> nPoints, <span class="keyword">const</span> <span class="keywordtype">float</span> phi, <span class="keywordtype">float</span> rStart, <a class="code hl_class" href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a>* pcstream)<span class="keyword"> const</span></div>
<div class="line"><a id="l04082" name="l04082"></a><span class="lineno"> 4082</span><span class="keyword"></span>{</div>
<div class="line"><a id="l04083" name="l04083"></a><span class="lineno"> 4083</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> rmin = getRMin(<a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">o2::tpc::Side::A</a>);</div>
<div class="line"><a id="l04084" name="l04084"></a><span class="lineno"> 4084</span>  std::vector&lt;float&gt; dRphi;</div>
<div class="line"><a id="l04085" name="l04085"></a><span class="lineno"> 4085</span>  std::vector&lt;float&gt; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>;</div>
<div class="line"><a id="l04086" name="l04086"></a><span class="lineno"> 4086</span>  dRphi.reserve(nPoints);</div>
<div class="line"><a id="l04087" name="l04087"></a><span class="lineno"> 4087</span>  <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>.reserve(nPoints);</div>
<div class="line"><a id="l04088" name="l04088"></a><span class="lineno"> 4088</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; nPoints; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l04089" name="l04089"></a><span class="lineno"> 4089</span>    <span class="keywordtype">float</span> radius = (rStart &gt; 0) ? (rStart + <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) : (rmin + <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>);</div>
<div class="line"><a id="l04090" name="l04090"></a><span class="lineno"> 4090</span>    <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a> = tgl * radius;</div>
<div class="line"><a id="l04091" name="l04091"></a><span class="lineno"> 4091</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distZ = 0;</div>
<div class="line"><a id="l04092" name="l04092"></a><span class="lineno"> 4092</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distR = 0;</div>
<div class="line"><a id="l04093" name="l04093"></a><span class="lineno"> 4093</span>    <a class="code hl_typedef" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">DataT</a> distRPhi = 0;</div>
<div class="line"><a id="l04094" name="l04094"></a><span class="lineno"> 4094</span>    getDistortionsCyl(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a>, radius, phi, <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">o2::tpc::Side::A</a>, distZ, distR, distRPhi);</div>
<div class="line"><a id="l04095" name="l04095"></a><span class="lineno"> 4095</span>    dRphi.emplace_back(distRPhi);</div>
<div class="line"><a id="l04096" name="l04096"></a><span class="lineno"> 4096</span>    <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>.emplace_back(radius);</div>
<div class="line"><a id="l04097" name="l04097"></a><span class="lineno"> 4097</span>  }</div>
<div class="line"><a id="l04098" name="l04098"></a><span class="lineno"> 4098</span> </div>
<div class="line"><a id="l04099" name="l04099"></a><span class="lineno"> 4099</span>  <a class="code hl_class" href="../../d5/d1a/classTF1.html">TF1</a> fPol(<span class="stringliteral">&quot;pol2&quot;</span>, <span class="stringliteral">&quot;pol2&quot;</span>, rmin, <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>.back());</div>
<div class="line"><a id="l04100" name="l04100"></a><span class="lineno"> 4100</span>  fPol.SetParameter(0, 0);</div>
<div class="line"><a id="l04101" name="l04101"></a><span class="lineno"> 4101</span>  fPol.SetParameter(1, 0);</div>
<div class="line"><a id="l04102" name="l04102"></a><span class="lineno"> 4102</span>  fPol.SetParameter(2, 0);</div>
<div class="line"><a id="l04103" name="l04103"></a><span class="lineno"> 4103</span>  TGraph gr(<a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>.size(), <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>.data(), dRphi.data());</div>
<div class="line"><a id="l04104" name="l04104"></a><span class="lineno"> 4104</span>  gr.Fit(&amp;fPol, <span class="stringliteral">&quot;QNRC&quot;</span>);</div>
<div class="line"><a id="l04105" name="l04105"></a><span class="lineno"> 4105</span>  <span class="keywordtype">float</span> dca = fPol.Eval(0);</div>
<div class="line"><a id="l04106" name="l04106"></a><span class="lineno"> 4106</span>  <span class="keywordflow">if</span> (pcstream) {</div>
<div class="line"><a id="l04107" name="l04107"></a><span class="lineno"> 4107</span>    std::vector&lt;double&gt; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a>{fPol.GetParameter(0), fPol.GetParameter(1), fPol.GetParameter(2)};</div>
<div class="line"><a id="l04108" name="l04108"></a><span class="lineno"> 4108</span>    std::vector&lt;float&gt; rInterpol;</div>
<div class="line"><a id="l04109" name="l04109"></a><span class="lineno"> 4109</span>    std::vector&lt;float&gt; dRPhiInterpol;</div>
<div class="line"><a id="l04110" name="l04110"></a><span class="lineno"> 4110</span>    std::vector&lt;float&gt; distanceInterpol;</div>
<div class="line"><a id="l04111" name="l04111"></a><span class="lineno"> 4111</span> </div>
<div class="line"><a id="l04112" name="l04112"></a><span class="lineno"> 4112</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 500; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l04113" name="l04113"></a><span class="lineno"> 4113</span>      <span class="keywordtype">float</span> radius = rmin + float(<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) / 10;</div>
<div class="line"><a id="l04114" name="l04114"></a><span class="lineno"> 4114</span>      rInterpol.emplace_back(radius);</div>
<div class="line"><a id="l04115" name="l04115"></a><span class="lineno"> 4115</span>      dRPhiInterpol.emplace_back(fPol.Eval(radius));</div>
<div class="line"><a id="l04116" name="l04116"></a><span class="lineno"> 4116</span>      distanceInterpol.emplace_back(std::sqrt(rInterpol.back() * rInterpol.back() + dRPhiInterpol.back() * dRPhiInterpol.back()));</div>
<div class="line"><a id="l04117" name="l04117"></a><span class="lineno"> 4117</span>    }</div>
<div class="line"><a id="l04118" name="l04118"></a><span class="lineno"> 4118</span> </div>
<div class="line"><a id="l04119" name="l04119"></a><span class="lineno"> 4119</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = -200; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 200; ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l04120" name="l04120"></a><span class="lineno"> 4120</span>      <span class="keywordtype">float</span> radius = float(<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) / 10;</div>
<div class="line"><a id="l04121" name="l04121"></a><span class="lineno"> 4121</span>      rInterpol.emplace_back(radius);</div>
<div class="line"><a id="l04122" name="l04122"></a><span class="lineno"> 4122</span>      dRPhiInterpol.emplace_back(fPol.Eval(radius));</div>
<div class="line"><a id="l04123" name="l04123"></a><span class="lineno"> 4123</span>      distanceInterpol.emplace_back(std::sqrt(rInterpol.back() * rInterpol.back() + dRPhiInterpol.back() * dRPhiInterpol.back()));</div>
<div class="line"><a id="l04124" name="l04124"></a><span class="lineno"> 4124</span>    }</div>
<div class="line"><a id="l04125" name="l04125"></a><span class="lineno"> 4125</span>    (*pcstream) &lt;&lt; <span class="stringliteral">&quot;tree&quot;</span></div>
<div class="line"><a id="l04126" name="l04126"></a><span class="lineno"> 4126</span>                &lt;&lt; <span class="stringliteral">&quot;r=&quot;</span> &lt;&lt; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a></div>
<div class="line"><a id="l04127" name="l04127"></a><span class="lineno"> 4127</span>                &lt;&lt; <span class="stringliteral">&quot;dRphi=&quot;</span> &lt;&lt; dRphi</div>
<div class="line"><a id="l04128" name="l04128"></a><span class="lineno"> 4128</span>                &lt;&lt; <span class="stringliteral">&quot;tgl=&quot;</span> &lt;&lt; tgl</div>
<div class="line"><a id="l04129" name="l04129"></a><span class="lineno"> 4129</span>                &lt;&lt; <span class="stringliteral">&quot;phi=&quot;</span> &lt;&lt; phi</div>
<div class="line"><a id="l04130" name="l04130"></a><span class="lineno"> 4130</span>                &lt;&lt; <span class="stringliteral">&quot;dca=&quot;</span> &lt;&lt; dca</div>
<div class="line"><a id="l04131" name="l04131"></a><span class="lineno"> 4131</span>                &lt;&lt; <span class="stringliteral">&quot;rInterpol=&quot;</span> &lt;&lt; rInterpol</div>
<div class="line"><a id="l04132" name="l04132"></a><span class="lineno"> 4132</span>                &lt;&lt; <span class="stringliteral">&quot;dRPhiInterpol=&quot;</span> &lt;&lt; dRPhiInterpol</div>
<div class="line"><a id="l04133" name="l04133"></a><span class="lineno"> 4133</span>                &lt;&lt; <span class="stringliteral">&quot;distanceInterpol=&quot;</span> &lt;&lt; distanceInterpol</div>
<div class="line"><a id="l04134" name="l04134"></a><span class="lineno"> 4134</span>                &lt;&lt; <span class="stringliteral">&quot;param=&quot;</span> &lt;&lt; <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a></div>
<div class="line"><a id="l04135" name="l04135"></a><span class="lineno"> 4135</span>                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l04136" name="l04136"></a><span class="lineno"> 4136</span>  }</div>
<div class="line"><a id="l04137" name="l04137"></a><span class="lineno"> 4137</span>  <span class="keywordflow">return</span> dca;</div>
<div class="line"><a id="l04138" name="l04138"></a><span class="lineno"> 4138</span>}</div>
</div>
<div class="line"><a id="l04139" name="l04139"></a><span class="lineno"> 4139</span> </div>
<div class="line"><a id="l04140" name="l04140"></a><span class="lineno"> 4140</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04141" data-start="{" data-end="}">
<div class="line"><a id="l04141" name="l04141"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abe1f7bf99cbb36ad75208f91e190f2ba"> 4141</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abe1f7bf99cbb36ad75208f91e190f2ba">SpaceCharge&lt;DataT&gt;::setPotential</a>(<span class="keywordtype">int</span> iz, <span class="keywordtype">int</span> <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, <span class="keywordtype">int</span> iphi, <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>, <span class="keywordtype">float</span> <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>)</div>
<div class="line"><a id="l04142" name="l04142"></a><span class="lineno"> 4142</span>{</div>
<div class="line"><a id="l04143" name="l04143"></a><span class="lineno"> 4143</span>  initContainer(mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>], <span class="keyword">true</span>);</div>
<div class="line"><a id="l04144" name="l04144"></a><span class="lineno"> 4144</span>  mPotential[<a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a>](iz, <a class="code hl_variable" href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a>, iphi) = <a class="code hl_typedef" href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a>;</div>
<div class="line"><a id="l04145" name="l04145"></a><span class="lineno"> 4145</span>}</div>
</div>
<div class="line"><a id="l04146" name="l04146"></a><span class="lineno"> 4146</span> </div>
<div class="line"><a id="l04147" name="l04147"></a><span class="lineno"> 4147</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> DataT&gt;</div>
<div class="foldopen" id="foldopen04148" data-start="{" data-end="}">
<div class="line"><a id="l04148" name="l04148"></a><span class="lineno"><a class="line" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af65e22a052d4188c6983457c76efffcc"> 4148</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af65e22a052d4188c6983457c76efffcc">SpaceCharge&lt;DataT&gt;::downSampleObject</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nZNew, <span class="keyword">const</span> <span class="keywordtype">int</span> nRNew, <span class="keyword">const</span> <span class="keywordtype">int</span> nPhiNew)</div>
<div class="line"><a id="l04149" name="l04149"></a><span class="lineno"> 4149</span>{</div>
<div class="line"><a id="l04150" name="l04150"></a><span class="lineno"> 4150</span>  <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataT&gt;</a> scNew(getBField(), nZNew, nRNew, nPhiNew);</div>
<div class="line"><a id="l04151" name="l04151"></a><span class="lineno"> 4151</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iside = 0; iside &lt; 2; ++iside) {</div>
<div class="line"><a id="l04152" name="l04152"></a><span class="lineno"> 4152</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a> <a class="code hl_variable" href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a> = (iside == 0) ? <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">o2::tpc::Side::A</a> : <a class="code hl_enumvalue" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">o2::tpc::Side::C</a>;</div>
<div class="line"><a id="l04153" name="l04153"></a><span class="lineno"> 4153</span>    <span class="keyword">const</span> std::vector&lt;std::reference_wrapper&lt;const DataContainer&gt;&gt; dataRef{mLocalDistdR[iside], mLocalDistdZ[iside], mLocalDistdRPhi[iside], mLocalVecDistdR[iside], mLocalVecDistdZ[iside], mLocalVecDistdRPhi[iside], mLocalCorrdR[iside], mLocalCorrdZ[iside], mLocalCorrdRPhi[iside], mGlobalDistdR[iside], mGlobalDistdZ[iside], mGlobalDistdRPhi[iside], mGlobalCorrdR[iside], mGlobalCorrdZ[iside], mGlobalCorrdRPhi[iside], mDensity[iside], mPotential[iside], mElectricFieldEr[iside], mElectricFieldEz[iside], mElectricFieldEphi[iside]};</div>
<div class="line"><a id="l04154" name="l04154"></a><span class="lineno"> 4154</span>    <span class="keyword">const</span> std::vector&lt;std::reference_wrapper&lt;DataContainer&gt;&gt; dataNew{scNew.mLocalDistdR[iside], scNew.mLocalDistdZ[iside], scNew.mLocalDistdRPhi[iside], scNew.mLocalVecDistdR[iside], scNew.mLocalVecDistdZ[iside], scNew.mLocalVecDistdRPhi[iside], scNew.mLocalCorrdR[iside], scNew.mLocalCorrdZ[iside], scNew.mLocalCorrdRPhi[iside], scNew.mGlobalDistdR[iside], scNew.mGlobalDistdZ[iside], scNew.mGlobalDistdRPhi[iside], scNew.mGlobalCorrdR[iside], scNew.mGlobalCorrdZ[iside], scNew.mGlobalCorrdRPhi[iside], scNew.mDensity[iside], scNew.mPotential[iside], scNew.mElectricFieldEr[iside], scNew.mElectricFieldEz[iside], scNew.mElectricFieldEphi[iside]};</div>
<div class="line"><a id="l04155" name="l04155"></a><span class="lineno"> 4155</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; dataRef.size(); ++<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div>
<div class="line"><a id="l04156" name="l04156"></a><span class="lineno"> 4156</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; objRef = dataRef[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].get();</div>
<div class="line"><a id="l04157" name="l04157"></a><span class="lineno"> 4157</span>      <span class="keywordflow">if</span> (objRef.getNDataPoints()) {</div>
<div class="line"><a id="l04158" name="l04158"></a><span class="lineno"> 4158</span>        <span class="keyword">auto</span>&amp; objNew = dataNew[<a class="code hl_variable" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a>].get();</div>
<div class="line"><a id="l04159" name="l04159"></a><span class="lineno"> 4159</span>        scNew.initContainer(objNew, <span class="keyword">true</span>);</div>
<div class="line"><a id="l04160" name="l04160"></a><span class="lineno"> 4160</span>        objNew = objRef.convert(scNew.mGrid3D[iside], mGrid3D[iside], sNThreads);</div>
<div class="line"><a id="l04161" name="l04161"></a><span class="lineno"> 4161</span>      }</div>
<div class="line"><a id="l04162" name="l04162"></a><span class="lineno"> 4162</span>    }</div>
<div class="line"><a id="l04163" name="l04163"></a><span class="lineno"> 4163</span>  }</div>
<div class="line"><a id="l04164" name="l04164"></a><span class="lineno"> 4164</span>  *<span class="keyword">this</span> = std::move(scNew);</div>
<div class="line"><a id="l04165" name="l04165"></a><span class="lineno"> 4165</span>}</div>
</div>
<div class="line"><a id="l04166" name="l04166"></a><span class="lineno"> 4166</span> </div>
<div class="line"><a id="l04167" name="l04167"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d"> 4167</a></span><span class="keyword">using </span><a class="code hl_typedef" href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a> = double;</div>
<div class="line"><a id="l04168" name="l04168"></a><span class="lineno"> 4168</span><span class="keyword">template</span> <span class="keyword">class </span><a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataTD&gt;</a>;</div>
<div class="line"><a id="l04169" name="l04169"></a><span class="lineno"> 4169</span> </div>
<div class="line"><a id="l04170" name="l04170"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#adecbfe0a9b630d5f59491ce8258541b2"> 4170</a></span><span class="keyword">using </span><a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a> = <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataTD&gt;</a>;</div>
<div class="line"><a id="l04171" name="l04171"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#adf7cbd7fe4d86c753f6d1b530cdf91cb"> 4171</a></span><span class="keyword">using </span><a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a> = <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataTD&gt;</a>;</div>
<div class="line"><a id="l04172" name="l04172"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a43d42999b18ff5a96d2f5400c5d51154"> 4172</a></span><span class="keyword">using </span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a> = <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataTD&gt;</a>;</div>
<div class="line"><a id="l04173" name="l04173"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#ad1219660c145fabf4a130cf2796f5e43"> 4173</a></span><span class="keyword">using </span><a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">O2TPCSpaceCharge3DCalcD</a> = <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataTD&gt;</a>;</div>
<div class="line"><a id="l04174" name="l04174"></a><span class="lineno"> 4174</span> </div>
<div class="line"><a id="l04175" name="l04175"></a><span class="lineno"> 4175</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcD::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcD::Type</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;);</div>
<div class="line"><a id="l04176" name="l04176"></a><span class="lineno"> 4176</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcD::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcD::Type</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;);</div>
<div class="line"><a id="l04177" name="l04177"></a><span class="lineno"> 4177</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcD::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;);</div>
<div class="line"><a id="l04178" name="l04178"></a><span class="lineno"> 4178</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcD::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;);</div>
<div class="line"><a id="l04179" name="l04179"></a><span class="lineno"> 4179</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04180" name="l04180"></a><span class="lineno"> 4180</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04181" name="l04181"></a><span class="lineno"> 4181</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcD::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04182" name="l04182"></a><span class="lineno"> 4182</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04183" name="l04183"></a><span class="lineno"> 4183</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04184" name="l04184"></a><span class="lineno"> 4184</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcD::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpD</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04185" name="l04185"></a><span class="lineno"> 4185</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::setGlobalCorrectionsFromFile&lt;double&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04186" name="l04186"></a><span class="lineno"> 4186</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::setGlobalCorrectionsFromFile&lt;float&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04187" name="l04187"></a><span class="lineno"> 4187</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::setGlobalDistortionsFromFile&lt;double&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04188" name="l04188"></a><span class="lineno"> 4188</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcD::setGlobalDistortionsFromFile&lt;float&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04189" name="l04189"></a><span class="lineno"> 4189</span> </div>
<div class="line"><a id="l04190" name="l04190"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a"> 4190</a></span><span class="keyword">using </span><a class="code hl_typedef" href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a> = float;</div>
<div class="line"><a id="l04191" name="l04191"></a><span class="lineno"> 4191</span><span class="keyword">template</span> <span class="keyword">class </span><a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge&lt;DataTF&gt;</a>;</div>
<div class="line"><a id="l04192" name="l04192"></a><span class="lineno"> 4192</span> </div>
<div class="line"><a id="l04193" name="l04193"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a4a9a9ce647fc38420dd8733afb52bc27"> 4193</a></span><span class="keyword">using </span><a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a> = <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumericalFields&lt;DataTF&gt;</a>;</div>
<div class="line"><a id="l04194" name="l04194"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a78bb0a43dd2d99d4c2711a20b52b83cb"> 4194</a></span><span class="keyword">using </span><a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a> = <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnalyticalFields&lt;DataTF&gt;</a>;</div>
<div class="line"><a id="l04195" name="l04195"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a195b56d4c3729f76f479c3a78bdf5efa"> 4195</a></span><span class="keyword">using </span><a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a> = <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpolator&lt;DataTF&gt;</a>;</div>
<div class="line"><a id="l04196" name="l04196"></a><span class="lineno"><a class="line" href="../../da/d8e/SpaceCharge_8cxx.html#a4e23d6527d8451c9c961dbbed5e50b12"> 4196</a></span><span class="keyword">using </span><a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">O2TPCSpaceCharge3DCalcF</a> = <a class="code hl_class" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">SpaceCharge&lt;DataTF&gt;</a>;</div>
<div class="line"><a id="l04197" name="l04197"></a><span class="lineno"> 4197</span> </div>
<div class="line"><a id="l04198" name="l04198"></a><span class="lineno"> 4198</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcF::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcF::Type</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;);</div>
<div class="line"><a id="l04199" name="l04199"></a><span class="lineno"> 4199</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">O2TPCSpaceCharge3DCalcF::calcLocalDistortionsCorrections</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">O2TPCSpaceCharge3DCalcF::Type</a>, <span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;);</div>
<div class="line"><a id="l04200" name="l04200"></a><span class="lineno"> 4200</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcF::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;);</div>
<div class="line"><a id="l04201" name="l04201"></a><span class="lineno"> 4201</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">O2TPCSpaceCharge3DCalcF::calcLocalDistortionCorrectionVector</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;);</div>
<div class="line"><a id="l04202" name="l04202"></a><span class="lineno"> 4202</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04203" name="l04203"></a><span class="lineno"> 4203</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04204" name="l04204"></a><span class="lineno"> 4204</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">O2TPCSpaceCharge3DCalcF::calcGlobalCorrections</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span>);</div>
<div class="line"><a id="l04205" name="l04205"></a><span class="lineno"> 4205</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">NumFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04206" name="l04206"></a><span class="lineno"> 4206</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">AnaFieldsF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04207" name="l04207"></a><span class="lineno"> 4207</span><span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">O2TPCSpaceCharge3DCalcF::calcGlobalDistortions</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">DistCorrInterpF</a>&amp;, <span class="keyword">const</span> <span class="keywordtype">int</span> maxIterations);</div>
<div class="line"><a id="l04208" name="l04208"></a><span class="lineno"> 4208</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::setGlobalCorrectionsFromFile&lt;double&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04209" name="l04209"></a><span class="lineno"> 4209</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::setGlobalCorrectionsFromFile&lt;float&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04210" name="l04210"></a><span class="lineno"> 4210</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::setGlobalDistortionsFromFile&lt;double&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
<div class="line"><a id="l04211" name="l04211"></a><span class="lineno"> 4211</span><span class="keyword">template</span> <span class="keywordtype">void</span> O2TPCSpaceCharge3DCalcF::setGlobalDistortionsFromFile&lt;float&gt;(TFile&amp;, <span class="keyword">const</span> <a class="code hl_enumeration" href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">Side</a>);</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="ttc" id="aCalDet_8h_html"><div class="ttname"><a href="../../d8/d81/CalDet_8h.html">CalDet.h</a></div></div>
<div class="ttc" id="aCathodeSegmentationLong_8cxx_html_a21eb5ade2031321b2b8a98fd3749ed43"><div class="ttname"><a href="../../d2/dba/CathodeSegmentationLong_8cxx.html#a21eb5ade2031321b2b8a98fd3749ed43">dumpToFile</a></div><div class="ttdeci">void dumpToFile(std::string fileName, const CathodeSegmentation &amp;seg, const std::vector&lt; Point &gt; &amp;points)</div><div class="ttdef"><b>Definition</b> <a href="../../d2/dba/CathodeSegmentationLong_8cxx_source.html#l00040">CathodeSegmentationLong.cxx:40</a></div></div>
<div class="ttc" id="aCommon_2MathUtils_2include_2MathUtils_2Utils_8h_html"><div class="ttname"><a href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h.html">Utils.h</a></div><div class="ttdoc">General auxilliary methods.</div></div>
<div class="ttc" id="aDetectors_2TPC_2qc_2src_2PID_8cxx_html_a86c73ab6f37eae94aef9f27a7e9e2fc0"><div class="ttname"><a href="../../d2/d14/Detectors_2TPC_2qc_2src_2PID_8cxx.html#a86c73ab6f37eae94aef9f27a7e9e2fc0">bins</a></div><div class="ttdeci">const auto bins</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d14/Detectors_2TPC_2qc_2src_2PID_8cxx_source.html#l00049">PID.cxx:49</a></div></div>
<div class="ttc" id="aFIT_2common_2include_2DataFormatsFIT_2RawEventData_8h_html_a3a5a5583cf997a469e4210b22aee42de"><div class="ttname"><a href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#a3a5a5583cf997a469e4210b22aee42de">charge</a></div><div class="ttdeci">int16_t charge</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h_source.html#l00005">RawEventData.h:5</a></div></div>
<div class="ttc" id="aFIT_2common_2include_2DataFormatsFIT_2RawEventData_8h_html_ada647bc214b6ea2c35e94324a030afea"><div class="ttname"><a href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h.html#ada647bc214b6ea2c35e94324a030afea">time</a></div><div class="ttdeci">int16_t time</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d77/FIT_2common_2include_2DataFormatsFIT_2RawEventData_8h_source.html#l00004">RawEventData.h:4</a></div></div>
<div class="ttc" id="aGPUCommonAlgorithm_8h_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#ad9484f5522d0e5f033037c369365ec61">i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00435">GPUCommonAlgorithm.h:436</a></div></div>
<div class="ttc" id="aGPUCommonDef_8h_html_a0117e1486062f932ded994de0d587344"><div class="ttname"><a href="../../df/d21/GPUCommonDef_8h.html#a0117e1486062f932ded994de0d587344">GPUCA_DEBUG_STREAMER_CHECK</a></div><div class="ttdeci">#define GPUCA_DEBUG_STREAMER_CHECK(...)</div><div class="ttdef"><b>Definition</b> <a href="../../df/d21/GPUCommonDef_8h_source.html#l00068">GPUCommonDef.h:68</a></div></div>
<div class="ttc" id="aGPUDebugStreamer_8h_html"><div class="ttname"><a href="../../d9/d53/GPUDebugStreamer_8h.html">GPUDebugStreamer.h</a></div></div>
<div class="ttc" id="aGPUTPCTrackingData_8cxx_html_a30f18d18adf7b4869abe5f41bd87f8f3"><div class="ttname"><a href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a30f18d18adf7b4869abe5f41bd87f8f3">zMax</a></div><div class="ttdeci">float float float &amp; zMax</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d9e/GPUTPCTrackingData_8cxx_source.html#l00130">GPUTPCTrackingData.cxx:130</a></div></div>
<div class="ttc" id="aGPUTPCTrackingData_8cxx_html_a6114fa7e064b858b899953d905390bb1"><div class="ttname"><a href="../../d8/d9e/GPUTPCTrackingData_8cxx.html#a6114fa7e064b858b899953d905390bb1">zMin</a></div><div class="ttdeci">float float &amp; zMin</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d9e/GPUTPCTrackingData_8cxx_source.html#l00130">GPUTPCTrackingData.cxx:130</a></div></div>
<div class="ttc" id="aGRPMagField_8h_html"><div class="ttname"><a href="../../de/dd2/GRPMagField_8h.html">GRPMagField.h</a></div><div class="ttdoc">Header of the General Run Parameters object for B field values.</div></div>
<div class="ttc" id="aHmpidCoder2_8cxx_html_a3b8db936726e102a877a4c2375c580a3"><div class="ttname"><a href="../../db/d78/HmpidCoder2_8cxx.html#a3b8db936726e102a877a4c2375c580a3">p2</a></div><div class="ttdeci">constexpr int p2()</div><div class="ttdef"><b>Definition</b> <a href="../../db/d78/HmpidCoder2_8cxx_source.html#l00090">HmpidCoder2.cxx:90</a></div></div>
<div class="ttc" id="aHmpidCoder2_8cxx_html_a6dba92e7a849aade284aac0c39b6e4b4"><div class="ttname"><a href="../../db/d78/HmpidCoder2_8cxx.html#a6dba92e7a849aade284aac0c39b6e4b4">p1</a></div><div class="ttdeci">constexpr int p1()</div><div class="ttdoc">constexpr to accelerate the coordinates changing</div><div class="ttdef"><b>Definition</b> <a href="../../db/d78/HmpidCoder2_8cxx_source.html#l00089">HmpidCoder2.cxx:89</a></div></div>
<div class="ttc" id="aLHCConstants_8h_html"><div class="ttname"><a href="../../d4/dc6/LHCConstants_8h.html">LHCConstants.h</a></div><div class="ttdoc">Header to collect LHC related constants.</div></div>
<div class="ttc" id="aLogger_8h_html"><div class="ttname"><a href="../../dd/da4/Logger_8h.html">Logger.h</a></div></div>
<div class="ttc" id="aMagneticField_8h_html"><div class="ttname"><a href="../../db/d4b/MagneticField_8h.html">MagneticField.h</a></div><div class="ttdoc">Definition of the MagF class.</div></div>
<div class="ttc" id="aPainter_8h_html"><div class="ttname"><a href="../../d8/db6/Painter_8h.html">Painter.h</a></div></div>
<div class="ttc" id="aParameterElectronics_8h_html"><div class="ttname"><a href="../../d3/d47/ParameterElectronics_8h.html">ParameterElectronics.h</a></div><div class="ttdoc">Definition of the parameter class for the detector electronics.</div></div>
<div class="ttc" id="aParameterGas_8h_html"><div class="ttname"><a href="../../db/d5b/ParameterGas_8h.html">ParameterGas.h</a></div><div class="ttdoc">Definition of the parameter class for the detector gas.</div></div>
<div class="ttc" id="aPoissonSolver_8h_html"><div class="ttname"><a href="../../dc/d2a/PoissonSolver_8h.html">PoissonSolver.h</a></div><div class="ttdoc">This class provides implementation of Poisson equation solver by MultiGrid Method Original version of...</div></div>
<div class="ttc" id="aRawData_8h_html_a0e0dffc35aa86c3f381de2b41070f9ea"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#a0e0dffc35aa86c3f381de2b41070f9ea">pos</a></div><div class="ttdeci">uint16_t pos</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d62/RawData_8h_source.html#l00003">RawData.h:3</a></div></div>
<div class="ttc" id="aRawData_8h_html_a7a83cc244d83d7cdff1229328d79a45e"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#a7a83cc244d83d7cdff1229328d79a45e">side</a></div><div class="ttdeci">uint32_t side</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d62/RawData_8h_source.html#l00000">RawData.h:0</a></div></div>
<div class="ttc" id="aRawData_8h_html_a8b02c1a703555609b690ce7e9a414e9c"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#a8b02c1a703555609b690ce7e9a414e9c">slope</a></div><div class="ttdeci">uint16_t slope</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d62/RawData_8h_source.html#l00001">RawData.h:1</a></div></div>
<div class="ttc" id="aRawData_8h_html_ab5eb7a5f806ca442b197ae56b071471a"><div class="ttname"><a href="../../dc/d62/RawData_8h.html#ab5eb7a5f806ca442b197ae56b071471a">stack</a></div><div class="ttdeci">uint32_t stack</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d62/RawData_8h_source.html#l00001">RawData.h:1</a></div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_a021e6e023b83ccdc5f7ff44ec3f61d41"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#a021e6e023b83ccdc5f7ff44ec3f61d41">templateClassImp</a></div><div class="ttdeci">templateClassImp(o2::tpc::SpaceCharge)</div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_a6cad7be1fe9e41f12c1d66fba3648d6a"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#a6cad7be1fe9e41f12c1d66fba3648d6a">DataTF</a></div><div class="ttdeci">float DataTF</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04190">SpaceCharge.cxx:4190</a></div></div>
<div class="ttc" id="aSpaceCharge_8cxx_html_aa4f840ce7cb69a862630b67217f4da7d"><div class="ttname"><a href="../../da/d8e/SpaceCharge_8cxx.html#aa4f840ce7cb69a862630b67217f4da7d">DataTD</a></div><div class="ttdeci">double DataTD</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04167">SpaceCharge.cxx:4167</a></div></div>
<div class="ttc" id="aSpaceCharge_8h_html"><div class="ttname"><a href="../../d3/db6/SpaceCharge_8h.html">SpaceCharge.h</a></div><div class="ttdoc">This class contains the algorithms for calculation the distortions and corrections.</div></div>
<div class="ttc" id="aTreeStreamRedirector_8h_html"><div class="ttname"><a href="../../d1/d22/TreeStreamRedirector_8h.html">TreeStreamRedirector.h</a></div></div>
<div class="ttc" id="aVariantJSONHelpers_8cxx_html_a506e5407bcc583441afe6823fe8f0854"><div class="ttname"><a href="../../d4/d67/VariantJSONHelpers_8cxx.html#a506e5407bcc583441afe6823fe8f0854">cols</a></div><div class="ttdeci">uint32_t cols</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d67/VariantJSONHelpers_8cxx_source.html#l00308">VariantJSONHelpers.cxx:308</a></div></div>
<div class="ttc" id="aclassROOT_1_1Math_1_1PositionVector2D_html"><div class="ttname"><a href="../../d2/db4/classROOT_1_1Math_1_1PositionVector2D.html">ROOT::Math::PositionVector2D</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/da8/GPUROOTCartesianFwd_8h_source.html#l00034">GPUROOTCartesianFwd.h:34</a></div></div>
<div class="ttc" id="aclassROOT_1_1Math_1_1PositionVector3D_html"><div class="ttname"><a href="../../d5/daf/classROOT_1_1Math_1_1PositionVector3D.html">ROOT::Math::PositionVector3D</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/da8/GPUROOTCartesianFwd_8h_source.html#l00036">GPUROOTCartesianFwd.h:36</a></div></div>
<div class="ttc" id="aclassTF1_html"><div class="ttname"><a href="../../d5/d1a/classTF1.html">TF1</a></div></div>
<div class="ttc" id="aclassint_html"><div class="ttname"><a href="../../d1/da0/classint.html">int</a></div></div>
<div class="ttc" id="aclasso2_1_1conf_1_1ConfigurableParamHelper_html_a8c7d4cc9dc1f34d578b77cc5d6cf1df0"><div class="ttname"><a href="../../d7/d50/classo2_1_1conf_1_1ConfigurableParamHelper.html#a8c7d4cc9dc1f34d578b77cc5d6cf1df0">o2::conf::ConfigurableParamHelper&lt; ParameterGas &gt;::Instance</a></div><div class="ttdeci">static const ParameterGas &amp; Instance()</div><div class="ttdef"><b>Definition</b> <a href="../../da/d6b/ConfigurableParamHelper_8h_source.html#l00081">ConfigurableParamHelper.h:81</a></div></div>
<div class="ttc" id="aclasso2_1_1field_1_1MagneticField_html"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html">o2::field::MagneticField</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00045">MagneticField.h:46</a></div></div>
<div class="ttc" id="aclasso2_1_1field_1_1MagneticField_html_af81094cbf8b590f954df3ec5f58612f8"><div class="ttname"><a href="../../d2/da0/classo2_1_1field_1_1MagneticField.html#af81094cbf8b590f954df3ec5f58612f8">o2::field::MagneticField::solenoidField</a></div><div class="ttdeci">Double_t solenoidField() const</div><div class="ttdef"><b>Definition</b> <a href="../../db/d4b/MagneticField_8h_source.html#l00215">MagneticField.h:215</a></div></div>
<div class="ttc" id="aclasso2_1_1parameters_1_1GRPMagField_html"><div class="ttname"><a href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html">o2::parameters::GRPMagField</a></div><div class="ttdef"><b>Definition</b> <a href="../../de/dd2/GRPMagField_8h_source.html#l00030">GRPMagField.h:31</a></div></div>
<div class="ttc" id="aclasso2_1_1parameters_1_1GRPMagField_html_a1a2145ff216c627103fce6bab7ae095c"><div class="ttname"><a href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#a1a2145ff216c627103fce6bab7ae095c">o2::parameters::GRPMagField::getNominalL3Field</a></div><div class="ttdeci">int8_t getNominalL3Field()</div><div class="ttdef"><b>Definition</b> <a href="../../de/dd2/GRPMagField_8h_source.html#l00074">GRPMagField.h:74</a></div></div>
<div class="ttc" id="aclasso2_1_1parameters_1_1GRPMagField_html_a7d1fe73476cc732643952bb2072932b3"><div class="ttname"><a href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#a7d1fe73476cc732643952bb2072932b3">o2::parameters::GRPMagField::setDipoleCurrent</a></div><div class="ttdeci">void setDipoleCurrent(o2::units::Current_t v)</div><div class="ttdef"><b>Definition</b> <a href="../../de/dd2/GRPMagField_8h_source.html#l00052">GRPMagField.h:52</a></div></div>
<div class="ttc" id="aclasso2_1_1parameters_1_1GRPMagField_html_af6084138aa46bb722dec64109c0a58d5"><div class="ttname"><a href="../../d7/df9/classo2_1_1parameters_1_1GRPMagField.html#af6084138aa46bb722dec64109c0a58d5">o2::parameters::GRPMagField::setL3Current</a></div><div class="ttdeci">void setL3Current(o2::units::Current_t v)</div><div class="ttdef"><b>Definition</b> <a href="../../de/dd2/GRPMagField_8h_source.html#l00051">GRPMagField.h:51</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalDistCorr_html"><div class="ttname"><a href="../../d7/d95/classo2_1_1tpc_1_1AnalyticalDistCorr.html">o2::tpc::AnalyticalDistCorr</a></div><div class="ttdoc">struct for containing simple analytical distortions (as function of local coordinates) and the result...</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00166">SpaceChargeHelpers.h:167</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html">o2::tpc::AnalyticalFields</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00066">SpaceChargeHelpers.h:67</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a1b2761dc0464d4248bfce8a178d6542d"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a1b2761dc0464d4248bfce8a178d6542d">o2::tpc::AnalyticalFields::evalFieldPhi</a></div><div class="ttdeci">DataT evalFieldPhi(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00108">SpaceChargeHelpers.h:108</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a5a124cae7990696b48d1a5bed028f07f"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a5a124cae7990696b48d1a5bed028f07f">o2::tpc::AnalyticalFields::evalDensity</a></div><div class="ttdeci">DataT evalDensity(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00120">SpaceChargeHelpers.h:120</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_a89af2dd4607f5098178e0fe609703050"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#a89af2dd4607f5098178e0fe609703050">o2::tpc::AnalyticalFields::evalFieldR</a></div><div class="ttdeci">DataT evalFieldR(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00096">SpaceChargeHelpers.h:96</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_ac393c2f9ec370c9bd53f820a02d910af"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac393c2f9ec370c9bd53f820a02d910af">o2::tpc::AnalyticalFields::evalPotential</a></div><div class="ttdeci">DataT evalPotential(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00114">SpaceChargeHelpers.h:114</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_ac5f253a17f2f1c0f5a0b1e3659de4b19"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ac5f253a17f2f1c0f5a0b1e3659de4b19">o2::tpc::AnalyticalFields::getSide</a></div><div class="ttdeci">o2::tpc::Side getSide() const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00071">SpaceChargeHelpers.h:71</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1AnalyticalFields_html_ae0d124f54f2584022f7cf92d855ce83d"><div class="ttname"><a href="../../de/daa/classo2_1_1tpc_1_1AnalyticalFields.html#ae0d124f54f2584022f7cf92d855ce83d">o2::tpc::AnalyticalFields::evalFieldZ</a></div><div class="ttdeci">DataT evalFieldZ(DataT z, DataT r, DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00102">SpaceChargeHelpers.h:102</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1CRU_html_a19bab22967ff05f6af451f9d209dcf9d"><div class="ttname"><a href="../../d3/d7d/classo2_1_1tpc_1_1CRU.html#a19bab22967ff05f6af451f9d209dcf9d">o2::tpc::CRU::gemStack</a></div><div class="ttdeci">GEMstack gemStack() const</div><div class="ttdef"><b>Definition</b> <a href="../../df/d26/CRU_8h_source.html#l00082">CRU.h:82</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1CalDet_html"><div class="ttname"><a href="../../dd/df9/classo2_1_1tpc_1_1CalDet.html">o2::tpc::CalDet</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d81/CalDet_8h_source.html#l00046">CalDet.h:47</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DigitPos_html"><div class="ttname"><a href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html">o2::tpc::DigitPos</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/d54/DigitPos_8h_source.html#l00025">DigitPos.h:26</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DigitPos_html_a06950864a2d265ac94e158d5588650b0"><div class="ttname"><a href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html#a06950864a2d265ac94e158d5588650b0">o2::tpc::DigitPos::getCRU</a></div><div class="ttdeci">const CRU &amp; getCRU() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d54/DigitPos_8h_source.html#l00030">DigitPos.h:30</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DigitPos_html_a7eabbba4318a10e7c85e661a9aeb42d6"><div class="ttname"><a href="../../d4/dff/classo2_1_1tpc_1_1DigitPos.html#a7eabbba4318a10e7c85e661a9aeb42d6">o2::tpc::DigitPos::isValid</a></div><div class="ttdeci">bool isValid() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d54/DigitPos_8h_source.html#l00038">DigitPos.h:38</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html">o2::tpc::DistCorrInterpolator</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00377">SpaceChargeHelpers.h:378</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a2c695f47938da98e89d832edb1d881f1"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a2c695f47938da98e89d832edb1d881f1">o2::tpc::DistCorrInterpolator::getSide</a></div><div class="ttdeci">o2::tpc::Side getSide() const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00411">SpaceChargeHelpers.h:411</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a6ce451ab1f382618b762cd0510c77472"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a6ce451ab1f382618b762cd0510c77472">o2::tpc::DistCorrInterpolator::evaldZ</a></div><div class="ttdeci">DataT evaldZ(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00403">SpaceChargeHelpers.h:403</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_a9d2c379302625ac301af5e44e3cca7b2"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#a9d2c379302625ac301af5e44e3cca7b2">o2::tpc::DistCorrInterpolator::evaldRPhi</a></div><div class="ttdeci">DataT evaldRPhi(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00409">SpaceChargeHelpers.h:409</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1DistCorrInterpolator_html_ac47ba0536e3125bacc267f613372d569"><div class="ttname"><a href="../../d8/dc0/classo2_1_1tpc_1_1DistCorrInterpolator.html#ac47ba0536e3125bacc267f613372d569">o2::tpc::DistCorrInterpolator::evaldR</a></div><div class="ttdeci">DataT evaldR(const DataT z, const DataT r, const DataT phi) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00397">SpaceChargeHelpers.h:397</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html">o2::tpc::Mapper</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00041">Mapper.h:42</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a04ba2b657cef66b28f117b0340dc353f"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a04ba2b657cef66b28f117b0340dc353f">o2::tpc::Mapper::ROWOFFSET</a></div><div class="ttdeci">static constexpr unsigned int ROWOFFSET[NREGIONS]</div><div class="ttdoc">offset to calculate local row from global row</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00533">Mapper.h:533</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a15f4e85c6dda93a9e623a9ff9524eac6"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a15f4e85c6dda93a9e623a9ff9524eac6">o2::tpc::Mapper::getGlobalPadNumber</a></div><div class="ttdeci">static GlobalPadNumber getGlobalPadNumber(const unsigned int lrow, const unsigned int pad, const unsigned int region)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00064">Mapper.h:64</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a4d8f001eec24323357692770a7bc31cb"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a4d8f001eec24323357692770a7bc31cb">o2::tpc::Mapper::findDigitPosFromGlobalPosition</a></div><div class="ttdeci">const DigitPos findDigitPosFromGlobalPosition(const GlobalPosition3D &amp;pos) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00716">Mapper.h:716</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a57665f936edb24da92b1d2be8ded708a"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a57665f936edb24da92b1d2be8ded708a">o2::tpc::Mapper::PADSPERROW</a></div><div class="ttdeci">static const std::vector&lt; unsigned int &gt; PADSPERROW[NREGIONS]</div><div class="ttdoc">number of pads per row in region</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00567">Mapper.h:567</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a71cfd167b4833c06ffc20c062555af63"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a71cfd167b4833c06ffc20c062555af63">o2::tpc::Mapper::INVPADAREA</a></div><div class="ttdeci">static constexpr float INVPADAREA[NREGIONS]</div><div class="ttdoc">inverse size of the pad area padwidth*padLength</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00536">Mapper.h:536</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a7226f7afc489f59ce5bdfcd88d83e33c"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7226f7afc489f59ce5bdfcd88d83e33c">o2::tpc::Mapper::instance</a></div><div class="ttdeci">static Mapper &amp; instance(const std::string mappingDir=&quot;&quot;)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00044">Mapper.h:44</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a7962684772bd8bf62a60941ea4312cb2"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a7962684772bd8bf62a60941ea4312cb2">o2::tpc::Mapper::GlobalToLocal</a></div><div class="ttdeci">static LocalPosition3D GlobalToLocal(const GlobalPosition3D &amp;pos, const double alpha)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00468">Mapper.h:468</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a85df553b7561b5281a061228ab409fc5"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a85df553b7561b5281a061228ab409fc5">o2::tpc::Mapper::ROWSPERREGION</a></div><div class="ttdeci">static constexpr unsigned int ROWSPERREGION[NREGIONS]</div><div class="ttdoc">number of pad rows for region</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00532">Mapper.h:532</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a8e4affb36cdb57afa32449379d43aef7"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a8e4affb36cdb57afa32449379d43aef7">o2::tpc::Mapper::NSECTORS</a></div><div class="ttdeci">static constexpr unsigned int NSECTORS</div><div class="ttdoc">total number of sectors in the TPC</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00526">Mapper.h:526</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a9009179fa0078961b118a7f5cbdf4ccf"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9009179fa0078961b118a7f5cbdf4ccf">o2::tpc::Mapper::getPadRegionInfo</a></div><div class="ttdeci">const PadRegionInfo &amp; getPadRegionInfo(const unsigned char region) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00385">Mapper.h:385</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a93c1a24bcb03c518c9b819b5aa45e45d"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a93c1a24bcb03c518c9b819b5aa45e45d">o2::tpc::Mapper::NREGIONS</a></div><div class="ttdeci">static constexpr unsigned int NREGIONS</div><div class="ttdoc">total number of regions in one sector</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00527">Mapper.h:527</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_a9441e037bf1815fc668c4cdda5090cfb"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#a9441e037bf1815fc668c4cdda5090cfb">o2::tpc::Mapper::getPadsInSector</a></div><div class="ttdeci">static constexpr unsigned short getPadsInSector()</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00414">Mapper.h:414</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_ab295f3e4892ba86df925979d99d82d66"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ab295f3e4892ba86df925979d99d82d66">o2::tpc::Mapper::padCentre</a></div><div class="ttdeci">const PadCentre &amp; padCentre(GlobalPadNumber padNumber) const</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00051">Mapper.h:51</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Mapper_html_ac3a82fbb8b2684194432dd095da3abfb"><div class="ttname"><a href="../../de/db6/classo2_1_1tpc_1_1Mapper.html#ac3a82fbb8b2684194432dd095da3abfb">o2::tpc::Mapper::LocalToGlobal</a></div><div class="ttdeci">static GlobalPosition3D LocalToGlobal(const LocalPosition3D &amp;pos, const double alpha)</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d1d/TPC_2base_2include_2TPCBase_2Mapper_8h_source.html#l00461">Mapper.h:461</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1NumericalFields_html"><div class="ttname"><a href="../../d9/d44/classo2_1_1tpc_1_1NumericalFields.html">o2::tpc::NumericalFields</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00237">SpaceChargeHelpers.h:238</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PadRegionInfo_html_a637bc7c57ceb250bcdf22fda72d41ec9"><div class="ttname"><a href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a637bc7c57ceb250bcdf22fda72d41ec9">o2::tpc::PadRegionInfo::getRadiusFirstRow</a></div><div class="ttdeci">float getRadiusFirstRow() const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9d/PadRegionInfo_8h_source.html#l00092">PadRegionInfo.h:92</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PadRegionInfo_html_a8f0855e5572ac21692b148a5c9810f32"><div class="ttname"><a href="../../d5/dd8/classo2_1_1tpc_1_1PadRegionInfo.html#a8f0855e5572ac21692b148a5c9810f32">o2::tpc::PadRegionInfo::getPadsInRowRegion</a></div><div class="ttdeci">unsigned char getPadsInRowRegion(const int row) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d9d/PadRegionInfo_8h_source.html#l00120">PadRegionInfo.h:120</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html">o2::tpc::PoissonSolver</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d2a/PoissonSolver_8h_source.html#l00048">PoissonSolver.h:49</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html_a196fbcdc355e62e60736768c7aab8189"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a196fbcdc355e62e60736768c7aab8189">o2::tpc::PoissonSolver::setConvergenceError</a></div><div class="ttdeci">static void setConvergenceError(const DataT error)</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d2a/PoissonSolver_8h_source.html#l00088">PoissonSolver.h:88</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1PoissonSolver_html_a66d868c082110c6929f68a06fb168f3c"><div class="ttname"><a href="../../d1/d53/classo2_1_1tpc_1_1PoissonSolver.html#a66d868c082110c6929f68a06fb168f3c">o2::tpc::PoissonSolver::poissonSolver3D</a></div><div class="ttdeci">void poissonSolver3D(DataContainer &amp;matricesV, const DataContainer &amp;matricesCharge, const int symmetry)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/ddc/PoissonSolver_8cxx_source.html#l00037">PoissonSolver.cxx:37</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1RegularGrid3D_html"><div class="ttname"><a href="../../d8/dc6/classo2_1_1tpc_1_1RegularGrid3D.html">o2::tpc::RegularGrid3D</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/dad/RegularGrid3D_8h_source.html#l00047">RegularGrid3D.h:47</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Sector_html"><div class="ttname"><a href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html">o2::tpc::Sector</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/dd6/Sector_8h_source.html#l00040">Sector.h:41</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1Sector_html_a0cbc050672c8d917aeca484baf230125"><div class="ttname"><a href="../../d0/d0c/classo2_1_1tpc_1_1Sector.html#a0cbc050672c8d917aeca484baf230125">o2::tpc::Sector::side</a></div><div class="ttdeci">Side side() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/dd6/Sector_8h_source.html#l00096">Sector.h:96</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html">o2::tpc::SpaceCharge</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00072">SpaceCharge.h:73</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a0284367d48f7b2fe6362843ffee61264"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0284367d48f7b2fe6362843ffee61264">o2::tpc::SpaceCharge::setOmegaTauT1T2</a></div><div class="ttdeci">void setOmegaTauT1T2(const DataT omegaTau=0.32f, const DataT t1=1, const DataT t2=1)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03460">SpaceCharge.cxx:3460</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a08ab2a3a5767a4e41e5461d4fe7b1797"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08ab2a3a5767a4e41e5461d4fe7b1797">o2::tpc::SpaceCharge::getDistortionsCyl</a></div><div class="ttdeci">void getDistortionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;distZ, DataT &amp;distR, DataT &amp;distRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02014">SpaceCharge.cxx:2014</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a08b328d8f063ff0af239e81ad3bbcceb"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a08b328d8f063ff0af239e81ad3bbcceb">o2::tpc::SpaceCharge::addChargeDensity</a></div><div class="ttdeci">void addChargeDensity(const SpaceCharge&lt; DataT &gt; &amp;otherSC)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03471">SpaceCharge.cxx:3471</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a0b12079b87187decbfbe5ebf5218ec8a"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0b12079b87187decbfbe5ebf5218ec8a">o2::tpc::SpaceCharge::dumpToTree</a></div><div class="ttdeci">void dumpToTree(const char *outFileName, const Side side, const int nZPoints=50, const int nRPoints=150, const int nPhiPoints=180, const bool randomize=false) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02469">SpaceCharge.cxx:2469</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a0dcc989405da5da7ac58d984be490881"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0dcc989405da5da7ac58d984be490881">o2::tpc::SpaceCharge::correctElectron</a></div><div class="ttdeci">void correctElectron(GlobalPosition3D &amp;point)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01775">SpaceCharge.cxx:1775</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a0e5633d230d25b21aafca1ec5f045992"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a0e5633d230d25b21aafca1ec5f045992">o2::tpc::SpaceCharge::initBField</a></div><div class="ttdeci">void initBField(const int field)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02894">SpaceCharge.cxx:2894</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a10a709181743c1200590da8f93c877db"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10a709181743c1200590da8f93c877db">o2::tpc::SpaceCharge::regulateR</a></div><div class="ttdeci">DataT regulateR(const DataT posR, const Side side) const</div><div class="ttdoc">set r coordinate between 'RMIN - 4 * GRIDSPACINGR' and 'RMAX + 2 * GRIDSPACINGR'. the r coordinate is...</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00199">SpaceCharge.cxx:199</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a10e3026161c8aa2eaa1982be85d1cd6e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10e3026161c8aa2eaa1982be85d1cd6e">o2::tpc::SpaceCharge::getPhiBinsGapFrame</a></div><div class="ttdeci">size_t getPhiBinsGapFrame(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00248">SpaceCharge.cxx:248</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a10fcb62febc447a733c8eb5975e8a40e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a10fcb62febc447a733c8eb5975e8a40e">o2::tpc::SpaceCharge::setROCMisalignmentRotationAlongX</a></div><div class="ttdeci">void setROCMisalignmentRotationAlongX(const int sector, const int type, const float potentialMin, const float potentialMax)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03884">SpaceCharge.cxx:3884</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a124395d1096003313755205833435610"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a124395d1096003313755205833435610">o2::tpc::SpaceCharge::dumpGlobalDistortions</a></div><div class="ttdeci">int dumpGlobalDistortions(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03055">SpaceCharge.cxx:3055</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a132f8becaf90d84135c890e606e60dda"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a132f8becaf90d84135c890e606e60dda">o2::tpc::SpaceCharge::addGlobalCorrections</a></div><div class="ttdeci">void addGlobalCorrections(const SpaceCharge&lt; DataT &gt; &amp;otherSC, const Side side)</div><div class="ttdoc">add global corrections from other space charge object</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03484">SpaceCharge.cxx:3484</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a14c8c621edb520a80aa7196c9b8652ca"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a14c8c621edb520a80aa7196c9b8652ca">o2::tpc::SpaceCharge::Type</a></div><div class="ttdeci">Type</div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00106">SpaceCharge.h:106</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a153f224e50193ee75876be32e85542ed"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a153f224e50193ee75876be32e85542ed">o2::tpc::SpaceCharge::setPotentialBoundaryInnerRadius</a></div><div class="ttdeci">void setPotentialBoundaryInnerRadius(const std::function&lt; DataT(DataT)&gt; &amp;potentialFunc, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00498">SpaceCharge.cxx:498</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a15baa243dd756629892923993d1ec1bf"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a15baa243dd756629892923993d1ec1bf">o2::tpc::SpaceCharge::setLocalCorrectionsFromFile</a></div><div class="ttdeci">void setLocalCorrectionsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03161">SpaceCharge.cxx:3161</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a198395c3d578002731dcbd2ba549970f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a198395c3d578002731dcbd2ba549970f">o2::tpc::SpaceCharge::setPotentialBoundaryGEMFrameAlongR</a></div><div class="ttdeci">void setPotentialBoundaryGEMFrameAlongR(const std::function&lt; DataT(DataT)&gt; &amp;potentialFunc, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00268">SpaceCharge.cxx:268</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a21eb5a81769da883b62ed8c6202349f1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a21eb5a81769da883b62ed8c6202349f1">o2::tpc::SpaceCharge::calcGlobalDistWithGlobalCorrIterative</a></div><div class="ttdeci">void calcGlobalDistWithGlobalCorrIterative(const DistCorrInterpolator&lt; DataT &gt; &amp;globCorr, const int maxIter=100, const DataT approachZ=1, const DataT approachR=1, const DataT approachPhi=1, const DataT diffCorr=50e-6, const SpaceCharge&lt; DataT &gt; *scSCale=nullptr, float scale=0)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00734">SpaceCharge.cxx:734</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2372e2d84908cc80db73b3c858c99732"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2372e2d84908cc80db73b3c858c99732">o2::tpc::SpaceCharge::dumpLocalCorrections</a></div><div class="ttdeci">int dumpLocalCorrections(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03146">SpaceCharge.cxx:3146</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a244ff868007df0f15fff94603c5b005d"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a244ff868007df0f15fff94603c5b005d">o2::tpc::SpaceCharge::setGlobalDistortionsFromFile</a></div><div class="ttdeci">void setGlobalDistortionsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03070">SpaceCharge.cxx:3070</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a24673a83786df4727afdb12165622b5f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a24673a83786df4727afdb12165622b5f">o2::tpc::SpaceCharge::checkGridFromFile</a></div><div class="ttdeci">bool checkGridFromFile(std::string_view file, std::string_view tree)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03278">SpaceCharge.cxx:3278</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a25aed0bc6b816140e1618c3d350f030e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25aed0bc6b816140e1618c3d350f030e">o2::tpc::SpaceCharge::setSimNSector</a></div><div class="ttdeci">void setSimNSector(const int nSectors)</div><div class="ttdoc">simulate N sectors</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03415">SpaceCharge.cxx:3415</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a25bbfc73f9401b5ff205f040606ea926"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a25bbfc73f9401b5ff205f040606ea926">o2::tpc::SpaceCharge::setGlobalCorrectionsFromFile</a></div><div class="ttdeci">void setGlobalCorrectionsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03115">SpaceCharge.cxx:3115</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2e145dc7463fb21cf9f69cd8e7015f48"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2e145dc7463fb21cf9f69cd8e7015f48">o2::tpc::SpaceCharge::getPotentialCyl</a></div><div class="ttdeci">DataT getPotentialCyl(const DataT z, const DataT r, const DataT phi, const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01859">SpaceCharge.cxx:1859</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2f23362f9672c1699bfc58e970c4937b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f23362f9672c1699bfc58e970c4937b">o2::tpc::SpaceCharge::setROCMisalignmentRotationAlongY</a></div><div class="ttdeci">void setROCMisalignmentRotationAlongY(const int sector, const int type, const float potentialMin, const float potentialMax)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03890">SpaceCharge.cxx:3890</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2f8cbc58786475327fe482b1d1ef6296"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2f8cbc58786475327fe482b1d1ef6296">o2::tpc::SpaceCharge::dumpDensity</a></div><div class="ttdeci">int dumpDensity(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03266">SpaceCharge.cxx:3266</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a2fa1642b32fac6f01ca4f04500c341d1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a2fa1642b32fac6f01ca4f04500c341d1">o2::tpc::SpaceCharge::setIFCChargeUpRisingPot</a></div><div class="ttdeci">void setIFCChargeUpRisingPot(const float deltaPot, const float zMaxDeltaPot, const int type, const float zStart, const float offs, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03728">SpaceCharge.cxx:3728</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a340511ce458d96bcb957243a25f14a4f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a340511ce458d96bcb957243a25f14a4f">o2::tpc::SpaceCharge::getLocalDistortionVectorCyl</a></div><div class="ttdeci">void getLocalDistortionVectorCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lvecdistZ, DataT &amp;lvecdistR, DataT &amp;lvecdistRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01972">SpaceCharge.cxx:1972</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a34b407b5797fe7d20144b0b4b95e5b87"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a34b407b5797fe7d20144b0b4b95e5b87">o2::tpc::SpaceCharge::dumpPotential</a></div><div class="ttdeci">int dumpPotential(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03242">SpaceCharge.cxx:3242</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a39e65fb4ba2b852a12662592073e50bc"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a39e65fb4ba2b852a12662592073e50bc">o2::tpc::SpaceCharge::getNPhiVertices</a></div><div class="ttdeci">unsigned short getNPhiVertices() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00410">SpaceCharge.h:410</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a3a46a0ad77d7d357b28b384627f098ec"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3a46a0ad77d7d357b28b384627f098ec">o2::tpc::SpaceCharge::setDefaultStaticDistortionsGEMFrameChargeUp</a></div><div class="ttdeci">void setDefaultStaticDistortionsGEMFrameChargeUp(const Side side, const DataT deltaPotential=1000)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00230">SpaceCharge.cxx:230</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a3da8a7835405ea520dffc7a3913f77d9"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3da8a7835405ea520dffc7a3913f77d9">o2::tpc::SpaceCharge::setAnalyticalCorrectionsDistortionsFromFile</a></div><div class="ttdeci">void setAnalyticalCorrectionsDistortionsFromFile(std::string_view inpf)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02861">SpaceCharge.cxx:2861</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a3dd986e654962435fabcf1cd8bfa253c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a3dd986e654962435fabcf1cd8bfa253c">o2::tpc::SpaceCharge::fillChargeFromCalDet</a></div><div class="ttdeci">void fillChargeFromCalDet(const std::vector&lt; CalDet&lt; float &gt; &gt; &amp;calCharge3D)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01132">SpaceCharge.cxx:1132</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a44692338c734f401f929f2e7c1c5ef4f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a44692338c734f401f929f2e7c1c5ef4f">o2::tpc::SpaceCharge::setPotentialBoundaryFromFormula</a></div><div class="ttdeci">void setPotentialBoundaryFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00557">SpaceCharge.cxx:557</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a4553fcd51a8cf4e85ed6a01b791e6ba7"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a4553fcd51a8cf4e85ed6a01b791e6ba7">o2::tpc::SpaceCharge::calcGlobalCorrWithGlobalDistIterativeLinearCartesian</a></div><div class="ttdeci">void calcGlobalCorrWithGlobalDistIterativeLinearCartesian(const Side side, const SpaceCharge&lt; DataT &gt; *scSCale=nullptr, float scale=0, const int maxIter=100, const DataT approachX=1, const DataT approachY=1, const DataT approachZ=1, const DataT diffCorr=50e-6)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00912">SpaceCharge.cxx:912</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a482522fbc912d311883b72f3d93b574e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a482522fbc912d311883b72f3d93b574e">o2::tpc::SpaceCharge::calcGlobalCorrWithGlobalDistIterative</a></div><div class="ttdeci">void calcGlobalCorrWithGlobalDistIterative(const Side side, const SpaceCharge&lt; DataT &gt; *scSCale=nullptr, float scale=0, const int maxIter=100, const DataT approachZ=1, const DataT approachR=1, const DataT approachPhi=1, const DataT diffCorr=50e-6)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00756">SpaceCharge.cxx:756</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a539978c05ed43feae754f81168bdccfd"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a539978c05ed43feae754f81168bdccfd">o2::tpc::SpaceCharge::calcLocalDistortionsCorrections</a></div><div class="ttdeci">void calcLocalDistortionsCorrections(const Type type, const ElectricFields &amp;formulaStruct)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a58f16f65295007b95080ab0ecf4f1360"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a58f16f65295007b95080ab0ecf4f1360">o2::tpc::SpaceCharge::dumpGlobalCorrections</a></div><div class="ttdeci">int dumpGlobalCorrections(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03100">SpaceCharge.cxx:3100</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5e313e6ec7dee6ce18834a8d37d2c06c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e313e6ec7dee6ce18834a8d37d2c06c">o2::tpc::SpaceCharge::getGlobalCorrInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getGlobalCorrInterpolator(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01107">SpaceCharge.cxx:1107</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a5e4c572eda5e6db7ad6a27c8cdf5d74e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a5e4c572eda5e6db7ad6a27c8cdf5d74e">o2::tpc::SpaceCharge::getLocalCorrInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getLocalCorrInterpolator(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01087">SpaceCharge.cxx:1087</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a61654209212ec0ab829f8c4da16a2961"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a61654209212ec0ab829f8c4da16a2961">o2::tpc::SpaceCharge::setEFieldFromFormula</a></div><div class="ttdeci">void setEFieldFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00623">SpaceCharge.cxx:623</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a645b39cfd808df71f11e9608c61c0830"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a645b39cfd808df71f11e9608c61c0830">o2::tpc::SpaceCharge::subtractGlobalDistortions</a></div><div class="ttdeci">void subtractGlobalDistortions(const SpaceCharge&lt; DataT &gt; &amp;otherSC, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03987">SpaceCharge.cxx:3987</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a65077bfa3724f61f2a744aa4f12cc45c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a65077bfa3724f61f2a744aa4f12cc45c">o2::tpc::SpaceCharge::dumpLocalDistCorrVectors</a></div><div class="ttdeci">int dumpLocalDistCorrVectors(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03193">SpaceCharge.cxx:3193</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a652634045c7a547e94854b3a43fefef4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a652634045c7a547e94854b3a43fefef4">o2::tpc::SpaceCharge::addBoundaryPotential</a></div><div class="ttdeci">void addBoundaryPotential(const SpaceCharge&lt; DataT &gt; &amp;other, const Side side, const float scaling=1)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03654">SpaceCharge.cxx:3654</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a670dc917d73d739a3531eacd5f05f176"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a670dc917d73d739a3531eacd5f05f176">o2::tpc::SpaceCharge::getCorrections</a></div><div class="ttdeci">void getCorrections(const DataT x, const DataT y, const DataT z, const Side side, DataT &amp;corrX, DataT &amp;corrY, DataT &amp;corrZ) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01927">SpaceCharge.cxx:1927</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a6e77426db84413f7e5e1a698f493a036"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a6e77426db84413f7e5e1a698f493a036">o2::tpc::SpaceCharge::initAfterReadingFromFile</a></div><div class="ttdeci">void initAfterReadingFromFile()</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04074">SpaceCharge.cxx:4074</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a72c9a75864562f65cb6983dd67d0bd22"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a72c9a75864562f65cb6983dd67d0bd22">o2::tpc::SpaceCharge::normalizeHistoQVEps0</a></div><div class="ttdeci">static void normalizeHistoQVEps0(TH3 &amp;histoIonsPhiRZ)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02831">SpaceCharge.cxx:2831</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a76bdf739697723796fcd8110e045b032"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a76bdf739697723796fcd8110e045b032">o2::tpc::SpaceCharge::getDistortions</a></div><div class="ttdeci">void getDistortions(const DataT x, const DataT y, const DataT z, const Side side, DataT &amp;distX, DataT &amp;distY, DataT &amp;distZ) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02035">SpaceCharge.cxx:2035</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7cf35cd4d86df75c69cb3a79697775d7"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7cf35cd4d86df75c69cb3a79697775d7">o2::tpc::SpaceCharge::calcLocalDistortionsCorrectionsRK4</a></div><div class="ttdeci">void calcLocalDistortionsCorrectionsRK4(const Type type, const Side side)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7db68da7d1c4cd48903f83379d1b06ac"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7db68da7d1c4cd48903f83379d1b06ac">o2::tpc::SpaceCharge::mirrorPotential</a></div><div class="ttdeci">void mirrorPotential(const Side sideRef, const Side sideMirrored)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00543">SpaceCharge.cxx:543</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7e763c27749fc15209e03300f0fa01aa"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7e763c27749fc15209e03300f0fa01aa">o2::tpc::SpaceCharge::getOMPMaxThreads</a></div><div class="ttdeci">static int getOMPMaxThreads()</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00106">SpaceCharge.cxx:106</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7ef90c889b90fb5fea40a47e077e02b4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7ef90c889b90fb5fea40a47e077e02b4">o2::tpc::SpaceCharge::dumpAnalyticalCorrectionsDistortions</a></div><div class="ttdeci">int dumpAnalyticalCorrectionsDistortions(TFile &amp;outf) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02850">SpaceCharge.cxx:2850</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a7f9c51c9aa6ca12682cb72e81662d2c5"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a7f9c51c9aa6ca12682cb72e81662d2c5">o2::tpc::SpaceCharge::unsetSimNSector</a></div><div class="ttdeci">static void unsetSimNSector()</div><div class="ttdoc">unsetting simulation of one sector</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03426">SpaceCharge.cxx:3426</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a8192363c5c378c3d1c54c424bc89e754"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8192363c5c378c3d1c54c424bc89e754">o2::tpc::SpaceCharge::getLocalDistInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getLocalDistInterpolator(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01077">SpaceCharge.cxx:1077</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a821350016d42e87acb42422ab3ed16c2"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a821350016d42e87acb42422ab3ed16c2">o2::tpc::SpaceCharge::getLocalCorrectionsCyl</a></div><div class="ttdeci">void getLocalCorrectionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lcorrZ, DataT &amp;lcorrR, DataT &amp;lcorrRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01885">SpaceCharge.cxx:1885</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a82913fcf78fb8274be5a8c19d21201f0"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82913fcf78fb8274be5a8c19d21201f0">o2::tpc::SpaceCharge::fillChargeFromIDCs</a></div><div class="ttdeci">void fillChargeFromIDCs(std::vector&lt; CalDet&lt; float &gt; &gt; &amp;idcZero, const CalDet&lt; float &gt; &amp;mapIBF, const float ionDriftTimeMS=200, const bool normToPadArea=true)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03592">SpaceCharge.cxx:3592</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a82916266360bee79127c2ca19ad2a330"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a82916266360bee79127c2ca19ad2a330">o2::tpc::SpaceCharge::scaleChargeDensityStack</a></div><div class="ttdeci">void scaleChargeDensityStack(const float scalingFactor, const Sector sector, const GEMstack stack)</div><div class="ttdoc">scaling the space-charge density for given stack</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04049">SpaceCharge.cxx:4049</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a852bf349cd4dcea7d4de2cd42f819a03"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a852bf349cd4dcea7d4de2cd42f819a03">o2::tpc::SpaceCharge::calcGlobalDistortions</a></div><div class="ttdeci">void calcGlobalDistortions(const Fields &amp;formulaStruct, const int maxIterations=3 *sSteps *129)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01537">SpaceCharge.cxx:1537</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a87b0207c6672f0fb60920f7cd60ae8d4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a87b0207c6672f0fb60920f7cd60ae8d4">o2::tpc::SpaceCharge::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02102">SpaceCharge.cxx:2102</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a89acd8f67d0813e37753362c2fa6ee6c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a89acd8f67d0813e37753362c2fa6ee6c">o2::tpc::SpaceCharge::dumpMetaData</a></div><div class="ttdeci">void dumpMetaData(std::string_view file, std::string_view option, const bool overwriteExisting=false) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03348">SpaceCharge.cxx:3348</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a8b1c785c09f42829bc9c20ee6b2d2c58"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a8b1c785c09f42829bc9c20ee6b2d2c58">o2::tpc::SpaceCharge::convertIDCsToCharge</a></div><div class="ttdeci">static void convertIDCsToCharge(std::vector&lt; CalDet&lt; float &gt; &gt; &amp;idcZero, const CalDet&lt; float &gt; &amp;mapIBF, const float ionDriftTimeMS=200, const bool normToPadArea=true)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03542">SpaceCharge.cxx:3542</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a92d6d29cf16721a3aa7772cbc9b3e0a7"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a92d6d29cf16721a3aa7772cbc9b3e0a7">o2::tpc::SpaceCharge::getDistortionsCorrectionsAnalytical</a></div><div class="ttdeci">const auto &amp; getDistortionsCorrectionsAnalytical() const &amp;</div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00604">SpaceCharge.h:604</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a9605d29586015f2f88aa63243964f582"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9605d29586015f2f88aa63243964f582">o2::tpc::SpaceCharge::getElectricFieldsInterpolator</a></div><div class="ttdeci">NumericalFields&lt; DataT &gt; getElectricFieldsInterpolator(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01067">SpaceCharge.cxx:1067</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a97ac150a6f1d354e6b104989d63e313b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a97ac150a6f1d354e6b104989d63e313b">o2::tpc::SpaceCharge::subtractGlobalCorrections</a></div><div class="ttdeci">void subtractGlobalCorrections(const SpaceCharge&lt; DataT &gt; &amp;otherSC, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03979">SpaceCharge.cxx:3979</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a984c671dc37272789ab30252c8cc2676"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a984c671dc37272789ab30252c8cc2676">o2::tpc::SpaceCharge::getCorrectionsCyl</a></div><div class="ttdeci">void getCorrectionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;corrZ, DataT &amp;corrR, DataT &amp;corrRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01906">SpaceCharge.cxx:1906</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a993d5dccf3d2de1da1aad94bf4018dbb"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a993d5dccf3d2de1da1aad94bf4018dbb">o2::tpc::SpaceCharge::setDensityFromFile</a></div><div class="ttdeci">void setDensityFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03298">SpaceCharge.cxx:3298</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a99f1e72b6f806fcad68a339cad9c7a86"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a99f1e72b6f806fcad68a339cad9c7a86">o2::tpc::SpaceCharge::getLocalDistortionsCyl</a></div><div class="ttdeci">void getLocalDistortionsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;ldistZ, DataT &amp;ldistR, DataT &amp;ldistRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01951">SpaceCharge.cxx:1951</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a9b795ba44b6b1ea7f444d42069076604"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9b795ba44b6b1ea7f444d42069076604">o2::tpc::SpaceCharge::dumpToFile</a></div><div class="ttdeci">void dumpToFile(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03324">SpaceCharge.cxx:3324</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a9dab3e3390f6b9c6fb8019d45070b96e"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dab3e3390f6b9c6fb8019d45070b96e">o2::tpc::SpaceCharge::fillChargeDensityFromCalDet</a></div><div class="ttdeci">void fillChargeDensityFromCalDet(const std::vector&lt; CalDet&lt; float &gt; &gt; &amp;calSCDensity3D)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01125">SpaceCharge.cxx:1125</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_a9dfcb180115bfd99f41b8e144a6142e4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#a9dfcb180115bfd99f41b8e144a6142e4">o2::tpc::SpaceCharge::setGlobalDistortions</a></div><div class="ttdeci">void setGlobalDistortions(const std::function&lt; void(int sector, DataT gx, DataT gy, DataT gz, DataT &amp;gCx, DataT &amp;gCy, DataT &amp;gCz)&gt; &amp;gDist, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03816">SpaceCharge.cxx:3816</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa0286a3f4f1f512226d73e758165be16"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa0286a3f4f1f512226d73e758165be16">o2::tpc::SpaceCharge::scaleCorrections</a></div><div class="ttdeci">void scaleCorrections(const float scaleFac, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03995">SpaceCharge.cxx:3995</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa2fc9ad13284a45fde40ff5b0d921fc6"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa2fc9ad13284a45fde40ff5b0d921fc6">o2::tpc::SpaceCharge::dumpLocalDistortions</a></div><div class="ttdeci">int dumpLocalDistortions(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03178">SpaceCharge.cxx:3178</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa30b36f2b70ca17375aa56eb554b0b15"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa30b36f2b70ca17375aa56eb554b0b15">o2::tpc::SpaceCharge::getNRVertices</a></div><div class="ttdeci">unsigned short getNRVertices() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00407">SpaceCharge.h:407</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa4af27826aa0fb803ce60a3e803c4642"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa4af27826aa0fb803ce60a3e803c4642">o2::tpc::SpaceCharge::setDistortionLookupTables</a></div><div class="ttdeci">void setDistortionLookupTables(const DataContainer &amp;distdZ, const DataContainer &amp;distdR, const DataContainer &amp;distdRPhi, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02131">SpaceCharge.cxx:2131</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa62a45be2e34032316254210125ccbc6"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa62a45be2e34032316254210125ccbc6">o2::tpc::SpaceCharge::setPotentialBoundaryOuterRadius</a></div><div class="ttdeci">void setPotentialBoundaryOuterRadius(const std::function&lt; DataT(DataT)&gt; &amp;potentialFunc, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00512">SpaceCharge.cxx:512</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa631e1ae6ea6fc0b1eb627f7ac8fe2a2"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa631e1ae6ea6fc0b1eb627f7ac8fe2a2">o2::tpc::SpaceCharge::setIFCChargeUpFallingPot</a></div><div class="ttdeci">void setIFCChargeUpFallingPot(const float deltaPot, const float zMaxDeltaPot, const int type, const float zEnd, const float offs, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03766">SpaceCharge.cxx:3766</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aa65ad3b3fbfd67af9df3ef0e172ba124"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aa65ad3b3fbfd67af9df3ef0e172ba124">o2::tpc::SpaceCharge::calcGlobalDistWithGlobalCorrIterativeLinearCartesian</a></div><div class="ttdeci">void calcGlobalDistWithGlobalCorrIterativeLinearCartesian(const Side side, const SpaceCharge&lt; DataT &gt; *scSCale=nullptr, float scale=0, const int maxIter=100, const DataT approachX=1, const DataT approachY=1, const DataT approachZ=1, const DataT diffCorr=50e-6)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00896">SpaceCharge.cxx:896</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aac3129a509588df0937376f883788fb6"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aac3129a509588df0937376f883788fb6">o2::tpc::SpaceCharge::makeElectronDriftPathGif</a></div><div class="ttdeci">static void makeElectronDriftPathGif(const char *inpFile, TH2F &amp;hBorder, const int type=0, const int gifSpeed=2, const int maxsamplingpoints=100, const char *outName=&quot;electron_drift_path&quot;)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02371">SpaceCharge.cxx:2371</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aad0b025fd2ed30676b2a23a1f248658a"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aad0b025fd2ed30676b2a23a1f248658a">o2::tpc::SpaceCharge::setElectricFieldsFromFile</a></div><div class="ttdeci">void setElectricFieldsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03038">SpaceCharge.cxx:3038</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab3ccf914d5c9d28ff5b13883f9501443"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab3ccf914d5c9d28ff5b13883f9501443">o2::tpc::SpaceCharge::calcEField</a></div><div class="ttdeci">void calcEField(const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00644">SpaceCharge.cxx:644</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab4541395c1c5f02af28e1a98329d4c0b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab4541395c1c5f02af28e1a98329d4c0b">o2::tpc::SpaceCharge::setPotentialFromFile</a></div><div class="ttdeci">void setPotentialFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03254">SpaceCharge.cxx:3254</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab45e362fb4bf0d9e7a181b7a2637063c"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab45e362fb4bf0d9e7a181b7a2637063c">o2::tpc::SpaceCharge::fillChargeDensityFromHisto</a></div><div class="ttdeci">void fillChargeDensityFromHisto(const TH3 &amp;hisSCDensity3D)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01140">SpaceCharge.cxx:1140</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ab81eb32c44b9187f071b4cc50d9080c8"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ab81eb32c44b9187f071b4cc50d9080c8">o2::tpc::SpaceCharge::getLocalCorrectionVectorCyl</a></div><div class="ttdeci">void getLocalCorrectionVectorCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;lveccorrZ, DataT &amp;lveccorrR, DataT &amp;lveccorrRPhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01993">SpaceCharge.cxx:1993</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_abe1f7bf99cbb36ad75208f91e190f2ba"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#abe1f7bf99cbb36ad75208f91e190f2ba">o2::tpc::SpaceCharge::setPotential</a></div><div class="ttdeci">void setPotential(int iz, int ir, int iphi, Side side, float val)</div><div class="ttdoc">setting the potential directly for given vertex</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04141">SpaceCharge.cxx:4141</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ac28fa8c5e945011ca2b459a9578ca3e3"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac28fa8c5e945011ca2b459a9578ca3e3">o2::tpc::SpaceCharge::setFromFile</a></div><div class="ttdeci">void setFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03432">SpaceCharge.cxx:3432</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ac7df75daa4554e43590229be7eb43368"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ac7df75daa4554e43590229be7eb43368">o2::tpc::SpaceCharge::SpaceCharge</a></div><div class="ttdeci">SpaceCharge()</div><div class="ttdoc">constructor for empty object. Can be used when buffers are loaded from file</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00072">SpaceCharge.cxx:72</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_acaa5cb1a79cbeb9a878f7cc4e86f93bc"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acaa5cb1a79cbeb9a878f7cc4e86f93bc">o2::tpc::SpaceCharge::setChargeDensityFromFormula</a></div><div class="ttdeci">void setChargeDensityFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00213">SpaceCharge.cxx:213</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_acb7e3314dadf5e5318890390f933d225"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#acb7e3314dadf5e5318890390f933d225">o2::tpc::SpaceCharge::averageDensityPerSector</a></div><div class="ttdeci">void averageDensityPerSector(const Side side)</div><div class="ttdoc">average the sc density across all sectors per side</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04003">SpaceCharge.cxx:4003</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aceb6220f59d6f3d24a8e7178317d8e8d"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aceb6220f59d6f3d24a8e7178317d8e8d">o2::tpc::SpaceCharge::getDensityCyl</a></div><div class="ttdeci">DataT getDensityCyl(const DataT z, const DataT r, const DataT phi, const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01841">SpaceCharge.cxx:1841</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad0549b2431c04af932fe5e6b2c3c5043"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad0549b2431c04af932fe5e6b2c3c5043">o2::tpc::SpaceCharge::getElectricFieldsCyl</a></div><div class="ttdeci">void getElectricFieldsCyl(const DataT z, const DataT r, const DataT phi, const Side side, DataT &amp;eZ, DataT &amp;eR, DataT &amp;ePhi) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01877">SpaceCharge.cxx:1877</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad10b30bfbc4b208375b11ec43415ddb4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad10b30bfbc4b208375b11ec43415ddb4">o2::tpc::SpaceCharge::getDCAr</a></div><div class="ttdeci">float getDCAr(float tgl, const int nPoints, const float phi, float rStart=-1, o2::utils::TreeStreamRedirector *pcstream=nullptr) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04081">SpaceCharge.cxx:4081</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad1e9a7cb42eb9c18bb632c133c56373f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad1e9a7cb42eb9c18bb632c133c56373f">o2::tpc::SpaceCharge::getGlobalDistInterpolator</a></div><div class="ttdeci">DistCorrInterpolator&lt; DataT &gt; getGlobalDistInterpolator(const Side side) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01097">SpaceCharge.cxx:1097</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad3dfc2263f84e647902150e801ed7d39"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3dfc2263f84e647902150e801ed7d39">o2::tpc::SpaceCharge::setROCMisalignmentShiftZ</a></div><div class="ttdeci">void setROCMisalignmentShiftZ(const int sector, const int type, const float potential)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03878">SpaceCharge.cxx:3878</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad3ebb9a326377e00a4ec6a5a5c20e11f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad3ebb9a326377e00a4ec6a5a5c20e11f">o2::tpc::SpaceCharge::calculateDistortionsCorrections</a></div><div class="ttdeci">void calculateDistortionsCorrections(const o2::tpc::Side side, const bool calcVectors=false)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00112">SpaceCharge.cxx:112</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad4ffea9e524ac5c1dbf1c60ceba36cb4"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad4ffea9e524ac5c1dbf1c60ceba36cb4">o2::tpc::SpaceCharge::calcGlobalCorrections</a></div><div class="ttdeci">void calcGlobalCorrections(const Fields &amp;formulaStruct, const int type=3)</div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ad7c1d42e2cd3ecd129d958b2b1759e05"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ad7c1d42e2cd3ecd129d958b2b1759e05">o2::tpc::SpaceCharge::setGlobalCorrections</a></div><div class="ttdeci">void setGlobalCorrections(const std::function&lt; void(int sector, DataT gx, DataT gy, DataT gz, DataT &amp;gCx, DataT &amp;gCy, DataT &amp;gCz)&gt; &amp;gCorr, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03810">SpaceCharge.cxx:3810</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ae64d2d0ed97678181c4e13cfa993ce5f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae64d2d0ed97678181c4e13cfa993ce5f">o2::tpc::SpaceCharge::calcLocalDistortionCorrectionVector</a></div><div class="ttdeci">void calcLocalDistortionCorrectionVector(const ElectricFields &amp;formulaStruct)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01370">SpaceCharge.cxx:1370</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_ae835161d4fc0064a05655670e8256e1f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#ae835161d4fc0064a05655670e8256e1f">o2::tpc::SpaceCharge::setPotentialFromFormula</a></div><div class="ttdeci">void setPotentialFromFormula(const AnalyticalFields&lt; DataT &gt; &amp;formulaStruct)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00526">SpaceCharge.cxx:526</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aec8eb38222b938a1a4c21ddbd934419a"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec8eb38222b938a1a4c21ddbd934419a">o2::tpc::SpaceCharge::setLocalDistCorrVectorsFromFile</a></div><div class="ttdeci">void setLocalDistCorrVectorsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03225">SpaceCharge.cxx:3225</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aec913e3cee7451e5101682da4d706e0b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aec913e3cee7451e5101682da4d706e0b">o2::tpc::SpaceCharge::distortElectron</a></div><div class="ttdeci">void distortElectron(GlobalPosition3D &amp;point, const SpaceCharge&lt; DataT &gt; *scSCale=nullptr, float scale=0) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01790">SpaceCharge.cxx:1790</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aefb573766d973254ec466cadcb6b8a05"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aefb573766d973254ec466cadcb6b8a05">o2::tpc::SpaceCharge::getNZVertices</a></div><div class="ttdeci">unsigned short getNZVertices() const</div><div class="ttdef"><b>Definition</b> <a href="../../d3/db6/SpaceCharge_8h_source.html#l00404">SpaceCharge.h:404</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_af47cefe85e3f183d786dec4557ac356f"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af47cefe85e3f183d786dec4557ac356f">o2::tpc::SpaceCharge::readMetaData</a></div><div class="ttdeci">void readMetaData(std::string_view file)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03377">SpaceCharge.cxx:3377</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_af621105fd13f9cbfbd1ec260eac9ab71"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af621105fd13f9cbfbd1ec260eac9ab71">o2::tpc::SpaceCharge::resetBoundaryPotentialToZeroInRangeZ</a></div><div class="ttdeci">void resetBoundaryPotentialToZeroInRangeZ(float zMin, float zMax, const Side side)</div><div class="ttdoc">setting the boundary potential to 0 for z&lt;zMin and z&gt;zMax</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03694">SpaceCharge.cxx:3694</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_af65e22a052d4188c6983457c76efffcc"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af65e22a052d4188c6983457c76efffcc">o2::tpc::SpaceCharge::downSampleObject</a></div><div class="ttdeci">void downSampleObject(const int nZNew, const int nRNew, const int nPhiNew)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04148">SpaceCharge.cxx:4148</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_af752bf3e3e0bb9f909ebd51525f2dd21"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af752bf3e3e0bb9f909ebd51525f2dd21">o2::tpc::SpaceCharge::dumpElectricFields</a></div><div class="ttdeci">int dumpElectricFields(std::string_view file, const Side side, std::string_view option) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03023">SpaceCharge.cxx:3023</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_af99823b28ab20c478b66288112dc897b"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#af99823b28ab20c478b66288112dc897b">o2::tpc::SpaceCharge::setLocalDistortionsFromFile</a></div><div class="ttdeci">void setLocalDistortionsFromFile(std::string_view file, const Side side)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l03208">SpaceCharge.cxx:3208</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_afb60aa556a63b877e6d3e5b25ebc78cd"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#afb60aa556a63b877e6d3e5b25ebc78cd">o2::tpc::SpaceCharge::scaleChargeDensitySector</a></div><div class="ttdeci">void scaleChargeDensitySector(const float scalingFactor, const Sector sector)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l04031">SpaceCharge.cxx:4031</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aff760ce186c6f55c70b42e28b6ae32e1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff760ce186c6f55c70b42e28b6ae32e1">o2::tpc::SpaceCharge::calculateElectronDriftPath</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::vector&lt; o2::math_utils::Point3D&lt; float &gt; &gt;, std::array&lt; DataT, 3 &gt; &gt; &gt; calculateElectronDriftPath(const std::vector&lt; GlobalPosition3D &gt; &amp;elePos, const int nSamplingPoints, const std::string_view outFile=&quot;electron_tracks.root&quot;) const</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l02242">SpaceCharge.cxx:2242</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_aff7fa9095cf2e4f061143333b6369aa1"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#aff7fa9095cf2e4f061143333b6369aa1">o2::tpc::SpaceCharge::fillChargeDensityFromFile</a></div><div class="ttdeci">void fillChargeDensityFromFile(TFile &amp;fInp, const char *name)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l01117">SpaceCharge.cxx:1117</a></div></div>
<div class="ttc" id="aclasso2_1_1tpc_1_1SpaceCharge_html_affebed01001fa0b594d20ef265a3565a"><div class="ttname"><a href="../../df/dc5/classo2_1_1tpc_1_1SpaceCharge.html#affebed01001fa0b594d20ef265a3565a">o2::tpc::SpaceCharge::poissonSolver</a></div><div class="ttdeci">void poissonSolver(const Side side, const DataT stoppingConvergence=1e-6, const int symmetry=0)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d8e/SpaceCharge_8cxx_source.html#l00603">SpaceCharge.cxx:603</a></div></div>
<div class="ttc" id="aclasso2_1_1utils_1_1TreeStreamRedirector_html"><div class="ttname"><a href="../../d0/d55/classo2_1_1utils_1_1TreeStreamRedirector.html">o2::utils::TreeStreamRedirector</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/d22/TreeStreamRedirector_8h_source.html#l00041">TreeStreamRedirector.h:42</a></div></div>
<div class="ttc" id="aclassunsigned_01short_html"><div class="ttname"><a href="../../d3/dd6/classunsigned_01short.html">unsigned short</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a36862d7c6208bc30723fd06f2a0f9bfd"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a36862d7c6208bc30723fd06f2a0f9bfd">entry</a></div><div class="ttdeci">GLuint entry</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05735">glcorearb.h:5735</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a3d1e3edfcf61ca2d831883e1afbad89e"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a></div><div class="ttdeci">GLsizeiptr size</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00659">glcorearb.h:659</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a57f14e05b1900f16a2da82ade47d0c6d"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a57f14e05b1900f16a2da82ade47d0c6d">index</a></div><div class="ttdeci">GLuint index</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a5c4947d4516dd7cfa3505ce3a648a4ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a5c4947d4516dd7cfa3505ce3a648a4ef">name</a></div><div class="ttdeci">GLuint const GLchar * name</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00781">glcorearb.h:781</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a6a8efad2e332fcd916bde9e19ddef215"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6a8efad2e332fcd916bde9e19ddef215">f</a></div><div class="ttdeci">GLdouble f</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00310">glcorearb.h:310</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a6b425be07cfa8ac09043ef8391e7e514"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6b425be07cfa8ac09043ef8391e7e514">weight</a></div><div class="ttdeci">GLuint GLuint GLfloat weight</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05477">glcorearb.h:5477</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a6eba317e3cf44d6d26c04a5a8f197dcb"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a></div><div class="ttdeci">GLboolean GLboolean GLboolean b</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a74d80fd479c0f6d0153c709949a089ef"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a74d80fd479c0f6d0153c709949a089ef">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00270">glcorearb.h:270</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a7d05960f4f1c1b11f3177dc963a45d86"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a7d05960f4f1c1b11f3177dc963a45d86">type</a></div><div class="ttdeci">GLint GLint GLsizei GLint GLenum GLenum type</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00275">glcorearb.h:275</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a7eca977aec48ecd8d48ebd7558c0538c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a7eca977aec48ecd8d48ebd7558c0538c">params</a></div><div class="ttdeci">GLenum const GLfloat * params</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00272">glcorearb.h:272</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a8922a680b00df660c57f47c1971d04c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00298">glcorearb.h:298</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a94ae715eebfc1eb65456c0ab9b97f1e9"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a94ae715eebfc1eb65456c0ab9b97f1e9">indices</a></div><div class="ttdeci">GLsizei GLenum const void * indices</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00400">glcorearb.h:400</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_a950fc91edb4504f62f1c577bf4727c29"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a></div><div class="ttdeci">typedef void(APIENTRYP PFNGLCULLFACEPROC)(GLenum mode)</div></div>
<div class="ttc" id="aglcorearb_8h_html_a95fc257e5ddf46f7db9d5e898cdf1991"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a95fc257e5ddf46f7db9d5e898cdf1991">bottom</a></div><div class="ttdeci">GLint GLint bottom</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01979">glcorearb.h:1979</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_aa857b95cc76669c2a9109239ef40a47c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aa857b95cc76669c2a9109239ef40a47c">val</a></div><div class="ttdeci">GLuint GLfloat * val</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01582">glcorearb.h:1582</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_abe08814c2f72843fde4d8df41440d5a0"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a></div><div class="ttdeci">GLboolean r</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_ac55adc720a3098c1b454d2a4647f4361"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac55adc720a3098c1b454d2a4647f4361">start</a></div><div class="ttdeci">GLuint start</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00469">glcorearb.h:469</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_ac8729153468b5dcf13f971b21d84d4e5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a></div><div class="ttdeci">GLboolean GLboolean GLboolean GLboolean a</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l01233">glcorearb.h:1233</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_aee38b51639b577753f6a92029fb92000"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#aee38b51639b577753f6a92029fb92000">z</a></div><div class="ttdeci">GLdouble GLdouble GLdouble z</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00843">glcorearb.h:843</a></div></div>
<div class="ttc" id="aglcorearb_8h_html_af48031a37b713afa3b0d0d7d29653d7c"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#af48031a37b713afa3b0d0d7d29653d7c">t1</a></div><div class="ttdeci">GLuint GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat GLfloat t1</div><div class="ttdef"><b>Definition</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05034">glcorearb.h:5034</a></div></div>
<div class="ttc" id="anamespaceo2_1_1constants_1_1lhc_html_a296bf820b93d969ac714d0aa4ea82d7c"><div class="ttname"><a href="../../d5/d46/namespaceo2_1_1constants_1_1lhc.html#a296bf820b93d969ac714d0aa4ea82d7c">o2::constants::lhc::LHCMaxBunches</a></div><div class="ttdeci">constexpr int LHCMaxBunches</div><div class="ttdef"><b>Definition</b> <a href="../../d4/dc6/LHCConstants_8h_source.html#l00031">LHCConstants.h:31</a></div></div>
<div class="ttc" id="anamespaceo2_1_1constants_1_1lhc_html_a2f0abc5677ddad18a3448a16bc191937"><div class="ttname"><a href="../../d5/d46/namespaceo2_1_1constants_1_1lhc.html#a2f0abc5677ddad18a3448a16bc191937">o2::constants::lhc::LHCOrbitMUS</a></div><div class="ttdeci">constexpr double LHCOrbitMUS</div><div class="ttdef"><b>Definition</b> <a href="../../d4/dc6/LHCConstants_8h_source.html#l00037">LHCConstants.h:37</a></div></div>
<div class="ttc" id="anamespaceo2_1_1framework_html_a3a2fc3abf9432c8fb87a3871962852de"><div class="ttname"><a href="../../dd/d8d/namespaceo2_1_1framework.html#a3a2fc3abf9432c8fb87a3871962852de">o2::framework::check</a></div><div class="ttdeci">void check(const std::vector&lt; std::string &gt; &amp;arguments, const std::vector&lt; ConfigParamSpec &gt; &amp;workflowOptions, const std::vector&lt; DeviceSpec &gt; &amp;deviceSpecs, CheckMatrix &amp;matrix)</div><div class="ttdef"><b>Definition</b> <a href="../../d4/de8/test__DeviceSpecHelpers_8cxx_source.html#l00054">test_DeviceSpecHelpers.cxx:54</a></div></div>
<div class="ttc" id="anamespaceo2_1_1math__utils_1_1detail_html_a06b6251b62a6bc134449253ce0046663"><div class="ttname"><a href="../../d4/dbd/namespaceo2_1_1math__utils_1_1detail.html#a06b6251b62a6bc134449253ce0046663">o2::math_utils::detail::bringTo02PiGen</a></div><div class="ttdeci">void bringTo02PiGen(T &amp;phi)</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d7d/trigonometric_8h_source.html#l00069">trigonometric.h:69</a></div></div>
<div class="ttc" id="anamespaceo2_1_1math__utils_1_1detail_html_a6165053352ad91e6afb11940eca08c1b"><div class="ttname"><a href="../../d4/dbd/namespaceo2_1_1math__utils_1_1detail.html#a6165053352ad91e6afb11940eca08c1b">o2::math_utils::detail::phi</a></div><div class="ttdeci">T phi</div><div class="ttdef"><b>Definition</b> <a href="../../dd/d7d/trigonometric_8h_source.html#l00220">trigonometric.h:221</a></div></div>
<div class="ttc" id="anamespaceo2_1_1math__utils_html_a6d56daf9a2b8f1a9d654fd52a0b40559"><div class="ttname"><a href="../../d9/d2e/namespaceo2_1_1math__utils.html#a6d56daf9a2b8f1a9d654fd52a0b40559">o2::math_utils::bringTo02PiGen</a></div><div class="ttdeci">void bringTo02PiGen(float &amp;phi)</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d52/Common_2MathUtils_2include_2MathUtils_2Utils_8h_source.html#l00080">Utils.h:80</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_1_1constants_html_aafb14a7cd1b982bce14d282d9dcfebaf"><div class="ttname"><a href="../../d5/da0/namespaceo2_1_1tpc_1_1constants.html#aafb14a7cd1b982bce14d282d9dcfebaf">o2::tpc::constants::LHCBCPERTIMEBIN</a></div><div class="ttdeci">constexpr int LHCBCPERTIMEBIN</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dda/DataFormats_2Detectors_2TPC_2include_2DataFormatsTPC_2Constants_8h_source.html#l00038">Constants.h:38</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html">o2::tpc</a></div><div class="ttdoc">Global TPC definitions and constants.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dbc/SimTraits_8h_source.html#l00167">SimTraits.h:168</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a10c5a3467cda7fde127dafd46814a4ae"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4ae">o2::tpc::GEMstack</a></div><div class="ttdeci">GEMstack</div><div class="ttdoc">TPC GEM stack types.</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00053">Defs.h:53</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea06f03320c888e86080511a824b996b60">o2::tpc::IROCgem</a></div><div class="ttdeci">@ IROCgem</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00053">Defs.h:53</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a10c5a3467cda7fde127dafd46814a4aea46e1c9be60cbf4a87dabc179218274cd"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea46e1c9be60cbf4a87dabc179218274cd">o2::tpc::OROC1gem</a></div><div class="ttdeci">@ OROC1gem</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00054">Defs.h:54</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea62658b4065ec1fdee024e2861a1c0a74">o2::tpc::OROC3gem</a></div><div class="ttdeci">@ OROC3gem</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00056">Defs.h:56</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a10c5a3467cda7fde127dafd46814a4aea68644cbdd30d74e98dc467bd9a6e9917"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a10c5a3467cda7fde127dafd46814a4aea68644cbdd30d74e98dc467bd9a6e9917">o2::tpc::OROC2gem</a></div><div class="ttdeci">@ OROC2gem</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00055">Defs.h:55</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a27fd5e5e157568a28d5859c3695c4375"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a27fd5e5e157568a28d5859c3695c4375">o2::tpc::getZVertex</a></div><div class="ttdeci">DataT getZVertex(const size_t indexZ, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00061">testO2TPCPoissonSolver.cxx:61</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a29b3fe27b015528948b6f0bae6a92c11"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a29b3fe27b015528948b6f0bae6a92c11">o2::tpc::LocalPosition2D</a></div><div class="ttdeci">math_utils::Point2D&lt; float &gt; LocalPosition2D</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00107">Defs.h:107</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a3681db29cb4bd2e5e2bc538b416fbb9d"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a3681db29cb4bd2e5e2bc538b416fbb9d">o2::tpc::PI</a></div><div class="ttdeci">constexpr double PI</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00043">Defs.h:43</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a3ddcf5bdc94f41edd8795de3b777a46a"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a3ddcf5bdc94f41edd8795de3b777a46a">o2::tpc::getRVertex</a></div><div class="ttdeci">DataT getRVertex(const size_t indexR, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00053">testO2TPCPoissonSolver.cxx:53</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a46d4efacb76f289c08e855e8325c8bc9"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a46d4efacb76f289c08e855e8325c8bc9">o2::tpc::TWOPI</a></div><div class="ttdeci">constexpr double TWOPI</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00044">Defs.h:44</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a64ab5278b1755af95e5ecd8d36409612"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a64ab5278b1755af95e5ecd8d36409612">o2::tpc::SECPHIWIDTH</a></div><div class="ttdeci">constexpr double SECPHIWIDTH</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00045">Defs.h:45</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a6bac13a95694c4c4262455a6803be9ae"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a6bac13a95694c4c4262455a6803be9ae">o2::tpc::SECTORSPERSIDE</a></div><div class="ttdeci">constexpr unsigned char SECTORSPERSIDE</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00040">Defs.h:40</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a7a76ec1f2ac8914d9ab4b6d3c0a3db7b"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a7a76ec1f2ac8914d9ab4b6d3c0a3db7b">o2::tpc::getPhiVertex</a></div><div class="ttdeci">DataT getPhiVertex(const size_t indexPhi, const o2::tpc::RegularGrid3D&lt; DataT &gt; &amp;grid)</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00045">testO2TPCPoissonSolver.cxx:45</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_a93c3023de017de4ec63c5e8f906db287"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#a93c3023de017de4ec63c5e8f906db287">o2::tpc::GlobalPosition3D</a></div><div class="ttdeci">math_utils::Point3D&lt; float &gt; GlobalPosition3D</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00108">Defs.h:108</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ab2729d1c6becc28660e849f6d60456d2"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ab2729d1c6becc28660e849f6d60456d2">o2::tpc::SIDES</a></div><div class="ttdeci">constexpr unsigned char SIDES</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00041">Defs.h:41</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237">o2::tpc::Side</a></div><div class="ttdeci">Side</div><div class="ttdoc">TPC readout sidE.</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00035">Defs.h:35</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a11eb3c467c3ac446e22b26eb91de781e">o2::tpc::A</a></div><div class="ttdeci">@ A</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00035">Defs.h:35</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac07df1734a9d9e9256fa3fde11bfc237a67e6c605fec4b9d571a48f12d471345f">o2::tpc::C</a></div><div class="ttdeci">@ C</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d73/Defs_8h_source.html#l00036">Defs.h:36</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_ac500ba134e1f57d158e7ee4e0f677cde"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#ac500ba134e1f57d158e7ee4e0f677cde">o2::tpc::DataT</a></div><div class="ttdeci">double DataT</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d8c/testO2TPCPoissonSolver_8cxx_source.html#l00031">testO2TPCPoissonSolver.cxx:31</a></div></div>
<div class="ttc" id="anamespaceo2_1_1tpc_html_aef2b3470d9c23d365364d3060d5f68a0"><div class="ttname"><a href="../../d0/d0a/namespaceo2_1_1tpc.html#aef2b3470d9c23d365364d3060d5f68a0">o2::tpc::sum</a></div><div class="ttdeci">DataT sum(const Vector&lt; DataT, N &gt; &amp;a)</div><div class="ttdef"><b>Definition</b> <a href="../../d6/dbe/Vector_8h_source.html#l00107">Vector.h:107</a></div></div>
<div class="ttc" id="anamespaceo2_1_1utils_html_ab00bdc0f94fa861734930fc91cf67e14ad7118865304df8cdfc1d7f6fb8e345eb"><div class="ttname"><a href="../../d0/d28/namespaceo2_1_1utils.html#ab00bdc0f94fa861734930fc91cf67e14ad7118865304df8cdfc1d7f6fb8e345eb">o2::utils::streamDistortionsSC</a></div><div class="ttdeci">@ streamDistortionsSC</div><div class="ttdoc">stream distortions applied in the TPC space-charge class (used for example in the tpc digitizer)</div><div class="ttdef"><b>Definition</b> <a href="../../de/d17/DebugStreamer_8h_source.html#l00039">DebugStreamer.h:39</a></div></div>
<div class="ttc" id="astandalone-cluster-dump-entropy-analysed_8cxx_html_af0baa3ccdd9d2a6adf03b72e2bea5789"><div class="ttname"><a href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx.html#af0baa3ccdd9d2a6adf03b72e2bea5789">file</a></div><div class="ttdeci">const char * file</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d13/standalone-cluster-dump-entropy-analysed_8cxx_source.html#l00052">standalone-cluster-dump-entropy-analysed.cxx:52</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1DataContainer3D_html"><div class="ttname"><a href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html">o2::tpc::DataContainer3D</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/dcd/DataContainer3D_8h_source.html#l00040">DataContainer3D.h:40</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1DataContainer3D_html_a067d56172cdb374ae8c3c9bfd3b0efdc"><div class="ttname"><a href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a067d56172cdb374ae8c3c9bfd3b0efdc">o2::tpc::DataContainer3D::getIndexR</a></div><div class="ttdeci">static size_t getIndexR(size_t index, const int nz, const int nr, const int nphi)</div><div class="ttdef"><b>Definition</b> <a href="../../db/d28/DataContainer3D_8cxx_source.html#l00269">DataContainer3D.cxx:269</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1DataContainer3D_html_a7882ef64d7636ef76cc35d856d06d253"><div class="ttname"><a href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a7882ef64d7636ef76cc35d856d06d253">o2::tpc::DataContainer3D::getIndexZ</a></div><div class="ttdeci">static size_t getIndexZ(size_t index, const int nz, const int nr, const int nphi)</div><div class="ttdef"><b>Definition</b> <a href="../../db/d28/DataContainer3D_8cxx_source.html#l00260">DataContainer3D.cxx:260</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1DataContainer3D_html_a84b1a5d8bcf89a81b4f4d60766e04733"><div class="ttname"><a href="../../de/d48/structo2_1_1tpc_1_1DataContainer3D.html#a84b1a5d8bcf89a81b4f4d60766e04733">o2::tpc::DataContainer3D::getIndexPhi</a></div><div class="ttdeci">static size_t getIndexPhi(size_t index, const int nz, const int nr, const int nphi)</div><div class="ttdef"><b>Definition</b> <a href="../../db/d28/DataContainer3D_8cxx_source.html#l00278">DataContainer3D.cxx:278</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1GEMFrameParameters_html"><div class="ttname"><a href="../../df/d83/structo2_1_1tpc_1_1GEMFrameParameters.html">o2::tpc::GEMFrameParameters</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d58/PoissonSolverHelpers_8h_source.html#l00076">PoissonSolverHelpers.h:76</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1MGParameters_html_a8bd2451ecbb3ffb4ded9e9862b1dffea"><div class="ttname"><a href="../../d0/d32/structo2_1_1tpc_1_1MGParameters.html#a8bd2451ecbb3ffb4ded9e9862b1dffea">o2::tpc::MGParameters::normalizeGridToNSector</a></div><div class="ttdeci">static int normalizeGridToNSector</div><div class="ttdoc">the grid in phi direction is squashed from 2 Pi to (2 Pi / SECTORSPERSIDE). This can used to get the ...</div><div class="ttdef"><b>Definition</b> <a href="../../df/d58/PoissonSolverHelpers_8h_source.html#l00059">PoissonSolverHelpers.h:59</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1ParameterElectronics_html"><div class="ttname"><a href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html">o2::tpc::ParameterElectronics</a></div><div class="ttdef"><b>Definition</b> <a href="../../d3/d47/ParameterElectronics_8h_source.html#l00037">ParameterElectronics.h:37</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1ParameterElectronics_html_a24b4febac39d03dcc5ffd94729979a4c"><div class="ttname"><a href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#a24b4febac39d03dcc5ffd94729979a4c">o2::tpc::ParameterElectronics::ADCdynamicRange</a></div><div class="ttdeci">float ADCdynamicRange</div><div class="ttdoc">Dynamic range of the ADC [mV].</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d47/ParameterElectronics_8h_source.html#l00044">ParameterElectronics.h:44</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1ParameterElectronics_html_a2c55cef75e9f1fd8c3c68d6d5ff5ecbb"><div class="ttname"><a href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#a2c55cef75e9f1fd8c3c68d6d5ff5ecbb">o2::tpc::ParameterElectronics::ADCsaturation</a></div><div class="ttdeci">float ADCsaturation</div><div class="ttdoc">ADC saturation [ADC counts].</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d47/ParameterElectronics_8h_source.html#l00045">ParameterElectronics.h:45</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1ParameterElectronics_html_aa8489337f7572584b43993fe1db33c13"><div class="ttname"><a href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#aa8489337f7572584b43993fe1db33c13">o2::tpc::ParameterElectronics::ElectronCharge</a></div><div class="ttdeci">float ElectronCharge</div><div class="ttdoc">Electron charge [C].</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d47/ParameterElectronics_8h_source.html#l00047">ParameterElectronics.h:47</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1ParameterElectronics_html_afd173cc796cf70490714b86310274ccd"><div class="ttname"><a href="../../df/d41/structo2_1_1tpc_1_1ParameterElectronics.html#afd173cc796cf70490714b86310274ccd">o2::tpc::ParameterElectronics::ChipGain</a></div><div class="ttdeci">float ChipGain</div><div class="ttdoc">Gain of the SAMPA [mV/fC] - may be either 20 or 30.</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d47/ParameterElectronics_8h_source.html#l00043">ParameterElectronics.h:43</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1RegularGridHelper_html"><div class="ttname"><a href="../../d1/d04/structo2_1_1tpc_1_1RegularGridHelper.html">o2::tpc::RegularGridHelper</a></div><div class="ttdoc">helper struct to store and set RegularGrid3D</div><div class="ttdef"><b>Definition</b> <a href="../../d3/dad/RegularGrid3D_8h_source.html#l00032">RegularGrid3D.h:32</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1SCMetaData_html"><div class="ttname"><a href="../../d1/d58/structo2_1_1tpc_1_1SCMetaData.html">o2::tpc::SCMetaData</a></div><div class="ttdef"><b>Definition</b> <a href="../../d5/d0c/SpaceChargeHelpers_8h_source.html#l00033">SpaceChargeHelpers.h:33</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1TPCParameters_html"><div class="ttname"><a href="../../d6/d80/structo2_1_1tpc_1_1TPCParameters.html">o2::tpc::TPCParameters</a></div><div class="ttdef"><b>Definition</b> <a href="../../df/d58/PoissonSolverHelpers_8h_source.html#l00063">PoissonSolverHelpers.h:63</a></div></div>
<div class="ttc" id="astructo2_1_1tpc_1_1painter_html_a30ee13e309499dfd21d3473e03ba3f9a"><div class="ttname"><a href="../../d7/dbe/structo2_1_1tpc_1_1painter.html#a30ee13e309499dfd21d3473e03ba3f9a">o2::tpc::painter::convertCalDetToTH3</a></div><div class="ttdeci">static TH3F convertCalDetToTH3(const std::vector&lt; CalDet&lt; DataT &gt; &gt; &amp;calDet, const bool norm=true, const int nRBins=150, const float rMin=83.5, const float rMax=254.5, const int nPhiBins=720, const float zMax=1)</div></div>
<div class="ttc" id="atest__Algorithm_8cxx_html_af9148b2bd92671329b9006d442f39cf3"><div class="ttname"><a href="../../d2/d0e/test__Algorithm_8cxx.html#af9148b2bd92671329b9006d442f39cf3">other</a></div><div class="ttdeci">VectorOfTObjectPtrs other</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d0e/test__Algorithm_8cxx_source.html#l00501">test_Algorithm.cxx:501</a></div></div>
<div class="ttc" id="atest__ctf__io__cpv_8cxx_html_a1ef7964b771b9b29688dfa8810b27d00"><div class="ttname"><a href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a1ef7964b771b9b29688dfa8810b27d00">LOG</a></div><div class="ttdeci">LOG(info)&lt;&lt; &quot;Compressed in &quot;&lt;&lt; sw.CpuTime()&lt;&lt; &quot; s&quot;</div></div>
<div class="ttc" id="atest__ctf__io__cpv_8cxx_html_a6d8bd09dd9b0133de63b5f568da3a653"><div class="ttname"><a href="../../dc/da7/test__ctf__io__cpv_8cxx.html#a6d8bd09dd9b0133de63b5f568da3a653">ir</a></div><div class="ttdeci">o2::InteractionRecord ir(0, 0)</div></div>
<div class="ttc" id="atest__ctf__io__cpv_8cxx_html_af35588954eba20a68d7784c5900333d6"><div class="ttname"><a href="../../dc/da7/test__ctf__io__cpv_8cxx.html#af35588954eba20a68d7784c5900333d6">tree</a></div><div class="ttdeci">std::unique_ptr&lt; TTree &gt; tree((TTree *) flIn.Get(std::string(o2::base::NameConf::CTFTREENAME).c_str()))</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_a597e8e061b11201a1dff411feb10d0b.html">TPC</a></li><li class="navelem"><a class="el" href="../../dir_eb851ed57c05376a3db13e33864acbb2.html">spacecharge</a></li><li class="navelem"><a class="el" href="../../dir_5baa4b952cbb1daf3a28665e1d18d3fd.html">src</a></li><li class="navelem"><a class="el" href="../../da/d8e/SpaceCharge_8cxx.html">SpaceCharge.cxx</a></li>
    <li class="footer">Generated on Sat Feb 21 2026 17:58:51 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
