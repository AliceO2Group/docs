<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Tracking</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/df6/refDetectorsMUONMCHTracking.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tracking</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>MCH Tracking</h1>
<ul>
<li>TrackExtrap.h(cxx)</li>
<li>TrackFitter.h(cxx)</li>
<li>TrackFinderOriginal.h(cxx)</li>
<li>TrackFinder.h(cxx)</li>
<li>Workflows<ul>
<li>Track fitter</li>
<li>Track finder</li>
</ul>
</li>
<li>Examples of workflow</li>
</ul>
<h2>TrackExtrap.h(cxx)</h2>
<p>Contains all the tools to:</p><ul>
<li>extrapolate the track parameters (and covariances) from one z position to another, taking into account or not the magnetic field.</li>
<li>add the dispersion from Multiple Coulomb Scattering (MCS) to the covariance matrix when crossing a tracking chamber.</li>
<li>extrapolate the track parameters (and covariances) through the front absorber, taking into account (or not) the effects from MCS and energy loss.</li>
</ul>
<h2>TrackFitter.h(cxx)</h2>
<p>Fit a track to the clusters attached to it, using the Kalman Filter.</p>
<h3>Short description of the algorithm</h3>
<p>The seeds for the track parameters and covariances are computed using the position and resolution of the 2 clusters in the last two fired chambers. An estimate of the bending momentum is obtained by assuming that the track is coming from the vertex (0,0,0) and crosses a constant magnetic field (both with sufficiently large uncertainties to do not bias the final result). The initial track parameters and covariances are then propagated to every clusters, up to the most upstream one, and are updated at each step by "attaching" the cluster with the Kalman filter. The dispersion from MCS is added to the covariances each time a chamber is crossed. This algorithm gives the track parameters and covariances at the first cluster (the last attached one). Optionally, the Smoother algorithm can be run to fit back the track and compute the track parameters and covariances at every clusters. If the pointer to the parameters at one of the attached clusters is given, the fit is resumed starting from this point.</p>
<h2>TrackFinderOriginal.h(cxx)</h2>
<p>This is a reimplementation of the original tracking algorithm from AliRoot.</p>
<h3>Input / Output</h3>
<p>It takes as input a list of reconstructed clusters, the clusters' position being given in the global coordinate system. It returns the list of reconstructed tracks, each of them containing (in the TrackParams) the pointers to the associated clusters.</p>
<h3>Short description of the algorithm</h3>
<p>The original tracking algorithm is described in detail here: <a href="https://edms.cern.ch/ui/file/1054937/1/ALICE-INT-2009-044.pdf">https://edms.cern.ch/ui/file/1054937/1/ALICE-INT-2009-044.pdf</a></p>
<p>The main difference with the original implementation is in the order the tracking of the initial candidates (made of clusters in stations 4&amp;5) is performed. In the original implementation, all candidates are propagated to station 3 to search for compatible clusters, tracks are duplicated to consider all possibilities, then all candidates are propagated to station 2, and so on. In some events with very high multiplicity, it results in a temporarily huge number of candidates in memory at the same time (&gt;10000) and a limitation is needed to abort the tracking in such case to do not break the reconstruction. In the new implementation, each candidate is treated one by one. The current candidate is propagated to station 3 to search for compatible clusters, duplicated to consider every posibilities, then each of them is tracked one by one to station 2, then to station 1. This limits drastically the number of candidates in memory at the same time, thus avoiding to abort the tracking for any event, while reconstructing exactly the same tracks in the end.</p>
<h2>TrackFinder.h(cxx)</h2>
<p>This is the implementation of the new tracking algorithm.</p>
<h3>Input / Output</h3>
<p>It takes as input a list of reconstructed clusters, the clusters' position being given in the global coordinate system. It returns the list of reconstructed tracks, each of them containing (in the TrackParams) the pointers to the associated clusters.</p>
<h3>Short description of the algorithm</h3>
<h4>General ideas to improve the original algorithm:</h4>
<ul>
<li>Consider the overlaps between DE on the same chamber during the tracking (the original algorithm considers only one cluster per chamber during the tracking, duplicating the tracks with 2 clusters in overlapping DE to consider both), so there is no need to complete the tracks to add the missing clusters afterward and to cleanup the duplicates. We assume there is no overlap between the 2 half-planes of chambers 5 to 10.</li>
<li>Do not try to recover tracks by removing one of the previously attached clusters in the previous station if no compatible cluster is found in the current one. Assume that a good track will not be lost if several clusters are attached in a station and some of them are bad (i.e. not belonging to that track).</li>
<li>Further reduce the number of track duplication and memory consumption by pursuing the tracking of the current candidate with the newly found compatible clusters down to station 1, or until the tracking fails, before testing other clusters, so that we duplicate the original candidate only to store valid complete tracks.</li>
<li>Speedup the cleanup of connected tracks in the end by reducing the number of imbricated loops.</li>
<li>Speedup the track extrapolation in the magnetic field by reducing the number of steps to reach to desired z position.</li>
</ul>
<h4>Algorithm:</h4>
<ul>
<li>Build candidates on station 5 starting from pairs of clusters on chambers 9 and 10 and looking for compatible clusters in overlap DE. Consider every combinations of different clusters and discard candidates whose parameters are outside of acceptance limits within uncertainties.</li>
<li>Propagate the candidates to station 4 and look for compatible clusters, taking into account overlaps. At least one cluster is requested and the track is duplicated to consider every possibilities, eliminating the ones driving the track parameters outside of acceptance limits within uncertainties.</li>
<li>Repeat the two steps above starting from station 4 then going to station 5 to look for additional candidates with only one chamber fired on station 5.</li>
<li>Propagate each candidate found in the previous steps from chamber 6 to 1, looking for compatible clusters taking into account the overlaps. This is a recursive procedure. For each cluster or couple of clusters found on one chamber, the current parameters of the initial candidate are updated and the tracking continue to the next chamber, and so on and so forth, until chamber 1 or until the tracking fails (at least one cluster per station is requested to continue). Only at the end, when/if the track reaches the first station, it is duplicated and the clusters found in the process are attached to the new track. Clusters that drive the track parameters outside of acceptance limits within uncertainties are discarded.</li>
<li>Improve the tracks: run the smoother to recompute the local chi2 at each cluster, remove the worst cluster if it does not pass a stricter chi2 cut, refit the track and repeat the procedure until all clusters pass the cut or one of them cannot be removed without violating the tracking conditions (by default, the track must contain at least 1 cluster per station and both chambers fired on station 4 or 5), in which case the track is removed.</li>
<li>Remove connected tracks in station 3, 4 and 5. If two tracks share at least one cluster in these stations, remove the one with the smallest number of fired chambers or with the highest chi2/(ndf-1) in case of equality, assuming it is a fake track.</li>
</ul>
<p>In all stations, the search for compatible clusters is done in a way to consider every possibilities, i.e. every combinations of 1 to 4 clusters, while skipping the already tested combinations. This includes subsets of previously found combinations, so that we always attach the maximum number of clusters to a candidate (e.g. if we can attach 4 clusters in one station because of the overlaps, we do not consider the possibility to attach only 3, 2, or 1 of them even if the track would still be valid).</p>
<p><a class="el" href="../../d2/d88/classA.html">A</a> more detailed description of the various parts of the algorithm is given in the code itself.</p>
<h4>Available options:</h4>
<ul>
<li>Find more track candidates, with only one chamber fired on station 4 and one on station 5, taking into account the overlaps between DE and excluding those whose parameters are outside of acceptance limits within uncertainties.</li>
<li>Do not request certain stations. When building initial candidates on stations 4 and 5, it means to keep the candidates found on station 5(4) even if no compatible cluster is found on station 4(5) if that station is not requested. However, if one or more compatible clusters are found we do not consider the possibility to do not attach any cluster on that station. When tracking the candidates to station 3 to 1, it means to consider the possibility to continue the tracking without attaching any cluster on the station that is not requested, even if compatible clusters are found on that station. However the clusters found upstream after having attached cluster(s) on that station are skipped.</li>
</ul>
<h2>Workflows</h2>
<h3>Track fitter</h3>
<div class="fragment"><div class="line">o2-mch-tracks-to-tracks-workflow</div>
</div><!-- fragment --><p>Take as input the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the current time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction, with the data description "TRACKSIN", "TRACKCLUSTERSIN" and "TRACKROFSIN", respectively. Send the list of all refitted MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction in three separate messages with the data description "TRACKS", "TRACKCLUSTERS" and "TRACKROFS", respectively.</p>
<h4>Workflow / Spec options:</h4>
<p><code>--l3Current xxx</code> and <code>--dipoleCurrent yyy</code> allow to specify the current in L3 and in the dipole to be used to set the magnetic field.</p>
<h3>Track finder</h3>
<div class="fragment"><div class="line">o2-mch-clusters-to-tracks-workflow</div>
</div><!-- fragment --><p>Take as input the list of all clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>) in the current time frame, with the data description "CLUSTERS", and the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the clusters associated to each interaction, with the data description "CLUSTERROFS". Send the list of all MCH tracks (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/TrackMCH.h">TrackMCH</a>) in the time frame, the list of all associated clusters (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Cluster.h">Cluster</a>), the list of ROF records (<a href="../../../../../../DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/ROFRecord.h">ROFRecord</a>) pointing to the tracks associated to each interaction and the list of processing errors (<a href="../../../Base/include/MCHBase/Error.h">Error</a>) in four separate messages with the data description "TRACKS", "TRACKCLUSTERS", "TRACKROFS" and "TRACKERRORS", respectively. Depending on the options, it may also need as input the list of digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) associated to clusters, with the data description "CLUSTERDIGITS", and send the list of digits (<a href="../..//DataFormats/Detectors/MUON/MCH/include/DataFormatsMCH/Digit.h">Digit</a>) associated to tracks, with the data description "TRACKDIGITS".</p>
<h4>Workflow / Spec options:</h4>
<p><code>--original</code> allows to use the original track finding algorithm (the new one is used by default).</p>
<p><code>--disable-magfield-from-ccdb</code> allows to disable the loading of the magnetic field from the CCDB. In this case, the magnetic field is loaded from the GRP file if available. Otherwise, it is created using the provided currents in L3 and in the dipole.</p>
<p><code>--grp-file</code> allows to set the name of the GRP file containing the magnetic field.</p>
<p><code>--l3Current xxx</code> and <code>--dipoleCurrent yyy</code> allow to specify the current in L3 and in the dipole to be used to set the magnetic field.</p>
<p><code>--disable-time-computation</code> allows to disable the computation of the track time from the associated digits. Instead, the track time is set to cover the ROF duration.</p>
<p><code>--digits</code> allows to send the list of digits associated to the tracks.</p>
<p><code>--debug x</code> allows to enable the debug level x (0 = no debug, 1 or 2).</p>
<p><code>--mch-config "file.json"</code> or <code>--mch-config "file.ini"</code> allows to change the tracking parameters from a configuration file. This file can be either in JSON or in INI format, as described below:</p>
<ul>
<li>Example of configuration file in JSON format: <div class="fragment"><div class="line">{</div>
<div class="line">    &quot;MCHTracking&quot;: {</div>
<div class="line">        &quot;chamberResolutionY&quot;: &quot;0.1&quot;,</div>
<div class="line">        &quot;requestStation[1]&quot;: &quot;false&quot;,</div>
<div class="line">        &quot;moreCandidates&quot;: &quot;true&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Example of configuration file in INI format: <div class="fragment"><div class="line">[MCHTracking]</div>
<div class="line">chamberResolutionY=0.1</div>
<div class="line">requestStation[1]=false</div>
<div class="line">moreCandidates=true</div>
</div><!-- fragment --></li>
</ul>
<p><code>--configKeyValues "key1=value1;key2=value2;..."</code> allows to change the tracking parameters from the command line. The parameters changed from the command line will supersede the ones changed from a configuration file.</p>
<ul>
<li>Example of parameters changed from the command line: <div class="fragment"><div class="line">--configKeyValues &quot;MCHTracking.chamberResolutionY=0.1;MCHTracking.requestStation[1]=false;MCHTracking.moreCandidates=true&quot;</div>
</div><!-- fragment --></li>
</ul>
<h2>Examples of workflow</h2>
<ul>
<li>The line below allows to read the clusters from the file <code>clusters.in</code>, run the new tracking algorithm, read the associated vertex from the file <code>vertices.in</code>, extrapolate the tracks to the vertex and write the result (tracks at vertex, MCH tracks and associated clusters) in the file <code>tracks.out</code>:</li>
</ul>
<div class="fragment"><div class="line">o2-mch-clusters-sampler-workflow --infile &quot;clusters.in&quot; --global | o2-mch-clusters-to-tracks-workflow --disable-magfield-from-ccdb --l3Current 29999.998047 --dipoleCurrent 5999.966797 | o2-mch-vertex-sampler-workflow --infile &quot;vertices.in&quot; | o2-mch-tracks-to-tracks-at-vertex-workflow --l3Current 29999.998047 --dipoleCurrent 5999.966797 | o2-mch-tracks-sink-workflow --outfile &quot;tracks.out&quot;</div>
</div><!-- fragment --><ul>
<li>The line below allows to read the MCH tracks and associated clusters from the file <code>tracks.in</code>, refit them and write them in the file <code>tracks.out</code>:</li>
</ul>
<div class="fragment"><div class="line">o2-mch-tracks-sampler-workflow --infile &quot;tracks.in&quot; --forTrackFitter | o2-mch-tracks-to-tracks-workflow --l3Current -30000.025391 --dipoleCurrent -5999.954590 | o2-mch-tracks-sink-workflow --outfile &quot;tracks.out&quot; --mchTracksOnly</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dff/refDetectorsMUON.html">MUON</a></li><li class="navelem"><a class="el" href="../../d0/daf/refDetectorsMUONMCH.html">MCH</a></li>
    <li class="footer">Generated on Sat Feb 21 2026 17:59:16 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
