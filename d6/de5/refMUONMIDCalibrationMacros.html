<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: MID Calibration macros</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/de5/refMUONMIDCalibrationMacros.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MID Calibration macros</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>MID calibration macros</h1>
<p>This repository contains macros that can be used to handle calibration objects in the CCDB.</p>
<h2>ccdbUtils.C</h2>
<p>This macro allows to query a series of MID CCDB objects in the CCDB as well as produce default objects. The basic usage is the following:</p>
<p>Query the list of bad channels from the official CCDB:</p>
<div class="fragment"><div class="line">root -l</div>
<div class="line">.x ccdbUtils.C(&quot;querybad&quot;,1721252719000,&quot;mask.txt&quot;,true,&quot;http://alice-ccdb.cern.ch&quot;)</div>
</div><!-- fragment --><p>Upload the default list of fake dead channels to the local CCDB (assuming that an instance of the local CCDB is running, see below):</p>
<div class="fragment"><div class="line">root -l</div>
<div class="line">.x ccdbUtils.C(&quot;uploadfake&quot;,1,&quot;mask.txt&quot;,true,&quot;localhost:8080&quot;)</div>
</div><!-- fragment --><p>The macro is also used to keep track of the fake dead channels, which are generated in <code>makeFakeDeadChannels()</code>.</p>
<h2>build_rejectList.C</h2>
<p>This macro analyses the quality flag and the occupancy plots in the QCCDB and searches for issues appearing in the middle of the run, e.g. local board(s) that become noisy and are then excluded from the data taking by the user logic of the CRU. It then correlates this information with the GRPECS object in the CCDB in order to create a reject list that will allow to mask the faulty local board(s) from slightly before the problem appeared till the end of the run.</p>
<p>If a problem is found, the macro will ask to upload the reject list in the local CCDB. For this, one needs to have the local CCDB up and running (see below).</p>
<p>The scan can be then performed with:</p>
<div class="fragment"><div class="line">root -l</div>
<div class="line">.x build_rejectlist.C+(1716436103391,1721272208000)</div>
</div><!-- fragment --><p>Where the first number is the start timestamp for the scan, and the second is the end timestamp of the scan.</p>
<h3>Running outside CERN network</h3>
<p>Notice that the QCDB is not directly reachable from outside CERN network. In that case one needs to first create an ssh tunnel:</p>
<div class="fragment"><div class="line">ssh -L 8083:ali-qcdb-gpn.cern.ch:8083 lxtunnel.cern.ch</div>
</div><!-- fragment --><p>and then tell the macro to reach the QCDB via the tunneled local port:</p>
<div class="fragment"><div class="line">root -l</div>
<div class="line">.x build_rejectlist.C+(1716436103391,1721272208000,&quot;localhost:8083&quot;)</div>
</div><!-- fragment --><h3>Add custom bad channels</h3>
<p>The macro <code>build_rejectlist.C</code> scans the QCDB and the CCDB in search of issues. However, the QCDB flag is based on local boards with empty signals. It can happen that a local board is problematic, but not completely dead and, therefore, it is not correctly spotted by the macro. It is therefore important to have a way to add the issues by hand. This can be done with a json file in the form:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;startRun&quot;: 557251,</div>
<div class="line">    &quot;endRun&quot;: 557926,</div>
<div class="line">    &quot;startTT&quot;: 1726300235000,</div>
<div class="line">    &quot;endTT&quot;: 1726324000000,</div>
<div class="line">    &quot;rejectList&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;deId&quot;: 4,</div>
<div class="line">            &quot;columnId&quot;: 2,</div>
<div class="line">            &quot;patterns&quot;: [</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0xFFFF&quot;,</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0x0&quot;</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;deId&quot;: 13,</div>
<div class="line">            &quot;columnId&quot;: 2,</div>
<div class="line">            &quot;patterns&quot;: [</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0xFFFF&quot;,</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0x0&quot;,</div>
<div class="line">                &quot;0x0&quot;</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Where <code>startTT</code> and <code>endTT</code> are the timestamps in which the manual reject list will be built. To use the timestamps of start/end of the specified runs set <code>startTT</code> and <code>endTT</code> to 0 (or do not include them in the json).</p>
<p>The path to the file is then given to the macro with:</p>
<div class="fragment"><div class="line">.x build_rejectlist.C+(1726299038000,1727386238000,&quot;http://localhost:8083&quot;,&quot;http://alice-ccdb.cern.ch&quot;,&quot;http://localhost:8080&quot;,&quot;rejectlist.json&quot;)</div>
</div><!-- fragment --><p>The macro will then merge the manual reject list from the file with the reject list that it finds by scanning the QCDB and CCDB.</p>
<h2>Running the local CCDB</h2>
<p>The local CCDB server can be easily built through alibuild. As usual, one needs to be in the directory containing alidist and then run:</p>
<div class="fragment"><div class="line">aliBuild build localccdb</div>
</div><!-- fragment --><p>The CCDB server can be then run with:</p>
<div class="fragment"><div class="line">alienv enter localccdb/latest</div>
<div class="line">startccdb -r &quot;path_to_local_ccdb&quot;</div>
</div><!-- fragment --><p>where <code>path_to_local_ccdb</code> is a directory in your local pc where the CCDB objects will be located. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
