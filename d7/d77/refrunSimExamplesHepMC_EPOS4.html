<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Example HepMC_EPOS4</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d77/refrunSimExamplesHepMC_EPOS4.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example HepMC_EPOS4</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The usage of EPOS4 with the O2 machinery is presented in this short manual. An in-depth explanation of the mechanisms behind the HepMC(3) data handling can be found in the HepMC_fifo folder of the MC examples. The scripts use the <code>cmd</code> parameter of <code>GeneratorHepMC</code> to spawn the EPOS4 generation via the <code>epos.sh</code> script.</p>
<p>EPOS 4.0.0 uses the outdated HepMC2 libraries, so this had to be specified in the steering scripts of the generators configuration. If <code>HepMC.version=2</code> is removed then the scripts will not work anymore. This is to say that the balance achieved with the configurations provided is easily destroyed if the user base edits parts that are not understood completely. The latest EPOS 4.0.3 and EPOS4HQ both use <a class="el" href="../../dc/dd2/namespaceHepMC3.html">HepMC3</a>, so the version is automatically updated when these generators are used.</p>
<h1>Scripts description</h1>
<p>Four scripts are available to run the simulations</p><ul>
<li><b>epos.sh</b> &rarr; starts the actual EPOS4 generation</li>
<li><b>runo2sim.sh</b> &rarr; allows the generation of events using o2-sim</li>
<li><b>rundpg.sh</b> &rarr; starts the DPG machinery for event generation</li>
<li><b>rundpl.sh</b> &rarr; starts the event generation with DPL</li>
</ul>
<p>In addition an example.optns file is provided to start EPOS4, but more can be found in the generator example folder or in the website <a href="https://epos4learn.docs.cern.ch/">epos4learn.web.cern.ch</a> where an extensive tutorial on the generator is provided.</p>
<h2>epos.sh</h2>
<p>It can be run without the help of the other scripts to simply generate an .hepmc file or print to the stdout the HepMC results. It it worth nothing though that EPOS4 must be loaded (via cvmfs through AliGenerators or O2sim for example) or installed. In this case the user should simply redirect the stdout to a file: </p><div class="fragment"><div class="line">./epos.sh -i test -s 234345 &gt; test.hepmc</div>
</div><!-- fragment --><p> This example shows all the functionalities of the script (which are implemented in a similar way inside the generation steering scripts). In particular the <code>-i</code> flag allows to provide .optns parameters to EPOS4, <code>-s</code> feeds the generator with a user seed, and the HepMC output is given by test.hepmc by redirecting the stdout which will contain only the HepMC data thanks to the <code>-hepstd</code> flag set automatically in epos.sh and the <code>set ihepmc 2</code> option which <b>MUST</b> be set in the option file (otherwise either an hepmc file will be created - ihepmc 1 - or nothing will be generated - missing ihepmc or != 1|2 ).</p>
<p>It is important to note that setting an empty/null seed in the generator out of the box makes EPOS4 crash, so a protection was added in our steering epos.sh script which now generates a random number if 0 is provided.</p>
<h2>runo2sim.sh, rundpg.sh and rundpl.sh</h2>
<p>The three scripts have little differences (especially in the first part), so they will be described together. They work after loading any O2sim version after the 20/09/2024 (included), since multiple modifications had to be performed on both EPOS4 and the introduction of AliGenO2 in order to be able to load both O2sim and EPOS4 simultaneously.</p>
<p>If no parameters are provided to the scripts, they will run with default values (energy and nevents provided in the example.optns file), but few flags are available to change the settings of the generation:</p><ul>
<li><b>-m , &ndash;more</b> &rarr; feeds the simulation with advanced parameters provided to the configuration key flags</li>
<li><b>-n , &ndash;nevents</b> &rarr; changes the number of events in the .optns file or gets the one in the file if no events are provided</li>
<li><b>-i , &ndash;input</b> &rarr; .optns filename to feed EPOS4, no extension must be set in the filename</li>
<li><b>-j , &ndash;jobs</b> &rarr; sets the number of workers (jobs)</li>
<li><b>-hq</b> &rarr; enables EPOS4HQ generation</li>
<li><b>-h , &ndash;help</b> &rarr; prints usage instructions</li>
<li><b>-e , &ndash;ecm</b> &rarr; sets the center-of-mass energy in the options file</li>
</ul>
<p>In the <code>rundpg.sh</code> script an additional flag is available</p><ul>
<li><b>-t , &ndash;tf</b> &rarr; number of timeframes to be generated</li>
</ul>
<p>In this case the options file will be copied in each tf$n folder, otherwise the epos script won't be able to run with multiple timeframes. In o2sim and DPG scripts the randomly generated seed is set directly, instead this is not feasible with the DPL one, given that the &ndash;seed option is not able to redirect this number to GeneratorHepMC. So a seed 0 is automatically given to epos.sh which generates a random number in return.</p>
<p>Now the three scripts start to differ:</p>
<ul>
<li><b>runo2sim.sh</b> &rarr; o2-sim is launched</li>
<li><b>rundpg.sh</b> &rarr; first the o2dpg_sim_workflow.py script will be launched generating the json configuration, then the o2_dpg_workflow_runner.py script will start the workflow</li>
<li><b>rundpl.sh</b> &rarr; o2-sim-dpl-eventgen is executed piping its results to o2-sim-mctracks-to-aod and afterwards to o2-analysis-mctracks-to-aod-simple-task</li>
</ul>
<p>The last few lines of the scripts contain the execution of o2-sim, DPG worflow creator/runner and DPL software respectively, so this part can be modified by the users following their requirements. It's important not to delete from the configuration keys <code>GeneratorFileOrCmd.cmd=$cmd -i $optns;GeneratorFileOrCmd.bMaxSwitch=none$HEPMC;</code> and it would be better to provide additional configurations via the -m flag. EPOS4 cannot set a maximum impact parameter value, so it's better to leave the bMaxSwitch to none, while the others serve the sole purpose of running successfully the generator using auto generated FIFOs. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d0b/refrun.html">Module &#39;run&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dc9/refrunSimExamples.html">Simulation Examples</a></li>
    <li class="footer">Generated on Fri Oct 31 2025 12:28:23 for Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
